import{i as O,j as h,x as L,l as Q,a2 as H,au as Y,av as z,aw as q,ax as $,ay as K,h as V,e as j,g as W,k as C,t as R,o as c,z as A,p as o,v as U,R as T,y as G,az as J,A as D,d as E,b as _,_ as I,ab as X,a as B,an as Z,q as S,T as ee,K as te,U as oe,C as M,Q as N,aA as se,aB as ae,aC as ie,f as ne,w as re,D as le,aD as ce,L as ue,M as de}from"../bundle.js";const pe=u=>{const t=O(),{collections:l,fetchBlogPost:f,checkBlogPostForUnreadReactions:b}=t,{blogPosts:P,blogReactions:m,isBlogPostDatabaseActionActive:r}=h(t);let p=[];const y=L(),d=s=>{s.metadata.hasPendingWrites||r.value||(clearTimeout(y.value),y.value=setTimeout(async()=>{await f(u.id,void 0,{loadingIndicator:!1}),b(P.value.previousData.single,!0)},200))};Q(async()=>{m.value.unread=m.value.unread.filter(x=>x.postId!==u.id);const s=H(u),e=l.blogPosts(s.isPrivate),a=l.blogReactions(s.isPrivate),i=Y(e,u.id),g=z(e,q("id","==",u.id)),k=z(a,q("post","==",i));p.push($(g,d)),p.push($(k,d))}),K(()=>{clearTimeout(y.value),p.forEach(s=>{s()})})},Pe=()=>{const u=O(),t=V(),{visibleBlogPosts:l,blogReactions:f,isBlogPostDatabaseActionActive:b}=h(u),{firebaseUser:P,isLoggedIn:m}=h(t),{collections:r,fetchBlogPosts:p,checkBlogPostsForUnreadReactions:y}=u;let d=[];const s=L(),e=a=>{a.metadata.hasPendingWrites||b.value||(clearTimeout(s.value),s.value=setTimeout(async()=>{var i;l.value.length&&(await p((i=P.value)==null?void 0:i.uid,{amount:l.value.length,loadingIndicator:!1}),y())},200))};Q(()=>{f.value.unread=[],d.push($(r.blogPosts(!1),e)),d.push($(r.blogReactions(!1),e)),m.value&&(d.push($(r.blogPosts(!0),e)),d.push($(r.blogReactions(!0),e)))}),K(()=>{clearTimeout(s.value),d.forEach(a=>{a()})})},ge={class:"flex flex-col gap-2"},F=j({__name:"BlogReaction",props:{post:{},reaction:{}},setup(u){const t=u,l=W(),f=V(),b=O(),{routeLoading:P,routeLoadingId:m}=h(l),{firebaseUser:r,isLoggedIn:p,isOwner:y}=h(f),{blogReactions:d}=h(b),{deleteBlogReaction:s}=b,e=C(()=>r.value&&t.reaction.user.id===r.value.uid||y.value);return(a,i)=>(c(),R(A,{id:t.reaction.id,class:U(["p-5 w-full md:w-3/4 xl:w-2/3",t.post.colorTertiary,t.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":o(P)===o(T).USER_DETAILS&&o(m)===t.reaction.user.id}},title:t.reaction.user.displayName||"Unknown user",subTitle:o(G)(t.reaction.date),avatar:t.reaction.user.avatar,route:o(p)?{name:o(T).USER_DETAILS,params:{userId:t.reaction.user.id}}:void 0,avatarRoute:o(p)?{name:o(T).USER_DETAILS,params:{userId:t.reaction.user.id}}:void 0,description:t.reaction.message},J({_:2},[e.value?{name:"right",fn:D(()=>[E("div",ge,[e.value&&!t.post.locked?(c(),R(I,{key:0,variant:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:o(d).isDatabaseDeletionActive,onClick:i[0]||(i[0]=g=>o(s)(t.reaction.id,t.post))},null,8,["disabled"])):_("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),ve={class:"grid justify-items-center p-5 gap-5"},me=j({__name:"BlogReactions",props:{post:{}},setup(u){const t=u,l=W(),f=V(),b=O(),{content:P}=h(l),{firebaseUser:m,isLoggedIn:r}=h(f),{blogReactions:p}=h(b),{createBlogReaction:y}=b,d=L(),s=L(!1),e=X({reaction:{value:"",error:""}}),a=C(()=>[...t.post.reactions].reverse()),i=C(()=>a.value.filter((n,v)=>v<3)),g=C(()=>a.value.filter((n,v)=>v>=3)),k=C(()=>t.post.locked||!r.value||p.value.isDatabaseCreationActive),x=async()=>{if(!p.value.isDatabaseCreationActive){if(await d.value.test(),!e.reaction.error&&m.value){const n=e.reaction.value;e.reaction.value="Replying...";const v=await y(t.post,{userId:m.value.uid,postId:t.post.id,message:n,date:new Date});e.reaction.value=v?"":n}ie()}};return(n,v)=>(c(),B("form",{action:"",onSubmit:Z(x,["prevent"])},[E("div",ve,[!o(r)||n.post.reactions.filter(w=>w.user.id===o(m).uid).length<20?(c(),R(A,{key:0,class:U(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",n.post.colorTertiary||"bg-secondary-700",n.post.opacityTertiary||"bg-opacity-25"])},{default:D(()=>[S(ee,{class:"w-5/6",id:n.post.id,inputProps:{class:["!bg-neutral-900 rounded-primary border-none !placeholder-gray-300",n.post.colorSecondary||n.post.colorPrimary||"bg-secondary-600",n.post.opacitySecondary||"!bg-opacity-20",k.value?{"!bg-gray-900 !bg-opacity-50":!o(p).isDatabaseCreationActive}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!o(r)&&!n.post.locked}],disabled:k.value,autocomplete:"off"},ref_key:"reaction",ref:d,name:"reaction",placeholder:n.post.locked?"Locked for comments":o(r)?"Reply":o(P).blogLoginGuest,modelValue:e.reaction.value,"onUpdate:modelValue":v[0]||(v[0]=w=>e.reaction.value=w),error:e.reaction.error,"onUpdate:error":v[1]||(v[1]=w=>e.reaction.error=w),rules:[o(oe).Required],onClick:v[2]||(v[2]=()=>!o(r)&&!n.post.locked?o(te).push({name:o(T).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):_("",!0),(c(!0),B(M,null,N(i.value,w=>(c(),R(F,{post:n.post,reaction:w},null,8,["post","reaction"]))),256)),(c(!0),B(M,null,N(g.value,w=>se((c(),R(F,{post:n.post,reaction:w},null,8,["post","reaction"])),[[ae,s.value]])),256)),n.post.reactions.length>3?(c(),R(I,{key:1,outlined:"",icon:s.value?"pi pi-angle-up":"pi pi-angle-down",label:s.value?"Hide older reactions":"View older reactions",onClick:v[3]||(v[3]=w=>s.value=!s.value)},null,8,["icon","label"])):_("",!0)])],32))}}),fe={class:"flex flex-wrap justify-end h-fit gap-3"},be=j({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(u){return(t,l)=>(c(),B("div",fe,[S(I,{class:"min-w-80",label:"Edit",onClick:l[0]||(l[0]=f=>t.$emit("editClicked"))}),S(I,{class:"min-w-80",variant:"danger",outlined:"",label:"Delete",onClick:l[1]||(l[1]=f=>t.$emit("deleteClicked"))})]))}}),ye={class:"flex justify-between h-fit mt-2 gap-2"},he={class:"flex flex-wrap gap-3"},ke=j({__name:"BlogPost",props:{post:{},withoutMutation:{type:Boolean}},emits:["editClicked","deleteClicked"],setup(u){const t=u,l=ne(),f=V(),b=re(),{publicUsers:P}=h(b),{firebaseUser:m,isOwner:r}=h(f);l.currentRoute.value.name!==T.BLOG&&pe(t.post);const p=C(()=>{var e;return(e=t.post.allowedUserIds)!=null&&e.length?P.value.filter(a=>{var i;return(i=t.post.allowedUserIds)==null?void 0:i.includes(a.id)}):[]}),y=C(()=>{const e=G(t.post.date);return t.post.dateUpdated?e+` - updated ${G(t.post.dateUpdated)}`:e}),d=C(()=>{const e=[];return t.post.datePinned&&e.push({value:"Pinned",severity:"success",rounded:!1}),t.post.locked&&e.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),t.post.archived&&e.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),e}),s=()=>{const e=document.createElement("textarea"),{protocol:a,hostname:i,port:g}=window.location,k=`${a}//${i}`+(i==="localhost"?`:${g}`:"");e.value=`${k}#${ue.BLOG.path}/${t.post.id}`,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),de.success("Copied link!")};return(e,a)=>(c(),R(A,{id:e.post.id,class:U(["border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:y.value,tags:d.value,loading:e.post.loading,clickable:"",route:{name:o(T).BLOG_DETAILS,params:{postId:e.post.id}}},{right:D(()=>[S(I,{class:"h-fit",variant:"neutral",icon:"pi pi-copy",text:"",onClick:s})]),default:D(()=>{var i;return[E("div",ye,[E("div",he,[(c(!0),B(M,null,N(p.value,g=>{var k;return c(),R(o(le),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:g.id===((k=o(m))==null?void 0:k.uid)?"You":g.displayName,rounded:""},null,8,["label"])}),256))]),o(r)&&!e.withoutMutation?(c(),B("div",{key:0,class:U(["flex justify-end ms-5",(i=e.post.allowedUserIds)!=null&&i.length?"flex-col md:flex-row":"flex-row"])},[S(be,{onEditClicked:a[0]||(a[0]=g=>e.$emit("editClicked")),onDeleteClicked:a[1]||(a[1]=g=>e.$emit("deleteClicked"))})],2)):_("",!0)]),S(A,{class:U(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5 flex flex-col gap-3",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{default:D(()=>[(c(!0),B(M,null,N(e.post.content,g=>(c(),R(ce,{key:g.id,post:e.post,block:g},null,8,["post","block"]))),128))]),_:1},8,["class"]),S(me,{post:e.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","loading","route"]))}});export{ke as _,be as a,Pe as u};
