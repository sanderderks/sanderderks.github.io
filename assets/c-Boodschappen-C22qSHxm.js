import{b9 as le,bs as ce,bt as pe,bg as me,bh as Y,bu as fe,ax as X,bv as ge,bw as ye,b5 as ve,be,q as he,bx as ke,s as H,z as $,C as R,au as P,by as Oe,bz as we,bA as K,d as Q,bq as Ve,U as se,b as S,g as q,D as M,Y as De,br as Se,v as Be,w as g,f as e,e as V,h as a,ab as ie,J as Ce,i as U,ac as re,a7 as xe,a8 as ze,a9 as Pe,t as N,$ as ue,aa as _e,a6 as $e,ad as Ne,E as Ue,l as je,c as L,O as T,I as Le,_ as Te,ai as Z,aj as z,k as _,bB as oe,n as ee}from"../bundle.js";import{_ as de}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{_ as qe}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{u as Fe,D as Ee,_ as Ae}from"./c-useDateChart-DGSG2NvK.js";class I{id;name;size;category;buyLog;isOutOfStock;constructor({id:t,name:l,size:y,category:v,buyLog:d,isOutOfStock:D}={}){this.id=t??le(),this.name=l??"",this.size=y??{value:0,unit:""},this.category=v??null,this.buyLog=d??[],this.isOutOfStock=D??!1}static deserialize(t){return new I({id:t.id,name:t.name,size:t.size,category:t.category,buyLog:t.buyLog.map(W.deserialize),isOutOfStock:t.isOutOfStock})}serialize(){return{id:this.id,name:this.name,size:this.size,category:this.category,buyLog:this.buyLog.map(t=>t.serialize()),isOutOfStock:this.isOutOfStock}}clone(){return new I({id:this.id,name:this.name,size:{...this.size},category:this.category?{...this.category}:null,buyLog:this.buyLog.map(t=>t.clone()),isOutOfStock:this.isOutOfStock})}}class W{date;price;quantity;constructor(t,l,y){this.date=t??new Date,this.price=l??0,this.quantity=y??1}static deserialize(t){return new W(t.date.toDate(),t.price,t.quantity)}serialize(){return{date:ce.fromDate(this.date),price:this.price,quantity:this.quantity}}clone(){return new W(new Date(this.date.getTime()),this.price,this.quantity)}}function Re(k){return k.map(Ie)}function Ie(k){return I.deserialize(k)}class Me{async fetchMultiple(t){return pe(me(t,Y.BOODSCHAPPEN))}async create(t,l){await fe(X(t,Y.BOODSCHAPPEN,l.id),l)}async update(t,l){await ge(X(t,Y.BOODSCHAPPEN,l.id),{...l})}async delete(t,l){await ye(X(t,Y.BOODSCHAPPEN,l))}}const J=new Me,ae=ve("boodschappenStore",()=>{const k=be(),t=he(),l=ke(),{firebaseUser:y}=H(t),{debug:v}=H(l),d=$([]),D=$(!1),w=$(!1),C=R(()=>d.value.reduce((s,u)=>{const n=u.category;return n&&!s.some(r=>r.id===n.id)&&s.push(n),s},[])),p=R(()=>[{value:null,label:"Geen categorie"},...C.value.map(s=>({value:s,label:s.label}))]);return{boodschappen:d,isFetchLoading:D,isMutationLoading:w,categories:C,categoryOptions:p,$reset:()=>{d.value=[]},fetchBoodschappen:async()=>{if(!y.value){P.error("You must be logged in to fetch products.");return}try{D.value=!0;const s=await J.fetchMultiple(k);d.value=Re(s)}catch(s){P.firebaseError(v.value,s)}finally{D.value=!1}},createBoodschap:async s=>{if(!y.value){P.error("You must be logged in to create products.");return}try{w.value=!0,await J.create(k,s.serialize()),Oe(d,s),P.success("Successfully created product")}catch(u){P.firebaseError(v.value,u)}finally{w.value=!1}},updateBoodschap:async s=>{if(!y.value){P.error("You must be logged in to update products.");return}try{w.value=!0,await J.update(k,s.serialize()),we(d,s,"id"),P.success("Successfully updated product")}catch(u){P.firebaseError(v.value,u)}finally{w.value=!1}},deleteBoodschap:async s=>{if(!y.value){P.error("You must be logged in to delete products.");return}try{w.value=!0,d.value.find(n=>n.id===s)&&(await J.delete(k,s),d.value=d.value.filter(n=>n.id!==s),P.success("Successfully deleted product"))}catch(u){P.firebaseError(v.value,u)}finally{w.value=!1}}}}),He=()=>{const k=ae(),{boodschappen:t}=H(k),l=R(()=>[...t.value].sort((m,o)=>{const i=!!m.isOutOfStock,f=!!o.isOutOfStock;if(i&&!f)return-1;if(!i&&f)return 1;const b=w(m),s=w(o);return b===null&&s===null?0:b===null?1:s===null?-1:b.getTime()-s.getTime()})),y=R(()=>{const m=new Date,o=new Date(m.getTime()+14*K);return l.value.filter(i=>{const f=w(i);return f!==null&&f.getTime()>=m.getTime()&&f.getTime()<=o.getTime()})}),v=R(()=>{const m=new Date(new Date().getTime()+14*K);return l.value.filter(o=>{const i=w(o);return!i||i.getTime()>m.getTime()})}),d=m=>[...m.buyLog].filter(o=>Number(o.quantity)>0&&!Number.isNaN(o.date.getTime())).sort((o,i)=>o.date.getTime()-i.date.getTime()),D=m=>d(m).at(-1)?.date??null,w=(m,o=new Date)=>{const i=d(m),f=m.size.value;if(!Number.isFinite(f)||f<=0)return null;if(i.length<2)return null;let b=0,s=0;for(let F=0;F<i.length-1;F++){const E=i[F],x=(i[F+1].date.getTime()-E.date.getTime())/K;!Number.isFinite(E.quantity)||E.quantity<=0||x<=0||(b+=E.quantity*f,s+=x)}if(s<=0||b<=0)return null;const u=b/s;if(!Number.isFinite(u)||u<=0)return null;const n=i.at(-1);if(!n)return null;const r=n.quantity;if(!Number.isFinite(r)||r<=0)return null;const B=r*f/u;if(!Number.isFinite(B)||B<=0)return null;const G=new Date(n.date.getTime()+B*K);return G.getTime()<o.getTime()?o:G};return{sortedBoodschappen:l,shortTermGroceries:y,longTermGroceries:v,getLatestPurchaseDate:D,getProjectedOutOfStockDate:w,getPricePerUnit:m=>{const o=d(m).at(-1);return!o||!Number.isFinite(o.price)||!Number.isFinite(o.quantity)||o.quantity<=0?null:o.price/o.quantity},getPriceIncreasePercentage:m=>{const o=d(m);if(o.length<2)return 0;const i=o.at(-1),f=o.at(-2);return!Number.isFinite(i.price)||!Number.isFinite(i.quantity)||!Number.isFinite(f.price)||!Number.isFinite(f.quantity)||f.quantity===0?0:(i.price/i.quantity-f.price/f.quantity)/(f.price/f.quantity)*100}}},te=Q({__name:"NumberField",props:Se({id:{},name:{},label:{},placeholder:{},error:{},rules:{},inputProps:{},labelProps:{},minLength:{},maxLength:{},minValue:{},maxValue:{},compare:{},deleteButton:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const t=k,l=Ve(k,"modelValue"),y=$("");function v(){l.value=parseFloat(y.value)||0}return se(l,d=>{y.value=d.toString()},{immediate:!0}),(d,D)=>(S(),q(M,De(t,{modelValue:y.value,"onUpdate:modelValue":D[0]||(D[0]=w=>y.value=w),"input-props":{...t.inputProps,type:"number"},onBlur:v}),null,16,["modelValue","input-props"]))}}),We={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ge={class:"flex gap-3"},Ye={class:"w-full flex gap-3"},Ke={class:"flex gap-5"},Je={class:"flex flex-col gap-3"},Qe=Q({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(k,{emit:t}){const l=k,y=t,v=ae(),{categories:d,categoryOptions:D,isMutationLoading:w}=H(v),C=$(!1),p=Be(m());function m(){const u=l.selectedBoodschap?.clone()??new I;return{name:u.name,category:d.value.find(n=>n.id===u.category?.id)??null,size:u.size,buyLog:u.buyLog,isOutOfStock:u.isOutOfStock}}function o(){const u=l.selectedBoodschap?l.selectedBoodschap:new I;Object.assign(u,p),l.selectedBoodschap?v.updateBoodschap(u):v.createBoodschap(u),y("close")}function i(){y("close")}function f(){C.value=!0,p.category={id:le(),label:""}}function b(){C.value=!1,p.category=null}function s(){p.buyLog.push(new W)}return se(()=>l.isOpen,u=>{u?Object.assign(p,m()):C.value=!1},{immediate:!0}),(u,n)=>(S(),q(de,{"is-open":k.isOpen,title:l.selectedBoodschap?`Bewerk ${l.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":l.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":e(w),onConfirm:o,onCancel:i},{default:g(()=>[V("div",We,[a(M,{name:"name",label:"Naam",modelValue:p.name,"onUpdate:modelValue":n[0]||(n[0]=r=>p.name=r)},null,8,["modelValue"]),V("div",Ge,[C.value?p.category?(S(),q(M,{key:1,class:"w-full",name:"category",label:"Categorie",modelValue:p.category.label,"onUpdate:modelValue":n[2]||(n[2]=r=>p.category.label=r)},null,8,["modelValue"])):Ce("",!0):(S(),q(ie,{key:0,class:"w-full",name:"category",label:"Categorie",modelValue:p.category,"onUpdate:modelValue":n[1]||(n[1]=r=>p.category=r),options:e(D)},null,8,["modelValue","options"])),C.value?(S(),q(U,{key:3,class:"h-fit place-self-end",icon:"pi pi-times","icon-only":"",variant:"neutral",onClick:b})):(S(),q(U,{key:2,class:"h-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",onClick:f}))]),V("div",Ye,[a(te,{name:"sizeValue",label:"Formaat",modelValue:p.size.value,"onUpdate:modelValue":n[3]||(n[3]=r=>p.size.value=r)},null,8,["modelValue"]),a(M,{name:"sizeUnit",label:"Eenheid",modelValue:p.size.unit,"onUpdate:modelValue":n[4]||(n[4]=r=>p.size.unit=r)},null,8,["modelValue"])]),a(re,{name:"isOutOfStock",label:"Voorraad leeg",modelValue:p.isOutOfStock,"onUpdate:modelValue":n[5]||(n[5]=r=>p.isOutOfStock=r)},null,8,["modelValue"]),n[8]||(n[8]=V("b",null,"Logboek",-1)),a(e(Ne),{ref:"draggable",class:"flex flex-col gap-3",modelValue:p.buyLog,"onUpdate:modelValue":n[6]||(n[6]=r=>p.buyLog=r),itemKey:r=>r.date.toString(),handle:".drag-handle"},{item:g(({element:r,index:j})=>[a(e(xe),null,{default:g(()=>[a(e(ze),{value:"0"},{default:g(()=>[a(e(Pe),{class:"drag-handle"},{default:g(()=>[V("div",Ke,[n[7]||(n[7]=V("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),V("p",null,N(e(ue)(r.date)),1)])]),_:2},1024),a(e(_e),null,{default:g(()=>[V("div",Je,[a($e,{name:`buylog-date-${j}`,label:"Datum",modelValue:r.date,"onUpdate:modelValue":B=>r.date=B,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),a(te,{name:`buylog-quantity-${j}`,label:"Aantal",modelValue:r.quantity,"onUpdate:modelValue":B=>r.quantity=B},null,8,["name","modelValue","onUpdate:modelValue"]),a(te,{name:`buylog-price-${j}`,label:"Prijs",modelValue:r.price,"onUpdate:modelValue":B=>r.price=B},null,8,["name","modelValue","onUpdate:modelValue"]),a(U,{variant:"danger",outlined:"",label:"Delete",onClick:B=>p.buyLog.splice(j,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),a(U,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:s})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),Xe=Q({__name:"ProductPriceChart",props:{product:{}},setup(k){const t=k,l=R(()=>t.product.buyLog.map(d=>({date:d.date,value:d.price/d.quantity}))),{headers:y,filteredData:v}=Fe(l,Ee.MONTHS);return(d,D)=>(S(),q(Ae,{headers:e(y),datasets:[{label:"Prijsverloop",fill:!1,borderColor:"orange",yAxisID:"y",tension:.4,data:e(v),spanGaps:!0}]},null,8,["headers","datasets"]))}}),Ze={class:"flex justify-end"},et={class:"flex gap-3 place-self-end"},lt=Q({__name:"Boodschappen",setup(k){const t=ae(),{categoryOptions:l,isFetchLoading:y,isMutationLoading:v}=H(t),d=Ue(Le),{sortedBoodschappen:D,shortTermGroceries:w,getLatestPurchaseDate:C,getPricePerUnit:p,getPriceIncreasePercentage:m,getProjectedOutOfStockDate:o}=He(),i=d.greaterOrEqual("md"),f=$([]),b=$(null),s=$({name:{value:null,matchMode:"startsWith"},"category.label":{value:null,matchMode:"startsWith"}}),u=$(!1),n=$(!1);async function r(x){const h=x.clone();h.isOutOfStock=!x.isOutOfStock,await t.updateBoodschap(h)}function j(x){f.value=[x.data]}function B(){b.value=null,n.value=!0}function G(x){b.value=x,n.value=!0}function F(x){b.value=x,u.value=!0}function E(){b.value=null,n.value=!1}async function ne(){b.value&&await t.deleteBoodschap(b.value.id),u.value=!1,b.value=null}return je(()=>{t.fetchBoodschappen()}),(x,h)=>(S(),L(T,null,[a(qe,null,{content:g(()=>[a(Te,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"Sander's Boodschappentool",description:"Nu zul je nooit meer iets vergeten in de supermarkt!","description-props":{class:"text-white mb-5"}},{default:g(()=>[h[5]||(h[5]=V("ol",{class:"ms-3 list-decimal list-inside"},[V("li",null,"Voeg een product toe"),V("li",null,"Registreer wanneer je iets hebt gekocht"),V("li",null,"Weet automatisch wanneer je voorraad bijna op is!")],-1)),h[6]||(h[6]=V("h3",{class:"text-xl mt-10 mb-3 font-bold"},"Mijn boodschappenlijstje",-1)),h[7]||(h[7]=V("p",{class:"mb-3"},"Producten die bijna op zijn in één overzicht.",-1)),a(e(Z),{value:e(w),tableStyle:e(i)?"min-width: 40rem":void 0,loading:e(y),size:e(i)?void 0:"small"},{empty:g(()=>[...h[3]||(h[3]=[_(" Er zijn nog geen producten gevonden. ",-1)])]),default:g(()=>[a(e(z),{field:"name",header:"Naam"}),a(e(z),{header:"Voorraad aanvullen over"},{body:g(({data:c})=>[c.isOutOfStock?(S(),L(T,{key:0},[_(" Nu ")],64)):(S(),L(T,{key:1},[_(N(e(o)(c)?`${e(oe)(e(o)(c))} dagen`:"Onbekend"),1)],64))]),_:1}),a(e(z),{header:"Voorraad leeg"},{body:g(({data:c})=>[a(re,{name:`outofstock-${c.id}`,"model-value":c.isOutOfStock,disabled:e(v),onClick:O=>r(c)},null,8,["name","model-value","disabled","onClick"])]),_:1})]),_:1},8,["value","tableStyle","loading","size"]),h[8]||(h[8]=V("h3",{class:"text-xl mt-10 mb-3 font-bold"}," Alle producten ",-1)),a(e(Z),{value:e(D),expandedRows:f.value,"onUpdate:expandedRows":h[0]||(h[0]=c=>f.value=c),filters:s.value,"onUpdate:filters":h[1]||(h[1]=c=>s.value=c),tableStyle:e(i)?"min-width: 40rem":void 0,loading:e(y),size:e(i)?void 0:"small",filterDisplay:"row",onRowExpand:j},{empty:g(()=>[...h[4]||(h[4]=[_(" Er zijn nog geen producten gevonden. ",-1)])]),expansion:g(({data:c})=>[a(e(Z),{value:[c],size:e(i)?void 0:"small"},{default:g(()=>[a(e(z),{class:"!border-0",field:"size.value",header:"Formaat"},{body:g(({data:O})=>[_(N(O.size.value)+" "+N(O.size.unit),1)]),_:2},1024),a(e(z),{class:"!border-0",header:"Laatste aankoop"},{body:g(({data:O})=>[e(C)(O)?(S(),L(T,{key:1},[_(N(e(ue)(e(C)(O))),1)],64)):(S(),L(T,{key:0},[_(" Nog niet gekocht ")],64))]),_:2},1024),a(e(z),{class:"!border-0",header:"Prijs"},{body:g(({data:O})=>[_(N(e(p)(O)?`€${e(p)(O).toFixed(2)}`:""),1)]),_:2},1024),a(e(z),{class:"!border-0",header:"Prijsstijging"},{body:g(({data:O})=>[V("span",{class:ee(e(m)(O)>0?"text-red-500":e(m)(O)<0?"text-green-500":"")},N(e(m)(O)?`${e(m)(O).toFixed(2)}%`:""),3)]),_:2},1024)]),_:2},1032,["value","size"]),a(Xe,{class:ee(e(i)?"max-h-[50vh]":"max-w-fit"),product:c},null,8,["class","product"])]),default:g(()=>[a(e(z),{class:ee({"w-[5rem]":e(i)}),expander:""},null,8,["class"]),a(e(z),{field:"name",header:"Naam"},{filter:g(({filterModel:c,filterCallback:O})=>[a(M,{name:"nameFilter",modelValue:c.value,"onUpdate:modelValue":A=>c.value=A,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:O},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),a(e(z),{field:"category.label",header:"Categorie",showFilterMenu:!1},{filter:g(({filterModel:c,filterCallback:O})=>[a(ie,{name:"categoryFilter",modelValue:c.value,"onUpdate:modelValue":[A=>c.value=A,O],options:e(l).map(A=>({...A,value:A.value?.label??null})),placeholder:"Filter...",style:{"min-width":"5rem"}},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(e(z),{header:"Voorraad aanvullen over"},{body:g(({data:c})=>[c.isOutOfStock?(S(),L(T,{key:0},[_(" Nu ")],64)):(S(),L(T,{key:1},[_(N(e(o)(c)?`${e(oe)(e(o)(c))} dagen`:"Onbekend"),1)],64))]),_:1}),a(e(z),null,{filter:g(()=>[V("div",Ze,[a(U,{class:"w-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",loading:e(v),onClick:B},null,8,["loading"])])]),body:g(({data:c})=>[V("div",et,[a(U,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:e(v),onClick:O=>G(c)},null,8,["loading","onClick"]),a(U,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:e(v),onClick:O=>F(c)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","tableStyle","loading","size"]),a(U,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:e(v),onClick:B},null,8,["loading"])]),_:1})]),_:1}),a(Qe,{"is-open":n.value,selectedBoodschap:b.value,onClose:E},null,8,["is-open","selectedBoodschap"]),a(de,{title:"Product verwijderen","is-open":u.value,description:[b.value?`Weet je zeker dat je het product '${b.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":e(v),onConfirm:ne,onCancel:h[2]||(h[2]=c=>u.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{lt as default};
