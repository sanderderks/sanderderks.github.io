import{_ as w}from"./c-Bubble.vue_vue_type_script_setup_true_lang-DJUKMPd9.js";import{r as B,c as u,au as M,e as O,A as R,aO as G,s as S,o as V,am as q,M as z,l as n,m as a,p as s,n as U,k as l,t as r,w as x,O as F,H as m,G as H,C as J,E as K,q as $,h as Q}from"../bundle.js";import{_ as W}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const X=(i,c)=>{const f=B(0),d=u(()=>M(i)),y=u(()=>(f.value+1)*c),g=u(()=>y.value-c),p=u(()=>f.value>0),h=u(()=>d.value.length>y.value),k=u(()=>d.value.filter((_,o)=>o>=g.value&&o<y.value));return{page:f,perPage:c,visibleData:k,hasPrevious:p,hasNext:h}},Y={class:"mt-5 flex justify-center"},Z={class:"w-full overflow-x-auto"},ee={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},te={key:0},se={key:0},oe={key:1},ne={key:1},le={key:0},ae={key:1},re={key:2},ue={key:3},ie={key:2},ce={key:3},de={key:4},ve={colspan:"100%"},fe=O({__name:"Highscores",props:{gameId:{},unit:{}},setup(i){const c=i,f=R(),d=G(),{publicUsers:y}=S(f),{allGameData:g,fetchLoading:p}=S(d),{fetchGameData:h,fetchHighscores:k,fetchScores:_}=d,o=B("highscores"),N=B(),A=u(()=>g.value[c.gameId].gameData[o.value]),{page:I,perPage:j,visibleData:v,hasPrevious:D,hasNext:C}=X(()=>A.value,10),E=b=>{var e;return((e=y.value.find(t=>t.id===b))==null?void 0:e.displayName)??"Unknown"},L=()=>{o.value==="highscores"?k():_()};return V(()=>{d.$init(c.gameId),h(),N.value=setInterval(()=>{h()},1e3*60*5)}),q(()=>{clearInterval(N.value)}),z(o,()=>{g.value[c.gameId].gameData[o.value].length||L()}),(b,e)=>(n(),a(x,null,[s("div",Y,[U(w,{class:"w-1/2 md:w-1/4 rounded-r-none",type:"secondary",outlined:o.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=t=>o.value="highscores")},null,8,["outlined"]),U(w,{class:"w-1/2 md:w-1/4 rounded-l-none",type:"secondary",outlined:o.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=t=>o.value="scores")},null,8,["outlined"])]),s("div",Z,[s("table",ee,[l(v).length?(n(),a("thead",te,[s("tr",null,[e[4]||(e[4]=s("th",null,"Rank",-1)),e[5]||(e[5]=s("th",null,"User",-1)),e[6]||(e[6]=s("th",null,"Score",-1)),l(v).length&&l(v).some(t=>t.difficulty)?(n(),a("th",se,"Difficulty")):r("",!0),e[7]||(e[7]=s("th",null,"Date",-1)),l(v).length&&l(v).some(t=>t.bonus)?(n(),a("th",oe,"Bonus")):r("",!0)])])):r("",!0),l(v).length?(n(),a("tbody",ne,[(n(!0),a(x,null,F(l(v),(t,T)=>(n(),a("tr",null,[s("th",null,m(T+1+l(I)*l(j)),1),s("th",null,m(E(t.userId??t.id)),1),s("td",null,[H(m(t.score)+" ",1),b.unit?(n(),a(x,{key:0},[H(m(b.unit),1),t.score!==1?(n(),a(x,{key:0},[H("s")],64)):r("",!0)],64)):r("",!0)]),t.difficulty?(n(),a("td",le,m(t.difficulty),1)):l(v).some(P=>P.difficulty)?(n(),a("td",ae)):r("",!0),s("td",null,m(l(J)(t.date)),1),t.bonus?(n(),a("td",re,m(t.bonus),1)):l(v).some(P=>P.bonus)?(n(),a("td",ue)):r("",!0)]))),256))])):l(p)?(n(),a("tbody",ie,e[8]||(e[8]=[s("tr",null,[s("th",null,"Loading highscores...")],-1)]))):(n(),a("tbody",ce,[s("tr",null,[s("th",null,"There are no "+m(o.value==="highscores"?"highscores":"scores")+" yet.",1)])])),l(D)||l(C)?(n(),a("tfoot",de,[s("tr",null,[s("td",ve,[s("div",{class:K(["w-full p-2 flex",[l(D)?"justify-between":"justify-end"]])},[l(D)?(n(),$(w,{key:0,class:"w-fit",label:"Previous",type:"neutral",onClick:e[2]||(e[2]=t=>I.value-=1)})):r("",!0),l(C)?(n(),$(w,{key:1,class:"w-fit",label:"Next",type:"neutral",onClick:e[3]||(e[3]=t=>I.value+=1)})):r("",!0)],2)])])])):r("",!0)])])],64))}}),ge=W(fe,[["__scopeId","data-v-f113b785"]]),pe=i=>{const c=Q(),f=G(),{allGameData:d,highscorePosition:y,personalBest:g}=S(f),{firebaseUser:p}=S(c),h=u(()=>p.value?y.value:null),k=u(()=>{if(!i)return!1;const o=d.value[i].previousHighscorePosition;return h.value&&o?o>h.value:!1}),_=u(()=>{if(!i)return!1;const o=d.value[i].previousPersonalBest;return p.value&&o?o<g.value:!1});return V(()=>{f.$init(i)}),{currentHighscorePosition:h,hasImprovedHighscorePosition:k,hasImprovedPersonalBest:_}};export{ge as H,pe as u};
