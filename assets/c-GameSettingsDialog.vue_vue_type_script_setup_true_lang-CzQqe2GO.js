import{_ as Ce}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{b5 as ke,bf as pe,s as X,v as ye,l as Ae,bd as V,U as Ie,z as E,C as H,bj as re,bm as Te,b6 as Pe,bk as Le,bc as De,q as Me,bb as z,bi as we,b8 as xe,bl as We,d as Ue,bq as $e,b as ve,g as de,w as Be,e as je,h as Fe,bo as fe,f as K,ac as be,J as Se,ab as _e,br as Ge}from"../bundle.js";var Ye=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Ye||{});const Ee={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var qe=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(qe||{}),ze=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(ze||{});const Ke={easy:.5,hard:1},Ne=()=>{const e=Je();return Pe(e),{pile1:e.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:e.splice(0,2).map((u,p)=>p<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:e.splice(0,3).map((u,p)=>p<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:e.splice(0,4).map((u,p)=>p<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:e.splice(0,5).map((u,p)=>p<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:e.splice(0,6).map((u,p)=>p<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:e.splice(0,7).map((u,p)=>p<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:e.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},Ze=ke("patienceStore",()=>{const e=pe(),{personalBest:u,highscorePosition:p}=X(e),{setPreviousHighscores:x,updateHighscores:W,sortHighscores:k}=e,D=E("hard"),C=E(0),M=E(0),R=E(0),I=E(0),O=E(0),ue=E(),ne=E(!0),v=ye(Ne()),ee=H(()=>Ke[D.value]),Z=H(()=>Object.keys(v).flatMap(s=>v[s])),U=1e3,P=10,d=10,J=H(()=>{const s=R.value%10===0?R.value:Math.floor(R.value/10)*10,a=M.value*P,o=O.value*P,n=s+a+o,g=I.value*d;return Math.max(0,U-(n-g))}),j=H(()=>{const s=Math.floor(R.value/60),a=R.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),le=H(()=>v.hearts.length===13&&v.spades.length===13&&v.diamonds.length===13&&v.clubs.length===13);Ae(()=>{e.$init(V.PATIENCE),R.value&&C.value===1&&y()}),Ie(le,s=>{s&&C.value!==2&&(Q(),C.value=2,ce(),re(Le))});const r=()=>{Q(),M.value=0,R.value=0,I.value=0,O.value=0,C.value=0,Object.assign(v,Ne()),e.setPreviousHighscores()},S=()=>{R.value=0,y(),C.value=1,setTimeout(()=>{_()},500)},y=()=>{ue.value&&Q(),ue.value=setInterval(()=>{R.value++},1e3)},Q=()=>{clearInterval(ue.value)},h=()=>{const s=v.stock_open;s.length&&(s.reverse(),G(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,v.stock_closed.push(a)}),s.splice(0,s.length),N(1))},T=s=>{const a=s.deck,o=Z.value.filter(n=>n.selected);if(a==="stock_closed"){const n=v.stock_closed,g=n.indexOf(s);if(g===n.length-1){const w=D.value==="hard"?g-2:g,b=w<0?0:w,B=n.filter((oe,ge)=>ge>=b);Y(),$(B,"stock_open",oe=>{oe.hidden=!1}),N(0)}}else if(a==="stock_open"){const n=v.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,o.length&&G(o[0],!1))}else if(o.length){const n=o[0];n===s?G(s,!1):ae(a)&&he(n,s)?s.value===n.value+1&&s.deck!==n.deck&&($(o,a),n.deck==="stock_open"?N(2):N(4)):o.length===1&&te(a)&&me(n,s)&&s.value===n.value-1&&(ie(n,a),N(3),n.hasBeenHome=!0)}else G(s,!0)},m=s=>{const a=Z.value.filter(o=>o.selected);if(a.length){const o=a[0],n=o.deck;o.value===13&&($(a,s),n==="stock_open"?N(2):ae(o.deck)&&v[o.deck].every(g=>!g.hidden)?N(5):N(4))}},F=s=>{const a=Z.value.filter(o=>o.selected);if(a.length===1){const o=a[0],n=o.type;!v[s].length&&n===s&&o.value===1&&(ie(o,s),N(3))}},G=(s,a,o)=>{const n=v[s.deck],g=n.indexOf(s);n.filter((b,B)=>B>=g).forEach(b=>{b.selected=a,o==null||o(b)})},Y=()=>{Z.value.forEach(s=>{s.selected=!1})},ie=(s,a)=>{const o=s.deck,n=v[o].indexOf(s);s.deck=a,s.selected=!1,v[a].push(s),v[o].splice(n,1),(ae(o)||o==="stock_open")&&q(o)},$=(s,a,o)=>{const n=s[0],g=n.deck,w=v[g].indexOf(n);G(n,!1,b=>{b.deck=a,o==null||o(b),v[a].push(b)}),v[g].splice(w,s.length),te(g)||q(g!=="stock_closed"?g:a)},se=s=>{if(!ne.value)return!0;const a=v[s.type],o=a.length?a[a.length-1].value:0;if(s.value===o+1){const n=["hearts","spades","diamonds","clubs"],g=o<=1||n.every(w=>{const b=v[w];return(b.length?b[b.length-1].value:0)>=o});if(o===0||g)return ie(s,s.type),s.hasBeenHome=!0,N(3),!0}return!1},_=()=>{if(ne.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=v[s];if(a.length&&se(a[a.length-1]))return}},q=s=>{const a=v[s];if(a.length){const o=a[a.length-1],n=o.deck;o.hidden=!1,setTimeout(()=>{o.deck===n&&(se(o)||_())},500)}else setTimeout(()=>{_()},500)},N=s=>{switch(s!==5&&M.value++,s){case 0:{O.value+=2*ee.value;break}case 1:{O.value+=5*ee.value;break}case 2:{I.value+=10*ee.value;break}case 3:{I.value+=20*ee.value;break}}re(Te)},he=(s,a)=>s.color!==a.color,me=(s,a)=>s.type===a.type,ae=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),te=s=>["hearts","spades","diamonds","clubs"].includes(s),ce=()=>{W({difficulty:D.value,score:J.value,bonus:I.value,time:R.value,turns:M.value,penalty:O.value})};return{difficulty:D,gameStatus:C,score:J,turns:M,time:R,bonus:I,penalty:O,cards:v,doAutocomplete:ne,allCards:Z,formattedTime:j,personalBest:u,highscorePosition:p,$reset:r,start:S,shuffle:h,selectCard:T,selectEmptyDeck:m,selectFinalDeck:F,deselectAllCards:Y,isPlayDeck:ae,isFinalDeck:te,setPreviousHighscores:x,updatePatienceHighscore:ce,sortHighscores:k}},{}),Je=()=>Object.keys(Ee).flatMap(e=>{const u=e,p=[];for(let x=0;x<13;x++){const W={type:u,label:Ee[u].label,color:Ee[u].color,value:x+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(W)}return p});var Qe=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.HAS_STARTED=2]="HAS_STARTED",e[e.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",e[e.HAS_LOST=6]="HAS_LOST",e[e.HAS_FINISHED=7]="HAS_FINISHED",e))(Qe||{}),Xe=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(Xe||{}),el=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.WINNER_TIE=3]="WINNER_TIE",e[e.LOSER=4]="LOSER",e))(el||{});const ll=e=>{for(let u=1;u<=6;u++)if(e.every(p=>p.value===u))return!0;return!1},sl=ke("rainwormsStore",()=>{const e=pe(),u=De(),p=Me(),{personalBest:x,highscorePosition:W}=X(e),{firebaseUser:k}=X(p),{games:D,gamesLoading:C,gameId:M,creatorId:R,players:I,opponents:O,chat:ue,isOwner:ne}=X(u),{setPreviousHighscores:v,updateHighscores:ee,sortHighscores:Z}=e,U=E(1),P=E(z.SOLO),d=E(0),J=E(!1),j=E(0),le=E(0),r=E("soloPlayer"),S=E(r.value),y=E(r.value),Q=E(!1),h=E(Re()),T=E(He()),m=ye({}),F=H(()=>h.value.some(l=>l.isRolling)),G=H(()=>h.value.filter(l=>l.selected).some(l=>l.value===6)),Y=H(()=>l=>h.value.some(t=>t.value===l&&t.selected)),ie=H(()=>T.value.some(l=>l.displayValue<=_.value)),$=H(()=>(l=r.value)=>S.value===l),se=H(()=>(l=r.value)=>{const t=m[l];return t.length?t[t.length-1]:null}),_=H(()=>{let l=0;return h.value.filter(t=>t.selected).forEach(t=>{l+=t.value===6?5:t.value}),l}),q=H(()=>l=>{let t=0;return m[l].forEach(c=>{t+=c.value}),t});Ae(()=>{e.$init(V.RAINWORMS),F.value&&h.value.forEach(l=>{l.isRolling=!1})}),Ie(d,l=>{l===7?Ve():P.value===z.SOLO&&(Q.value||S.value==="robot")&&ge(S.value)}),Ie([d,S,F],()=>{P.value===z.MULTIPLAYER&&s()},{deep:!0});const N=()=>{u.$reset(),P.value=z.SOLO,d.value=0,j.value=0,le.value=0,r.value="soloPlayer",S.value=r.value,y.value=r.value,h.value=Re(),T.value=He(),Object.keys(m).forEach(l=>{delete m[l]}),v()},he=()=>{P.value=z.SOLO,d.value=2,m[r.value]=[],m.robot=[]},me=l=>{k.value&&(l=[{userId:k.value.uid,isOnline:!0},...l],P.value=z.MULTIPLAYER,d.value=2,r.value=k.value.uid,S.value=r.value,y.value=r.value,l.forEach(t=>{m[t.userId]=[]}),u.$init(V.RAINWORMS,te,ce,N),u.createGame(l))},ae=l=>{k.value&&(P.value=z.MULTIPLAYER,r.value=k.value.uid,u.$init(V.RAINWORMS,te,ce,N),u.continueGame(l))},te=()=>({gameStatus:d.value,gameStatusActivator:y.value,activePlayer:S.value,dices:h.value,tiles:T.value,score:m}),ce=l=>{var c;const t=(c=k.value)==null?void 0:c.uid;!t||S.value===r.value||(d.value=l.gameStatus,y.value=l.gameStatusActivator,S.value=l.activePlayer,h.value=l.dices,T.value=l.tiles,Object.assign(m,l.score),Object.keys(m).includes(t)||(m[t]=[]))},s=()=>{!k.value||S.value!==r.value&&!J.value||u.pushState()},a=(l=r.value)=>{if(!$.value(l))return;(d.value===2||d.value===5||d.value===6)&&h.value.forEach(c=>{c.selected=!1}),d.value=3;const t=e.diceRollSpeed*1e3;h.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=we(6),c.isRolling=!1,h.value.sort((A,i)=>A.value-i.value),!F.value&&d.value!==6&&n()&&g(l)},xe(t,t/3)))}),re(We)},o=async()=>{for(;F.value;)await new Promise(l=>setTimeout(l,e.diceRollSpeed*1e3));return!0},n=()=>{const l=h.value.filter(t=>!t.selected&&!Y.value(t.value));return!l.length||ll(l)&&l.every(t=>t.value!==6)&&h.value.filter(t=>t.selected).every(t=>t.value!==6)},g=(l=r.value)=>{d.value=6,y.value=l,m[y.value].length?le.value=1:le.value=2,w(),T.value.length===0?d.value=7:oe()},w=()=>{const l=m[S.value];if(l.length){const t=l.splice(l.length-1,1)[0];T.value.push(t),T.value.sort((c,A)=>c.displayValue-A.displayValue)}T.value.splice(T.value.length-1,1)},b=(l,t=r.value)=>{$.value(t)&&!F.value&&d.value===3&&!l.selected&&!Y.value(l.value)&&(d.value=4,h.value.filter(c=>c.value===l.value).forEach(c=>{c.selected=!0}),re(Te))},B=(l,t,c=r.value)=>{if($.value(c)&&(d.value===3||d.value===4)){if(t){const A=m[t];A.splice(A.length-1,1)}else T.value=T.value.filter(A=>A.displayValue!==l.displayValue);m[S.value].push(l),T.value.length===0?d.value=7:(d.value=5,y.value=c,oe()),re(Te)}},oe=l=>{(Q.value||S.value!==r.value||d.value!==6||l)&&(S.value===r.value?setTimeout(()=>{J.value=!0,S.value=P.value===z.SOLO?"robot":u.getNextPlayerId(r.value),setTimeout(()=>{d.value=2,y.value=r.value,J.value=!1},U.value*1e3)},l?0:U.value*1e3*2):setTimeout(()=>{const t=S.value;S.value=r.value,setTimeout(()=>{d.value=2,y.value=t},U.value*1e3)},l?0:U.value*1e3*2))},ge=async l=>{if(await new Promise(c=>setTimeout(c,5)),!$.value(l))return;const t=l===r.value?"robot":r.value;switch(d.value){case 2:{a(l);break}case 3:{await o(),setTimeout(()=>{const c=h.value.filter(i=>!i.selected),A=se.value(t);if(A&&_.value<A.displayValue)for(let i=6;i>=1;i--){const f=c.filter(L=>L.value===i&&!Y.value(i));if(f.length){const L=f.length*(i===6?5:i);if(_.value+L===A.displayValue){b(f[0],l);return}}}for(let i=6;i>=1;i--){const f=h.value.find(L=>L.value===i);if(f&&!Y.value(i)){b(f,l);return}}},U.value*1e3);break}case 4:{setTimeout(()=>{const c=se.value(t),A=h.value.filter(i=>!i.selected).length;if(!A||_.value>=30){A?console.log(l,"i am rich"):console.log(l,"i can only pick a tile now");for(let i=_.value;i>=21;i--){const f=T.value.find(L=>L.displayValue===i);if(f){B(f,void 0,l);return}}A&&a(l)}if(T.value.every(i=>i.displayValue>_.value)&&c&&c.displayValue>_.value)console.log(l,"my score is too low"),a(l);else if(c&&c.displayValue===_.value)console.log(l,"i can steal"),B(c,t,l);else if(new Set(h.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(h.value.filter(i=>!i.selected).length<=2){console.log(l,"there aren't that much dices left");const i=T.value.filter(f=>f.displayValue>=_.value-5&&f.displayValue<=_.value).sort((f,L)=>L.displayValue-f.displayValue);i.length?(console.log(l,"i choose the highest score within 5 tiles"),B(i[0],void 0,l)):(console.log(l,"i choose to roll again"),a(l))}else console.log(l,"i have nothing to worry about"),a(l);else if(!G.value)console.log(l,"i am worrying and have no worm yet"),a(l);else{console.log(l,"if i can choose, i choose");const i=T.value.filter(f=>f.displayValue<=_.value).sort((f,L)=>L.displayValue-f.displayValue);i.length?(console.log(l,"i choose the highest score"),B(i[0],void 0,l)):(console.log(l,"i choose to roll again"),a(l))}},U.value*1e3);break}default:console.log(l,"DEFAULT",d.value)}},Ve=()=>{const l=Math.max(...Object.keys(m).map(c=>q.value(c))),t=Object.keys(m).filter(c=>q.value(c)===l);if(t.includes(r.value))if(t.length===1)j.value=1;else{const c=Math.max(...m[r.value].map(f=>f.displayValue)),A=t.filter(f=>f!==r.value)[0],i=Math.max(...m[A].map(f=>f.displayValue));c>i?j.value=2:j.value=3}else j.value=4;Oe()},Oe=()=>{ee({gameId:M.value??null,score:q.value(r.value)})};return{gameType:P,gameStatus:d,gameStatusLoading:J,myPlayerId:r,gameStatusActivatorId:y,finishStatus:j,loseStatus:le,activePlayerId:S,isFullyAutomatic:Q,dices:h,tiles:T,score:m,robotSpeed:U,isRolling:F,hasWorm:G,hasAlreadyChosen:Y,canSelectAnyTile:ie,canPlay:$,visibleTile:se,selectedDiceTotal:_,totalScore:q,personalBest:x,highscorePosition:W,games:D,gamesLoading:C,gameId:M,creatorId:R,players:I,opponents:O,chat:ue,isOwner:ne,$reset:N,start:he,roll:a,hasFinishedRolling:o,hasLostRound:n,loseTurn:g,popLastTile:w,selectDice:b,selectTile:B,passTurn:oe,setPreviousHighscores:v,updateRainwormsHighscore:Oe,sortHighscores:Z,fetchOnlineGames:u.fetchGames,createOnlineGame:me,continueOnlineGame:ae,leaveOnlineGame:u.leaveGame,deleteOnlineGame:u.deleteGame}},{}),Re=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],He=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],al={class:"flex flex-col gap-3"},ul=Ue({__name:"GameSettingsDialog",props:Ge({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const u=e,p=$e(e,"isOpen"),x=pe(),{useAudio:W,diceRollSpeed:k}=X(pe()),{robotSpeed:D}=X(sl()),{doAutocomplete:C}=X(Ze()),M=H(()=>{switch(u.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)";case V.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Ae(()=>{x.$init(u.gameId)}),(R,I)=>(ve(),de(Ce,{isOpen:p.value,title:"Game Settings",description:e.gameId?`Current version: ${M.value}`:"General settings",cancelText:"Close",onCancel:I[4]||(I[4]=O=>p.value=!1)},{default:Be(()=>[je("div",al,[Fe(be,{name:"useAudio",label:"Audio",modelValue:K(W),"onUpdate:modelValue":I[0]||(I[0]=O=>fe(W)?W.value=O:null)},null,8,["modelValue"]),e.gameId===K(V).PATIENCE?(ve(),de(be,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:K(C),"onUpdate:modelValue":I[1]||(I[1]=O=>fe(C)?C.value=O:null)},null,8,["modelValue"])):Se("",!0),e.gameId===K(V).YAHTZEE||e.gameId===K(V).RAINWORMS?(ve(),de(_e,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:K(k),"onUpdate:modelValue":I[2]||(I[2]=O=>fe(k)?k.value=O:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),e.gameId===K(V).RAINWORMS?(ve(),de(_e,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:K(D),"onUpdate:modelValue":I[3]||(I[3]=O=>fe(D)?D.value=O:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)])]),_:1},8,["isOpen","description"]))}});export{Ye as C,qe as D,el as F,Qe as G,Xe as L,ul as _,Ze as a,ze as b,sl as u};
