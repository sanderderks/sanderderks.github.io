import{d as te,w as n,f as c,g as me,j as D,k as t,q as v,aL as g,P as p,h as o,Q as S,_ as oe,c as ve,aE as ge,s as re,a9 as fe,aM as Ve,ai as we,L as ce,l as x,A as d,a5 as F,a2 as O,a3 as I,I as $,a4 as k,m as z,T as C,aH as De,aI as pe,aJ as be,r as ye,U as ae,aN as Ue,a0 as le,aK as xe,ao as Fe}from"../bundle.js";import{_ as Oe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-CFG94sGa.js";import{u as ke}from"./c-useUsers-b70JZ-jJ.js";const Ce={class:"flex flex-col gap-3 md:px-5"},Se={class:"mt-3 flex justify-evenly font-bold"},Le=te({__name:"PetLogDialogSection",props:{id:{},log:{}},emits:["error","delete"],setup(N,{expose:L,emit:u}){const b=u,y=n(),f=n(),V=n(),w=n(),P=c(()=>[V.value,w.value].some(e=>!!e));return L({test:async()=>{var e,i;await Promise.all([(e=y.value)==null?void 0:e.test(),(i=f.value)==null?void 0:i.test()]),b("error",P.value)}}),(e,i)=>(D(),me("div",Ce,[t(g,{ref_key:"dateField",ref:y,id:e.id,name:"logDate",label:"Date",modelValue:e.log.date,"onUpdate:modelValue":i[0]||(i[0]=s=>e.log.date=s),error:V.value,"onUpdate:error":i[1]||(i[1]=s=>V.value=s),"without-time":""},null,8,["id","modelValue","error"]),t(p,{ref_key:"weightField",ref:f,id:e.id,name:"logWeight",label:"Weight (kg)","model-value":`${e.log.weight}`,"onUpdate:modelValue":i[2]||(i[2]=s=>e.log.weight=Number(s)),error:w.value,"onUpdate:error":i[3]||(i[3]=s=>w.value=s),rules:[o(S).Required,o(S).Numeric],"min-value":0,"input-props":{type:"number"}},null,8,["id","model-value","error","rules"]),v("div",Se,[t(oe,{class:"w-full sm:w-2/3 md:w-1/2 xl:w-2/3",variant:"danger",outlined:"",label:"Delete",onClick:i[4]||(i[4]=s=>e.$emit("delete"))})])]))}}),Pe={class:"pt-6 mb-4 xl:px-16 flex flex-col gap-3"},Be={class:"flex gap-5"},he={class:"flex justify-center"},Ie={class:"basis-full lg:basis-1/2"},Ee=te({__name:"PetDialog",props:{isOpen:{type:Boolean},originalPet:{}},emits:["close"],setup(N,{emit:L}){const u=N,b=L,y=ve(),f=ge(),{isMutationLoading:V}=re(f),{firebaseUser:w}=re(y),{mappedUsers:P}=ke(),B=l=>({name:{value:(l==null?void 0:l.name)??"",error:""},description:{value:(l==null?void 0:l.description)??"",error:""},coOwnerId:{value:(l==null?void 0:l.coOwnerId)??"",error:""},avatar:{value:(l==null?void 0:l.avatar)??"",error:""},dateOfBirth:{value:l!=null&&l.dateOfBirth?new Date(l.dateOfBirth):null,error:""},type:{value:(l==null?void 0:l.type)??"cat",error:""},breed:{value:(l==null?void 0:l.breed)??"",error:""},breedSize:{value:(l==null?void 0:l.breedSize)??"medium",error:""},gender:{value:(l==null?void 0:l.gender)??"male",error:""},weight:{value:l!=null&&l.weight?l.weight.toString():"",error:""},insideCat:{value:(l==null?void 0:l.insideCat)??!1,error:""},castrated:{value:(l==null?void 0:l.castrated)??!1,error:""},dewormingDate:{value:l!=null&&l.dewormingDate?new Date(l.dewormingDate):null,error:""},vetDate:{value:l!=null&&l.vetDate?new Date(l.vetDate):null,error:""},lastVaccinationDate:{value:l!=null&&l.lastVaccinationDate?new Date(l.lastVaccinationDate):null,error:""},nextVaccinationDate:{value:l!=null&&l.nextVaccinationDate?new Date(l.nextVaccinationDate):null,error:""},weightLog:{value:l!=null&&l.weightLog?l.weightLog.map(r=>({...r,date:new Date(r.date)})):[],error:{}}}),e=fe(B(u.originalPet)),i=c(()=>{var l,r;return{name:e.name.value,description:e.description.value,userId:((l=u.originalPet)==null?void 0:l.userId)??((r=w.value)==null?void 0:r.uid)??"",coOwnerId:e.coOwnerId.value??null,avatar:e.avatar.value,dateOfBirth:e.dateOfBirth.value??null,type:e.type.value,breed:e.breed.value,breedSize:e.breedSize.value,gender:e.gender.value,weight:isNaN(+e.weight.value)?null:+e.weight.value,insideCat:e.type.value==="cat"?e.insideCat.value:null,castrated:e.castrated.value,dewormingDate:e.dewormingDate.value??null,vetDate:e.vetDate.value??null,lastVaccinationDate:e.lastVaccinationDate.value??null,nextVaccinationDate:e.nextVaccinationDate.value??null,weightLog:e.weightLog.value}}),s=n(),E=n(),j=n(),M=n(),R=n(),T=n(),W=n(),q=n(),A=n(),K=n(),G=n(),H=n(),J=n(),Q=n(),X=n(),Y=n([]),h=c(()=>u.originalPet?Ve.convert(u.originalPet):null),Z=c(()=>!we(h.value,i.value)),_=c(()=>{if(e.name.value)return e.name.value;switch(e.type.value){case"cat":return"Cat";case"dog":return"Dog";default:return"Pet"}}),ne=async()=>{var l,r,a,U;await Promise.all([s.value.test(),E.value.test(),j.value.test(),M.value.test(),R.value.test(),T.value.test(),(l=W.value)==null?void 0:l.test(),q.value.test(),(r=A.value)==null?void 0:r.test(),(a=K.value)==null?void 0:a.test(),G.value.test(),H.value.test(),Q.value.test(),X.value.test(),J.value.test()]);for(const m of Y.value)await(m==null?void 0:m.test());e.name.error||e.description.error||e.coOwnerId.error||e.avatar.error||e.dateOfBirth.error||e.type.error||e.breed.error||e.breedSize.error||e.gender.error||e.weight.error||e.insideCat.error||e.castrated.error||e.dewormingDate.error||e.vetDate.error||e.lastVaccinationDate.error||e.nextVaccinationDate.error||Object.values(e.weightLog.error).some(m=>!!m)||(await f.mutatePet(i.value,(U=u.originalPet)==null?void 0:U.id),b("close"))},ie=()=>{e.weightLog.value.push({date:new Date,weight:0})},ee=l=>e.weightLog.value.findIndex(r=>r.date.toString()===l),de=l=>{e.weightLog.value.splice(ee(l),1)},se=(l,r)=>{e.weightLog.error[ee(r)]=l},ue=()=>{b("close")};return ce(()=>[u.isOpen,u.originalPet],()=>{Object.assign(e,B(u.originalPet))}),(l,r)=>(D(),x(Oe,{isOpen:l.isOpen,title:h.value?"Update Pet":"Create Pet",description:"Keep in mind that pet data is visible to all authenticated users.","confirm-text":h.value?Z.value?"Update":"Nothing changed":"Create","confirm-loading":o(V),"confirm-props":{disabled:!Z.value},onConfirm:ne,onCancel:ue},{default:d(()=>[v("form",Pe,[t(p,{ref_key:"nameField",ref:s,id:"name",name:"name",label:"Name",placeholder:"Mogu",modelValue:e.name.value,"onUpdate:modelValue":r[0]||(r[0]=a=>e.name.value=a),error:e.name.error,"onUpdate:error":r[1]||(r[1]=a=>e.name.error=a),rules:[o(S).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),t(p,{ref_key:"descriptionField",ref:E,id:"description",name:"description",label:"Description",placeholder:"My cute pet.",modelValue:e.description.value,"onUpdate:modelValue":r[2]||(r[2]=a=>e.description.value=a),error:e.description.error,"onUpdate:error":r[3]||(r[3]=a=>e.description.error=a),"max-length":100},null,8,["modelValue","error"]),t(o(le),null,{default:d(()=>[t(o(F),{value:"details"},{default:d(()=>[t(o(O),null,{default:d(()=>[I($(_.value)+"'s Details ",1)]),_:1}),t(o(k),{"pt:content":"flex flex-col gap-3"},{default:d(()=>[t(C,{name:"coOwnerId",label:"Co-owner",modelValue:e.coOwnerId.value,"onUpdate:modelValue":r[4]||(r[4]=a=>e.coOwnerId.value=a),error:e.coOwnerId.error,"onUpdate:error":r[5]||(r[5]=a=>e.coOwnerId.error=a),options:[{value:"",label:"No co-owner"},...o(P).filter(a=>a.value!==i.value.userId)]},null,8,["modelValue","error","options"]),t(g,{ref_key:"dateOfBirthField",ref:M,name:"dateOfBirth",label:"Date of birth",modelValue:e.dateOfBirth.value,"onUpdate:modelValue":r[6]||(r[6]=a=>e.dateOfBirth.value=a),error:e.dateOfBirth.error,"onUpdate:error":r[7]||(r[7]=a=>e.dateOfBirth.error=a),"without-time":""},null,8,["modelValue","error"]),t(C,{ref_key:"typeField",ref:R,name:"type",label:"Type",modelValue:e.type.value,"onUpdate:modelValue":r[8]||(r[8]=a=>e.type.value=a),error:e.type.error,"onUpdate:error":r[9]||(r[9]=a=>e.type.error=a),options:o(De)},null,8,["modelValue","error","options"]),t(p,{ref_key:"breedField",ref:T,id:"breed",name:"breed",label:"Breed",placeholder:e.type.value==="dog"?"Golden Retriever":"Maine Coone",modelValue:e.breed.value,"onUpdate:modelValue":r[10]||(r[10]=a=>e.breed.value=a),error:e.breed.error,"onUpdate:error":r[11]||(r[11]=a=>e.breed.error=a),"min-length":3,"max-length":50},null,8,["placeholder","modelValue","error"]),e.type.value==="dog"?(D(),x(C,{key:0,ref_key:"breedSizeField",ref:W,name:"breedSize",label:"Breed Size",modelValue:e.breedSize.value,"onUpdate:modelValue":r[12]||(r[12]=a=>e.breedSize.value=a),error:e.breedSize.error,"onUpdate:error":r[13]||(r[13]=a=>e.breedSize.error=a),options:o(pe)},null,8,["modelValue","error","options"])):z("",!0),t(C,{ref_key:"genderField",ref:q,name:"gender",label:"Gender",modelValue:e.gender.value,"onUpdate:modelValue":r[14]||(r[14]=a=>e.gender.value=a),error:e.gender.error,"onUpdate:error":r[15]||(r[15]=a=>e.gender.error=a),options:o(be)},null,8,["modelValue","error","options"])]),_:1})]),_:1}),t(o(F),{value:"health"},{default:d(()=>[t(o(O),null,{default:d(()=>[I($(_.value)+"'s Health ",1)]),_:1}),t(o(k),{"pt:content":"flex flex-col gap-3"},{default:d(()=>[e.weightLog.value.length?z("",!0):(D(),x(p,ye({key:0,ref_key:"weightField",ref:A,name:"weight",label:"Weight (kg)",modelValue:e.weight.value,"onUpdate:modelValue":r[16]||(r[16]=a=>e.weight.value=a),error:e.weight.error,"onUpdate:error":r[17]||(r[17]=a=>e.weight.error=a)},e.weight.value?{rules:[o(S).Numeric],minValue:0}:void 0,{"input-props":{type:"number"}}),null,16,["modelValue","error"])),e.type.value==="cat"?(D(),x(ae,{key:1,ref_key:"insideCatField",ref:K,name:"insideCat",label:"Inside Cat",modelValue:e.insideCat.value,"onUpdate:modelValue":r[18]||(r[18]=a=>e.insideCat.value=a)},null,8,["modelValue"])):z("",!0),t(ae,{ref_key:"castratedField",ref:G,name:"castrated",label:"Castrated or Sterilized",modelValue:e.castrated.value,"onUpdate:modelValue":r[19]||(r[19]=a=>e.castrated.value=a)},null,8,["modelValue"]),t(g,{ref_key:"vetDateField",ref:J,name:"vetDate",label:"Last vet visit",modelValue:e.vetDate.value,"onUpdate:modelValue":r[20]||(r[20]=a=>e.vetDate.value=a),error:e.vetDate.error,"onUpdate:error":r[21]||(r[21]=a=>e.vetDate.error=a),"without-time":""},null,8,["modelValue","error"]),t(g,{ref_key:"lastVaccinationDateField",ref:Q,name:"lastVaccinationDate",label:"Last vaccination",modelValue:e.lastVaccinationDate.value,"onUpdate:modelValue":r[22]||(r[22]=a=>e.lastVaccinationDate.value=a),error:e.lastVaccinationDate.error,"onUpdate:error":r[23]||(r[23]=a=>e.lastVaccinationDate.error=a),"without-time":""},null,8,["modelValue","error"]),t(g,{ref_key:"nextVaccinationDateField",ref:X,name:"nextVaccinationDate",label:"Next vaccination",modelValue:e.nextVaccinationDate.value,"onUpdate:modelValue":r[24]||(r[24]=a=>e.nextVaccinationDate.value=a),error:e.nextVaccinationDate.error,"onUpdate:error":r[25]||(r[25]=a=>e.nextVaccinationDate.error=a),"without-time":""},null,8,["modelValue","error"]),t(g,{ref_key:"dewormingDateField",ref:H,name:"dewormingDate",label:"Last deworming date",modelValue:e.dewormingDate.value,"onUpdate:modelValue":r[26]||(r[26]=a=>e.dewormingDate.value=a),error:e.dewormingDate.error,"onUpdate:error":r[27]||(r[27]=a=>e.dewormingDate.error=a),"without-time":""},null,8,["modelValue","error"])]),_:1})]),_:1}),t(o(F),{value:"Weight Log"},{default:d(()=>[t(o(O),null,{default:d(()=>r[31]||(r[31]=[I(" Weight Log ")])),_:1,__:[31]}),t(o(k),{"pt:content":"flex flex-col gap-3"},{default:d(()=>[t(o(Ue),{ref:"draggable",class:"flex flex-col gap-3",modelValue:e.weightLog.value,"onUpdate:modelValue":r[28]||(r[28]=a=>e.weightLog.value=a),itemKey:a=>a.date.toString(),handle:".drag-handle"},{item:d(({element:a,index:U})=>[t(o(le),null,{default:d(()=>[t(o(F),{value:"0"},{default:d(()=>[t(o(O),{class:"drag-handle"},{default:d(()=>[v("div",Be,[r[32]||(r[32]=v("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),v("p",null,$(o(xe)(a.date)),1)])]),_:2},1024),t(o(k),null,{default:d(()=>[t(Le,{ref:m=>{Y.value[U]=m},id:a.date.toString(),log:a,onDelete:m=>de(a.date.toString()),onError:m=>se(m,a.date.toString())},null,8,["id","log","onDelete","onError"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),v("div",he,[t(oe,{class:"w-1/2",variant:"green",label:"Add Log",onClick:ie})])]),_:1})]),_:1})]),_:1}),v("div",Ie,[t(Fe,{ref_key:"avatarField",ref:j,id:"avatar",name:"avatar",label:"Avatar",modelValue:e.avatar.value,"onUpdate:modelValue":r[29]||(r[29]=a=>e.avatar.value=a),error:e.avatar.error,"onUpdate:error":r[30]||(r[30]=a=>e.avatar.error=a),"is-public":"","blog-post":null,"image-props":{class:"rounded-full"},"image-container-props":{class:"!h-64 !w-64"}},null,8,["modelValue","error"])])])]),_:1},8,["isOpen","title","confirm-text","confirm-loading","confirm-props"]))}});export{Ee as _};
