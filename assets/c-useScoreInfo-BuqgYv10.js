import{d as U,a as F,g as r,m as u,j as s,l as $,y as J,A as H,a3 as _,q as a,h as t,R as M,_ as S,w as L,f,aD as K,v as Q,aV as A,s as B,o as V,ax as W,L as X,k as N,N as Y,C as P,E as Z,I as p,x as ee,z as te,c as se}from"../bundle.js";import{_ as oe}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"flex flex-wrap gap-3 mt-3 justify-center"},Ie=U({__name:"AddToLeaderboard",props:{isLoggedIn:{type:Boolean},isSolo:{type:Boolean},isGameOver:{type:Boolean},finalScore:{},personalBest:{},redirectRoute:{},showIf:{type:Boolean}},emits:["updateHighscore"],setup(c){const d=F();return(l,o)=>l.isGameOver?(s(),r("div",ne,[l.isLoggedIn?l.showIf!==!1&&l.isSolo&&l.finalScore>l.personalBest?(s(),$(S,{key:1,class:"w-full md:w-1/2",variant:"primary",onClick:o[1]||(o[1]=v=>l.$emit("updateHighscore"))},{default:H(()=>o[4]||(o[4]=[_(" Add To Leaderboard ")])),_:1,__:[4]})):u("",!0):(s(),$(J,{key:0,class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:H(()=>[o[2]||(o[2]=_(" Please ")),a("a",{class:"cursor-pointer",onClick:o[0]||(o[0]=v=>t(d).push({name:t(M).LOGIN,params:{redirect:JSON.stringify({name:l.redirectRoute})}}))}," Login "),o[3]||(o[3]=_(" to add your score to the leaderboard. "))]),_:1,__:[2,3]}))])):u("",!0)}}),ae=(c,d)=>{const l=L(0),o=f(()=>K(c)),v=f(()=>(l.value+1)*d),g=f(()=>v.value-d),y=f(()=>l.value>0),m=f(()=>o.value.length>v.value),b=f(()=>o.value.filter((i,w)=>w>=g.value&&w<v.value));return{page:l,perPage:d,visibleData:b,hasPrevious:y,hasNext:m,$reset:()=>{l.value=0}}},le={class:"mt-5 flex flex-col items-center"},re={class:"w-full overflow-x-auto"},ie={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},ue={key:0},de={key:0},ce={key:1},fe={key:1},ve={key:0},he={key:1},me={key:2},pe={key:3},ge={key:2},ye={key:3},ke={key:4},_e={colspan:"100%"},be=U({__name:"Highscores",props:{gameId:{},unit:{}},setup(c){const d=c,l=Q(),o=A(),{publicUsers:v}=B(l),{allGameData:g,fetchLoading:y}=B(o),{fetchGameData:m,fetchHighscores:b,fetchScores:I}=o,i=L("highscores"),w=L(),T=f(()=>g.value[d.gameId].gameData[i.value]),{page:x,perPage:j,visibleData:h,hasPrevious:C,hasNext:G,$reset:O}=ae(()=>T.value,10),E=k=>{var e;return((e=v.value.find(n=>n.id===k))==null?void 0:e.displayName)??"Unknown"},R=k=>{O(),i.value=k},z=()=>{i.value==="highscores"?b():I()};return V(()=>{o.$init(d.gameId),m(),w.value=setInterval(()=>{m()},1e3*60*5)}),W(()=>{clearInterval(w.value)}),X(i,()=>{g.value[d.gameId].gameData[i.value].length||z()}),(k,e)=>(s(),r("div",le,[N(t(Y),{class:"w-full md:w-1/2"},{default:H(()=>[N(S,{class:"w-full",variant:"secondary",outlined:i.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=n=>R("highscores"))},null,8,["outlined"]),N(S,{class:"w-full",variant:"secondary",outlined:i.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=n=>R("scores"))},null,8,["outlined"])]),_:1}),a("div",re,[a("table",ie,[t(h).length?(s(),r("thead",ue,[a("tr",null,[e[4]||(e[4]=a("th",null,"Rank",-1)),e[5]||(e[5]=a("th",null,"User",-1)),e[6]||(e[6]=a("th",null,"Score",-1)),t(h).length&&t(h).some(n=>n.difficulty)?(s(),r("th",de,"Difficulty")):u("",!0),e[7]||(e[7]=a("th",null,"Date",-1)),t(h).length&&t(h).some(n=>n.bonus)?(s(),r("th",ce,"Bonus")):u("",!0)])])):u("",!0),t(h).length?(s(),r("tbody",fe,[(s(!0),r(P,null,Z(t(h),(n,q)=>(s(),r("tr",null,[a("th",null,p(q+1+t(x)*t(j)),1),a("th",null,p(E(n.userId??n.id)),1),a("td",null,[_(p(n.score)+" ",1),k.unit?(s(),r(P,{key:0},[_(p(k.unit),1),n.score!==1?(s(),r(P,{key:0},[_("s")],64)):u("",!0)],64)):u("",!0)]),n.difficulty?(s(),r("td",ve,p(n.difficulty),1)):t(h).some(D=>D.difficulty)?(s(),r("td",he)):u("",!0),a("td",null,p(t(ee)(n.date)),1),n.bonus?(s(),r("td",me,p(n.bonus),1)):t(h).some(D=>D.bonus)?(s(),r("td",pe)):u("",!0)]))),256))])):t(y)?(s(),r("tbody",ge,e[8]||(e[8]=[a("tr",null,[a("th",null,"Loading highscores...")],-1)]))):(s(),r("tbody",ye,[a("tr",null,[a("th",null,"There are no "+p(i.value==="highscores"?"highscores":"scores")+" yet.",1)])])),t(C)||t(G)?(s(),r("tfoot",ke,[a("tr",null,[a("td",_e,[a("div",{class:te(["w-full p-2 flex",[t(C)?"justify-between":"justify-end"]])},[t(C)?(s(),$(S,{key:0,class:"w-fit",label:"Previous",variant:"neutral",onClick:e[2]||(e[2]=n=>x.value-=1)})):u("",!0),t(G)?(s(),$(S,{key:1,class:"w-fit",label:"Next",variant:"neutral",onClick:e[3]||(e[3]=n=>x.value+=1)})):u("",!0)],2)])])])):u("",!0)])])]))}}),$e=oe(be,[["__scopeId","data-v-b42fb3e6"]]),Be=c=>{const d=se(),l=A(),{allGameData:o,highscorePosition:v,personalBest:g}=B(l),{firebaseUser:y}=B(d),m=f(()=>y.value?v.value:null),b=f(()=>{if(!c)return!1;const i=o.value[c].previousHighscorePosition;return m.value&&i?i>m.value:!1}),I=f(()=>{if(!c)return!1;const i=o.value[c].previousPersonalBest;return y.value&&i?i<g.value:!1});return V(()=>{l.$init(c)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:I}};export{$e as H,Ie as _,Be as u};
