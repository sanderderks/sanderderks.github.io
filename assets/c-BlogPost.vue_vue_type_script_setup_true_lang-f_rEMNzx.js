import{e as V,s as y,o as Q,a5 as K,as as Y,at as q,au as F,av as C,aw as W,c as j,v as D,d as M,b as J,g as c,k,w as A,f as s,R as B,H as z,x as T,ax as X,y as I,q as L,_ as U,l as E,m as R,h as x,ai as Z,j as S,O as _,E as ee,P as te,z as O,C as N,ay as oe,az as se,a8 as ae,aA as ie,a as ne,t as le,A as re,D as ce,I as ue,J as de}from"../bundle.js";const pe=e=>{const t=V(),{collections:r,fetchBlogPost:m,checkBlogPostForUnreadReactions:f}=t,{blogPosts:P,blogReactions:v,isBlogPostDatabaseActionActive:l}=y(t);let d=[];const b=D(),u=a=>{a.metadata.hasPendingWrites||l.value||(clearTimeout(b.value),b.value=setTimeout(async()=>{await m(e.id,void 0,{loadingIndicator:!1}),f(P.value.previousData.single,!0)},200))};Q(async()=>{v.value.unread=v.value.unread.filter(G=>G.postId!==e.id);const a=K(e),o=r.blogPosts(a.isPrivate),i=r.blogReactions(a.isPrivate),n=Y(o,e.id),p=q(o,F("id","==",e.id)),w=q(i,F("post","==",n));d.push(C(p,u)),d.push(C(w,u))}),W(()=>{clearTimeout(b.value),d.forEach(a=>{a()})})},we=()=>{const e=V(),t=j(),{visibleBlogPosts:r,blogReactions:m,isBlogPostDatabaseActionActive:f}=y(e),{firebaseUser:P,isLoggedIn:v}=y(t),{collections:l,fetchBlogPosts:d,checkBlogPostsForUnreadReactions:b}=e;let u=[];const a=D(),o=i=>{i.metadata.hasPendingWrites||f.value||(clearTimeout(a.value),a.value=setTimeout(async()=>{var n;r.value.length&&(await d((n=P.value)==null?void 0:n.uid,{amount:r.value.length,loadingIndicator:!1}),b())},200))};Q(()=>{m.value.unread=[],u.push(C(l.blogPosts(!1),o)),u.push(C(l.blogReactions(!1),o)),v.value&&(u.push(C(l.blogPosts(!0),o)),u.push(C(l.blogReactions(!0),o)))}),W(()=>{clearTimeout(a.value),u.forEach(i=>{i()})})},ge={class:"flex flex-col gap-2"},H=M({__name:"BlogReaction",props:{post:{},reaction:{}},setup(e){const t=e,r=J(),m=j(),f=V(),{routeLoading:P,routeLoadingId:v}=y(r),{firebaseUser:l,isLoggedIn:d,isOwner:b}=y(m),{blogReactions:u}=y(f),{deleteBlogReaction:a}=f,o=R(()=>l.value&&t.reaction.user.id===l.value.uid||b.value);return(i,n)=>(c(),k(A,{id:t.reaction.id,class:T(["p-5 w-full md:w-3/4 xl:w-2/3",t.post.colorTertiary,t.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":s(P)===s(B).USER_DETAILS&&s(v)===t.reaction.user.id}},title:t.reaction.user.displayName||"Unknown user",subTitle:s(z)(t.reaction.date),avatar:t.reaction.user.avatar,route:s(d)?{name:s(B).USER_DETAILS,params:{userId:t.reaction.user.id}}:void 0,avatarRoute:s(d)?{name:s(B).USER_DETAILS,params:{userId:t.reaction.user.id}}:void 0,description:t.reaction.message},X({_:2},[o.value?{name:"right",fn:I(()=>[L("div",ge,[o.value&&!t.post.locked?(c(),k(U,{key:0,variant:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:s(u).isDatabaseDeletionActive,onClick:n[0]||(n[0]=p=>s(a)(t.reaction.id,t.post))},null,8,["disabled"])):E("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),ve={class:"grid justify-items-center p-5 gap-5"},me=M({__name:"BlogReactions",props:{post:{}},setup(e){const t=e,r=J(),m=j(),f=V(),{content:P}=y(r),{firebaseUser:v,isLoggedIn:l}=y(m),{blogReactions:d}=y(f),{createBlogReaction:b}=f,u=D(),a=D(!1),o=ae({reaction:{value:"",error:""}}),i=R(()=>[...t.post.reactions].reverse()),n=R(()=>i.value.filter(($,g)=>g<3)),p=R(()=>i.value.filter(($,g)=>g>=3)),w=R(()=>t.post.locked||!l.value||d.value.isDatabaseCreationActive),G=async()=>{if(!d.value.isDatabaseCreationActive){if(await u.value.test(),!o.reaction.error&&v.value){const $=o.reaction.value;o.reaction.value="Replying...";const g=await b(t.post,{userId:v.value.uid,postId:t.post.id,message:$,date:new Date});o.reaction.value=g?"":$}ie()}};return($,g)=>(c(),x("form",{action:"",onSubmit:Z(G,["prevent"])},[L("div",ve,[!s(l)||e.post.reactions.filter(h=>h.user.id===s(v).uid).length<20?(c(),k(A,{key:0,class:T(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",e.post.colorTertiary||"bg-secondary-700",e.post.opacityTertiary||"bg-opacity-25"])},{default:I(()=>[S(_,{class:"w-5/6",id:e.post.id,inputProps:{class:["!bg-neutral-900 rounded-primary border-none !placeholder-gray-300",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-600",e.post.opacitySecondary||"!bg-opacity-20",w.value?{"!bg-gray-900 !bg-opacity-50":!s(d).isDatabaseCreationActive}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!s(l)&&!e.post.locked}],disabled:w.value,autocomplete:"off"},ref_key:"reaction",ref:u,name:"reaction",placeholder:e.post.locked?"Locked for comments":s(l)?"Reply":s(P).blogLoginGuest,modelValue:o.reaction.value,"onUpdate:modelValue":g[0]||(g[0]=h=>o.reaction.value=h),error:o.reaction.error,"onUpdate:error":g[1]||(g[1]=h=>o.reaction.error=h),rules:[s(te).Required],onClick:g[2]||(g[2]=()=>!s(l)&&!e.post.locked?s(ee).push({name:s(B).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):E("",!0),(c(!0),x(O,null,N(n.value,h=>(c(),k(H,{post:e.post,reaction:h},null,8,["post","reaction"]))),256)),(c(!0),x(O,null,N(p.value,h=>oe((c(),k(H,{post:e.post,reaction:h},null,8,["post","reaction"])),[[se,a.value]])),256)),e.post.reactions.length>3?(c(),k(U,{key:1,outlined:"",icon:a.value?"pi pi-angle-up":"pi pi-angle-down",label:a.value?"Hide older reactions":"View older reactions",onClick:g[3]||(g[3]=h=>a.value=!a.value)},null,8,["icon","label"])):E("",!0)])],32))}}),fe={class:"flex flex-wrap justify-end h-fit gap-3"},be=M({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(e){return(t,r)=>(c(),x("div",fe,[S(U,{class:"min-w-80",label:"Edit",onClick:r[0]||(r[0]=m=>t.$emit("editClicked"))}),S(U,{class:"min-w-80",variant:"danger",outlined:"",label:"Delete",onClick:r[1]||(r[1]=m=>t.$emit("deleteClicked"))})]))}}),ye={class:"flex justify-between h-fit mt-2 gap-2"},he={class:"flex flex-wrap gap-3"},ke=M({__name:"BlogPost",props:{post:{},withoutMutation:{type:Boolean}},emits:["editClicked","deleteClicked"],setup(e){const t=e,r=ne(),m=j(),f=le(),{publicUsers:P}=y(f),{firebaseUser:v,isOwner:l}=y(m);r.currentRoute.value.name!==B.BLOG&&pe(t.post);const d=R(()=>{var o;return(o=t.post.allowedUserIds)!=null&&o.length?P.value.filter(i=>{var n;return(n=t.post.allowedUserIds)==null?void 0:n.includes(i.id)}):[]}),b=R(()=>{const o=z(t.post.date);return t.post.dateUpdated?o+` - updated ${z(t.post.dateUpdated)}`:o}),u=R(()=>{const o=[];return t.post.datePinned&&o.push({value:"Pinned",severity:"success",rounded:!1}),t.post.locked&&o.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),t.post.archived&&o.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),o}),a=()=>{const o=document.createElement("textarea"),{protocol:i,hostname:n,port:p}=window.location,w=`${i}//${n}`+(n==="localhost"?`:${p}`:"");o.value=`${w}#${ue.BLOG.path}/${t.post.id}`,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),de.success("Copied link!")};return(o,i)=>(c(),k(A,{id:e.post.id,class:T(["border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:b.value,tags:u.value,loading:e.post.loading,clickable:"",route:{name:s(B).BLOG_DETAILS,params:{postId:e.post.id}}},{right:I(()=>[S(U,{class:"h-fit",variant:"neutral",icon:"pi pi-copy",text:"",onClick:a})]),default:I(()=>{var n;return[L("div",ye,[L("div",he,[(c(!0),x(O,null,N(d.value,p=>{var w;return c(),k(s(re),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:p.id===((w=s(v))==null?void 0:w.uid)?"You":p.displayName,rounded:""},null,8,["label"])}),256))]),s(l)&&!e.withoutMutation?(c(),x("div",{key:0,class:T(["flex justify-end ms-5",(n=e.post.allowedUserIds)!=null&&n.length?"flex-col md:flex-row":"flex-row"])},[S(be,{onEditClicked:i[0]||(i[0]=p=>o.$emit("editClicked")),onDeleteClicked:i[1]||(i[1]=p=>o.$emit("deleteClicked"))})],2)):E("",!0)]),S(A,{class:T(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5 flex flex-col gap-3",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{default:I(()=>[(c(!0),x(O,null,N(e.post.content,p=>(c(),k(ce,{key:p.id,post:e.post,block:p},null,8,["post","block"]))),128))]),_:1},8,["class"]),S(me,{post:e.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","loading","route"]))}});export{ke as _,be as a,we as u};
