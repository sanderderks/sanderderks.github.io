import{_ as Ve}from"./c-Dialog.vue_vue_type_script_setup_true_lang-CFG94sGa.js";import{aU as be,aV as pe,s as J,w as E,a9 as ke,f as b,o as Ae,aS as V,L as Ie,aW as re,b6 as Ce,aX as Pe,b7 as Te,aR as Le,c as De,aQ as q,b3 as Me,b4 as we,b5 as xe,d as We,aY as Ue,aZ as $e,l as ve,j as de,A as Be,q as je,k as Fe,m as Se,h as K,an as fe,U as Oe,T as _e}from"../bundle.js";var Ge=(l=>(l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(Ge||{});const Ee={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Ye=(l=>(l.STOCK_CLOSED="stock_closed",l.STOCK_OPEN="stock_open",l.PILE1="pile1",l.PILE2="pile2",l.PILE3="pile3",l.PILE4="pile4",l.PILE5="pile5",l.PILE6="pile6",l.PILE7="pile7",l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(Ye||{}),Ze=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.HAS_STARTED=1]="HAS_STARTED",l[l.HAS_FINISHED=2]="HAS_FINISHED",l))(Ze||{});const qe={easy:.5,hard:1},Re=()=>{const l=ze();return Ce(l),{pile1:l.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:l.splice(0,2).map((u,p)=>p<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:l.splice(0,3).map((u,p)=>p<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:l.splice(0,4).map((u,p)=>p<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:l.splice(0,5).map((u,p)=>p<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:l.splice(0,6).map((u,p)=>p<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:l.splice(0,7).map((u,p)=>p<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:l.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},Ke=be("patienceStore",()=>{const l=pe(),{personalBest:u,highscorePosition:p}=J(l),{setPreviousHighscores:x,updateHighscores:W,sortHighscores:k}=l,D=E("hard"),C=E(0),M=E(0),I=E(0),T=E(0),_=E(0),ue=E(),ne=E(!0),v=ke(Re()),ee=b(()=>qe[D.value]),z=b(()=>Object.keys(v).flatMap(s=>v[s])),U=1e3,P=10,d=10,Q=b(()=>{const s=I.value%10===0?I.value:Math.floor(I.value/10)*10,a=M.value*P,o=_.value*P,n=s+a+o,g=T.value*d;return Math.max(0,U-(n-g))}),j=b(()=>{const s=Math.floor(I.value/60),a=I.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),le=b(()=>v.hearts.length===13&&v.spades.length===13&&v.diamonds.length===13&&v.clubs.length===13);Ae(()=>{l.$init(V.PATIENCE),I.value&&C.value===1&&y()}),Ie(le,s=>{s&&C.value!==2&&(X(),C.value=2,ce(),re(Pe))});const r=()=>{X(),M.value=0,I.value=0,T.value=0,_.value=0,C.value=0,Object.assign(v,Re()),l.setPreviousHighscores()},S=()=>{I.value=0,y(),C.value=1,setTimeout(()=>{H()},500)},y=()=>{ue.value&&X(),ue.value=setInterval(()=>{I.value++},1e3)},X=()=>{clearInterval(ue.value)},h=()=>{const s=v.stock_open;s.length&&(s.reverse(),G(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,v.stock_closed.push(a)}),s.splice(0,s.length),N(1))},A=s=>{const a=s.deck,o=z.value.filter(n=>n.selected);if(a==="stock_closed"){const n=v.stock_closed,g=n.indexOf(s);if(g===n.length-1){const w=D.value==="hard"?g-2:g,R=w<0?0:w,B=n.filter((oe,ge)=>ge>=R);Y(),$(B,"stock_open",oe=>{oe.hidden=!1}),N(0)}}else if(a==="stock_open"){const n=v.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,o.length&&G(o[0],!1))}else if(o.length){const n=o[0];n===s?G(s,!1):ae(a)&&he(n,s)?s.value===n.value+1&&s.deck!==n.deck&&($(o,a),n.deck==="stock_open"?N(2):N(4)):o.length===1&&te(a)&&me(n,s)&&s.value===n.value-1&&(ie(n,a),N(3),n.hasBeenHome=!0)}else G(s,!0)},m=s=>{const a=z.value.filter(o=>o.selected);if(a.length){const o=a[0],n=o.deck;o.value===13&&($(a,s),n==="stock_open"?N(2):ae(o.deck)&&v[o.deck].every(g=>!g.hidden)?N(5):N(4))}},F=s=>{const a=z.value.filter(o=>o.selected);if(a.length===1){const o=a[0],n=o.type;!v[s].length&&n===s&&o.value===1&&(ie(o,s),N(3))}},G=(s,a,o)=>{const n=v[s.deck],g=n.indexOf(s);n.filter((R,B)=>B>=g).forEach(R=>{R.selected=a,o==null||o(R)})},Y=()=>{z.value.forEach(s=>{s.selected=!1})},ie=(s,a)=>{const o=s.deck,n=v[o].indexOf(s);s.deck=a,s.selected=!1,v[a].push(s),v[o].splice(n,1),(ae(o)||o==="stock_open")&&Z(o)},$=(s,a,o)=>{const n=s[0],g=n.deck,w=v[g].indexOf(n);G(n,!1,R=>{R.deck=a,o==null||o(R),v[a].push(R)}),v[g].splice(w,s.length),te(g)||Z(g!=="stock_closed"?g:a)},se=s=>{if(!ne.value)return!0;const a=v[s.type],o=a.length?a[a.length-1].value:0;if(s.value===o+1){const n=["hearts","spades","diamonds","clubs"],g=o<=1||n.every(w=>{const R=v[w];return(R.length?R[R.length-1].value:0)>=o});if(o===0||g)return ie(s,s.type),s.hasBeenHome=!0,N(3),!0}return!1},H=()=>{if(ne.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=v[s];if(a.length&&se(a[a.length-1]))return}},Z=s=>{const a=v[s];if(a.length){const o=a[a.length-1],n=o.deck;o.hidden=!1,setTimeout(()=>{o.deck===n&&(se(o)||H())},500)}else setTimeout(()=>{H()},500)},N=s=>{switch(s!==5&&M.value++,s){case 0:{_.value+=2*ee.value;break}case 1:{_.value+=5*ee.value;break}case 2:{T.value+=10*ee.value;break}case 3:{T.value+=20*ee.value;break}}re(Te)},he=(s,a)=>s.color!==a.color,me=(s,a)=>s.type===a.type,ae=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),te=s=>["hearts","spades","diamonds","clubs"].includes(s),ce=()=>{W({difficulty:D.value,score:Q.value,bonus:T.value,time:I.value,turns:M.value,penalty:_.value})};return{difficulty:D,gameStatus:C,score:Q,turns:M,time:I,bonus:T,penalty:_,cards:v,doAutocomplete:ne,allCards:z,formattedTime:j,personalBest:u,highscorePosition:p,$reset:r,start:S,shuffle:h,selectCard:A,selectEmptyDeck:m,selectFinalDeck:F,deselectAllCards:Y,isPlayDeck:ae,isFinalDeck:te,setPreviousHighscores:x,updatePatienceHighscore:ce,sortHighscores:k}},{persist:{enabled:!0}}),ze=()=>Object.keys(Ee).flatMap(l=>{const u=l,p=[];for(let x=0;x<13;x++){const W={type:u,label:Ee[u].label,color:Ee[u].color,value:x+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(W)}return p});var Qe=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.HAS_STARTED=2]="HAS_STARTED",l[l.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",l[l.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",l[l.HAS_LOST=6]="HAS_LOST",l[l.HAS_FINISHED=7]="HAS_FINISHED",l))(Qe||{}),Xe=(l=>(l[l.NONE=0]="NONE",l[l.HAS_LOST_TILE=1]="HAS_LOST_TILE",l[l.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",l))(Xe||{}),Je=(l=>(l[l.NONE=0]="NONE",l[l.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",l[l.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",l[l.WINNER_TIE=3]="WINNER_TIE",l[l.LOSER=4]="LOSER",l))(Je||{});const el=l=>{for(let u=1;u<=6;u++)if(l.every(p=>p.value===u))return!0;return!1},ll=be("rainwormsStore",()=>{const l=pe(),u=Le(),p=De(),{personalBest:x,highscorePosition:W}=J(l),{firebaseUser:k}=J(p),{games:D,gamesLoading:C,gameId:M,creatorId:I,players:T,opponents:_,chat:ue,isOwner:ne}=J(u),{setPreviousHighscores:v,updateHighscores:ee,sortHighscores:z}=l,U=E(1),P=E(q.SOLO),d=E(0),Q=E(!1),j=E(0),le=E(0),r=E("soloPlayer"),S=E(r.value),y=E(r.value),X=E(!1),h=E(He()),A=E(Ne()),m=ke({}),F=b(()=>h.value.some(e=>e.isRolling)),G=b(()=>h.value.filter(e=>e.selected).some(e=>e.value===6)),Y=b(()=>e=>h.value.some(t=>t.value===e&&t.selected)),ie=b(()=>A.value.some(e=>e.displayValue<=H.value)),$=b(()=>(e=r.value)=>S.value===e),se=b(()=>(e=r.value)=>{const t=m[e];return t.length?t[t.length-1]:null}),H=b(()=>{let e=0;return h.value.filter(t=>t.selected).forEach(t=>{e+=t.value===6?5:t.value}),e}),Z=b(()=>e=>{let t=0;return m[e].forEach(c=>{t+=c.value}),t});Ae(()=>{l.$init(V.RAINWORMS),F.value&&h.value.forEach(e=>{e.isRolling=!1})}),Ie(d,e=>{e===7?ye():P.value===q.SOLO&&(X.value||S.value==="robot")&&ge(S.value)}),Ie([d,S,F],()=>{P.value===q.MULTIPLAYER&&s()},{deep:!0});const N=()=>{u.$reset(),P.value=q.SOLO,d.value=0,j.value=0,le.value=0,r.value="soloPlayer",S.value=r.value,y.value=r.value,h.value=He(),A.value=Ne(),Object.keys(m).forEach(e=>{delete m[e]}),v()},he=()=>{P.value=q.SOLO,d.value=2,m[r.value]=[],m.robot=[]},me=e=>{k.value&&(e=[{userId:k.value.uid,isOnline:!0},...e],P.value=q.MULTIPLAYER,d.value=2,r.value=k.value.uid,S.value=r.value,y.value=r.value,e.forEach(t=>{m[t.userId]=[]}),u.$init(V.RAINWORMS,te,ce,N),u.createGame(e))},ae=e=>{k.value&&(P.value=q.MULTIPLAYER,r.value=k.value.uid,u.$init(V.RAINWORMS,te,ce,N),u.continueGame(e))},te=()=>({gameStatus:d.value,gameStatusActivator:y.value,activePlayer:S.value,dices:h.value,tiles:A.value,score:m}),ce=e=>{var c;const t=(c=k.value)==null?void 0:c.uid;!t||S.value===r.value||(d.value=e.gameStatus,y.value=e.gameStatusActivator,S.value=e.activePlayer,h.value=e.dices,A.value=e.tiles,Object.assign(m,e.score),Object.keys(m).includes(t)||(m[t]=[]))},s=()=>{!k.value||S.value!==r.value&&!Q.value||u.pushState()},a=(e=r.value)=>{if(!$.value(e))return;(d.value===2||d.value===5||d.value===6)&&h.value.forEach(c=>{c.selected=!1}),d.value=3;const t=l.diceRollSpeed*1e3;h.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=Me(6),c.isRolling=!1,h.value.sort((O,i)=>O.value-i.value),!F.value&&d.value!==6&&n()&&g(e)},we(t,t/3)))}),re(xe)},o=async()=>{for(;F.value;)await new Promise(e=>setTimeout(e,l.diceRollSpeed*1e3));return!0},n=()=>{const e=h.value.filter(t=>!t.selected&&!Y.value(t.value));return!e.length||el(e)&&e.every(t=>t.value!==6)&&h.value.filter(t=>t.selected).every(t=>t.value!==6)},g=(e=r.value)=>{d.value=6,y.value=e,m[y.value].length?le.value=1:le.value=2,w(),A.value.length===0?d.value=7:oe()},w=()=>{const e=m[S.value];if(e.length){const t=e.splice(e.length-1,1)[0];A.value.push(t),A.value.sort((c,O)=>c.displayValue-O.displayValue)}A.value.splice(A.value.length-1,1)},R=(e,t=r.value)=>{$.value(t)&&!F.value&&d.value===3&&!e.selected&&!Y.value(e.value)&&(d.value=4,h.value.filter(c=>c.value===e.value).forEach(c=>{c.selected=!0}),re(Te))},B=(e,t,c=r.value)=>{if($.value(c)&&(d.value===3||d.value===4)){if(t){const O=m[t];O.splice(O.length-1,1)}else A.value=A.value.filter(O=>O.displayValue!==e.displayValue);m[S.value].push(e),A.value.length===0?d.value=7:(d.value=5,y.value=c,oe()),re(Te)}},oe=e=>{(X.value||S.value!==r.value||d.value!==6||e)&&(S.value===r.value?setTimeout(()=>{Q.value=!0,S.value=P.value===q.SOLO?"robot":u.getNextPlayerId(r.value),setTimeout(()=>{d.value=2,y.value=r.value,Q.value=!1},U.value*1e3)},e?0:U.value*1e3*2):setTimeout(()=>{const t=S.value;S.value=r.value,setTimeout(()=>{d.value=2,y.value=t},U.value*1e3)},e?0:U.value*1e3*2))},ge=async e=>{if(await new Promise(c=>setTimeout(c,5)),!$.value(e))return;const t=e===r.value?"robot":r.value;switch(d.value){case 2:{a(e);break}case 3:{await o(),setTimeout(()=>{const c=h.value.filter(i=>!i.selected),O=se.value(t);if(O&&H.value<O.displayValue)for(let i=6;i>=1;i--){const f=c.filter(L=>L.value===i&&!Y.value(i));if(f.length){const L=f.length*(i===6?5:i);if(H.value+L===O.displayValue){R(f[0],e);return}}}for(let i=6;i>=1;i--){const f=h.value.find(L=>L.value===i);if(f&&!Y.value(i)){R(f,e);return}}},U.value*1e3);break}case 4:{setTimeout(()=>{const c=se.value(t),O=h.value.filter(i=>!i.selected).length;if(!O||H.value>=30){O?console.log(e,"i am rich"):console.log(e,"i can only pick a tile now");for(let i=H.value;i>=21;i--){const f=A.value.find(L=>L.displayValue===i);if(f){B(f,void 0,e);return}}O&&a(e)}if(A.value.every(i=>i.displayValue>H.value)&&c&&c.displayValue>H.value)console.log(e,"my score is too low"),a(e);else if(c&&c.displayValue===H.value)console.log(e,"i can steal"),B(c,t,e);else if(new Set(h.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(h.value.filter(i=>!i.selected).length<=2){console.log(e,"there aren't that much dices left");const i=A.value.filter(f=>f.displayValue>=H.value-5&&f.displayValue<=H.value).sort((f,L)=>L.displayValue-f.displayValue);i.length?(console.log(e,"i choose the highest score within 5 tiles"),B(i[0],void 0,e)):(console.log(e,"i choose to roll again"),a(e))}else console.log(e,"i have nothing to worry about"),a(e);else if(!G.value)console.log(e,"i am worrying and have no worm yet"),a(e);else{console.log(e,"if i can choose, i choose");const i=A.value.filter(f=>f.displayValue<=H.value).sort((f,L)=>L.displayValue-f.displayValue);i.length?(console.log(e,"i choose the highest score"),B(i[0],void 0,e)):(console.log(e,"i choose to roll again"),a(e))}},U.value*1e3);break}default:console.log(e,"DEFAULT",d.value)}},ye=()=>{const e=Math.max(...Object.keys(m).map(c=>Z.value(c))),t=Object.keys(m).filter(c=>Z.value(c)===e);if(t.includes(r.value))if(t.length===1)j.value=1;else{const c=Math.max(...m[r.value].map(f=>f.displayValue)),O=t.filter(f=>f!==r.value)[0],i=Math.max(...m[O].map(f=>f.displayValue));c>i?j.value=2:j.value=3}else j.value=4};return{gameType:P,gameStatus:d,gameStatusLoading:Q,myPlayerId:r,gameStatusActivatorId:y,finishStatus:j,loseStatus:le,activePlayerId:S,isFullyAutomatic:X,dices:h,tiles:A,score:m,robotSpeed:U,isRolling:F,hasWorm:G,hasAlreadyChosen:Y,canSelectAnyTile:ie,canPlay:$,visibleTile:se,selectedDiceTotal:H,totalScore:Z,personalBest:x,highscorePosition:W,games:D,gamesLoading:C,gameId:M,creatorId:I,players:T,opponents:_,chat:ue,isOwner:ne,$reset:N,start:he,roll:a,hasFinishedRolling:o,hasLostRound:n,loseTurn:g,popLastTile:w,selectDice:R,selectTile:B,passTurn:oe,setPreviousHighscores:v,updateRainwormsHighscore:()=>{ee({gameId:M.value??null,score:Z.value(r.value)})},sortHighscores:z,fetchOnlineGames:u.fetchGames,createOnlineGame:me,continueOnlineGame:ae,leaveOnlineGame:u.leaveGame,deleteOnlineGame:u.deleteGame}},{persist:{enabled:!0}}),He=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],Ne=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],sl={class:"flex flex-col gap-3"},ul=We({__name:"GameSettingsDialog",props:Ue({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(l){const u=l,p=$e(l,"isOpen"),x=pe(),{useAudio:W,diceRollSpeed:k}=J(pe()),{robotSpeed:D}=J(ll()),{doAutocomplete:C}=J(Ke()),M=b(()=>{switch(u.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)";case V.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Ae(()=>{x.$init(u.gameId)}),(I,T)=>(de(),ve(Ve,{isOpen:p.value,title:"Game Settings",description:I.gameId?`Current version: ${M.value}`:"General settings",cancelText:"Close",onCancel:T[4]||(T[4]=_=>p.value=!1)},{default:Be(()=>[je("div",sl,[Fe(Oe,{name:"useAudio",label:"Audio",modelValue:K(W),"onUpdate:modelValue":T[0]||(T[0]=_=>fe(W)?W.value=_:null)},null,8,["modelValue"]),I.gameId===K(V).PATIENCE?(de(),ve(Oe,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:K(C),"onUpdate:modelValue":T[1]||(T[1]=_=>fe(C)?C.value=_:null)},null,8,["modelValue"])):Se("",!0),I.gameId===K(V).YAHTZEE||I.gameId===K(V).RAINWORMS?(de(),ve(_e,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:K(k),"onUpdate:modelValue":T[2]||(T[2]=_=>fe(k)?k.value=_:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),I.gameId===K(V).RAINWORMS?(de(),ve(_e,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:K(D),"onUpdate:modelValue":T[3]||(T[3]=_=>fe(D)?D.value=_:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)])]),_:1},8,["isOpen","description"]))}});export{Ge as C,Ye as D,Je as F,Qe as G,Xe as L,ul as _,Ke as a,Ze as b,ll as u};
