import{j as N,s as P,r as K,o as J,a4 as x,as as ee,at as F,au as Q,av as T,aw as X,i as j,f as G,h as Z,c as B,t as k,n as a,G as O,m as s,C as U,R as D,E as q,ax as oe,H as A,q as L,w as R,_ as E,a as te,l as w,al as se,p as $,V as ae,O as ne,W as ie,x as V,U as M,ay as le,az as re,aA as ce,B as ue,aB as de,y as pe,A as W,z as I,aC as H,M as me,g as ve,D as ge,aD as fe,P as ye,Q as be}from"../bundle.js";const he=t=>{const o=N(),{collections:i,fetchBlogPost:y,checkBlogPostForUnreadReactions:f}=o,{blogPosts:d,blogReactions:b,isBlogPostDatabaseActionActive:u}=P(o);let m=[];const h=K(),p=n=>{n.metadata.hasPendingWrites||u.value||(clearTimeout(h.value),h.value=setTimeout(async()=>{await y(t.id,void 0,{loadingIndicator:!1}),f(d.value.previousData.single,!0)},200))};J(async()=>{b.value.unread=b.value.unread.filter(z=>z.postId!==t.id);const n=x(t),e=i.blogPosts(n.isPrivate),l=i.blogReactions(n.isPrivate),r=ee(e,t.id),v=F(e,Q("id","==",t.id)),S=F(l,Q("post","==",r));m.push(T(v,p)),m.push(T(S,p))}),X(()=>{clearTimeout(h.value),m.forEach(n=>{n()})})},Ke=()=>{const t=N(),o=j(),{visibleBlogPosts:i,blogReactions:y,isBlogPostDatabaseActionActive:f}=P(t),{firebaseUser:d,isLoggedIn:b}=P(o),{collections:u,fetchBlogPosts:m,checkBlogPostsForUnreadReactions:h}=t;let p=[];const n=K(),e=l=>{l.metadata.hasPendingWrites||f.value||(clearTimeout(n.value),n.value=setTimeout(async()=>{var r;i.value.length&&(await m((r=d.value)==null?void 0:r.uid,{amount:i.value.length,loadingIndicator:!1}),h())},200))};J(()=>{y.value.unread=[],p.push(T(u.blogPosts(!1),e)),p.push(T(u.blogReactions(!1),e)),b.value&&(p.push(T(u.blogPosts(!0),e)),p.push(T(u.blogReactions(!0),e)))}),X(()=>{clearTimeout(n.value),p.forEach(l=>{l()})})},ke={class:"flex flex-col gap-2"},Y=G({__name:"BlogReaction",props:{post:{},reaction:{}},setup(t){const o=t,i=Z(),y=j(),f=N(),{routeLoading:d,routeLoadingId:b}=P(i),{firebaseUser:u,isLoggedIn:m,isOwner:h}=P(y),{blogReactions:p}=P(f),{deleteBlogReaction:n}=f,e=B(()=>u.value&&o.reaction.user.id===u.value.uid||h.value);return(l,r)=>(a(),k(O,{id:o.reaction.id,class:U(["p-5 w-full md:w-3/4 xl:w-2/3",o.post.colorTertiary,o.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":s(d)===s(D).USER_DETAILS&&s(b)===o.reaction.user.id}},title:o.reaction.user.displayName||"Unknown user",subTitle:s(q)(o.reaction.date),avatar:o.reaction.user.avatar,route:s(m)?{name:s(D).USER_DETAILS,params:{userId:o.reaction.user.id}}:void 0,avatarRoute:s(m)?{name:s(D).USER_DETAILS,params:{userId:o.reaction.user.id}}:void 0,description:o.reaction.message},oe({_:2},[e.value?{name:"right",fn:A(()=>[L("div",ke,[e.value&&!o.post.locked?(a(),k(E,{key:0,type:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:s(p).isDatabaseDeletionActive,onClick:r[0]||(r[0]=v=>s(n)(o.reaction.id,o.post))},null,8,["disabled"])):R("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),we={class:"grid justify-items-center p-5 gap-5"},Pe=G({__name:"BlogReactions",props:{post:{}},setup(t){const o=t,i=Z(),y=j(),f=N(),{content:d}=P(i),{firebaseUser:b,isLoggedIn:u}=P(y),{blogReactions:m}=P(f),{createBlogReaction:h}=f,p=K(),n=K(!1),e=te({reaction:{value:"",error:""}}),l=B(()=>[...o.post.reactions].reverse()),r=B(()=>l.value.filter((c,g)=>g<3)),v=B(()=>l.value.filter((c,g)=>g>=3)),S=B(()=>o.post.locked||!u.value||m.value.isDatabaseCreationActive),z=async()=>{if(!m.value.isDatabaseCreationActive){if(await p.value.test(),!e.reaction.error&&b.value){const c=e.reaction.value;e.reaction.value="Replying...";const g=await h(o.post,{userId:b.value.uid,postId:o.post.id,message:c,date:new Date});e.reaction.value=g?"":c}ce()}};return(c,g)=>(a(),w("form",{action:"",onSubmit:se(z,["prevent"])},[L("div",we,[!s(u)||c.post.reactions.filter(C=>C.user.id===s(b).uid).length<20?(a(),k(O,{key:0,class:U(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",c.post.colorTertiary||"bg-secondary-700",c.post.opacityTertiary||"bg-opacity-25"])},{default:A(()=>[$(ae,{class:"w-5/6",id:c.post.id,inputProps:{class:["rounded-primary border-none !placeholder-gray-300",c.post.colorSecondary||c.post.colorPrimary||"bg-secondary-600",c.post.opacitySecondary||"!bg-opacity-20",S.value?{"!bg-gray-900 !bg-opacity-50":!s(m).isDatabaseCreationActive}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!s(u)&&!c.post.locked}],disabled:S.value,autocomplete:"off"},ref_key:"reaction",ref:p,name:"reaction",placeholder:c.post.locked?"Locked for comments":s(u)?"Reply":s(d).blogLoginGuest,modelValue:e.reaction.value,"onUpdate:modelValue":g[0]||(g[0]=C=>e.reaction.value=C),error:e.reaction.error,"onUpdate:error":g[1]||(g[1]=C=>e.reaction.error=C),rules:[s(ie).Required],onClick:g[2]||(g[2]=()=>!s(u)&&!c.post.locked?s(ne).push({name:s(D).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):R("",!0),(a(!0),w(V,null,M(r.value,C=>(a(),k(Y,{post:c.post,reaction:C},null,8,["post","reaction"]))),256)),(a(!0),w(V,null,M(v.value,C=>le((a(),k(Y,{post:c.post,reaction:C},null,8,["post","reaction"])),[[re,n.value]])),256)),c.post.reactions.length>3?(a(),k(E,{key:1,type:"primary",outlined:"",icon:n.value?"pi pi-angle-up":"pi pi-angle-down",label:n.value?"Hide older reactions":"View older reactions",onClick:g[3]||(g[3]=C=>n.value=!n.value)},null,8,["icon","label"])):R("",!0)])],32))}});var Ce={root:function(o){var i=o.props;return["p-chip p-component",{"p-chip-image":i.image!=null}]},icon:"p-chip-icon",label:"p-chip-text",removeIcon:"p-chip-remove-icon"},Se=ue.extend({name:"chip",classes:Ce}),Be={name:"BaseChip",extends:pe,props:{label:{type:String,default:null},icon:{type:String,default:null},image:{type:String,default:null},removable:{type:Boolean,default:!1},removeIcon:{type:String,default:void 0}},style:Se,provide:function(){return{$parentInstance:this}}},_={name:"Chip",extends:Be,inheritAttrs:!1,emits:["remove"],data:function(){return{visible:!0}},methods:{onKeydown:function(o){(o.key==="Enter"||o.key==="Backspace")&&this.close(o)},close:function(o){this.visible=!1,this.$emit("remove",o)}},components:{TimesCircleIcon:de}},Re=["aria-label"],$e=["src"];function Ie(t,o,i,y,f,d){return f.visible?(a(),w("div",I({key:0,class:t.cx("root"),"aria-label":t.label},t.ptmi("root")),[W(t.$slots,"default",{},function(){return[t.image?(a(),w("img",I({key:0,src:t.image},t.ptm("image")),null,16,$e)):t.$slots.icon?(a(),k(H(t.$slots.icon),I({key:1,class:t.cx("icon")},t.ptm("icon")),null,16,["class"])):t.icon?(a(),w("span",I({key:2,class:[t.cx("icon"),t.icon]},t.ptm("icon")),null,16)):R("",!0),t.label?(a(),w("div",I({key:3,class:t.cx("label")},t.ptm("label")),me(t.label),17)):R("",!0)]}),t.removable?W(t.$slots,"removeicon",{key:0,onClick:d.close,onKeydown:d.onKeydown,removeCallback:d.close,keydownCallback:d.onKeydown},function(){return[(a(),k(H(t.removeIcon?"span":"TimesCircleIcon"),I({tabindex:"0",class:[t.cx("removeIcon"),t.removeIcon],onClick:d.close,onKeydown:d.onKeydown},t.ptm("removeIcon")),null,16,["class","onClick","onKeydown"]))]}):R("",!0)],16,Re)):R("",!0)}_.render=Ie;const Te={class:"flex flex-wrap justify-end h-fit gap-3"},De=G({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(t){return(o,i)=>(a(),w("div",Te,[$(E,{class:"min-w-80",label:"Edit",onClick:i[0]||(i[0]=y=>o.$emit("editClicked"))}),$(E,{class:"min-w-80",type:"danger",outlined:"",label:"Delete",onClick:i[1]||(i[1]=y=>o.$emit("deleteClicked"))})]))}}),Ue={class:"flex gap-3"},Ae={class:"flex justify-between h-fit mt-2 gap-2"},Le={class:"flex flex-wrap gap-3"},Oe=G({__name:"BlogPost",props:{post:{},withoutMutation:{type:Boolean}},emits:["editClicked","deleteClicked"],setup(t){const o=t,i=ve(),y=j(),f=ge(),{publicUsers:d}=P(f),{firebaseUser:b,isOwner:u}=P(y);i.currentRoute.value.name!==D.BLOG&&he(o.post);const m=B(()=>{var e;return(e=o.post.allowedUserIds)!=null&&e.length?d.value.filter(l=>{var r;return(r=o.post.allowedUserIds)==null?void 0:r.includes(l.id)}):[]}),h=B(()=>{const e=q(o.post.date);return o.post.dateUpdated?e+` - updated ${q(o.post.dateUpdated)}`:e}),p=B(()=>{const e=[];return o.post.datePinned&&e.push({value:"Pinned",severity:"success",rounded:!1}),o.post.locked&&e.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),o.post.archived&&e.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),e}),n=()=>{const e=document.createElement("textarea"),{protocol:l,hostname:r,port:v}=window.location,S=`${l}//${r}`+(r==="localhost"?`:${v}`:"");e.value=`${S}#${ye.BLOG.path}/${o.post.id}`,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),be.success("Copied link!")};return(e,l)=>(a(),k(O,{id:e.post.id,class:U(["border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:h.value,tags:p.value,loading:e.post.loading,clickable:"",route:{name:s(D).BLOG_DETAILS,params:{postId:e.post.id}}},{right:A(()=>[L("div",Ue,[$(E,{class:"border-none h-fit",type:"neutral",icon:"pi pi-copy",onClick:n})])]),default:A(()=>{var r;return[L("div",Ae,[L("div",Le,[(a(!0),w(V,null,M(m.value,v=>{var S;return a(),k(s(_),{class:"h-fit !p-0 !px-4 !py-1 bg-red-800 bg-opacity-50",icon:"pi pi-user",label:v.id===((S=s(b))==null?void 0:S.uid)?"You":v.displayName,rounded:""},null,8,["label"])}),256))]),s(u)&&!e.withoutMutation?(a(),w("div",{key:0,class:U(["flex justify-end ms-5",(r=e.post.allowedUserIds)!=null&&r.length?"flex-col md:flex-row":"flex-row"])},[$(De,{onEditClicked:l[0]||(l[0]=v=>e.$emit("editClicked")),onDeleteClicked:l[1]||(l[1]=v=>e.$emit("deleteClicked"))})],2)):R("",!0)]),$(O,{class:U(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{default:A(()=>[(a(!0),w(V,null,M(e.post.content,v=>(a(),k(fe,{key:v.id,post:e.post,block:v},null,8,["post","block"]))),128))]),_:1},8,["class"]),$(Pe,{post:e.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","loading","route"]))}});export{Oe as _,De as a,_ as s,Ke as u};
