import{_ as x}from"./c-Bubble.vue_vue_type_script_setup_true_lang-DJUKMPd9.js";import{r as B,c as u,au as R,e as q,A as z,aO as V,s as I,o as A,am as F,M as J,l as o,m as l,p as s,n as U,k as n,t as r,w as S,O as K,H as m,G as $,C as Q,E as W,q as G,h as X}from"../bundle.js";import{_ as Y}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const Z=(i,c)=>{const d=B(0),v=u(()=>R(i)),g=u(()=>(d.value+1)*c),y=u(()=>g.value-c),p=u(()=>d.value>0),f=u(()=>v.value.length>g.value),_=u(()=>v.value.filter((a,b)=>b>=y.value&&b<g.value));return{page:d,perPage:c,visibleData:_,hasPrevious:p,hasNext:f,$reset:()=>{d.value=0}}},ee={class:"mt-5 flex justify-center"},te={class:"w-full overflow-x-auto"},se={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},oe={key:0},ne={key:0},le={key:1},ae={key:1},re={key:0},ue={key:1},ie={key:2},ce={key:3},de={key:2},ve={key:3},he={key:4},fe={colspan:"100%"},me=q({__name:"Highscores",props:{gameId:{},unit:{}},setup(i){const c=i,d=z(),v=V(),{publicUsers:g}=I(d),{allGameData:y,fetchLoading:p}=I(v),{fetchGameData:f,fetchHighscores:_,fetchScores:w}=v,a=B("highscores"),b=B(),j=u(()=>y.value[c.gameId].gameData[a.value]),{page:D,perPage:E,visibleData:h,hasPrevious:P,hasNext:C,$reset:L}=Z(()=>j.value,10),T=k=>{var e;return((e=g.value.find(t=>t.id===k))==null?void 0:e.displayName)??"Unknown"},N=k=>{L(),a.value=k},M=()=>{a.value==="highscores"?_():w()};return A(()=>{v.$init(c.gameId),f(),b.value=setInterval(()=>{f()},1e3*60*5)}),F(()=>{clearInterval(b.value)}),J(a,()=>{y.value[c.gameId].gameData[a.value].length||M()}),(k,e)=>(o(),l(S,null,[s("div",ee,[U(x,{class:"w-1/2 md:w-1/4 rounded-r-none",type:"secondary",outlined:a.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=t=>N("highscores"))},null,8,["outlined"]),U(x,{class:"w-1/2 md:w-1/4 rounded-l-none",type:"secondary",outlined:a.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=t=>N("scores"))},null,8,["outlined"])]),s("div",te,[s("table",se,[n(h).length?(o(),l("thead",oe,[s("tr",null,[e[4]||(e[4]=s("th",null,"Rank",-1)),e[5]||(e[5]=s("th",null,"User",-1)),e[6]||(e[6]=s("th",null,"Score",-1)),n(h).length&&n(h).some(t=>t.difficulty)?(o(),l("th",ne,"Difficulty")):r("",!0),e[7]||(e[7]=s("th",null,"Date",-1)),n(h).length&&n(h).some(t=>t.bonus)?(o(),l("th",le,"Bonus")):r("",!0)])])):r("",!0),n(h).length?(o(),l("tbody",ae,[(o(!0),l(S,null,K(n(h),(t,O)=>(o(),l("tr",null,[s("th",null,m(O+1+n(D)*n(E)),1),s("th",null,m(T(t.userId??t.id)),1),s("td",null,[$(m(t.score)+" ",1),k.unit?(o(),l(S,{key:0},[$(m(k.unit),1),t.score!==1?(o(),l(S,{key:0},[$("s")],64)):r("",!0)],64)):r("",!0)]),t.difficulty?(o(),l("td",re,m(t.difficulty),1)):n(h).some(H=>H.difficulty)?(o(),l("td",ue)):r("",!0),s("td",null,m(n(Q)(t.date)),1),t.bonus?(o(),l("td",ie,m(t.bonus),1)):n(h).some(H=>H.bonus)?(o(),l("td",ce)):r("",!0)]))),256))])):n(p)?(o(),l("tbody",de,e[8]||(e[8]=[s("tr",null,[s("th",null,"Loading highscores...")],-1)]))):(o(),l("tbody",ve,[s("tr",null,[s("th",null,"There are no "+m(a.value==="highscores"?"highscores":"scores")+" yet.",1)])])),n(P)||n(C)?(o(),l("tfoot",he,[s("tr",null,[s("td",fe,[s("div",{class:W(["w-full p-2 flex",[n(P)?"justify-between":"justify-end"]])},[n(P)?(o(),G(x,{key:0,class:"w-fit",label:"Previous",type:"neutral",onClick:e[2]||(e[2]=t=>D.value-=1)})):r("",!0),n(C)?(o(),G(x,{key:1,class:"w-fit",label:"Next",type:"neutral",onClick:e[3]||(e[3]=t=>D.value+=1)})):r("",!0)],2)])])])):r("",!0)])])],64))}}),ke=Y(me,[["__scopeId","data-v-50c9f69b"]]),_e=i=>{const c=X(),d=V(),{allGameData:v,highscorePosition:g,personalBest:y}=I(d),{firebaseUser:p}=I(c),f=u(()=>p.value?g.value:null),_=u(()=>{if(!i)return!1;const a=v.value[i].previousHighscorePosition;return f.value&&a?a>f.value:!1}),w=u(()=>{if(!i)return!1;const a=v.value[i].previousPersonalBest;return p.value&&a?a<y.value:!1});return A(()=>{d.$init(i)}),{currentHighscorePosition:f,hasImprovedHighscorePosition:_,hasImprovedPersonalBest:w}};export{ke as H,_e as u};
