import{_ as fe,a as ye}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-lxypY4ur.js";import{_ as pe}from"./c-SelectField.vue_vue_type_script_setup_true_lang-BFyx74Rf.js";import{d as Ae,aS as se,s as K,r as E,a as Te,c as I,o as re,aT as V,N as He,aU as U,cZ as Oe,aV as _e,aY as ce,aW as he,aX as ke,e as Re,b$ as Ve,cH as be,l as G,t as ee,E as Ne,n as Ce,k as D,af as le,w as ue}from"../bundle.js";var De=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(De||{});const ie={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Pe=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Pe||{}),Le=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(Le||{});const we={easy:.5,hard:1},me=()=>{const e=xe();return Oe(e),{pile1:e.splice(0,1).map(i=>({...i,deck:"pile1"})),pile2:e.splice(0,2).map((i,p)=>p<1?{...i,hidden:!0,deck:"pile2"}:{...i,deck:"pile2"}),pile3:e.splice(0,3).map((i,p)=>p<2?{...i,hidden:!0,deck:"pile3"}:{...i,deck:"pile3"}),pile4:e.splice(0,4).map((i,p)=>p<3?{...i,hidden:!0,deck:"pile4"}:{...i,deck:"pile4"}),pile5:e.splice(0,5).map((i,p)=>p<4?{...i,hidden:!0,deck:"pile5"}:{...i,deck:"pile5"}),pile6:e.splice(0,6).map((i,p)=>p<5?{...i,hidden:!0,deck:"pile6"}:{...i,deck:"pile6"}),pile7:e.splice(0,7).map((i,p)=>p<6?{...i,hidden:!0,deck:"pile7"}:{...i,deck:"pile7"}),stock_closed:e.map(i=>({...i,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},Me=Ae("patienceStore",()=>{const e=se(),{personalBest:i,highscorePosition:p}=K(e),{setPreviousHighscores:R,updateHighscores:b,sortHighscores:P}=e,T=E("hard"),r=E(0),_=E(0),f=E(0),h=E(0),v=E(0),m=E(),g=E(!0),c=Te(me()),N=I(()=>we[T.value]),C=I(()=>Object.keys(c).flatMap(l=>c[l])),L=1e3,q=10,M=10,x=I(()=>{const l=f.value%10===0?f.value:Math.floor(f.value/10)*10,o=_.value*q,n=v.value*q,u=l+o+n,S=h.value*M;return Math.max(0,L-(u-S))}),y=I(()=>{const l=Math.floor(f.value/60),o=f.value%60;return`${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")}`}),B=I(()=>c.hearts.length===13&&c.spades.length===13&&c.diamonds.length===13&&c.clubs.length===13);re(()=>{e.$init(V.PATIENCE),f.value&&r.value===1&&O()}),He(B,l=>{l&&r.value!==2&&($(),r.value=2,de(),U(_e))});const ae=()=>{$(),_.value=0,f.value=0,h.value=0,v.value=0,r.value=0,Object.assign(c,me()),e.setPreviousHighscores()},oe=()=>{f.value=0,O(),r.value=1,setTimeout(()=>{a()},500)},O=()=>{m.value&&$(),m.value=setInterval(()=>{f.value++},1e3)},$=()=>{clearInterval(m.value)},z=()=>{const l=c.stock_open;l.length&&(l.reverse(),k(l[0],!1,o=>{o.deck="stock_closed",o.hidden=!0,c.stock_closed.push(o)}),l.splice(0,l.length),s(1))},X=l=>{const o=l.deck,n=C.value.filter(u=>u.selected);if(o==="stock_closed"){const u=c.stock_closed,S=u.indexOf(l);if(S===u.length-1){const w=T.value==="hard"?S-2:S,H=w<0?0:w,ne=u.filter((ve,Ie)=>Ie>=H);W(),j(ne,"stock_open",ve=>{ve.hidden=!1}),s(0)}}else if(o==="stock_open"){const u=c.stock_open;u.indexOf(l)===u.length-1&&(l.selected=!l.selected,n.length&&k(n[0],!1))}else if(n.length){const u=n[0];u===l?k(l,!1):Q(o)&&d(u,l)?l.value===u.value+1&&l.deck!==u.deck&&(j(n,o),u.deck==="stock_open"?s(2):s(4)):n.length===1&&te(o)&&A(u,l)&&l.value===u.value-1&&(Y(u,o),s(3),u.hasBeenHome=!0)}else k(l,!0)},J=l=>{const o=C.value.filter(n=>n.selected);if(o.length){const n=o[0],u=n.deck;n.value===13&&(j(o,l),u==="stock_open"?s(2):Q(n.deck)&&c[n.deck].every(S=>!S.hidden)?s(5):s(4))}},F=l=>{const o=C.value.filter(n=>n.selected);if(o.length===1){const n=o[0],u=n.type;!c[l].length&&u===l&&n.value===1&&(Y(n,l),s(3))}},k=(l,o,n)=>{const u=c[l.deck],S=u.indexOf(l);u.filter((H,ne)=>ne>=S).forEach(H=>{H.selected=o,n==null||n(H)})},W=()=>{C.value.forEach(l=>{l.selected=!1})},Y=(l,o)=>{const n=l.deck,u=c[n].indexOf(l);l.deck=o,l.selected=!1,c[o].push(l),c[n].splice(u,1),(Q(n)||n==="stock_open")&&t(n)},j=(l,o,n)=>{const u=l[0],S=u.deck,w=c[S].indexOf(u);k(u,!1,H=>{H.deck=o,n==null||n(H),c[o].push(H)}),c[S].splice(w,l.length),te(S)||t(S!=="stock_closed"?S:o)},Z=l=>{if(!g.value)return!0;const o=c[l.type],n=o.length?o[o.length-1].value:0;if(l.value===n+1){const u=["hearts","spades","diamonds","clubs"],S=n<=1||u.every(w=>{const H=c[w];return(H.length?H[H.length-1].value:0)>=n});if(n===0||S)return Y(l,l.type),l.hasBeenHome=!0,s(3),!0}return!1},a=()=>{if(g.value)for(const l of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const o=c[l];if(o.length&&Z(o[o.length-1]))return}},t=l=>{const o=c[l];if(o.length){const n=o[o.length-1],u=n.deck;n.hidden=!1,setTimeout(()=>{n.deck===u&&(Z(n)||a())},500)}else setTimeout(()=>{a()},500)},s=l=>{switch(l!==5&&_.value++,l){case 0:{v.value+=2*N.value;break}case 1:{v.value+=5*N.value;break}case 2:{h.value+=10*N.value;break}case 3:{h.value+=20*N.value;break}}U(ce)},d=(l,o)=>l.color!==o.color,A=(l,o)=>l.type===o.type,Q=l=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(l),te=l=>["hearts","spades","diamonds","clubs"].includes(l),de=()=>{b({difficulty:T.value,score:x.value,bonus:h.value,time:f.value,turns:_.value,penalty:v.value})};return{difficulty:T,gameStatus:r,score:x,turns:_,time:f,bonus:h,penalty:v,cards:c,doAutocomplete:g,allCards:C,formattedTime:y,personalBest:i,highscorePosition:p,$reset:ae,start:oe,shuffle:z,selectCard:X,selectEmptyDeck:J,selectFinalDeck:F,deselectAllCards:W,isPlayDeck:Q,isFinalDeck:te,setPreviousHighscores:R,updatePatienceHighscore:de,sortHighscores:P}},{persist:{enabled:!0}}),xe=()=>Object.keys(ie).flatMap(e=>{const i=e,p=[];for(let R=0;R<13;R++){const b={type:i,label:ie[i].label,color:ie[i].color,value:R+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(b)}return p});var Be=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_THROWN_DICES=2]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=3]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=4]="HAS_CHOSEN_TILE",e[e.HAS_LOST=5]="HAS_LOST",e[e.HAS_FINISHED=6]="HAS_FINISHED",e))(Be||{}),$e=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))($e||{}),We=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.LOSER=3]="LOSER",e))(We||{}),Ue=(e=>(e[e.PLAYER=0]="PLAYER",e[e.ROBOT=1]="ROBOT",e))(Ue||{});const Fe=e=>{for(let i=1;i<=6;i++)if(e.every(p=>p.value===i))return!0;return!1},ge=()=>({0:[],1:[]}),Ye=Ae("rainwormsStore",()=>{const e=se(),{personalBest:i,highscorePosition:p}=K(e),{setPreviousHighscores:R,updateHighscores:b,sortHighscores:P}=e,T=E(1),r=E(0),_=E(0),f=E(0),h=E(0),v=E(0),m=E(Se()),g=E(Ee()),c=Te(ge()),N=I(()=>m.value.some(a=>a.isRolling)),C=I(()=>m.value.filter(a=>a.selected).some(a=>a.value===6)),L=I(()=>a=>m.value.some(t=>t.value===a&&t.selected)),q=I(()=>a=>g.value.some(t=>t.displayValue<=a)),M=I(()=>a=>v.value===(a??0)),x=I(()=>a=>{const t=c[a??0];return t.length?t[t.length-1]:null}),y=I(()=>{let a=0;return m.value.filter(t=>t.selected).forEach(t=>{a+=t.value===6?5:t.value}),a}),B=I(()=>a=>{let t=0;return c[a].forEach(s=>{t+=s.value}),t});re(()=>{e.$init(V.RAINWORMS)});const ae=()=>{r.value=0,_.value=0,f.value=0,h.value=0,v.value=0,m.value=Se(),g.value=Ee(),Object.assign(c,ge()),R()},oe=()=>{r.value=1},O=a=>{if(!M.value(a))return;(r.value===1||r.value===4||r.value===5)&&m.value.forEach(s=>{s.selected=!1}),r.value=2;const t=e.diceRollSpeed*1e3;m.value.forEach(s=>{s.selected||(s.isRolling=!0,setTimeout(()=>{s.value=he(6),s.isRolling=!1,m.value.sort((d,A)=>d.value-A.value),!N.value&&r.value!==5&&z()&&X(a)},he(t,t/3)))}),U(ke)},$=async()=>{for(;N.value;)await new Promise(a=>setTimeout(a,500));return!0},z=()=>{const a=m.value.filter(t=>!t.selected&&!L.value(t.value));return!a.length||Fe(a)&&a.every(t=>t.value!==6)},X=a=>{r.value=5,_.value=a??0,c[_.value].length?h.value=1:h.value=2,J(),g.value.length===0?r.value=6:W()},J=()=>{const a=c[v.value];if(a.length){const t=a.splice(a.length-1,1)[0];g.value.push(t),g.value.sort((s,d)=>s.displayValue-d.displayValue)}g.value.splice(g.value.length-1,1)},F=(a,t)=>{M.value(t)&&!N.value&&r.value===2&&!a.selected&&!L.value(a.value)&&(r.value=3,m.value.filter(s=>s.value===a.value).forEach(s=>{s.selected=!0}),U(ce))},k=(a,t,s)=>{if(M.value(s)&&(r.value===2||r.value===3)){if(r.value=4,_.value=s??0,t){const d=c[v.value===0?1:0];d.splice(d.length-1,1)}else g.value=g.value.filter(d=>d.displayValue!==a.displayValue);c[v.value].push(a),U(ce),g.value.length===0?r.value=6:W()}},W=a=>{(v.value===1||r.value!==5||a)&&(v.value===0?setTimeout(()=>{v.value=1,setTimeout(()=>{r.value=1,_.value=0},1e3)},a?0:T.value*1e3*2):setTimeout(()=>{v.value=0},a?0:T.value*1e3*2))},Y=async()=>{switch(r.value){case 1:{O(1);break}case 2:{await $(),setTimeout(()=>{const a=m.value.filter(s=>!s.selected),t=x.value(0);if(t&&y.value<t.displayValue)for(let s=6;s>=1;s--){const d=a.filter(A=>A.value===s&&!L.value(s));if(d.length){const A=d.length*(s===6?5:s);if(y.value+A===t.displayValue){F(d[0],1);return}}}for(let s=6;s>=1;s--){const d=m.value.find(A=>A.value===s);if(d&&!L.value(s)){F(d,1);return}}},T.value*1e3);break}case 3:{setTimeout(()=>{const a=x.value(0),t=m.value.filter(s=>!s.selected).length;if(!t||y.value>=30){console.log(t?"i am rich":"i can only pick a tile now");for(let s=y.value;s>=21;s--){const d=g.value.find(A=>A.displayValue===s);if(d){k(d,!1,1);return}}t&&O(1)}if(g.value.every(s=>s.displayValue>y.value)&&a&&a.displayValue>y.value)console.log("my score is too low"),O(1);else if(a&&a.displayValue===y.value)console.log("i can steal"),k(a,!0,1);else if(new Set(m.value.filter(s=>s.selected).map(s=>s.value)).size<=3)if(m.value.filter(s=>!s.selected).length<=2){console.log("there aren't that much dices left");const s=g.value.filter(d=>d.displayValue>=y.value-5&&d.displayValue<=y.value).sort((d,A)=>A.displayValue-d.displayValue);s.length?(console.log("i choose the highest score within 5 tiles"),k(s[0],!1,1)):(console.log("i choose to roll again"),O(1))}else console.log("i have nothing to worry about"),O(1);else if(!C.value)console.log("i am worrying and have no worm yet"),O(1);else{console.log("if i can choose, i choose");const s=g.value.filter(d=>d.displayValue<=y.value).sort((d,A)=>A.displayValue-d.displayValue);s.length?(console.log("i choose the highest score"),k(s[0],!1,1)):(console.log("i choose to roll again"),O(1))}},T.value*1e3);break}default:console.log("DEFAULT",r.value)}},j=()=>{const a=B.value(0),t=B.value(1);a>t?f.value=1:a===t&&Math.max(...c[0].map(s=>s.displayValue))>Math.max(...c[1].map(s=>s.displayValue))?f.value=2:f.value=3,(f.value===1||f.value===2)&&(Z(),U(_e))},Z=()=>{b({score:B.value(0)})};return{gameStatus:r,gameStatusActivator:_,finishStatus:f,loseStatus:h,activePlayer:v,dices:m,tiles:g,score:c,robotSpeed:T,isRolling:N,hasWorm:C,hasAlreadyChosen:L,canSelectAnyTile:q,canPlay:M,visibleTile:x,selectedDiceTotal:y,totalScore:B,personalBest:i,highscorePosition:p,$reset:ae,start:oe,roll:O,hasFinishedRolling:$,hasLostRound:z,loseTurn:X,popLastTile:J,selectDice:F,selectTile:k,passTurn:W,playRobot:Y,checkFinishStatus:j,setPreviousHighscores:R,updateRainwormsHighscore:Z,sortHighscores:P}},{persist:{enabled:!0}}),Se=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],Ee=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],qe=Re({__name:"GameSettingsDialog",props:Ve({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const i=e,p=be(e,"isOpen"),R=se(),{useAudio:b,diceRollSpeed:P}=K(se()),{robotSpeed:T}=K(Ye()),{doAutocomplete:r}=K(Me()),_=I(()=>{switch(i.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)"}});return re(()=>{R.$init(i.gameId)}),(f,h)=>(G(),ee(ye,{isOpen:p.value,title:"Game Settings",description:f.gameId?`Current version: ${_.value}`:"General settings",cancelText:"Close",onCancel:h[4]||(h[4]=v=>p.value=!1)},{default:Ne(()=>[Ce(fe,{name:"useAudio",label:"Audio",modelValue:D(b),"onUpdate:modelValue":h[0]||(h[0]=v=>le(b)?b.value=v:null)},null,8,["modelValue"]),f.gameId===D(V).PATIENCE?(G(),ee(fe,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:D(r),"onUpdate:modelValue":h[1]||(h[1]=v=>le(r)?r.value=v:null)},null,8,["modelValue"])):ue("",!0),f.gameId===D(V).YAHTZEE||f.gameId===D(V).RAINWORMS?(G(),ee(pe,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:D(P),"onUpdate:modelValue":h[2]||(h[2]=v=>le(P)?P.value=v:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):ue("",!0),f.gameId===D(V).RAINWORMS?(G(),ee(pe,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:D(T),"onUpdate:modelValue":h[3]||(h[3]=v=>le(T)?T.value=v:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):ue("",!0)]),_:1},8,["isOpen","description"]))}});export{De as C,Pe as D,We as F,Be as G,$e as L,Ue as P,qe as _,Me as a,Le as b,Ye as u};
