import{b9 as se,bs as fe,bt as ge,bg as ye,bh as W,bu as ve,ax as Z,bv as he,bw as be,b5 as Oe,be as we,q as ke,bx as Be,s as E,z as $,C as A,au as z,by as De,bz as Ve,bA as Y,d as Q,v as ie,U as re,g as T,w as g,f as e,b as P,e as D,h as a,D as J,ab as ue,J as Se,i as U,ac as ce,a7 as Ce,a8 as xe,a9 as ze,t as j,$ as de,aa as $e,a6 as Pe,ad as _e,E as Le,l as je,c as ee,O as te,I as Ue,_ as qe,ai as ae,aj as x,k as L,n as oe,bB as Te}from"../bundle.js";import{_ as ne}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{_ as Ne}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{_ as M}from"./c-NumberField.vue_vue_type_script_setup_true_lang-BaJkCxK_.js";import{u as Fe,D as Ae,_ as Ee}from"./c-useDateChart-DGSG2NvK.js";class I{id;name;size;category;buyLog;isOutOfStock;constructor({id:n,name:t,size:b,category:y,buyLog:p,isOutOfStock:O}={}){this.id=n??se(),this.name=t??"",this.size=b??{value:0,unit:""},this.category=y??null,this.buyLog=p??[],this.isOutOfStock=O??!1}static deserialize(n){return new I({id:n.id,name:n.name,size:n.size,category:n.category,buyLog:n.buyLog.map(R.deserialize),isOutOfStock:n.isOutOfStock})}serialize(){return{id:this.id,name:this.name,size:this.size,category:this.category,buyLog:this.buyLog.map(n=>n.serialize()),isOutOfStock:this.isOutOfStock}}clone(){return new I({id:this.id,name:this.name,size:{...this.size},category:this.category?{...this.category}:null,buyLog:this.buyLog.map(n=>n.clone()),isOutOfStock:this.isOutOfStock})}}class R{date;price;quantity;constructor(n,t,b){this.date=n??new Date,this.price=t??0,this.quantity=b??1}static deserialize(n){return new R(n.date.toDate(),n.price,n.quantity)}serialize(){return{date:fe.fromDate(this.date),price:this.price,quantity:this.quantity}}clone(){return new R(new Date(this.date.getTime()),this.price,this.quantity)}}function Ie(w){return w.map(Re)}function Re(w){return I.deserialize(w)}class Me{async fetchMultiple(n){return ge(ye(n,W.BOODSCHAPPEN))}async create(n,t){await ve(Z(n,W.BOODSCHAPPEN,t.id),t)}async update(n,t){await he(Z(n,W.BOODSCHAPPEN,t.id),{...t})}async delete(n,t){await be(Z(n,W.BOODSCHAPPEN,t))}}const K=new Me,X=Oe("boodschappenStore",()=>{const w=we(),n=ke(),t=Be(),{firebaseUser:b}=E(n),{debug:y}=E(t),p=$([]),O=$(!1),k=$(!1),V=A(()=>p.value.reduce((r,c)=>{const l=c.category;return l&&!r.some(u=>u.id===l.id)&&r.push(l),r},[])),d=A(()=>[{value:null,label:"Geen categorie"},...V.value.map(r=>({value:r,label:r.label}))]);return{boodschappen:p,isFetchLoading:O,isMutationLoading:k,categories:V,categoryOptions:d,$reset:()=>{p.value=[]},fetchBoodschappen:async()=>{if(!b.value){z.error("You must be logged in to fetch products.");return}try{O.value=!0;const r=await K.fetchMultiple(w);p.value=Ie(r)}catch(r){z.firebaseError(y.value,r)}finally{O.value=!1}},createBoodschap:async r=>{if(!b.value){z.error("You must be logged in to create products.");return}try{k.value=!0,await K.create(w,r.serialize()),De(p,r),z.success("Successfully created product")}catch(c){z.firebaseError(y.value,c)}finally{k.value=!1}},updateBoodschap:async r=>{if(!b.value){z.error("You must be logged in to update products.");return}try{k.value=!0,await K.update(w,r.serialize()),Ve(p,r,"id"),z.success("Successfully updated product")}catch(c){z.firebaseError(y.value,c)}finally{k.value=!1}},deleteBoodschap:async r=>{if(!b.value){z.error("You must be logged in to delete products.");return}try{k.value=!0,p.value.find(l=>l.id===r)&&(await K.delete(w,r),p.value=p.value.filter(l=>l.id!==r),z.success("Successfully deleted product"))}catch(c){z.firebaseError(y.value,c)}finally{k.value=!1}}}}),Ge=()=>{const w=X(),{boodschappen:n}=E(w),t=A(()=>[...n.value].sort((o,s)=>{const i=!!o.isOutOfStock,f=!!s.isOutOfStock;if(i&&!f)return-1;if(!i&&f)return 1;const v=k(o),r=k(s);return v===null&&r===null?0:v===null?1:r===null?-1:v.getTime()-r.getTime()})),b=A(()=>{const o=new Date,s=new Date(o.getTime()+14*Y);return t.value.filter(i=>{const f=k(i);return f!==null&&f.getTime()>=o.getTime()&&f.getTime()<=s.getTime()})}),y=A(()=>{const o=new Date(new Date().getTime()+14*Y);return t.value.filter(s=>{const i=k(s);return!i||i.getTime()>o.getTime()})}),p=o=>[...o.buyLog].filter(s=>Number(s.quantity)>0&&!Number.isNaN(s.date.getTime())).sort((s,i)=>s.date.getTime()-i.date.getTime()),O=o=>p(o).at(-1)?.date??null,k=(o,s=new Date)=>{const i=p(o),f=o.size.value;if(!Number.isFinite(f)||f<=0)return null;if(i.length<2)return null;let v=0,r=0;for(let q=0;q<i.length-1;q++){const N=i[q],H=(i[q+1].date.getTime()-N.date.getTime())/Y;!Number.isFinite(N.quantity)||N.quantity<=0||H<=0||(v+=N.quantity*f,r+=H)}if(r<=0||v<=0)return null;const c=v/r;if(!Number.isFinite(c)||c<=0)return null;const l=i.at(-1);if(!l)return null;const u=l.quantity;if(!Number.isFinite(u)||u<=0)return null;const C=u*f/c;if(!Number.isFinite(C)||C<=0)return null;const G=new Date(l.date.getTime()+C*Y);return G.getTime()<s.getTime()?s:G};return{sortedBoodschappen:t,shortTermGroceries:b,longTermGroceries:y,getLatestPurchaseDate:O,getProjectedOutOfStockDate:k,getPricePerUnit:o=>{const s=p(o).at(-1);return!s||!Number.isFinite(s.price)||!Number.isFinite(s.quantity)||s.quantity<=0?null:s.price/s.quantity},getPriceIncreasePercentage:o=>{const s=p(o);if(s.length<2)return 0;const i=s.at(-1),f=s.at(-2);return!Number.isFinite(i.price)||!Number.isFinite(i.quantity)||!Number.isFinite(f.price)||!Number.isFinite(f.quantity)||f.quantity===0?0:(i.price/i.quantity-f.price/f.quantity)/(f.price/f.quantity)*100}}},He={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},We={class:"flex gap-3"},Ye={class:"w-full flex gap-3"},Ke={class:"flex gap-5"},Je={class:"flex flex-col gap-3"},Qe=Q({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(w,{emit:n}){const t=w,b=n,y=X(),{categories:p,categoryOptions:O,isMutationLoading:k}=E(y),V=$(!1),d=ie(o());function o(){const c=t.selectedBoodschap?.clone()??new I;return{name:c.name,category:p.value.find(l=>l.id===c.category?.id)??null,size:c.size,buyLog:c.buyLog,isOutOfStock:c.isOutOfStock}}async function s(){const c=t.selectedBoodschap?t.selectedBoodschap:new I;Object.assign(c,d),t.selectedBoodschap?await y.updateBoodschap(c):await y.createBoodschap(c),b("close")}function i(){b("close")}function f(){V.value=!0,d.category={id:se(),label:""}}function v(){V.value=!1,d.category=null}function r(){d.buyLog.push(new R)}return re(()=>t.isOpen,c=>{c?Object.assign(d,o()):V.value=!1}),(c,l)=>(P(),T(ne,{"is-open":w.isOpen,title:t.selectedBoodschap?`Bewerk ${t.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":t.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":e(k),onConfirm:s,onCancel:i},{default:g(()=>[D("div",He,[a(J,{name:"name",label:"Naam",modelValue:d.name,"onUpdate:modelValue":l[0]||(l[0]=u=>d.name=u)},null,8,["modelValue"]),D("div",We,[V.value?d.category?(P(),T(J,{key:1,class:"w-full",name:"category",label:"Categorie",modelValue:d.category.label,"onUpdate:modelValue":l[2]||(l[2]=u=>d.category.label=u)},null,8,["modelValue"])):Se("",!0):(P(),T(ue,{key:0,class:"w-full",name:"category",label:"Categorie",modelValue:d.category,"onUpdate:modelValue":l[1]||(l[1]=u=>d.category=u),options:e(O)},null,8,["modelValue","options"])),V.value?(P(),T(U,{key:3,class:"h-fit place-self-end",icon:"pi pi-times","icon-only":"",variant:"neutral",onClick:v})):(P(),T(U,{key:2,class:"h-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",onClick:f}))]),D("div",Ye,[a(M,{class:"w-full",name:"sizeValue",label:"Formaat",modelValue:d.size.value,"onUpdate:modelValue":l[3]||(l[3]=u=>d.size.value=u)},null,8,["modelValue"]),a(J,{class:"w-full",name:"sizeUnit",label:"Eenheid",modelValue:d.size.unit,"onUpdate:modelValue":l[4]||(l[4]=u=>d.size.unit=u)},null,8,["modelValue"])]),a(ce,{name:"isOutOfStock",label:"Voorraad leeg",modelValue:d.isOutOfStock,"onUpdate:modelValue":l[5]||(l[5]=u=>d.isOutOfStock=u)},null,8,["modelValue"]),l[8]||(l[8]=D("b",null,"Logboek",-1)),a(e(_e),{ref:"draggable",class:"flex flex-col gap-3",modelValue:d.buyLog,"onUpdate:modelValue":l[6]||(l[6]=u=>d.buyLog=u),itemKey:u=>u.date.toString(),handle:".drag-handle"},{item:g(({element:u,index:_})=>[a(e(Ce),null,{default:g(()=>[a(e(xe),{value:"0"},{default:g(()=>[a(e(ze),{class:"drag-handle"},{default:g(()=>[D("div",Ke,[l[7]||(l[7]=D("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),D("p",null,j(e(de)(u.date)),1)])]),_:2},1024),a(e($e),null,{default:g(()=>[D("div",Je,[a(Pe,{name:`buylog-date-${_}`,label:"Datum",modelValue:u.date,"onUpdate:modelValue":C=>u.date=C,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),a(M,{name:`buylog-quantity-${_}`,label:"Aantal",modelValue:u.quantity,"onUpdate:modelValue":C=>u.quantity=C},null,8,["name","modelValue","onUpdate:modelValue"]),a(M,{name:`buylog-price-${_}`,label:"Prijs",modelValue:u.price,"onUpdate:modelValue":C=>u.price=C},null,8,["name","modelValue","onUpdate:modelValue"]),a(U,{variant:"danger",outlined:"",label:"Delete",onClick:C=>d.buyLog.splice(_,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),a(U,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:r})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),Xe={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ze=Q({__name:"BuyLogAddDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(w,{emit:n}){const t=w,b=n,y=X(),{isMutationLoading:p}=E(y),O=ie(k());function k(){const o=t.selectedBoodschap?.buyLog.length?t.selectedBoodschap.buyLog[t.selectedBoodschap.buyLog.length-1]:null;return{quantity:o?o.quantity:1,price:o?o.price:0}}async function V(){if(t.selectedBoodschap){const o=t.selectedBoodschap.clone();o.buyLog.push(new R(new Date,O.quantity,O.price)),o.isOutOfStock=!1,await y.updateBoodschap(o)}b("close")}async function d(){if(t.selectedBoodschap){const o=t.selectedBoodschap.clone();o.isOutOfStock=!1,await y.updateBoodschap(o)}b("close")}return re(()=>t.isOpen,o=>{o&&Object.assign(O,k())}),(o,s)=>(P(),T(ne,{"is-open":w.isOpen,title:t.selectedBoodschap?"Aankoop toevoegen":"Geen product geselecteerd",description:t.selectedBoodschap?`Voeg een aankoop toe voor ${t.selectedBoodschap.name} (${t.selectedBoodschap.size.value} ${t.selectedBoodschap.size.unit})`:"Selecteer een product om een aankoop toe te voegen","cancel-text":"Overslaan","confirm-text":t.selectedBoodschap?"Toevoegen":"Annuleren","confirm-loading":e(p),onConfirm:V,onCancel:d},{default:g(()=>[D("div",Xe,[a(M,{name:"buylog-quantity",label:"Aantal",modelValue:O.quantity,"onUpdate:modelValue":s[0]||(s[0]=i=>O.quantity=i)},null,8,["modelValue"]),a(M,{name:"buylog-price",label:"Prijs",modelValue:O.price,"onUpdate:modelValue":s[1]||(s[1]=i=>O.price=i)},null,8,["modelValue"])])]),_:1},8,["is-open","title","description","confirm-text","confirm-loading"]))}}),et=Q({__name:"ProductPriceChart",props:{product:{}},setup(w){const n=w,t=A(()=>n.product.buyLog.map(p=>({date:p.date,value:p.price/p.quantity}))),{headers:b,filteredData:y}=Fe(t,Ae.MONTHS);return(p,O)=>(P(),T(Ee,{headers:e(b),datasets:[{label:"Prijsverloop",fill:!1,borderColor:"orange",yAxisID:"y",tension:.4,data:e(y),spanGaps:!0}]},null,8,["headers","datasets"]))}}),tt={class:"flex justify-end"},at={class:"flex gap-3 place-self-end"},rt=Q({__name:"Boodschappen",setup(w){const n=X(),{categoryOptions:t,isFetchLoading:b,isMutationLoading:y}=E(n),p=Le(Ue),{sortedBoodschappen:O,shortTermGroceries:k,getLatestPurchaseDate:V,getPricePerUnit:d,getPriceIncreasePercentage:o,getProjectedOutOfStockDate:s}=Ge(),i=p.greaterOrEqual("md"),f=$([]),v=$(null),r=$({name:{value:null,matchMode:"startsWith"},"category.label":{value:null,matchMode:"startsWith"}}),c=$(!1),l=$(!1),u=$(!1);function _(S){if(S.isOutOfStock)return"0 dagen";{const h=s(S);if(h){const m=Te(h);return`${m} dag${m!==1?"en":""}`}else return"Onbekend"}}async function C(S){if(S.isOutOfStock)v.value=S,u.value=!0;else{const h=S.clone();h.isOutOfStock=!S.isOutOfStock,await n.updateBoodschap(h)}}function G(S){f.value=[S.data]}function q(){v.value=null,l.value=!0}function N(S){v.value=S,l.value=!0}function le(S){v.value=S,c.value=!0}function H(){v.value=null,l.value=!1}function pe(){v.value=null,u.value=!1}async function me(){v.value&&await n.deleteBoodschap(v.value.id),c.value=!1,v.value=null}return je(()=>{n.fetchBoodschappen()}),(S,h)=>(P(),ee(te,null,[a(Ne,null,{content:g(()=>[a(qe,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"Sander's Boodschappentool",description:"Nu zul je nooit meer iets vergeten in de supermarkt!","description-props":{class:"text-white mb-5"}},{default:g(()=>[h[5]||(h[5]=D("ol",{class:"ms-3 list-decimal list-inside"},[D("li",null,"Voeg een product toe"),D("li",null,"Registreer wanneer je iets hebt gekocht"),D("li",null,"Weet automatisch wanneer je voorraad bijna op is!")],-1)),h[6]||(h[6]=D("h3",{class:"text-xl mt-10 mb-3 font-bold"},"Mijn boodschappenlijstje",-1)),h[7]||(h[7]=D("p",{class:"mb-3"},"Producten die bijna op zijn in één overzicht.",-1)),a(e(ae),{value:e(k),tableStyle:e(i)?"min-width: 40rem":void 0,loading:e(b),size:e(i)?void 0:"small"},{empty:g(()=>[...h[3]||(h[3]=[L(" Er zijn nog geen producten gevonden. ",-1)])]),default:g(()=>[a(e(x),{field:"name",header:"Naam"}),a(e(x),{header:"Voorraad aanvullen over"},{body:g(({data:m})=>[L(j(_(m)),1)]),_:1}),a(e(x),{header:"Voorraad leeg"},{body:g(({data:m})=>[a(ce,{name:`outofstock-${m.id}`,"model-value":m.isOutOfStock,disabled:e(y),onClick:B=>C(m)},null,8,["name","model-value","disabled","onClick"])]),_:1})]),_:1},8,["value","tableStyle","loading","size"]),h[8]||(h[8]=D("h3",{class:"text-xl mt-10 mb-3 font-bold"}," Alle producten ",-1)),a(e(ae),{value:e(O),expandedRows:f.value,"onUpdate:expandedRows":h[0]||(h[0]=m=>f.value=m),filters:r.value,"onUpdate:filters":h[1]||(h[1]=m=>r.value=m),tableStyle:e(i)?"min-width: 40rem":void 0,loading:e(b),size:e(i)?void 0:"small",filterDisplay:e(O).length>1?"row":void 0,onRowExpand:G},{empty:g(()=>[...h[4]||(h[4]=[L(" Er zijn nog geen producten gevonden. ",-1)])]),expansion:g(({data:m})=>[a(e(ae),{value:[m],size:e(i)?void 0:"small"},{default:g(()=>[a(e(x),{class:"!border-0",field:"size.value",header:"Formaat"},{body:g(({data:B})=>[L(j(B.size.value)+" "+j(B.size.unit),1)]),_:2},1024),a(e(x),{class:"!border-0",header:"Laatste aankoop"},{body:g(({data:B})=>[e(V)(B)?(P(),ee(te,{key:1},[L(j(e(de)(e(V)(B))),1)],64)):(P(),ee(te,{key:0},[L(" Nog niet gekocht ")],64))]),_:2},1024),a(e(x),{class:"!border-0",header:"Prijs"},{body:g(({data:B})=>[L(j(e(d)(B)?`€${e(d)(B).toFixed(2)}`:""),1)]),_:2},1024),a(e(x),{class:"!border-0",header:"Prijsstijging"},{body:g(({data:B})=>[D("span",{class:oe(e(o)(B)>0?"text-red-500":e(o)(B)<0?"text-green-500":"")},j(e(o)(B)?`${e(o)(B).toFixed(2)}%`:""),3)]),_:2},1024)]),_:2},1032,["value","size"]),a(et,{class:oe(e(i)?"max-h-[50vh]":"max-w-fit"),product:m},null,8,["class","product"])]),default:g(()=>[a(e(x),{class:oe({"w-[5rem]":e(i)}),expander:""},null,8,["class"]),a(e(x),{field:"name",header:"Naam"},{filter:g(({filterModel:m,filterCallback:B})=>[a(J,{name:"nameFilter",modelValue:m.value,"onUpdate:modelValue":F=>m.value=F,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:B},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),a(e(x),{field:"category.label",header:"Categorie",showFilterMenu:!1},{filter:g(({filterModel:m,filterCallback:B})=>[a(ue,{name:"categoryFilter",modelValue:m.value,"onUpdate:modelValue":[F=>m.value=F,B],options:e(t).map(F=>({...F,value:F.value?.label??null})),placeholder:"Filter...",style:{"min-width":"5rem"}},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(e(x),{header:"Voorraad aanvullen over"},{body:g(({data:m})=>[L(j(_(m)),1)]),_:1}),a(e(x),null,{filter:g(()=>[D("div",tt,[a(U,{class:"w-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",loading:e(y),onClick:q},null,8,["loading"])])]),body:g(({data:m})=>[D("div",at,[a(U,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:e(y),onClick:B=>N(m)},null,8,["loading","onClick"]),a(U,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:e(y),onClick:B=>le(m)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","tableStyle","loading","size","filterDisplay"]),a(U,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:e(y),onClick:q},null,8,["loading"])]),_:1})]),_:1}),a(Qe,{"is-open":l.value,selectedBoodschap:v.value,onClose:H},null,8,["is-open","selectedBoodschap"]),a(Ze,{"is-open":u.value,"selected-boodschap":v.value,onClose:pe},null,8,["is-open","selected-boodschap"]),a(ne,{title:"Product verwijderen","is-open":c.value,description:[v.value?`Weet je zeker dat je het product '${v.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":e(y),onConfirm:me,onCancel:h[2]||(h[2]=m=>c.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{rt as default};
