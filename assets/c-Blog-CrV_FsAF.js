import{_ as re}from"./c-Page.vue_vue_type_script_setup_true_lang-j8RYmb9b.js";import{X as de,Y as ce,b as t,c as i,$ as P,r as U,J as v,e as n,d as j,q as Y,a as q,al as ue,s as C,l as Z,am as pe,an as fe,R as O,f as s,h as y,g as f,B as ve,j as ee,C as R,i as D,u as te,G as se,ao as oe,z as T,P as N,w as A,ap as V,n as M,Q as H,aq as ge,ar as Q,t as me,_ as W,as as ye,at as he,a8 as X,U as ae,W as be,au as J}from"../bundle.js";import{_ as ke}from"./c-BackButton.vue_vue_type_script_setup_true_lang-oHqvxMiV.js";import{_ as le,b as K,u as $e,a as we}from"./c-BlogPostDialog.vue_vue_type_script_setup_true_lang-TEpR2vuw.js";import{_ as xe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DI3Y1UAH.js";import"./c-useUsers-Cf6IoDz_.js";var Ce=`
    .p-card {
        background: dt('card.background');
        color: dt('card.color');
        box-shadow: dt('card.shadow');
        border-radius: dt('card.border.radius');
        display: flex;
        flex-direction: column;
    }

    .p-card-caption {
        display: flex;
        flex-direction: column;
        gap: dt('card.caption.gap');
    }

    .p-card-body {
        padding: dt('card.body.padding');
        display: flex;
        flex-direction: column;
        gap: dt('card.body.gap');
    }

    .p-card-title {
        font-size: dt('card.title.font.size');
        font-weight: dt('card.title.font.weight');
    }

    .p-card-subtitle {
        color: dt('card.subtitle.color');
    }
`,Se={root:"p-card p-component",header:"p-card-header",body:"p-card-body",caption:"p-card-caption",title:"p-card-title",subtitle:"p-card-subtitle",content:"p-card-content",footer:"p-card-footer"},Pe=de.extend({name:"card",style:Ce,classes:Se}),Be={name:"BaseCard",extends:ce,style:Pe,provide:function(){return{$pcCard:this,$parentInstance:this}}},ne={name:"Card",extends:Be,inheritAttrs:!1};function Le(e,o,b,S,a,u){return t(),i("div",P({class:e.cx("root")},e.ptmi("root")),[e.$slots.header?(t(),i("div",P({key:0,class:e.cx("header")},e.ptm("header")),[U(e.$slots,"header")],16)):v("",!0),n("div",P({class:e.cx("body")},e.ptm("body")),[e.$slots.title||e.$slots.subtitle?(t(),i("div",P({key:0,class:e.cx("caption")},e.ptm("caption")),[e.$slots.title?(t(),i("div",P({key:0,class:e.cx("title")},e.ptm("title")),[U(e.$slots,"title")],16)):v("",!0),e.$slots.subtitle?(t(),i("div",P({key:1,class:e.cx("subtitle")},e.ptm("subtitle")),[U(e.$slots,"subtitle")],16)):v("",!0)],16)):v("",!0),n("div",P({class:e.cx("content")},e.ptm("content")),[U(e.$slots,"content")],16),e.$slots.footer?(t(),i("div",P({key:1,class:e.cx("footer")},e.ptm("footer")),[U(e.$slots,"footer")],16)):v("",!0)],16)],16)}ne.render=Le;const _e={key:0,class:"flex justify-center mt-5"},Ie={key:1,class:"flex flex-col gap-3"},Oe=j({__name:"BlogDetails",setup(e){const o=ve(),b=ee(),S=Y(),a=q(),u=ue(),{isLoggedIn:k}=C(S),{blogPosts:$,isBlogPostsFetchLoading:w}=C(a),{fetchBlogPost:B}=a,d=R(()=>o.params.postId);return Z(async()=>{var p;if(u.unread=[],d.value)if(((p=$.value.data.single)==null?void 0:p.id)!==d.value){const l=await B(d.value);if(pe(l)&&l===fe.PERMISSION_DENIED&&!k.value){b.push({name:O.LOGIN,params:{redirect:JSON.stringify({name:O.BLOG_DETAILS,params:{postId:d.value}})}});return}}else $.value.data.single}),(p,l)=>s(w)?(t(),i("div",_e,[y(D,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:"",label:"Loading..."})])):(t(),i("div",Ie,[y(ke,{"back-route":s(O).BLOG,label:"Back to other posts"},null,8,["back-route"]),s($).data.single?(t(),f(le,{key:0,post:s($).data.single},null,8,["post"])):v("",!0)]))}}),De={class:"flex gap-3"},Te={class:"min-h-[50vh] flex flex-col"},Ee={class:"flex justify-between h-fit mt-2 gap-2"},Ue={class:"flex flex-wrap gap-3"},Re={class:"relative mt-5 min-h-[20vh] max-h-screen flex flex-col justify-end"},Ne={class:"relative min-h-[20vh] max-h-full flex-grow"},Ae={class:"flex flex-col gap-1"},Ge={class:"flex justify-center mt-5"},Me={class:"flex justify-center mt-3"},je=j({__name:"BlogPostOverview",props:{post:{}},setup(e){const o=e,b=te(),S=Y(),a=se(),u=q(),k=oe(),{routeLoading:$,routeLoadingId:w}=C(b),{publicUsers:B}=C(a),{isOwner:d}=C(S),{deleteBlogPost:p}=u,l=T(!1),L=T(o.post.archived),_=R(()=>{var c;return(c=o.post.allowedUserIds)!=null&&c.length?B.value.filter(m=>{var x;return(x=o.post.allowedUserIds)==null?void 0:x.includes(m.id)}):[]}),E=R(()=>{const c=X(o.post.date);return o.post.dateUpdated?c+` - updated ${X(o.post.dateUpdated)}`:c}),F=R(()=>{const c=[];return o.post.datePinned&&c.push({value:"Pinned",severity:"success",rounded:!1}),o.post.locked&&c.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),o.post.archived&&c.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),c}),r=()=>{k.openWith(o.post)},h=()=>{l.value=!0},g=async()=>{await p(o.post.id)&&(l.value=!1)},z=()=>{const c=document.createElement("textarea"),{protocol:m,hostname:x,port:G}=window.location,I=`${m}//${x}`+(x==="localhost"?`:${G}`:"");c.value=`${I}#${ye.BLOG.path}/${o.post.id}`,document.body.appendChild(c),c.select(),document.execCommand("copy"),document.body.removeChild(c),he.success("Copied link!")};return(c,m)=>(t(),i(N,null,[y(W,{id:e.post.id,class:M([{"min-h-[50vh]":!L.value},"border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:E.value,tags:F.value,isCollapsed:L.value,clickable:"",route:{name:s(O).BLOG_DETAILS,params:{postId:e.post.id}}},{right:A(()=>[n("div",De,[L.value?s(d)?(t(),f(K,{key:1,onEditClicked:r,onDeleteClicked:h})):v("",!0):(t(),f(D,{key:0,class:"border-none h-fit",variant:"neutral",icon:"pi pi-copy",onClick:z}))])]),default:A(()=>{var x,G;return[n("div",Te,[n("div",Ee,[n("div",Ue,[_.value.length?(t(),i(N,{key:0},[y(s(V),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:(x=_.value[0])==null?void 0:x.displayName,rounded:""},null,8,["label"]),_.value.length>1?(t(),f(s(V),{key:0,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:"You",rounded:""})):v("",!0),_.value.length>2?(t(),f(s(V),{key:1,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",label:`${_.value.length-2} others`,rounded:""},null,8,["label"])):v("",!0)],64)):v("",!0)]),s(d)?(t(),i("div",{key:0,class:M(["flex justify-end ms-5",(G=e.post.allowedUserIds)!=null&&G.length?"flex-col md:flex-row":"flex-row"])},[y(K,{onEditClicked:r,onDeleteClicked:h})],2)):v("",!0)]),n("div",Re,[m[3]||(m[3]=n("div",{class:"absolute inset-0 rounded-primary bg-gradient-to-t from-neutral-500 to-transparent"},null,-1)),n("div",Ne,[y(s(ne),{class:M(["z-10 min-h-[20vh] p-5 text-neutral-300",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{content:A(()=>[n("div",Ae,[(t(!0),i(N,null,H(e.post.content.filter((I,ie)=>ie<2),I=>(t(),f(ge,{key:I.id,class:"max-h-[150px] overflow-hidden",post:e.post,block:I},null,8,["post","block"]))),128))])]),_:1},8,["class"])])]),n("div",Ge,[y(D,{class:"w-full md:w-1/2",variant:"neutral",label:"Read more",loading:s($)===s(O).BLOG_DETAILS&&s(w)===e.post.id,onClick:m[0]||(m[0]=I=>s(Q).push({name:s(O).BLOG_DETAILS,params:{postId:e.post.id}}))},null,8,["loading"])]),n("div",Me,[n("p",{class:M(e.post.reactions.length?"text-yellow-400 hover:text-yellow-500 cursor-pointer":"text-neutral-200"),onClick:m[1]||(m[1]=I=>s(Q).push({name:s(O).BLOG_DETAILS,params:{postId:e.post.id}}))},me(e.post.reactions.length)+" replies ",3)])])]}),_:1},8,["id","class","title","subTitle","tags","isCollapsed","route"]),y(xe,{title:"Delete Post",isOpen:l.value,description:[` Are you sure you want to delete this post called '${e.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:g,onCancel:m[2]||(m[2]=x=>l.value=!1)},null,8,["isOpen","description"])],64))}}),Fe={class:"w-full grid gap-4 md:gap-10 xl:gap-20"},ze={key:2,class:"w-full flex justify-center mt-5"},Ve=j({__name:"BlogPosts",props:{single:{type:Boolean}},setup(e){const o=Y(),b=q(),S=oe(),{blogPosts:a,visibleBlogPosts:u,isBlogPostsFetchLoading:k}=C(b),{firebaseUser:$,isLoggedIn:w,isOwner:B}=C(o),{fetchBlogPosts:d}=b;$e();const p=T(),l=T(),L=T(),_=()=>{S.openWith(null)},E=async r=>{a.value.visibility!==r&&(a.value.data[r].length||await d({visibility:r}),a.value.visibility=r,a.value.isLastPage=!1,J(p.value))},F=async()=>{const r=u.value.length;await d(),u.value[r]&&J(l.value[r])};return Z(()=>{a.value.loadedOnce||(w.value?E("private"):a.value.visibility!=="public"&&E("public"),a.value.loadedOnce=!0)}),ae(()=>{var r;return(r=l.value)==null?void 0:r.length},()=>{var r;if((r=l.value)!=null&&r.length&&L.value){const h=u.value.find(g=>g.id===L.value);if(h){const g=u.value.indexOf(h);J(l.value[g]),L.value=void 0}}}),(r,h)=>(t(),i("div",{ref_key:"container",ref:p,class:"flex flex-col gap-5 items-center"},[s(B)?(t(),f(D,{key:0,class:"w-full md:w-1/2",variant:"tertiary",label:"New Post",onClick:_})):v("",!0),s(w)?(t(),f(s(be),{key:1,class:"w-full md:w-1/2"},{default:A(()=>[y(D,{class:"w-full",variant:"secondary",outlined:s(a).visibility!=="public",loading:s(a).isLoading.public.fetch,label:"Public Posts",onClick:h[0]||(h[0]=g=>E("public"))},null,8,["outlined","loading"]),y(D,{class:"w-full",variant:"secondary",outlined:s(a).visibility!=="private",loading:s(a).isLoading.private.fetch,label:"Private Posts",onClick:h[1]||(h[1]=g=>E("private"))},null,8,["outlined","loading"])]),_:1})):v("",!0),n("div",Fe,[s(u).length?(t(!0),i(N,{key:0},H(s(u),(g,z)=>(t(),i("div",{key:g.id,ref_for:!0,ref_key:"posts",ref:l},[z===0||g.datePinned?(t(),f(le,{key:0,post:g},null,8,["post"])):(t(),f(je,{key:1,post:g},null,8,["post"]))]))),128)):s(k)?(t(),f(W,{key:1,class:"!bg-neutral-600 !bg-opacity-40 !rounded-primary",title:"Loading..."})):(t(),f(W,{key:2,class:"!bg-red-900 !bg-opacity-40 !rounded-primary",title:"No posts"}))]),s(a).isLastPage?v("",!0):(t(),i("div",ze,[y(D,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:s(u).length>0&&s(k),label:"Load more posts",onClick:F},null,8,["loading"])]))],512))}}),Je={class:"grid mt-10 md:mt-15"},We={class:"grid justify-center"},Ye={class:"text-lg md:text-xl text-white"},qe=["innerHTML"],He={class:"grid my-5 xl:px-20"},st=j({__name:"Blog",setup(e){const o=ee(),b=te(),S=se(),{menuItems:a,content:u}=C(b),{publicUser:k}=C(S),$=T(),w=T(o.currentRoute.value.params.postId),B=R(()=>{var d;return k.value?[...u.value.blogDescriptionUser.map(p=>p.replace("%USER%",k.value.displayName||"Unknown user")),...((d=a.value.find(p=>p.id==="nfNQM4SMESU2VOkJtcgY"))==null?void 0:d.description)||[]]:u.value.blogDescriptionGuest});return ae(o.currentRoute,d=>{w.value=d.params.postId}),(d,p)=>(t(),f(re,null,{content:A(()=>[n("div",Je,[n("div",We,[(t(!0),i(N,null,H(B.value,l=>(t(),i("h1",Ye,[n("span",{innerHTML:l},null,8,qe)]))),256))]),n("div",He,[w.value?(t(),f(Oe,{key:0})):(t(),f(Ve,{key:1})),y(we,{onScrollToUpdated:p[0]||(p[0]=l=>$.value=l)})])])]),_:1}))}});export{st as default};
