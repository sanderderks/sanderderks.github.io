import{b9 as ee,bs as te,bt as ae,bg as ne,bh as z,bu as le,ax as O,bv as se,bw as oe,b5 as ie,be as re,q as M,bx as ue,s as E,z as S,au as x,by as de,bz as ce,C as F,bA as U,d as W,v as me,U as fe,g as pe,w as v,f as t,b as q,e as b,h as a,D as P,ab as B,a7 as ge,a8 as ve,a9 as ke,t as N,$ as be,aa as we,a6 as Te,i as $,ad as xe,E as ye,l as he,c as De,O as Se,I as Ve,_ as $e,ai as Y,aj as j,k as R,bB as je}from"../bundle.js";import{_ as J}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{_ as Ce}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{_ as _e}from"./c-NumberField.vue_vue_type_script_setup_true_lang-BaJkCxK_.js";class C{id;name;interval;executeLog;constructor({id:e,name:n,interval:T,executeLog:f}={}){this.id=e??ee(),this.name=n??"",this.interval=T??{value:0,unit:"day"},this.executeLog=f??[]}static deserialize(e){return new C({id:e.id,name:e.name,interval:e.interval,executeLog:e.executeLog.map(_.deserialize)})}serialize(){return{id:this.id,name:this.name,interval:this.interval,executeLog:this.executeLog.map(e=>e.serialize())}}clone(){return new C({id:this.id,name:this.name,interval:{...this.interval},executeLog:this.executeLog.map(e=>e.clone())})}}class _{date;executorId;constructor(e,n){this.date=n??new Date,this.executorId=e??""}static deserialize(e){return new _(e.executorId,e.date.toDate())}serialize(){return{date:te.fromDate(this.date),executorId:this.executorId}}clone(){return new _(this.executorId,new Date(this.date.getTime()))}}function Le(w){return w.map(Ue)}function Ue(w){return C.deserialize(w)}class Ee{async fetchMultiple(e){return ae(ne(e,z.TASKS))}async create(e,n){await le(O(e,z.TASKS,n.id),n)}async update(e,n){await se(O(e,z.TASKS,n.id),{...n})}async delete(e,n){await oe(O(e,z.TASKS,n))}}const A=new Ee,K=ie("taskStore",()=>{const w=re(),e=M(),n=ue(),{firebaseUser:T}=E(e),{debug:f}=E(n),k=S([]),y=S(!1),l=S(!1);return{tasks:k,isFetchLoading:y,isMutationLoading:l,$reset:()=>{k.value=[]},fetchTasks:async()=>{if(!T.value){x.error("You must be logged in to fetch tasks.");return}try{y.value=!0;const c=await A.fetchMultiple(w);k.value=Le(c)}catch(c){x.firebaseError(f.value,c)}finally{y.value=!1}},createTask:async c=>{if(!T.value){x.error("You must be logged in to create tasks.");return}try{l.value=!0,await A.create(w,c.serialize()),de(k,c),x.success("Successfully created task")}catch(o){x.firebaseError(f.value,o)}finally{l.value=!1}},updateTask:async c=>{if(!T.value){x.error("You must be logged in to update tasks.");return}try{l.value=!0,await A.update(w,c.serialize()),ce(k,c,"id"),x.success("Successfully updated task")}catch(o){x.firebaseError(f.value,o)}finally{l.value=!1}},deleteTask:async c=>{if(!T.value){x.error("You must be logged in to delete tasks.");return}try{l.value=!0,k.value.find(u=>u.id===c)&&(await A.delete(w,c),k.value=k.value.filter(u=>u.id!==c),x.success("Successfully deleted task"))}catch(o){x.firebaseError(f.value,o)}finally{l.value=!1}}}}),Ie=()=>{const w=K(),{tasks:e}=E(w),n=F(()=>[...e.value].sort((g,r)=>{const d=l(g),s=l(r);return d===null&&s===null?0:d===null?1:s===null?-1:d.getTime()-s.getTime()})),T=F(()=>{const g=new Date,r=new Date(g.getTime()+7*U);return n.value.filter(d=>{const s=l(d);return s!==null&&s.getTime()>=g.getTime()&&s.getTime()<=r.getTime()})}),f=g=>[...g.executeLog].filter(r=>!Number.isNaN(r.date.getTime())).sort((r,d)=>r.date.getTime()-d.date.getTime()),k=g=>f(g).at(-1)?.date??null,y=g=>{const{value:r,unit:d}=g;switch(d){case"day":return r*U;case"week":return r*7*U;case"month":return r*30*U;case"year":return r*365*U;default:return null}},l=(g,r=new Date)=>{const d=k(g);if(!d)return new Date;const s=y(g.interval);if(!s)return new Date;const D=new Date(d.getTime()+s);return D.getTime()>=r.getTime()?D:new Date};return{sortedTasks:n,shortTermTasks:T,getLatestExecuteDate:k,getProjectedReExecuteDate:l}},ze={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Re={class:"w-full flex gap-3"},Ae={class:"flex gap-5"},Oe={class:"flex flex-col gap-3"},Fe=W({__name:"TaskEditDialog",props:{isOpen:{type:Boolean},selectedTask:{}},emits:["close"],setup(w,{emit:e}){const n=w,T=e,f=M(),k=K(),{isMutationLoading:y}=E(k),l=me(d()),g=[{label:"Dagen",value:"day"},{label:"Weken",value:"week"},{label:"Maanden",value:"month"},{label:"Jaren",value:"year"}],r=F(()=>[{value:"wEaq28Vfx8aygJ6TUi0hDrNut1F2",label:"Sander"},{value:"2VYQvSoxA6OtwDc2pd9f5AGgLK33",label:"Kasper"}].sort((o,u)=>{const m=f.firebaseUser?.uid;return o.value===m?-1:u.value===m?1:0}));function d(){const o=n.selectedTask?.clone()??new C;return{name:o.name,interval:o.interval,executeLog:o.executeLog}}async function s(){const o=n.selectedTask?n.selectedTask:new C;Object.assign(o,l),n.selectedTask?await k.updateTask(o):await k.createTask(o),T("close")}function D(){T("close")}function c(){if(!f.firebaseUser){x.error("You must be logged in to do this.");return}l.executeLog.push(new _(f.firebaseUser.uid))}return fe(()=>n.isOpen,o=>{o&&Object.assign(l,d())}),(o,u)=>(q(),pe(J,{"is-open":w.isOpen,title:n.selectedTask?`Bewerk ${n.selectedTask.name}`:"Taak toevoegen",description:"","cancel-text":"Annuleren","confirm-text":n.selectedTask?"Bijwerken":"Toevoegen","confirm-loading":t(y),onConfirm:s,onCancel:D},{default:v(()=>[b("div",ze,[a(P,{name:"name",label:"Naam",modelValue:l.name,"onUpdate:modelValue":u[0]||(u[0]=m=>l.name=m)},null,8,["modelValue"]),b("div",Re,[a(_e,{class:"w-full",name:"intervalValue",label:"Interval",modelValue:l.interval.value,"onUpdate:modelValue":u[1]||(u[1]=m=>l.interval.value=m)},null,8,["modelValue"]),a(B,{class:"!w-full",name:"intervalUnit",label:"Eenheid",modelValue:l.interval.unit,"onUpdate:modelValue":u[2]||(u[2]=m=>l.interval.unit=m),options:g},null,8,["modelValue"])]),u[5]||(u[5]=b("b",null,"Logboek",-1)),a(t(xe),{ref:"draggable",class:"flex flex-col gap-3",modelValue:l.executeLog,"onUpdate:modelValue":u[3]||(u[3]=m=>l.executeLog=m),itemKey:m=>m.date.toString(),handle:".drag-handle"},{item:v(({element:m,index:L})=>[a(t(ge),null,{default:v(()=>[a(t(ve),{value:"0"},{default:v(()=>[a(t(ke),{class:"drag-handle"},{default:v(()=>[b("div",Ae,[u[4]||(u[4]=b("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),b("p",null,N(t(be)(m.date)),1)])]),_:2},1024),a(t(we),null,{default:v(()=>[b("div",Oe,[a(Te,{name:`executeLog-date-${L}`,label:"Datum",modelValue:m.date,"onUpdate:modelValue":V=>m.date=V,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),a(B,{name:`executeLog-executor-${L}`,label:"Uitvoerder",modelValue:m.executorId,"onUpdate:modelValue":V=>m.executorId=V,options:r.value},null,8,["name","modelValue","onUpdate:modelValue","options"]),a($,{variant:"danger",outlined:"",label:"Delete",onClick:V=>l.executeLog.splice(L,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),a($,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:c})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),Ne={class:"flex justify-end"},Me={class:"flex justify-end"},Ke={class:"flex gap-3 place-self-end"},Pe=W({__name:"Tasks",setup(w){const e=K(),n=M(),{isFetchLoading:T,isMutationLoading:f}=E(e),k=ye(Ve),{sortedTasks:y,shortTermTasks:l,getProjectedReExecuteDate:g}=Ie(),r=k.greaterOrEqual("md"),d=S([]),s=S(null),D=S({name:{value:null,matchMode:"startsWith"}}),c=S(!1),o=S(!1);function u(h){const i=g(h);if(i){const p=je(i);return`${p} dag${p!==1?"en":""}`}else return"Onbekend"}async function m(h){if(!n.firebaseUser){x.error("You must be logged in to do this.");return}const i=h.clone();i.executeLog.push(new _(n.firebaseUser.uid)),await e.updateTask(i)}function L(h){d.value=[h.data]}function V(){s.value=null,o.value=!0}function G(h){s.value=h,o.value=!0}function H(h){s.value=h,c.value=!0}function Q(){s.value=null,o.value=!1}async function X(){s.value&&await e.deleteTask(s.value.id),c.value=!1,s.value=null}return he(()=>{e.fetchTasks()}),(h,i)=>(q(),De(Se,null,[a(Ce,null,{content:v(()=>[a($e,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"Sander's Klusjestool",description:"Nu zul je nooit meer iets vergeten te doen!","description-props":{class:"text-white mb-5"}},{default:v(()=>[i[5]||(i[5]=b("ol",{class:"ms-3 list-decimal list-inside"},[b("li",null,"Voeg een taak toe"),b("li",null,"Registreer wanneer je iets hebt gedaan"),b("li",null,"Weet automatisch wanneer je volgende taak gepland is!")],-1)),i[6]||(i[6]=b("h3",{class:"text-xl mt-10 mb-3 font-bold"},"Mijn takenlijst",-1)),i[7]||(i[7]=b("p",{class:"mb-3"},"Taken die binnenkort uitgevoerd moeten worden in één overzicht.",-1)),a(t(Y),{value:t(l),tableStyle:t(r)?"min-width: 40rem":void 0,loading:t(T),size:t(r)?void 0:"small"},{empty:v(()=>[...i[3]||(i[3]=[R(" Er zijn nog geen taken gevonden. ",-1)])]),default:v(()=>[a(t(j),{field:"name",header:"Naam"}),a(t(j),{header:"Taakje uitvoeren over"},{body:v(({data:p})=>[R(N(u(p)),1)]),_:1}),a(t(j),null,{body:v(({data:p})=>[b("div",Ne,[a($,{class:"w-fit",icon:"pi pi-check","icon-only":"",variant:"green",loading:t(f),onClick:I=>m(p)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","tableStyle","loading","size"]),i[8]||(i[8]=b("h3",{class:"text-xl mt-10 mb-3 font-bold"}," Alle taken ",-1)),a(t(Y),{value:t(y),expandedRows:d.value,"onUpdate:expandedRows":i[0]||(i[0]=p=>d.value=p),filters:D.value,"onUpdate:filters":i[1]||(i[1]=p=>D.value=p),tableStyle:t(r)?"min-width: 40rem":void 0,loading:t(T),size:t(r)?void 0:"small",filterDisplay:t(y).length>1?"row":void 0,onRowExpand:L},{empty:v(()=>[...i[4]||(i[4]=[R(" Er zijn nog geen taken gevonden. ",-1)])]),default:v(()=>[a(t(j),{field:"name",header:"Naam"},{filter:v(({filterModel:p,filterCallback:I})=>[a(P,{name:"nameFilter",modelValue:p.value,"onUpdate:modelValue":Z=>p.value=Z,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:I},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),a(t(j),{header:"Taakje uitvoeren over"},{body:v(({data:p})=>[R(N(u(p)),1)]),_:1}),a(t(j),null,{filter:v(()=>[b("div",Me,[a($,{class:"w-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(f),onClick:V},null,8,["loading"])])]),body:v(({data:p})=>[b("div",Ke,[a($,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:t(f),onClick:I=>G(p)},null,8,["loading","onClick"]),a($,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:t(f),onClick:I=>H(p)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","tableStyle","loading","size","filterDisplay"]),a($,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(f),onClick:V},null,8,["loading"])]),_:1})]),_:1}),a(Fe,{"is-open":o.value,"selected-task":s.value,onClose:Q},null,8,["is-open","selected-task"]),a(J,{title:"Taak verwijderen","is-open":c.value,description:[s.value?`Weet je zeker dat je het taakje '${s.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":t(f),onConfirm:X,onCancel:i[2]||(i[2]=p=>c.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{Pe as default};
