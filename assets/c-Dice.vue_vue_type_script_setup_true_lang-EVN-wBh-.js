import{C as g,b6 as Le,bf as Pe,q as Fe,bg as De,bd as we,s as k,bh as Ce,bi as le,be as M,z as R,bc as _,l as Ye,U as C,v as Z,bj as pe,b9 as Ge,bk as U,b8 as Me,m as Ue,bl as ke,bm as Ve,bn as te,d as $e,b as ae,c as je,n as Ke,g as xe,b4 as Ze,f as z}from"../bundle.js";import{_ as ze,a as We,b as ye,c as Be,d as Xe}from"./c-Dice5.vue_vue_type_script_setup_true_lang-C6p2XO2T.js";import{_ as qe}from"./c-Dice6.vue_vue_type_script_setup_true_lang-asLvsLFP.js";const Je=e=>{const H=g(()=>N(3)),A=g(()=>N(4)),i=g(()=>b(2)&&b(3)?L[Y.FULL_HOUSE].trueValue??!1:!1),P=g(()=>D(4)?L[Y.SMALL_STRAIGHT].trueValue??!1:!1),F=g(()=>D(5)?L[Y.LARGE_STRAIGHT].trueValue??!1:!1),m=g(()=>b(5)?L[Y.YAHTZEE].trueValue??!1:!1),T=g(()=>{let n=0;return e.value.forEach(r=>{n+=r.value}),n}),N=n=>{for(let r=1;r<=6;r++)if(e.value.filter(f=>f.value===r).length>=n){let f=0;return e.value.forEach(I=>{f+=I.value}),f}return!1},b=n=>{for(let r=1;r<=6;r++)if(e.value.filter(f=>f.value===r).length===n)return!0;return!1},D=n=>{let r=0,f=n;do{e:for(let I=f-n+1;I<=f;I++)if(e.value.some(p=>p.value===I))r++;else break e;if(r===n)return!0;r=0,f++}while(f<=6);return!1};return{hasThreeOfAKind:H,hasFourOfAKind:A,hasFullHouse:i,hasSmallStraight:P,hasLargeStraight:F,hasYahtzee:m,diceTotal:T,hasAtLeastOf:N,hasExactOf:b,hasStraight:D}};var Qe=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.WAITING_FOR_OPPONENTS=2]="WAITING_FOR_OPPONENTS",e[e.HAS_STARTED=3]="HAS_STARTED",e[e.HAS_THROWN_DICES=4]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=5]="HAS_CHOSEN_DICES",e[e.HAS_FINISHED=6]="HAS_FINISHED",e))(Qe||{}),Y=(e=>(e[e.ONES=0]="ONES",e[e.TWOS=1]="TWOS",e[e.THREES=2]="THREES",e[e.FOURS=3]="FOURS",e[e.FIVES=4]="FIVES",e[e.SIXES=5]="SIXES",e[e.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",e[e.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",e[e.FULL_HOUSE=8]="FULL_HOUSE",e[e.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",e[e.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",e[e.YAHTZEE=11]="YAHTZEE",e[e.CHANCE=12]="CHANCE",e))(Y||{}),el=(e=>(e[e.TOP=35]="TOP",e[e.YAHTZEE=100]="YAHTZEE",e))(el||{});const ll=Le("yahtzeeStore",()=>{const e=Pe(),H=Fe(),A=De(),i=we(),{personalBest:P,highscorePosition:F}=k(A),{firebaseUser:m}=k(H),{games:T,gamesLoading:N,gameId:b,creatorId:D,players:n,opponents:r,partyName:f,maxPlayers:I,isLocked:p,chat:ue,isOwner:V}=k(i),{setPreviousHighscores:W,updateHighscores:oe,sortHighscores:ie}=A,ne={onlineGames:Ce(e,le.GAME_DATA,M.YAHTZEE,le.ONLINE_GAMES)},S=R(_.SOLO),c=R(0),w=R(!1),s=R("soloPlayer"),O=R(s.value),d=R(se()),h=R(-1),v=Z({}),E=Z({}),o=Z({}),G=g(()=>d.value.some(l=>l.isRolling)),re=g(()=>h.value===-1&&!d.value.every(l=>l.selected)),ce=g(()=>h.value>=0&&h.value<2&&!d.value.every(l=>l.selected)),ve=g(()=>l=>d.value.filter(t=>t.value===l).length),{hasThreeOfAKind:fe,hasFourOfAKind:de,hasFullHouse:he,hasSmallStraight:Ee,hasLargeStraight:me,hasYahtzee:y,diceTotal:Oe}=Je(d);Ye(()=>{A.$init(M.YAHTZEE)}),C(v,l=>{c.value!==6&&Object.keys(l).length&&Object.keys(l).every(t=>l[t].length===13)&&(S.value===_.SOLO||V.value)&&(c.value=6)}),C(c,l=>{l===6&&(S.value===_.SOLO?(Q(s.value),K()):V.value&&(n.value.forEach(t=>{Q(t.userId)}),Ne(),q()),U(ke))}),C(o,()=>{S.value===_.MULTIPLAYER&&K()}),C([c,O,G],()=>{S.value===_.MULTIPLAYER&&q()},{deep:!0}),C(n,()=>{c.value===2&&I.value&&n.value.length===I.value&&(p.value=!0,c.value=3)});const $=()=>{i.$reset(),S.value=_.SOLO,c.value=0,w.value=!1,s.value="soloPlayer",O.value=s.value,h.value=-1,d.value=se(),Object.keys(v).forEach(l=>{delete v[l],delete E[l],delete o[l]}),W()},ge=(l,t=null,a=null)=>{m.value&&(l=[{userId:m.value.uid,isOnline:!0},...l],S.value=_.MULTIPLAYER,c.value=a?2:3,s.value=m.value.uid,O.value=s.value,l.forEach(u=>{v[u.userId]=[],E[u.userId]=[],o[u.userId]=null}),i.$init(M.YAHTZEE,B,X,$),i.createGame(l,t,a))},Ae=l=>{m.value&&(S.value=_.MULTIPLAYER,s.value=m.value.uid,i.$init(M.YAHTZEE,B,X,$),i.continueGame(l))},B=()=>({gameStatus:c.value,activePlayerId:O.value,dices:d.value,reroll:h.value,score:v,bonusScore:E,finalScore:o}),X=l=>{const t=m.value?.uid;!t||O.value===s.value||(c.value=l.gameStatus,O.value=l.activePlayerId,d.value=l.dices,h.value=l.reroll,Object.assign(v,l.score),Object.assign(E,l.bonusScore),Object.assign(o,l.finalScore),Object.keys(v).includes(t)||(v[t]=[],E[t]=[],o[t]=null))},q=()=>{!m.value||O.value!==s.value&&!w.value||i.pushState()},J=async()=>{for(;G.value;)await new Promise(l=>setTimeout(l,A.diceRollSpeed*1e3));return!0},Se=()=>{S.value=_.SOLO,c.value=3,v[s.value]=[],E[s.value]=[],o[s.value]=null},_e=async()=>{const l=A.diceRollSpeed*1e3;h.value++,d.value.forEach(t=>{t.selected||(t.isRolling=!0,setTimeout(()=>{t.value=pe(6),t.isRolling=!1,h.value===2&&(t.selected=!0),d.value.sort((a,u)=>a.value-u.value)},Ge(l,l/3)))}),await J(),c.value=4,U(Ve)},Ie=(l,t)=>v[t]?.find(a=>a.row===l),be=(l,t)=>Me(E[t].filter(a=>a===l)),j=(l,t="soloPlayer")=>{let a=0;return v[t]?.filter(u=>L[u.row].section===l).forEach(u=>{u.value!==!1&&(a+=u.value)}),a},Re=(l,t)=>{let a=t;if(a===!1)return!1;const u=L[l];return u.multiplier?a*=u.multiplier:u.trueValue&&(a=u.trueValue),a},He=l=>{O.value===s.value&&h.value>=0&&h.value<2&&(l.selected=!l.selected,U(te))},Te=(l,t)=>{if(!G.value){if(t!==!1&&y.value){const a=v[s.value].find(u=>u.row===11);a&&a.value!==!1&&E[s.value].push(100)}v[s.value].push({row:l,value:t}),j("top",s.value)>=63&&!E[s.value].includes(35)&&E[s.value].push(35),h.value=-1,d.value.forEach(a=>{a.selected=!1}),U(te),S.value===_.MULTIPLAYER&&(w.value=!0,c.value=5,setTimeout(async()=>{c.value=3,O.value=i.getNextPlayerId(O.value),await Ue(),w.value=!1},A.diceRollSpeed*1e3))}},Q=l=>{const t=j("top",l),a=j("bottom",l),u=E[l].reduce((x,ee)=>ee===35?x+(t>=63?35:0):ee===100?x+100:x,0);o[l]={top:t,bottom:a,bonus:u,total:t+a+u}},Ne=()=>{const l=Math.max(...Object.values(o).map(a=>a?.total??0)),t=Object.keys(o).filter(a=>o[a]?.total===l);n.value.forEach(a=>{t.includes(a.userId)?t.length===1?o[a.userId].winStatus="win":o[a.userId].winStatus="tie":o[a.userId].winStatus="lose"})},K=()=>{m?.value&&o[s.value]&&oe({gameId:b.value??null,score:o[s.value].total,bonus:o[s.value].bonus})};return{collections:ne,games:T,gamesLoading:N,gameId:b,creatorId:D,players:n,opponents:r,partyName:f,maxPlayers:I,isLocked:p,chat:ue,isOwner:V,gameType:S,gameStatus:c,gameStatusLoading:w,myPlayerId:s,activePlayerId:O,score:v,finalScore:o,bonusScore:E,reroll:h,dices:d,isRolling:G,canRoll:re,canReroll:ce,hasOfValue:ve,hasThreeOfAKind:fe,hasFourOfAKind:de,hasFullHouse:he,hasSmallStraight:Ee,hasLargeStraight:me,hasYahtzee:y,diceTotal:Oe,personalBest:P,highscorePosition:F,$reset:$,start:Se,roll:_e,hasFinishedRolling:J,getScore:Ie,getBonus:be,getActualValue:Re,selectDice:He,selectScore:Te,setPreviousHighscores:W,updateYahtzeeHighscore:K,sortHighscores:ie,fetchOnlineGames:i.fetchGames,createOnlineGame:ge,continueOnlineGame:Ae,leaveOnlineGame:i.leaveGame,deleteOnlineGame:i.deleteGame,getPlayerDisplayName:i.getPlayerDisplayName,getNextPlayerId:i.getNextPlayerId}},{}),se=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],L={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},ul=$e({__name:"Dice",props:{dice:{}},setup(e){const H=ll(),{activePlayerId:A,myPlayerId:i}=k(H),{selectDice:P}=H,F={1:Xe,2:Be,3:ye,4:We,5:ze,6:qe};return(m,T)=>(ae(),je("div",{class:Ke(["cursor-pointer",{"animate-spin":e.dice.isRolling}])},[(ae(),xe(Ze(F[e.dice.value]),{color:"black",backgroundColor:e.dice.selected?z(A)===z(i)?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:T[0]||(T[0]=N=>z(P)(e.dice))},null,8,["backgroundColor"]))],2))}});export{el as B,Qe as G,Y as S,ul as _,L as s,ll as u};
