import{f as g,aU as Le,aY as be,c as Pe,aV as Fe,aR as pe,s as V,a_ as De,a$ as le,aS as M,w as T,aQ as I,a9 as Z,o as Ge,L as w,b2 as we,b3 as Ce,aW as U,b4 as Ye,b0 as Me,b8 as te,aq as Ue,aX as Ve,d as ke,g as $e,j as ae,l as je,aT as Ke,h as z,z as We}from"../bundle.js";import{_ as Ze,a as ze,b as xe,c as ye,d as Be}from"./c-Dice5.vue_vue_type_script_setup_true_lang-DK-8hWiG.js";import{_ as Xe}from"./c-Dice6.vue_vue_type_script_setup_true_lang-CbzU1YFL.js";const qe=l=>{const N=g(()=>b(3)),A=g(()=>b(4)),o=g(()=>H(2)&&H(3)?P[C.FULL_HOUSE].trueValue??!1:!1),F=g(()=>D(4)?P[C.SMALL_STRAIGHT].trueValue??!1:!1),p=g(()=>D(5)?P[C.LARGE_STRAIGHT].trueValue??!1:!1),i=g(()=>H(5)?P[C.YAHTZEE].trueValue??!1:!1),L=g(()=>{let r=0;return l.value.forEach(c=>{r+=c.value}),r}),b=r=>{for(let c=1;c<=6;c++)if(l.value.filter(d=>d.value===c).length>=r){let d=0;return l.value.forEach(S=>{d+=S.value}),d}return!1},H=r=>{for(let c=1;c<=6;c++)if(l.value.filter(d=>d.value===c).length===r)return!0;return!1},D=r=>{let c=0,d=r;do{e:for(let S=d-r+1;S<=d;S++)if(l.value.some(k=>k.value===S))c++;else break e;if(c===r)return!0;c=0,d++}while(d<=6);return!1};return{hasThreeOfAKind:N,hasFourOfAKind:A,hasFullHouse:o,hasSmallStraight:F,hasLargeStraight:p,hasYahtzee:i,diceTotal:L,hasAtLeastOf:b,hasExactOf:H,hasStraight:D}};var Qe=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.WAITING_FOR_OPPONENTS=2]="WAITING_FOR_OPPONENTS",l[l.HAS_STARTED=3]="HAS_STARTED",l[l.HAS_THROWN_DICES=4]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=5]="HAS_CHOSEN_DICES",l[l.HAS_FINISHED=6]="HAS_FINISHED",l))(Qe||{}),C=(l=>(l[l.ONES=0]="ONES",l[l.TWOS=1]="TWOS",l[l.THREES=2]="THREES",l[l.FOURS=3]="FOURS",l[l.FIVES=4]="FIVES",l[l.SIXES=5]="SIXES",l[l.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",l[l.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",l[l.FULL_HOUSE=8]="FULL_HOUSE",l[l.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",l[l.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",l[l.YAHTZEE=11]="YAHTZEE",l[l.CHANCE=12]="CHANCE",l))(C||{}),Je=(l=>(l[l.TOP=35]="TOP",l[l.YAHTZEE=100]="YAHTZEE",l))(Je||{});const el=Le("yahtzeeStore",()=>{const l=be(),N=Pe(),A=Fe(),o=pe(),{personalBest:F,highscorePosition:p}=V(A),{firebaseUser:i}=V(N),{games:L,gamesLoading:b,gameId:H,creatorId:D,players:r,opponents:c,partyName:d,maxPlayers:S,chat:k,isOwner:$}=V(o),{setPreviousHighscores:x,updateHighscores:ue,sortHighscores:ne}=A,oe={onlineGames:De(l,le.GAME_DATA,M.YAHTZEE,le.ONLINE_GAMES)},_=T(I.SOLO),v=T(0),G=T(!1),s=T("soloPlayer"),O=T(s.value),h=T(se()),m=T(-1),f=Z({}),E=Z({}),n=Z({}),Y=g(()=>h.value.some(e=>e.isRolling)),ie=g(()=>m.value===-1&&!h.value.every(e=>e.selected)),re=g(()=>m.value>=0&&m.value<2&&!h.value.every(e=>e.selected)),ce=g(()=>e=>h.value.filter(t=>t.value===e).length),{hasThreeOfAKind:ve,hasFourOfAKind:fe,hasFullHouse:de,hasSmallStraight:he,hasLargeStraight:me,hasYahtzee:y,diceTotal:Ee}=qe(h);Ge(()=>{A.$init(M.YAHTZEE)}),w(f,e=>{v.value!==6&&Object.keys(e).length&&Object.keys(e).every(t=>e[t].length===13)&&(_.value===I.SOLO||$.value)&&(v.value=6)}),w(v,e=>{e===6&&(_.value===I.SOLO?(J(s.value),W()):$.value&&(r.value.forEach(t=>{J(t.userId)}),Ne(),q()),U(Ve))}),w(n,()=>{var e;if(_.value===I.MULTIPLAYER){const t=(e=n[s.value])==null?void 0:e.winStatus;(t==="win"||t==="tie")&&W()}}),w([v,O,Y],()=>{_.value===I.MULTIPLAYER&&q()},{deep:!0}),w(r,()=>{v.value===2&&S.value&&r.value.length===S.value&&(v.value=3)});const j=()=>{o.$reset(),_.value=I.SOLO,v.value=0,G.value=!1,s.value="soloPlayer",O.value=s.value,m.value=-1,h.value=se(),Object.keys(f).forEach(e=>{delete f[e],delete E[e],delete n[e]}),x()},Oe=(e,t=null,a=null)=>{i.value&&(e=[{userId:i.value.uid,isOnline:!0},...e],_.value=I.MULTIPLAYER,v.value=a?2:3,s.value=i.value.uid,O.value=s.value,e.forEach(u=>{f[u.userId]=[],E[u.userId]=[],n[u.userId]=null}),o.$init(M.YAHTZEE,B,X,j),o.createGame(e,t,a))},ge=e=>{i.value&&(_.value=I.MULTIPLAYER,s.value=i.value.uid,o.$init(M.YAHTZEE,B,X,j),o.continueGame(e))},B=()=>({gameStatus:v.value,activePlayerId:O.value,dices:h.value,reroll:m.value,score:f,bonusScore:E,finalScore:n}),X=e=>{var a;const t=(a=i.value)==null?void 0:a.uid;!t||O.value===s.value||(v.value=e.gameStatus,O.value=e.activePlayerId,h.value=e.dices,m.value=e.reroll,Object.assign(f,e.score),Object.assign(E,e.bonusScore),Object.assign(n,e.finalScore),Object.keys(f).includes(t)||(f[t]=[],E[t]=[],n[t]=null))},q=()=>{!i.value||O.value!==s.value&&!G.value||o.pushState()},Q=async()=>{for(;Y.value;)await new Promise(e=>setTimeout(e,A.diceRollSpeed*1e3));return!0},Ae=()=>{v.value=3,f[s.value]=[],E[s.value]=[],n[s.value]=null},Se=async()=>{const e=A.diceRollSpeed*1e3;m.value++,h.value.forEach(t=>{t.selected||(t.isRolling=!0,setTimeout(()=>{t.value=we(6),t.isRolling=!1,m.value===2&&(t.selected=!0),h.value.sort((a,u)=>a.value-u.value)},Ce(e,e/3)))}),await Q(),v.value=4,U(Ye)},_e=(e,t)=>{var a;return(a=f[t])==null?void 0:a.find(u=>u.row===e)},Ie=(e,t)=>Me(E[t].filter(a=>a===e)),K=(e,t="soloPlayer")=>{var u;let a=0;return(u=f[t])==null||u.filter(R=>P[R.row].section===e).forEach(R=>{R.value!==!1&&(a+=R.value)}),a},Re=(e,t)=>{let a=t;if(a===!1)return!1;const u=P[e];return u.multiplier?a*=u.multiplier:u.trueValue&&(a=u.trueValue),a},He=e=>{O.value===s.value&&m.value>=0&&m.value<2&&(e.selected=!e.selected,U(te))},Te=(e,t)=>{if(!Y.value){if(t!==!1&&y.value){const a=f[s.value].find(u=>u.row===11);a&&a.value!==!1&&E[s.value].push(100)}f[s.value].push({row:e,value:t}),K("top",s.value)>=63&&!E[s.value].includes(35)&&E[s.value].push(35),m.value=-1,h.value.forEach(a=>{a.selected=!1}),U(te),_.value===I.MULTIPLAYER&&(G.value=!0,v.value=5,setTimeout(async()=>{v.value=3,O.value=o.getNextPlayerId(O.value),await Ue(),G.value=!1},A.diceRollSpeed*1e3))}},J=e=>{const t=K("top",e),a=K("bottom",e),u=E[e].reduce((R,ee)=>ee===35?R+(t>=63?35:0):ee===100?R+100:R,0);n[e]={top:t,bottom:a,bonus:u,total:t+a+u}},Ne=()=>{const e=Math.max(...Object.values(n).map(a=>(a==null?void 0:a.total)??0)),t=Object.keys(n).filter(a=>{var u;return((u=n[a])==null?void 0:u.total)===e});r.value.forEach(a=>{t.includes(a.userId)?t.length===1?n[a.userId].winStatus="win":n[a.userId].winStatus="tie":n[a.userId].winStatus="lose"})},W=()=>{i!=null&&i.value&&n[s.value]&&ue({gameId:H.value??null,score:n[s.value].total,bonus:n[s.value].bonus})};return{collections:oe,onlineGames:L,onlineGamesLoading:b,onlineGameId:H,onlineGameCreatorId:D,onlineGamePlayers:r,onlineGameOpponents:c,partyName:d,maxPlayers:S,onlineGameChat:k,isOnlineGameOwner:$,gameType:_,gameStatus:v,gameStatusLoading:G,myPlayerId:s,activePlayerId:O,score:f,finalScore:n,bonusScore:E,reroll:m,dices:h,isRolling:Y,canRoll:ie,canReroll:re,hasOfValue:ce,hasThreeOfAKind:ve,hasFourOfAKind:fe,hasFullHouse:de,hasSmallStraight:he,hasLargeStraight:me,hasYahtzee:y,diceTotal:Ee,personalBest:F,highscorePosition:p,$reset:j,start:Ae,roll:Se,hasFinishedRolling:Q,getScore:_e,getBonus:Ie,getActualValue:Re,selectDice:He,selectScore:Te,setPreviousHighscores:x,updateYahtzeeHighscore:W,sortHighscores:ne,fetchOnlineGames:o.fetchGames,createOnlineGame:Oe,continueOnlineGame:ge,leaveOnlineGame:o.leaveGame,deleteOnlineGame:o.deleteGame,getPlayerDisplayName:o.getPlayerDisplayName,getNextPlayerId:o.getNextPlayerId}},{persist:{enabled:!0}}),se=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],P={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},sl=ke({__name:"Dice",props:{dice:{}},setup(l){const N=el(),{activePlayerId:A,myPlayerId:o}=V(N),{selectDice:F}=N,p={1:Be,2:ye,3:xe,4:ze,5:Ze,6:Xe};return(i,L)=>(ae(),$e("div",{class:We(["cursor-pointer",{"animate-spin":i.dice.isRolling}])},[(ae(),je(Ke(p[i.dice.value]),{color:"black",backgroundColor:i.dice.selected?z(A)===z(o)?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:L[0]||(L[0]=b=>z(F)(i.dice))},null,8,["backgroundColor"]))],2))}});export{Je as B,Qe as G,C as S,sl as _,P as s,el as u};
