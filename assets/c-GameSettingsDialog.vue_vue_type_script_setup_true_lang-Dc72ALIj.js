import{_ as m,a as T}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-CqI702AU.js";import{_ as f}from"./c-SelectField.vue_vue_type_script_setup_true_lang-RLKzDD90.js";import{c1 as y,cG as a,cH as c,cI as p,cJ as n,cK as R,cL as v,M as A,bo as _,bQ as g,aK as H,s as V,bH as O,I as u,bi as h,ak as d}from"../bundle.js";var E=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_THROWN_DICES=2]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=3]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=4]="HAS_CHOSEN_TILE",e[e.HAS_LOST=5]="HAS_LOST",e[e.HAS_FINISHED=6]="HAS_FINISHED",e))(E||{}),b=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(b||{}),N=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.LOSER=3]="LOSER",e))(N||{}),I=(e=>(e[e.PLAYER=0]="PLAYER",e[e.ROBOT=1]="ROBOT",e))(I||{});const S=()=>({gameStatus:0,gameStatusActivator:0,finishStatus:0,loseStatus:0,activePlayer:0,dices:[...P.map(e=>({...e}))],tiles:[...L],score:{0:[],1:[]},robotSpeed:1}),D=e=>{for(let s=1;s<=6;s++)if(e.every(l=>l.value===s))return!0;return!1},C=y("rainwormsStore",{state:()=>S(),getters:{isRolling:e=>e.dices.some(s=>s.isRolling),hasWorm:e=>e.dices.filter(s=>s.selected).some(s=>s.value===6),hasAlreadyChosen:e=>s=>e.dices.some(l=>l.value===s&&l.selected),canSelectAnyTile:e=>s=>e.tiles.some(l=>l.displayValue<=s),canPlay:e=>s=>e.activePlayer===(s??0),visibleTile:e=>s=>{const l=e.score[s??0];return l.length?l[l.length-1]:null},selectedDiceTotal:e=>{let s=0;return e.dices.filter(l=>l.selected).forEach(l=>{s+=l.value===6?5:l.value}),s},totalScore:e=>s=>{let l=0;return e.score[s].forEach(t=>{l+=t.value}),l},personalBest:e=>s=>a().personalBest(c.RAINWORMS,s),highscorePosition:e=>s=>a().highscorePosition(c.RAINWORMS,s)},actions:{reset(e){this.$patch(S()),a().setPreviousHighscores(c.RAINWORMS,e)},start(){this.gameStatus=1},roll(e){if(!this.canPlay(e))return;(this.gameStatus===1||this.gameStatus===4||this.gameStatus===5)&&this.dices.forEach(l=>{l.selected=!1}),this.gameStatus=2;const s=a().diceRollSpeed*1e3;this.dices.forEach(l=>{l.selected||(l.isRolling=!0,setTimeout(()=>{l.value=p(6),l.isRolling=!1,this.dices.sort((t,i)=>t.value-i.value),!this.isRolling&&this.gameStatus!==5&&this.hasLostRound()&&this.loseTurn(e)},p(s,s/3)))}),n(R)},async hasFinishedRolling(){for(;this.isRolling;)await new Promise(e=>setTimeout(e,500));return!0},hasLostRound(){const e=this.dices.filter(s=>!s.selected&&!this.hasAlreadyChosen(s.value));return!e.length||D(e)&&this.dices.every(s=>s.value!==6)},loseTurn(e){this.gameStatus=5,this.gameStatusActivator=e??0,this.score[this.gameStatusActivator].length?this.loseStatus=1:this.loseStatus=2,this.popLastTile(),this.tiles.length===0?this.gameStatus=6:this.passTurn()},popLastTile(){const e=this.score[this.activePlayer];if(e.length){const s=e.splice(e.length-1,1)[0];this.tiles.push(s),this.tiles.sort((l,t)=>l.displayValue-t.displayValue)}this.tiles.splice(this.tiles.length-1,1)},selectDice(e,s){this.canPlay(s)&&!this.isRolling&&this.gameStatus===2&&!e.selected&&!this.hasAlreadyChosen(e.value)&&(this.gameStatus=3,this.dices.filter(l=>l.value===e.value).forEach(l=>{l.selected=!0}),n(v))},selectTile(e,s,l){if(this.canPlay(l)&&(this.gameStatus===2||this.gameStatus===3)){if(this.gameStatus=4,this.gameStatusActivator=l??0,s){const t=this.score[this.activePlayer===0?1:0];t.splice(t.length-1,1)}else this.tiles=this.tiles.filter(t=>t.displayValue!==e.displayValue);this.score[this.activePlayer].push(e),n(v),this.tiles.length===0?this.gameStatus=6:this.passTurn()}},passTurn(e){(this.activePlayer===1||this.gameStatus!==5||e)&&(this.activePlayer===0?setTimeout(()=>{this.activePlayer=1,setTimeout(()=>{this.gameStatus=1,this.gameStatusActivator=0},1e3)},e?0:this.robotSpeed*1e3*2):setTimeout(()=>{this.activePlayer=0},e?0:this.robotSpeed*1e3*2))},async playRobot(){switch(this.gameStatus){case 1:{this.roll(1);break}case 2:{await this.hasFinishedRolling(),setTimeout(()=>{const e=this.dices.filter(l=>!l.selected),s=this.visibleTile(0);if(s&&this.selectedDiceTotal<s.displayValue)for(let l=6;l>=1;l--){const t=e.filter(i=>i.value===l&&!this.hasAlreadyChosen(l));if(t.length){const i=t.length*(l===6?5:l);if(this.selectedDiceTotal+i===s.displayValue){this.selectDice(t[0],1);return}}}for(let l=6;l>=1;l--){const t=e.find(i=>i.value===l);if(t&&!this.hasAlreadyChosen(l)){this.selectDice(t,1);return}}},this.robotSpeed*1e3);break}case 3:{setTimeout(()=>{const e=this.visibleTile(0);if(this.tiles.every(s=>s.displayValue>this.selectedDiceTotal)&&e&&e.displayValue>this.selectedDiceTotal)console.log("my score is too low"),this.roll(1);else if(e&&e.displayValue===this.selectedDiceTotal)console.log("i can steal"),this.selectTile(e,!0,1);else if(this.selectedDiceTotal>=30){console.log("i am rich");for(let s=this.selectedDiceTotal;s>=21;s--){const l=this.tiles.find(t=>t.displayValue===s);if(l){this.selectTile(l,!1,1);return}}this.roll(1)}else if(new Set(this.dices.filter(s=>s.selected).map(s=>s.value)).size<=3)if(this.dices.filter(s=>!s.selected).length<=2){console.log("there aren't that much dices left");const s=this.tiles.filter(l=>l.displayValue>=this.selectedDiceTotal-5&&l.displayValue<=this.selectedDiceTotal).sort((l,t)=>t.displayValue-l.displayValue);s.length?(console.log("i choose the highest score within 5 tiles"),this.selectTile(s[0],!1,1)):(console.log("i choose to roll again"),this.roll(1))}else console.log("i have nothing to worry about"),this.roll(1);else if(!this.hasWorm)console.log("i am worrying and have no worm yet"),this.roll(1);else{console.log("if i can choose, i choose");const s=this.tiles.filter(l=>l.displayValue<=this.selectedDiceTotal).sort((l,t)=>t.displayValue-l.displayValue);s.length?(console.log("i choose the highest score"),this.selectTile(s[0],!1,1)):(console.log("i choose to roll again"),this.roll(1))}},this.robotSpeed*1e3);break}default:console.log("DEFAULT",this.gameStatus)}},checkFinishStatus(e){const s=this.totalScore(0),l=this.totalScore(1);s>l?this.finishStatus=1:s===l&&Math.max(...this.score[0].map(t=>t.displayValue))>Math.max(...this.score[1].map(t=>t.displayValue))?this.finishStatus=2:this.finishStatus=3,(this.finishStatus===1||this.finishStatus===2)&&(e&&a().updateHighscores(c.RAINWORMS,e,s),new Audio("/sounds/applause-and-cheer.mp3").play())},setPreviousHighscores:(e,s)=>a().setPreviousHighscores(c.RAINWORMS,e,s),fetchGameData:e=>a().fetchGameData(c.RAINWORMS,e),updateHighscores:(e,s)=>a().updateHighscores(c.RAINWORMS,e,s),sortHighscores:()=>a().sortHighscores(c.RAINWORMS)},persist:{enabled:!0}}),P=[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],L=[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],B=A({__name:"GameSettingsDialog",props:{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}},emits:["update:isOpen"],setup(e){const s=_(e,"isOpen"),{useAudio:l,diceRollSpeed:t}=g(a()),{robotSpeed:i}=g(C());return(w,o)=>(H(),V(T,{isOpen:s.value,title:"Game Settings",description:"Huidige versie: v2 (17-11-2024)",cancelText:"Close",onCancel:o[3]||(o[3]=r=>s.value=!1)},{default:O(()=>[u(m,{name:"useAudio",label:"Audio",modelValue:h(l),"onUpdate:modelValue":o[0]||(o[0]=r=>d(l)?l.value=r:null)},null,8,["modelValue"]),u(f,{name:"diceSpeed",label:"Dice rolling speed",modelValue:h(t),"onUpdate:modelValue":o[1]||(o[1]=r=>d(t)?t.value=r:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"]),u(f,{name:"robotSpeed",label:"Rainworms robot speed",modelValue:h(i),"onUpdate:modelValue":o[2]||(o[2]=r=>d(i)?i.value=r:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])]),_:1},8,["isOpen"]))}});export{N as F,E as G,b as L,I as P,B as _,C as u};
