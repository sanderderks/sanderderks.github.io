import{d as R,j as q,b as t,c as r,g as $,_ as F,w as N,k,e as a,f as e,R as M,i as x,J as u,C as f,z as L,a0 as Q,G as W,bd as A,s as B,l as T,aA as K,U as X,h as D,W as Y,P as H,Q as Z,t as g,a2 as ee,n as te,q as se}from"../bundle.js";import{_ as oe}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"flex flex-wrap gap-3 mt-3 justify-center"},Ie=R({__name:"AddToLeaderboard",props:{isLoggedIn:{type:Boolean},isSolo:{type:Boolean},isGameOver:{type:Boolean},finalScore:{},personalBest:{},redirectRoute:{},showIf:{type:Boolean}},emits:["updateHighscore"],setup(n){const d=q();return(c,s)=>n.isGameOver?(t(),r("div",ne,[n.isLoggedIn?n.showIf!==!1&&n.isSolo&&n.finalScore>n.personalBest?(t(),$(x,{key:1,class:"w-full md:w-1/2",variant:"primary",onClick:s[1]||(s[1]=v=>c.$emit("updateHighscore"))},{default:N(()=>[...s[4]||(s[4]=[k(" Add To Leaderboard ",-1)])]),_:1})):u("",!0):(t(),$(F,{key:0,class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:N(()=>[s[2]||(s[2]=k(" Please ",-1)),a("a",{class:"cursor-pointer",onClick:s[0]||(s[0]=v=>e(d).push({name:e(M).LOGIN,params:{redirect:JSON.stringify({name:n.redirectRoute})}}))}," Login "),s[3]||(s[3]=k(" to add your score to the leaderboard. ",-1))]),_:1}))])):u("",!0)}}),ae=(n,d)=>{const c=L(0),s=f(()=>Q(n)),v=f(()=>(c.value+1)*d),y=f(()=>v.value-d),p=f(()=>c.value>0),m=f(()=>s.value.length>v.value),b=f(()=>s.value.filter((i,w)=>w>=y.value&&w<v.value));return{page:c,perPage:d,visibleData:b,hasPrevious:p,hasNext:m,$reset:()=>{c.value=0}}},le={class:"mt-5 flex flex-col items-center"},re={class:"w-full overflow-x-auto"},ie={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},ue={key:0},de={key:0},ce={key:1},fe={key:1},ve={key:0},he={key:1},me={key:2},ge={key:3},ye={key:2},pe={key:3},ke={key:4},be={colspan:"100%"},we=R({__name:"Highscores",props:{gameId:{},unit:{}},setup(n){const d=n,c=W(),s=A(),{publicUsers:v}=B(c),{allGameData:y,fetchLoading:p}=B(s),{fetchGameData:m,fetchHighscores:b,fetchScores:S}=s,i=L("highscores"),w=L(),V=f(()=>y.value[d.gameId].gameData[i.value]),{page:_,perPage:j,visibleData:h,hasPrevious:P,hasNext:G,$reset:O}=ae(()=>V.value,10),z=I=>v.value.find(o=>o.id===I)?.displayName??"Unknown",U=I=>{O(),i.value=I},E=()=>{i.value==="highscores"?b():S()};return T(()=>{s.$init(d.gameId),m(),w.value=setInterval(()=>{m()},1e3*60*5)}),K(()=>{clearInterval(w.value)}),X(i,()=>{y.value[d.gameId].gameData[i.value].length||E()}),(I,o)=>(t(),r("div",le,[D(e(Y),{class:"w-full md:w-1/2"},{default:N(()=>[D(x,{class:"w-full",variant:"secondary",outlined:i.value==="scores",label:"Highscores",onClick:o[0]||(o[0]=l=>U("highscores"))},null,8,["outlined"]),D(x,{class:"w-full",variant:"secondary",outlined:i.value==="highscores",label:"All Scores",onClick:o[1]||(o[1]=l=>U("scores"))},null,8,["outlined"])]),_:1}),a("div",re,[a("table",ie,[e(h).length?(t(),r("thead",ue,[a("tr",null,[o[4]||(o[4]=a("th",null,"Rank",-1)),o[5]||(o[5]=a("th",null,"User",-1)),o[6]||(o[6]=a("th",null,"Score",-1)),e(h).length&&e(h).some(l=>l.difficulty)?(t(),r("th",de,"Difficulty")):u("",!0),o[7]||(o[7]=a("th",null,"Date",-1)),e(h).length&&e(h).some(l=>l.bonus)?(t(),r("th",ce,"Bonus")):u("",!0)])])):u("",!0),e(h).length?(t(),r("tbody",fe,[(t(!0),r(H,null,Z(e(h),(l,J)=>(t(),r("tr",null,[a("th",null,g(J+1+e(_)*e(j)),1),a("th",null,g(z(l.userId??l.id)),1),a("td",null,[k(g(l.score)+" ",1),n.unit?(t(),r(H,{key:0},[k(g(n.unit),1),l.score!==1?(t(),r(H,{key:0},[k("s")],64)):u("",!0)],64)):u("",!0)]),l.difficulty?(t(),r("td",ve,g(l.difficulty),1)):e(h).some(C=>C.difficulty)?(t(),r("td",he)):u("",!0),a("td",null,g(e(ee)(l.date)),1),l.bonus?(t(),r("td",me,g(l.bonus),1)):e(h).some(C=>C.bonus)?(t(),r("td",ge)):u("",!0)]))),256))])):e(p)?(t(),r("tbody",ye,[...o[8]||(o[8]=[a("tr",null,[a("th",null,"Loading highscores...")],-1)])])):(t(),r("tbody",pe,[a("tr",null,[a("th",null,"There are no "+g(i.value==="highscores"?"highscores":"scores")+" yet.",1)])])),e(P)||e(G)?(t(),r("tfoot",ke,[a("tr",null,[a("td",be,[a("div",{class:te(["w-full p-2 flex",[e(P)?"justify-between":"justify-end"]])},[e(P)?(t(),$(x,{key:0,class:"w-fit",label:"Previous",variant:"neutral",onClick:o[2]||(o[2]=l=>_.value-=1)})):u("",!0),e(G)?(t(),$(x,{key:1,class:"w-fit",label:"Next",variant:"neutral",onClick:o[3]||(o[3]=l=>_.value+=1)})):u("",!0)],2)])])])):u("",!0)])])]))}}),$e=oe(we,[["__scopeId","data-v-b42fb3e6"]]),Be=n=>{const d=se(),c=A(),{allGameData:s,highscorePosition:v,personalBest:y}=B(c),{firebaseUser:p}=B(d),m=f(()=>p.value?v.value:null),b=f(()=>{if(!n)return!1;const i=s.value[n].previousHighscorePosition;return m.value&&i?i>m.value:!1}),S=f(()=>{if(!n)return!1;const i=s.value[n].previousPersonalBest;return p.value&&i?i<y.value:!1});return T(()=>{c.$init(n)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:S}};export{$e as H,Ie as _,Be as u};
