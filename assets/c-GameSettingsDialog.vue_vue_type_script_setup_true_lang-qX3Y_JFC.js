import{_ as Pe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-CDjfIsRS.js";import{aS as ke,aU as pe,s as J,v as E,a8 as ye,f as b,o as Ae,aR as V,K as Ie,aZ as re,b6 as Ce,b0 as Le,a$ as Te,aQ as De,c as Me,aP as Z,aX as we,aY as xe,a_ as We,d as $e,b4 as Ue,b5 as Be,l as ve,j as de,z as je,p as Fe,k as Ge,m as Se,h as z,am as fe,T as _e,S as Re}from"../bundle.js";var Ye=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Ye||{});const Ee={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Ke=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Ke||{}),Ze=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(Ze||{});const ze={easy:.5,hard:1},Ne=()=>{const e=Qe();return Ce(e),{pile1:e.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:e.splice(0,2).map((u,p)=>p<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:e.splice(0,3).map((u,p)=>p<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:e.splice(0,4).map((u,p)=>p<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:e.splice(0,5).map((u,p)=>p<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:e.splice(0,6).map((u,p)=>p<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:e.splice(0,7).map((u,p)=>p<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:e.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},qe=ke("patienceStore",()=>{const e=pe(),{personalBest:u,highscorePosition:p}=J(e),{setPreviousHighscores:x,updateHighscores:W,sortHighscores:k}=e,D=E("hard"),P=E(0),M=E(0),H=E(0),I=E(0),O=E(0),ue=E(),ne=E(!0),v=ye(Ne()),ee=b(()=>ze[D.value]),q=b(()=>Object.keys(v).flatMap(s=>v[s])),$=1e3,C=10,d=10,Q=b(()=>{const s=H.value%10===0?H.value:Math.floor(H.value/10)*10,a=M.value*C,o=O.value*C,n=s+a+o,g=I.value*d;return Math.max(0,$-(n-g))}),j=b(()=>{const s=Math.floor(H.value/60),a=H.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),le=b(()=>v.hearts.length===13&&v.spades.length===13&&v.diamonds.length===13&&v.clubs.length===13);Ae(()=>{e.$init(V.PATIENCE),H.value&&P.value===1&&y()}),Ie(le,s=>{s&&P.value!==2&&(X(),P.value=2,ce(),re(Le))});const r=()=>{X(),M.value=0,H.value=0,I.value=0,O.value=0,P.value=0,Object.assign(v,Ne()),e.setPreviousHighscores()},S=()=>{H.value=0,y(),P.value=1,setTimeout(()=>{R()},500)},y=()=>{ue.value&&X(),ue.value=setInterval(()=>{H.value++},1e3)},X=()=>{clearInterval(ue.value)},h=()=>{const s=v.stock_open;s.length&&(s.reverse(),G(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,v.stock_closed.push(a)}),s.splice(0,s.length),N(1))},T=s=>{const a=s.deck,o=q.value.filter(n=>n.selected);if(a==="stock_closed"){const n=v.stock_closed,g=n.indexOf(s);if(g===n.length-1){const w=D.value==="hard"?g-2:g,_=w<0?0:w,B=n.filter((oe,ge)=>ge>=_);Y(),U(B,"stock_open",oe=>{oe.hidden=!1}),N(0)}}else if(a==="stock_open"){const n=v.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,o.length&&G(o[0],!1))}else if(o.length){const n=o[0];n===s?G(s,!1):ae(a)&&he(n,s)?s.value===n.value+1&&s.deck!==n.deck&&(U(o,a),n.deck==="stock_open"?N(2):N(4)):o.length===1&&te(a)&&me(n,s)&&s.value===n.value-1&&(ie(n,a),N(3),n.hasBeenHome=!0)}else G(s,!0)},m=s=>{const a=q.value.filter(o=>o.selected);if(a.length){const o=a[0],n=o.deck;o.value===13&&(U(a,s),n==="stock_open"?N(2):ae(o.deck)&&v[o.deck].every(g=>!g.hidden)?N(5):N(4))}},F=s=>{const a=q.value.filter(o=>o.selected);if(a.length===1){const o=a[0],n=o.type;!v[s].length&&n===s&&o.value===1&&(ie(o,s),N(3))}},G=(s,a,o)=>{const n=v[s.deck],g=n.indexOf(s);n.filter((_,B)=>B>=g).forEach(_=>{_.selected=a,o==null||o(_)})},Y=()=>{q.value.forEach(s=>{s.selected=!1})},ie=(s,a)=>{const o=s.deck,n=v[o].indexOf(s);s.deck=a,s.selected=!1,v[a].push(s),v[o].splice(n,1),(ae(o)||o==="stock_open")&&K(o)},U=(s,a,o)=>{const n=s[0],g=n.deck,w=v[g].indexOf(n);G(n,!1,_=>{_.deck=a,o==null||o(_),v[a].push(_)}),v[g].splice(w,s.length),te(g)||K(g!=="stock_closed"?g:a)},se=s=>{if(!ne.value)return!0;const a=v[s.type],o=a.length?a[a.length-1].value:0;if(s.value===o+1){const n=["hearts","spades","diamonds","clubs"],g=o<=1||n.every(w=>{const _=v[w];return(_.length?_[_.length-1].value:0)>=o});if(o===0||g)return ie(s,s.type),s.hasBeenHome=!0,N(3),!0}return!1},R=()=>{if(ne.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=v[s];if(a.length&&se(a[a.length-1]))return}},K=s=>{const a=v[s];if(a.length){const o=a[a.length-1],n=o.deck;o.hidden=!1,setTimeout(()=>{o.deck===n&&(se(o)||R())},500)}else setTimeout(()=>{R()},500)},N=s=>{switch(s!==5&&M.value++,s){case 0:{O.value+=2*ee.value;break}case 1:{O.value+=5*ee.value;break}case 2:{I.value+=10*ee.value;break}case 3:{I.value+=20*ee.value;break}}re(Te)},he=(s,a)=>s.color!==a.color,me=(s,a)=>s.type===a.type,ae=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),te=s=>["hearts","spades","diamonds","clubs"].includes(s),ce=()=>{W({difficulty:D.value,score:Q.value,bonus:I.value,time:H.value,turns:M.value,penalty:O.value})};return{difficulty:D,gameStatus:P,score:Q,turns:M,time:H,bonus:I,penalty:O,cards:v,doAutocomplete:ne,allCards:q,formattedTime:j,personalBest:u,highscorePosition:p,$reset:r,start:S,shuffle:h,selectCard:T,selectEmptyDeck:m,selectFinalDeck:F,deselectAllCards:Y,isPlayDeck:ae,isFinalDeck:te,setPreviousHighscores:x,updatePatienceHighscore:ce,sortHighscores:k}},{persist:{enabled:!0}}),Qe=()=>Object.keys(Ee).flatMap(e=>{const u=e,p=[];for(let x=0;x<13;x++){const W={type:u,label:Ee[u].label,color:Ee[u].color,value:x+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(W)}return p});var Xe=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.HAS_STARTED=2]="HAS_STARTED",e[e.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",e[e.HAS_LOST=6]="HAS_LOST",e[e.HAS_FINISHED=7]="HAS_FINISHED",e))(Xe||{}),Je=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(Je||{}),el=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.WINNER_TIE=3]="WINNER_TIE",e[e.LOSER=4]="LOSER",e))(el||{});const ll=e=>{for(let u=1;u<=6;u++)if(e.every(p=>p.value===u))return!0;return!1},sl=ke("rainwormsStore",()=>{const e=pe(),u=De(),p=Me(),{personalBest:x,highscorePosition:W}=J(e),{firebaseUser:k}=J(p),{games:D,gamesLoading:P,gameId:M,creatorId:H,players:I,opponents:O,chat:ue,isOwner:ne}=J(u),{setPreviousHighscores:v,updateHighscores:ee,sortHighscores:q}=e,$=E(1),C=E(Z.SOLO),d=E(0),Q=E(!1),j=E(0),le=E(0),r=E("soloPlayer"),S=E(r.value),y=E(r.value),X=E(!1),h=E(He()),T=E(be()),m=ye({}),F=b(()=>h.value.some(l=>l.isRolling)),G=b(()=>h.value.filter(l=>l.selected).some(l=>l.value===6)),Y=b(()=>l=>h.value.some(t=>t.value===l&&t.selected)),ie=b(()=>T.value.some(l=>l.displayValue<=R.value)),U=b(()=>(l=r.value)=>S.value===l),se=b(()=>(l=r.value)=>{const t=m[l];return t.length?t[t.length-1]:null}),R=b(()=>{let l=0;return h.value.filter(t=>t.selected).forEach(t=>{l+=t.value===6?5:t.value}),l}),K=b(()=>l=>{let t=0;return m[l].forEach(c=>{t+=c.value}),t});Ae(()=>{e.$init(V.RAINWORMS),F.value&&h.value.forEach(l=>{l.isRolling=!1})}),Ie(d,l=>{l===7?Ve():C.value===Z.SOLO&&(X.value||S.value==="robot")&&ge(S.value)}),Ie([d,S,F],()=>{C.value===Z.MULTIPLAYER&&s()},{deep:!0});const N=()=>{u.$reset(),C.value=Z.SOLO,d.value=0,j.value=0,le.value=0,r.value="soloPlayer",S.value=r.value,y.value=r.value,h.value=He(),T.value=be(),Object.keys(m).forEach(l=>{delete m[l]}),v()},he=()=>{C.value=Z.SOLO,d.value=2,m[r.value]=[],m.robot=[]},me=l=>{k.value&&(l=[{userId:k.value.uid,isOnline:!0},...l],C.value=Z.MULTIPLAYER,d.value=2,r.value=k.value.uid,S.value=r.value,y.value=r.value,l.forEach(t=>{m[t.userId]=[]}),u.$init(V.RAINWORMS,te,ce,N),u.createGame(l))},ae=l=>{k.value&&(C.value=Z.MULTIPLAYER,r.value=k.value.uid,u.$init(V.RAINWORMS,te,ce,N),u.continueGame(l))},te=()=>({gameStatus:d.value,gameStatusActivator:y.value,activePlayer:S.value,dices:h.value,tiles:T.value,score:m}),ce=l=>{var c;const t=(c=k.value)==null?void 0:c.uid;!t||S.value===r.value||(d.value=l.gameStatus,y.value=l.gameStatusActivator,S.value=l.activePlayer,h.value=l.dices,T.value=l.tiles,Object.assign(m,l.score),Object.keys(m).includes(t)||(m[t]=[]))},s=()=>{!k.value||S.value!==r.value&&!Q.value||u.pushState()},a=(l=r.value)=>{if(!U.value(l))return;(d.value===2||d.value===5||d.value===6)&&h.value.forEach(c=>{c.selected=!1}),d.value=3;const t=e.diceRollSpeed*1e3;h.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=we(6),c.isRolling=!1,h.value.sort((A,i)=>A.value-i.value),!F.value&&d.value!==6&&n()&&g(l)},xe(t,t/3)))}),re(We)},o=async()=>{for(;F.value;)await new Promise(l=>setTimeout(l,e.diceRollSpeed*1e3));return!0},n=()=>{const l=h.value.filter(t=>!t.selected&&!Y.value(t.value));return!l.length||ll(l)&&l.every(t=>t.value!==6)&&h.value.filter(t=>t.selected).every(t=>t.value!==6)},g=(l=r.value)=>{d.value=6,y.value=l,m[y.value].length?le.value=1:le.value=2,w(),T.value.length===0?d.value=7:oe()},w=()=>{const l=m[S.value];if(l.length){const t=l.splice(l.length-1,1)[0];T.value.push(t),T.value.sort((c,A)=>c.displayValue-A.displayValue)}T.value.splice(T.value.length-1,1)},_=(l,t=r.value)=>{U.value(t)&&!F.value&&d.value===3&&!l.selected&&!Y.value(l.value)&&(d.value=4,h.value.filter(c=>c.value===l.value).forEach(c=>{c.selected=!0}),re(Te))},B=(l,t,c=r.value)=>{if(U.value(c)&&(d.value===3||d.value===4)){if(t){const A=m[t];A.splice(A.length-1,1)}else T.value=T.value.filter(A=>A.displayValue!==l.displayValue);m[S.value].push(l),T.value.length===0?d.value=7:(d.value=5,y.value=c,oe()),re(Te)}},oe=l=>{(X.value||S.value!==r.value||d.value!==6||l)&&(S.value===r.value?setTimeout(()=>{Q.value=!0,S.value=C.value===Z.SOLO?"robot":u.getNextPlayerId(r.value),setTimeout(()=>{d.value=2,y.value=r.value,Q.value=!1},$.value*1e3)},l?0:$.value*1e3*2):setTimeout(()=>{const t=S.value;S.value=r.value,setTimeout(()=>{d.value=2,y.value=t},$.value*1e3)},l?0:$.value*1e3*2))},ge=async l=>{if(await new Promise(c=>setTimeout(c,5)),!U.value(l))return;const t=l===r.value?"robot":r.value;switch(d.value){case 2:{a(l);break}case 3:{await o(),setTimeout(()=>{const c=h.value.filter(i=>!i.selected),A=se.value(t);if(A&&R.value<A.displayValue)for(let i=6;i>=1;i--){const f=c.filter(L=>L.value===i&&!Y.value(i));if(f.length){const L=f.length*(i===6?5:i);if(R.value+L===A.displayValue){_(f[0],l);return}}}for(let i=6;i>=1;i--){const f=h.value.find(L=>L.value===i);if(f&&!Y.value(i)){_(f,l);return}}},$.value*1e3);break}case 4:{setTimeout(()=>{const c=se.value(t),A=h.value.filter(i=>!i.selected).length;if(!A||R.value>=30){A?console.log(l,"i am rich"):console.log(l,"i can only pick a tile now");for(let i=R.value;i>=21;i--){const f=T.value.find(L=>L.displayValue===i);if(f){B(f,void 0,l);return}}A&&a(l)}if(T.value.every(i=>i.displayValue>R.value)&&c&&c.displayValue>R.value)console.log(l,"my score is too low"),a(l);else if(c&&c.displayValue===R.value)console.log(l,"i can steal"),B(c,t,l);else if(new Set(h.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(h.value.filter(i=>!i.selected).length<=2){console.log(l,"there aren't that much dices left");const i=T.value.filter(f=>f.displayValue>=R.value-5&&f.displayValue<=R.value).sort((f,L)=>L.displayValue-f.displayValue);i.length?(console.log(l,"i choose the highest score within 5 tiles"),B(i[0],void 0,l)):(console.log(l,"i choose to roll again"),a(l))}else console.log(l,"i have nothing to worry about"),a(l);else if(!G.value)console.log(l,"i am worrying and have no worm yet"),a(l);else{console.log(l,"if i can choose, i choose");const i=T.value.filter(f=>f.displayValue<=R.value).sort((f,L)=>L.displayValue-f.displayValue);i.length?(console.log(l,"i choose the highest score"),B(i[0],void 0,l)):(console.log(l,"i choose to roll again"),a(l))}},$.value*1e3);break}default:console.log(l,"DEFAULT",d.value)}},Ve=()=>{const l=Math.max(...Object.keys(m).map(c=>K.value(c))),t=Object.keys(m).filter(c=>K.value(c)===l);if(t.includes(r.value))if(t.length===1)j.value=1;else{const c=Math.max(...m[r.value].map(f=>f.displayValue)),A=t.filter(f=>f!==r.value)[0],i=Math.max(...m[A].map(f=>f.displayValue));c>i?j.value=2:j.value=3}else j.value=4;Oe()},Oe=()=>{ee({gameId:M.value??null,score:K.value(r.value)})};return{gameType:C,gameStatus:d,gameStatusLoading:Q,myPlayerId:r,gameStatusActivatorId:y,finishStatus:j,loseStatus:le,activePlayerId:S,isFullyAutomatic:X,dices:h,tiles:T,score:m,robotSpeed:$,isRolling:F,hasWorm:G,hasAlreadyChosen:Y,canSelectAnyTile:ie,canPlay:U,visibleTile:se,selectedDiceTotal:R,totalScore:K,personalBest:x,highscorePosition:W,games:D,gamesLoading:P,gameId:M,creatorId:H,players:I,opponents:O,chat:ue,isOwner:ne,$reset:N,start:he,roll:a,hasFinishedRolling:o,hasLostRound:n,loseTurn:g,popLastTile:w,selectDice:_,selectTile:B,passTurn:oe,setPreviousHighscores:v,updateRainwormsHighscore:Oe,sortHighscores:q,fetchOnlineGames:u.fetchGames,createOnlineGame:me,continueOnlineGame:ae,leaveOnlineGame:u.leaveGame,deleteOnlineGame:u.deleteGame}},{persist:{enabled:!0}}),He=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],be=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],al={class:"flex flex-col gap-3"},ul=$e({__name:"GameSettingsDialog",props:Ue({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const u=e,p=Be(e,"isOpen"),x=pe(),{useAudio:W,diceRollSpeed:k}=J(pe()),{robotSpeed:D}=J(sl()),{doAutocomplete:P}=J(qe()),M=b(()=>{switch(u.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)";case V.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Ae(()=>{x.$init(u.gameId)}),(H,I)=>(de(),ve(Pe,{isOpen:p.value,title:"Game Settings",description:e.gameId?`Current version: ${M.value}`:"General settings",cancelText:"Close",onCancel:I[4]||(I[4]=O=>p.value=!1)},{default:je(()=>[Fe("div",al,[Ge(_e,{name:"useAudio",label:"Audio",modelValue:z(W),"onUpdate:modelValue":I[0]||(I[0]=O=>fe(W)?W.value=O:null)},null,8,["modelValue"]),e.gameId===z(V).PATIENCE?(de(),ve(_e,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:z(P),"onUpdate:modelValue":I[1]||(I[1]=O=>fe(P)?P.value=O:null)},null,8,["modelValue"])):Se("",!0),e.gameId===z(V).YAHTZEE||e.gameId===z(V).RAINWORMS?(de(),ve(Re,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:z(k),"onUpdate:modelValue":I[2]||(I[2]=O=>fe(k)?k.value=O:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),e.gameId===z(V).RAINWORMS?(de(),ve(Re,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:z(D),"onUpdate:modelValue":I[3]||(I[3]=O=>fe(D)?D.value=O:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)])]),_:1},8,["isOpen","description"]))}});export{Ye as C,Ke as D,el as F,Xe as G,Je as L,ul as _,qe as a,Ze as b,sl as u};
