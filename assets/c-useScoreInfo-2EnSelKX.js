import{_ as D}from"./c-Bubble.vue_vue_type_script_setup_true_lang-Di5vSobc.js";import{e as A,A as V,aK as U,s as _,r as x,c as y,o as N,al as L,M as T,l as n,m as l,p as s,n as B,t as u,w as p,O as M,H as r,G as I,k as P,C as R,h as j}from"../bundle.js";import{_ as E}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"mt-5 flex justify-center"},K={class:"w-full overflow-x-auto"},O={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},q={key:0},z={key:0},J={key:1},Q={key:1},W={key:0},X={key:1},Y={key:2},Z={key:3},ee={key:2},te={key:3},se=A({__name:"Highscores",props:{gameId:{},unit:{}},setup(d){const h=d,v=V(),i=U(),{publicUsers:k}=_(v),{allGameData:f,fetchLoading:m}=_(i),{fetchGameData:c,fetchHighscores:b,fetchScores:S}=i,o=x("highscores"),H=x(),a=y(()=>f.value[h.gameId].gameData[o.value]),C=g=>{var e;return((e=k.value.find(t=>t.id===g))==null?void 0:e.displayName)??"Unknown"},G=()=>{o.value==="highscores"?b():S()};return N(()=>{i.$init(h.gameId),c(),H.value=setInterval(()=>{c()},1e3*60*5)}),L(()=>{clearInterval(H.value)}),T(o,()=>{f.value[h.gameId].gameData[o.value].length||G()}),(g,e)=>(n(),l(p,null,[s("div",F,[B(D,{class:"w-1/2 md:w-1/4 rounded-r-none",type:"secondary",outlined:o.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=t=>o.value="highscores")},null,8,["outlined"]),B(D,{class:"w-1/2 md:w-1/4 rounded-l-none",type:"secondary",outlined:o.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=t=>o.value="scores")},null,8,["outlined"])]),s("div",K,[s("table",O,[a.value.length?(n(),l("thead",q,[s("tr",null,[e[2]||(e[2]=s("th",null,"Rank",-1)),e[3]||(e[3]=s("th",null,"User",-1)),e[4]||(e[4]=s("th",null,"Score",-1)),a.value.length&&a.value.some(t=>t.difficulty)?(n(),l("th",z,"Difficulty")):u("",!0),e[5]||(e[5]=s("th",null,"Date",-1)),a.value.length&&a.value.some(t=>t.bonus)?(n(),l("th",J,"Bonus")):u("",!0)])])):u("",!0),a.value.length?(n(),l("tbody",Q,[(n(!0),l(p,null,M(a.value,(t,$)=>(n(),l("tr",null,[s("th",null,r($+1),1),s("th",null,r(C(t.userId??t.id)),1),s("td",null,[I(r(t.score)+" ",1),g.unit?(n(),l(p,{key:0},[I(r(g.unit),1),t.score!==1?(n(),l(p,{key:0},[I("s")],64)):u("",!0)],64)):u("",!0)]),t.difficulty?(n(),l("td",W,r(t.difficulty),1)):a.value.some(w=>w.difficulty)?(n(),l("td",X)):u("",!0),s("td",null,r(P(R)(t.date)),1),t.bonus?(n(),l("td",Y,r(t.bonus),1)):a.value.some(w=>w.bonus)?(n(),l("td",Z)):u("",!0)]))),256))])):P(m)?(n(),l("tbody",ee,e[6]||(e[6]=[s("tr",null,[s("th",null,"Loading highscores...")],-1)]))):(n(),l("tbody",te,[s("tr",null,[s("th",null,"There are no "+r(o.value==="highscores"?"highscores":"scores")+" yet.",1)])]))])])],64))}}),ae=E(se,[["__scopeId","data-v-5c8366dc"]]),re=d=>{const h=j(),v=U(),{allGameData:i,highscorePosition:k,personalBest:f}=_(v),{firebaseUser:m}=_(h),c=y(()=>m.value?k.value:null),b=y(()=>{const o=i.value[d].previousHighscorePosition;return c.value&&o?o>c.value:!1}),S=y(()=>{const o=i.value[d].previousPersonalBest;return m.value&&o?o<f.value:!1});return N(()=>{v.$init(d)}),{currentHighscorePosition:c,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:S}};export{ae as H,re as u};
