import{b9 as ne,bs as le,bt as se,bg as W,bh as I,bu as oe,ax as R,bv as ie,bw as re,b5 as ue,be as ce,q as K,bx as de,s as z,z as D,au as x,by as me,bz as fe,aA as ve,C as N,bA as U,d as q,v as ge,U as pe,g as ke,w as v,f as t,b as J,e as g,h as l,D as G,ab as B,a7 as be,a8 as we,a9 as Te,t as E,$ as xe,aa as ye,a6 as he,i as C,ad as De,E as Se,l as _e,c as Ce,O as Ve,I as je,_ as $e,ai as P,aj as j,n as Le,k as F,bC as Ue}from"../bundle.js";import{_ as H}from"./c-Dialog.vue_vue_type_script_setup_true_lang-Cg8Yx5Jw.js";import{_ as Ie}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{_ as Ee}from"./c-NumberField.vue_vue_type_script_setup_true_lang-BaJkCxK_.js";class ${id;name;interval;executeLog;constructor({id:e,name:s,interval:w,executeLog:m}={}){this.id=e??ne(),this.name=s??"",this.interval=w??{value:0,unit:"day"},this.executeLog=m??[]}static deserialize(e){return new $({id:e.id,name:e.name,interval:e.interval,executeLog:e.executeLog.map(L.deserialize)})}serialize(){return{id:this.id,name:this.name,interval:this.interval,executeLog:this.executeLog.map(e=>e.serialize())}}clone(){return new $({id:this.id,name:this.name,interval:{...this.interval},executeLog:this.executeLog.map(e=>e.clone())})}}class L{date;executorId;constructor(e,s){this.date=s??new Date,this.executorId=e??""}static deserialize(e){return new L(e.executorId,e.date.toDate())}serialize(){return{date:le.fromDate(this.date),executorId:this.executorId}}clone(){return new L(this.executorId,new Date(this.date.getTime()))}}function ze(b){return b.map(Ae)}function Ae(b){return $.deserialize(b)}class Re{async fetchMultiple(e){return se(W(e,I.TASKS))}async create(e,s){await oe(R(e,I.TASKS,s.id),s)}async update(e,s){await ie(R(e,I.TASKS,s.id),{...s})}async delete(e,s){await re(R(e,I.TASKS,s))}}const O=new Re,M=ue("taskStore",()=>{const b=ce(),e=K(),s=de(),{firebaseUser:w}=z(e),{debug:m}=z(s),p=D([]),y=D(!1),o=D(!1),r=D(null),u=()=>{r.value?.(),r.value=null,p.value=[]},d=()=>{y.value=!0,r.value?.(),r.value=ve(W(b,I.TASKS),a=>{const n=a.docs.map(h=>({id:h.id,...h.data()}));p.value=ze(n),y.value=!1},a=>{y.value=!1,x.firebaseError(m.value,a)})};return{tasks:p,isFetchLoading:y,isMutationLoading:o,$reset:u,fetchTasks:async()=>{if(!w.value){x.error("You must be logged in to fetch tasks."),r.value?.(),r.value=null;return}d()},createTask:async a=>{if(!w.value){x.error("You must be logged in to create tasks.");return}try{o.value=!0,await O.create(b,a.serialize()),me(p,a),x.success("Successfully created task")}catch(n){x.firebaseError(m.value,n)}finally{o.value=!1}},updateTask:async a=>{if(!w.value){x.error("You must be logged in to update tasks.");return}try{o.value=!0,await O.update(b,a.serialize()),fe(p,a,"id"),x.success("Successfully updated task")}catch(n){x.firebaseError(m.value,n)}finally{o.value=!1}},deleteTask:async a=>{if(!w.value){x.error("You must be logged in to delete tasks.");return}try{o.value=!0,p.value.find(h=>h.id===a)&&(await O.delete(b,a),p.value=p.value.filter(h=>h.id!==a),x.success("Successfully deleted task"))}catch(n){x.firebaseError(m.value,n)}finally{o.value=!1}}}}),Fe=()=>{const b=M(),{tasks:e}=z(b),s=N(()=>[...e.value].sort((r,u)=>{const d=o(r),c=o(u);return d===null&&c===null?0:d===null?1:c===null?-1:d.getTime()-c.getTime()})),w=N(()=>{const r=new Date,u=new Date(r.getTime()+7*U);return s.value.filter(d=>{const c=o(d);return c!==null&&c.getTime()>=r.getTime()&&c.getTime()<=u.getTime()})}),m=r=>[...r.executeLog].filter(u=>!Number.isNaN(u.date.getTime())).sort((u,d)=>u.date.getTime()-d.date.getTime()),p=r=>m(r).at(-1)?.date??null,y=r=>{const{value:u,unit:d}=r;switch(d){case"day":return u*U;case"week":return u*7*U;case"month":return u*30*U;case"year":return u*365*U;default:return null}},o=(r,u=new Date)=>{const d=p(r);if(!d)return new Date;const c=y(r.interval);if(!c)return new Date;const S=new Date(d.getTime()+c);return S.getTime()>=u.getTime()?S:new Date};return{sortedTasks:s,shortTermTasks:w,getLatestExecuteDate:p,getProjectedReExecuteDate:o}},Oe={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ne={class:"w-full flex gap-3"},Ke={class:"flex gap-5"},Me={class:"flex flex-col gap-3"},Ye=q({__name:"TaskEditDialog",props:{isOpen:{type:Boolean},selectedTask:{}},emits:["close"],setup(b,{emit:e}){const s=b,w=e,m=K(),p=M(),{isMutationLoading:y}=z(p),o=ge(d()),r=[{label:"Dagen",value:"day"},{label:"Weken",value:"week"},{label:"Maanden",value:"month"},{label:"Jaren",value:"year"}],u=N(()=>[{value:"wEaq28Vfx8aygJ6TUi0hDrNut1F2",label:"Sander"},{value:"2VYQvSoxA6OtwDc2pd9f5AGgLK33",label:"Kasper"}].sort((f,a)=>{const n=m.firebaseUser?.uid;return f.value===n?-1:a.value===n?1:0}));function d(){const f=s.selectedTask?.clone()??new $;return{name:f.name,interval:f.interval,executeLog:f.executeLog}}async function c(){const f=s.selectedTask?s.selectedTask:new $;Object.assign(f,o),s.selectedTask?await p.updateTask(f):await p.createTask(f),w("close")}function S(){w("close")}function _(){if(!m.firebaseUser){x.error("You must be logged in to do this.");return}o.executeLog.push(new L(m.firebaseUser.uid))}return pe(()=>s.isOpen,f=>{f&&Object.assign(o,d())}),(f,a)=>(J(),ke(H,{"is-open":b.isOpen,title:s.selectedTask?`Bewerk ${s.selectedTask.name}`:"Taak toevoegen",description:"","cancel-text":"Annuleren","confirm-text":s.selectedTask?"Bijwerken":"Toevoegen","confirm-loading":t(y),onConfirm:c,onCancel:S},{default:v(()=>[g("div",Oe,[l(G,{name:"name",label:"Naam",modelValue:o.name,"onUpdate:modelValue":a[0]||(a[0]=n=>o.name=n)},null,8,["modelValue"]),g("div",Ne,[l(Ee,{class:"w-full",name:"intervalValue",label:"Interval",modelValue:o.interval.value,"onUpdate:modelValue":a[1]||(a[1]=n=>o.interval.value=n)},null,8,["modelValue"]),l(B,{class:"!w-full",name:"intervalUnit",label:"Eenheid",modelValue:o.interval.unit,"onUpdate:modelValue":a[2]||(a[2]=n=>o.interval.unit=n),options:r},null,8,["modelValue"])]),a[5]||(a[5]=g("b",null,"Logboek",-1)),l(t(De),{ref:"draggable",class:"flex flex-col gap-3",modelValue:o.executeLog,"onUpdate:modelValue":a[3]||(a[3]=n=>o.executeLog=n),itemKey:n=>n.date.toString(),handle:".drag-handle"},{item:v(({element:n,index:h})=>[l(t(be),null,{default:v(()=>[l(t(we),{value:"0"},{default:v(()=>[l(t(Te),{class:"drag-handle"},{default:v(()=>[g("div",Ke,[a[4]||(a[4]=g("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),g("p",null,E(t(xe)(n.date)),1)])]),_:2},1024),l(t(ye),null,{default:v(()=>[g("div",Me,[l(he,{name:`executeLog-date-${h}`,label:"Datum",modelValue:n.date,"onUpdate:modelValue":V=>n.date=V,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),l(B,{name:`executeLog-executor-${h}`,label:"Uitvoerder",modelValue:n.executorId,"onUpdate:modelValue":V=>n.executorId=V,options:u.value},null,8,["name","modelValue","onUpdate:modelValue","options"]),l(C,{variant:"danger",outlined:"",label:"Delete",onClick:V=>o.executeLog.splice(h,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),l(C,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:_})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),Be={class:"text-xl mt-10 mb-3 font-bold"},Pe={class:"flex justify-end"},We={class:"text-xl mt-10 mb-3 font-bold"},qe={class:"flex justify-end"},Je={class:"flex gap-3 place-self-end"},Ze=q({__name:"Tasks",setup(b){const e=M(),s=K(),{isFetchLoading:w,isMutationLoading:m}=z(e),p=Se(je),{sortedTasks:y,shortTermTasks:o,getProjectedReExecuteDate:r}=Fe(),u=p.greaterOrEqual("md"),d=D([]),c=D(null),S=D({name:{value:null,matchMode:"startsWith"}}),_=D(!1),f=D(!1);function a(T){const i=r(T);return Ue(i)}function n(T){const i=a(T);return`${i} dag${i!==1?"en":""}`}function h(T){const i=a(T);return{"text-red-400":i===0,"text-orange-300":i>0&&i<=3}}async function V(T){if(!s.firebaseUser){x.error("You must be logged in to do this.");return}const i=T.clone();i.executeLog.push(new L(s.firebaseUser.uid)),await e.updateTask(i)}function Q(T){d.value=[T.data]}function Y(){c.value=null,f.value=!0}function X(T){c.value=T,f.value=!0}function Z(T){c.value=T,_.value=!0}function ee(){c.value=null,f.value=!1}async function te(){c.value&&await e.deleteTask(c.value.id),_.value=!1,c.value=null}return _e(()=>{e.fetchTasks()}),(T,i)=>(J(),Ce(Ve,null,[l(Ie,null,{content:v(()=>[l($e,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"Sander's Klusjestool",description:"Nu zul je nooit meer iets vergeten te doen!","description-props":{class:"text-white mb-5"}},{default:v(()=>[i[5]||(i[5]=g("ol",{class:"ms-3 list-decimal list-inside"},[g("li",null,"Voeg een taak toe"),g("li",null,"Registreer wanneer je iets hebt gedaan"),g("li",null,"Weet automatisch wanneer je volgende taak gepland is!")],-1)),g("h3",Be,"Mijn takenlijst ("+E(t(o).length)+")",1),i[6]||(i[6]=g("p",{class:"mb-3"},"Taken die binnenkort uitgevoerd moeten worden in één overzicht.",-1)),l(t(P),{value:t(o),tableStyle:t(u)?"min-width: 40rem":void 0,loading:t(w),size:t(u)?void 0:"small"},{empty:v(()=>[...i[3]||(i[3]=[F(" Er zijn nog geen taken gevonden. ",-1)])]),default:v(()=>[l(t(j),{field:"name",header:"Naam"}),l(t(j),{header:"Taakje uitvoeren over"},{body:v(({data:k})=>[g("span",{class:Le(h(k))},E(n(k)),3)]),_:1}),l(t(j),null,{body:v(({data:k})=>[g("div",Pe,[l(C,{class:"w-fit",icon:"pi pi-check","icon-only":"",variant:"green",loading:t(m),onClick:A=>V(k)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","tableStyle","loading","size"]),g("h3",We," Alle taken ("+E(t(y).length)+") ",1),l(t(P),{value:t(y),expandedRows:d.value,"onUpdate:expandedRows":i[0]||(i[0]=k=>d.value=k),filters:S.value,"onUpdate:filters":i[1]||(i[1]=k=>S.value=k),tableStyle:t(u)?"min-width: 40rem":void 0,loading:t(w),size:t(u)?void 0:"small",filterDisplay:t(y).length>1?"row":void 0,onRowExpand:Q},{empty:v(()=>[...i[4]||(i[4]=[F(" Er zijn nog geen taken gevonden. ",-1)])]),default:v(()=>[l(t(j),{field:"name",header:"Naam"},{filter:v(({filterModel:k,filterCallback:A})=>[l(G,{name:"nameFilter",modelValue:k.value,"onUpdate:modelValue":ae=>k.value=ae,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:A},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(t(j),{header:"Taakje uitvoeren over"},{body:v(({data:k})=>[F(E(n(k)),1)]),_:1}),l(t(j),null,{filter:v(()=>[g("div",qe,[l(C,{class:"w-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(m),onClick:Y},null,8,["loading"])])]),body:v(({data:k})=>[g("div",Je,[l(C,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:t(m),onClick:A=>X(k)},null,8,["loading","onClick"]),l(C,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:t(m),onClick:A=>Z(k)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","tableStyle","loading","size","filterDisplay"]),l(C,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(m),onClick:Y},null,8,["loading"])]),_:1})]),_:1}),l(Ye,{"is-open":f.value,"selected-task":c.value,onClose:ee},null,8,["is-open","selected-task"]),l(H,{title:"Taak verwijderen","is-open":_.value,description:[c.value?`Weet je zeker dat je het taakje '${c.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":t(m),onConfirm:te,onCancel:i[2]||(i[2]=k=>_.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{Ze as default};
