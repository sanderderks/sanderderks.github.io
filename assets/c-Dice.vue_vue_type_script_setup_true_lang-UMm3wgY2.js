import{aW as Pe,bl as Ve,c as Ye,aX as Be,aR as Ue,s as D,bm as ze,bn as K,aS as G,w as _,aQ as m,a9 as Ze,f,o as We,L as x,b0 as Me,b1 as Xe,aY as b,b2 as je,a$ as ee,aq as qe,aZ as ye,d as S,g as N,j as p,q as n,l as Qe,aT as Je,h as P,z as Ke}from"../bundle.js";import{_ as el}from"./c-Dice6.vue_vue_type_script_setup_true_lang-CbzU1YFL.js";var ll=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.HAS_STARTED=2]="HAS_STARTED",l[l.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",l[l.HAS_FINISHED=5]="HAS_FINISHED",l))(ll||{}),tl=(l=>(l[l.ONES=0]="ONES",l[l.TWOS=1]="TWOS",l[l.THREES=2]="THREES",l[l.FOURS=3]="FOURS",l[l.FIVES=4]="FIVES",l[l.SIXES=5]="SIXES",l[l.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",l[l.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",l[l.FULL_HOUSE=8]="FULL_HOUSE",l[l.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",l[l.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",l[l.YAHTZEE=11]="YAHTZEE",l[l.CHANCE=12]="CHANCE",l))(tl||{}),oe=(l=>(l[l.PLAYER=0]="PLAYER",l[l.OPPONENT=1]="OPPONENT",l))(oe||{});const le=()=>({0:[],1:[]}),ol=Pe("yahtzeeStore",()=>{const l=Ve(),s=Ye(),r=Be(),C=Ue(),{personalBest:L,highscorePosition:g}=D(r),{firebaseUser:O}=D(s),{onlineGames:V,onlineGamesLoading:se,onlineGameId:ie,onlineGameCreatorId:ne,onlineGameOpponentId:Y,onlineGameOpponentActive:ae,onlineGameChat:re,isInitializingOnlineGame:B,isOnlineGameOwner:U,onlineGameOpponentName:ce}=D(C),{$init:z,$reset:ue,fetchOnlineGames:fe,createOnlineGame:ve,continueOnlineGame:he,updateOnlineGame:_e,leaveOnlineGame:de,deleteOnlineGame:me}=C,{setPreviousHighscores:Z,updateHighscores:pe,sortHighscores:ge}=r,Oe={onlineGames:ze(l,K.GAME_DATA,G.YAHTZEE,K.ONLINE_GAMES)},d=_(m.SOLO),c=_(0),H=_(!1),v=_(0),E=_(null),$=_(null),A=_(0),W=_(0),h=_(-1),a=_(te()),u=Ze(le()),I=f(()=>a.value.some(e=>e.isRolling)),Ee=f(()=>h.value===-1&&!a.value.every(e=>e.selected)),Ae=f(()=>h.value>=0&&h.value<2&&!a.value.every(e=>e.selected)),Te=f(()=>e=>a.value.filter(t=>t.value===e).length),Se=f(()=>Q(3)),Ne=f(()=>Q(4)),He=f(()=>F(2)&&F(3)?T[8].trueValue??!1:!1),Ie=f(()=>J(4)?T[9].trueValue??!1:!1),Ce=f(()=>J(5)?T[10].trueValue??!1:!1),M=f(()=>F(5)?T[11].trueValue??!1:!1),Ge=f(()=>{let e=0;return a.value.forEach(t=>{e+=t.value}),e}),w=f(()=>(e,t=0)=>{let o=0;return u[t].filter(i=>T[i.row].section===e).forEach(i=>{i.value!==!1&&(o+=i.value)}),o});We(()=>{r.$init(G.YAHTZEE)}),x(u,e=>{e[0].length===13&&(d.value===m.SOLO||e[1].length===13)&&(c.value=5)},{deep:!0}),x(c,e=>{if(e===5){const t=o=>{let i=w.value("top",o);i>=63&&(o===0?A.value+=35:W.value+=35),i+=w.value("bottom",o),i+=A.value,o===0?E.value=i:$.value=i};t(0),d.value===m.ONLINE?(t(1),(E.value??0)>($.value??0)&&R()):R(),b(ye)}}),x([c,v,I],()=>{d.value===m.ONLINE&&(console.log("CHANGE IN LOCAL DATA DETECTED",c.value,v.value,I.value),X())},{deep:!0});const k=()=>{ue(),d.value=m.SOLO,c.value=0,H.value=!1,v.value=0,E.value=null,A.value=0,h.value=-1,a.value=te(),Object.assign(u,le()),Z()},be=e=>{O.value&&(d.value=m.ONLINE,c.value=2,z(G.YAHTZEE,q,j,k),ve(e))},De=e=>{d.value=m.ONLINE,z(G.YAHTZEE,q,j,k),he(e)},X=()=>{console.log("updateOnlineGameCustom.1"),!(!O.value||!Y.value||v.value===1&&!H.value&&!B.value)&&(console.log("updateOnlineGameCustom.2"),_e())},j=(e,t)=>({gameStatus:c.value,activePlayer:v.value===0?e:t,dices:a.value,score:{[e]:u[0],[t]:u[1]}}),q=e=>{var o;console.log("updateLocalGameState.1");const t=(o=O.value)==null?void 0:o.uid;!t||v.value===0&&!B.value||(console.log("updateLocalGameState.2"),c.value=e.gameStatus,v.value=e.activePlayer===t?0:1,a.value=e.dices,U.value?(u[0]=e.score[e.creatorId],u[1]=e.score[e.opponentId]):(u[0]=e.score[e.opponentId],u[1]=e.score[e.creatorId]))},y=async()=>{for(;I.value;)await new Promise(e=>setTimeout(e,r.diceRollSpeed*1e3));return!0},Q=e=>{for(let t=1;t<=6;t++)if(a.value.filter(o=>o.value===t).length>=e){let o=0;return a.value.forEach(i=>{o+=i.value}),o}return!1},F=e=>{for(let t=1;t<=6;t++)if(a.value.filter(o=>o.value===t).length===e)return!0;return!1},J=e=>{let t=0,o=e;do{e:for(let i=o-e+1;i<=o;i++)if(a.value.some(xe=>xe.value===i))t++;else break e;if(t===e)return!0;t=0,o++}while(o<=6);return!1},Le=()=>{c.value=2},$e=async()=>{const e=r.diceRollSpeed*1e3;h.value++,a.value.forEach(t=>{t.selected||(t.isRolling=!0,setTimeout(()=>{t.value=Me(6),t.isRolling=!1,h.value===2&&(t.selected=!0),a.value.sort((o,i)=>o.value-i.value)},Xe(e,e/3)))}),await y(),c.value=3,b(je)},we=(e,t=0)=>u[t].find(o=>o.row===e),ke=(e,t)=>{let o=t;if(o===!1)return!1;const i=T[e];return i.multiplier?o*=i.multiplier:i.trueValue&&(o=i.trueValue),o},Fe=e=>{v.value===0&&h.value>=0&&h.value<2&&(e.selected=!e.selected,b(ee))},Re=(e,t)=>{if(!I.value){if(t!==!1&&M.value){const o=u[0].find(i=>i.row===11);o&&o.value!==!1&&(A.value+=100)}u[0].push({row:e,value:t}),h.value=-1,a.value.forEach(o=>{o.selected=!1}),b(ee),d.value===m.ONLINE&&(H.value=!0,c.value=4,setTimeout(async()=>{c.value=2,v.value=1,await qe(),H.value=!1},r.diceRollSpeed*1e3))}},R=()=>{E.value&&pe({score:E.value,bonus:A.value})};return{collections:Oe,onlineGames:V,onlineGamesLoading:se,onlineGameId:ie,onlineGameCreatorId:ne,onlineGameOpponentId:Y,onlineGameOpponentActive:ae,onlineGameChat:re,isOnlineGameOwner:U,onlineGameOpponentName:ce,gameType:d,gameStatus:c,gameStatusLoading:H,activePlayer:v,score:u,finalScore:E,finalScoreOpponent:$,bonus:A,bonusOpponent:W,reroll:h,dices:a,isRolling:I,canRoll:Ee,canReroll:Ae,hasOfValue:Te,hasThreeOfAKind:Se,hasFourOfAKind:Ne,hasFullHouse:He,hasSmallStraight:Ie,hasLargeStraight:Ce,hasYahtzee:M,diceTotal:Ge,scoreTotalOf:w,personalBest:L,highscorePosition:g,$reset:k,start:Le,roll:$e,hasFinishedRolling:y,getScore:we,getActualValue:ke,selectDice:Fe,selectScore:Re,setPreviousHighscores:Z,updateYahtzeeHighscore:R,sortHighscores:ge,fetchOnlineGames:fe,createOnlineGame:be,continueOnlineGame:De,updateOnlineGame:X,leaveOnlineGame:de,deleteOnlineGame:me}},{persist:{enabled:!0}}),te=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],T={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},sl={width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},il=["fill"],nl=["fill"],al=S({__name:"Dice1",props:{color:{},backgroundColor:{}},setup(l){return(s,r)=>(p(),N("svg",sl,[n("rect",{width:"100",height:"100",rx:"10",ry:"10",fill:s.backgroundColor,stroke:"#000000","stroke-width":"5"},null,8,il),n("circle",{cx:"50",cy:"50",r:"10",fill:s.color},null,8,nl)]))}}),rl={width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},cl=["fill"],ul=["fill"],fl=["fill"],vl=S({__name:"Dice2",props:{color:{},backgroundColor:{}},setup(l){return(s,r)=>(p(),N("svg",rl,[n("rect",{width:"100",height:"100",rx:"10",ry:"10",fill:s.backgroundColor,stroke:"#000000","stroke-width":"5"},null,8,cl),n("circle",{cx:"25",cy:"25",r:"10",fill:s.color},null,8,ul),n("circle",{cx:"75",cy:"75",r:"10",fill:s.color},null,8,fl)]))}}),hl={width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},_l=["fill"],dl=["fill"],ml=["fill"],pl=["fill"],gl=S({__name:"Dice3",props:{color:{},backgroundColor:{}},setup(l){return(s,r)=>(p(),N("svg",hl,[n("rect",{width:"100",height:"100",rx:"10",ry:"10",fill:s.backgroundColor,stroke:"#000000","stroke-width":"5"},null,8,_l),n("circle",{cx:"25",cy:"25",r:"10",fill:s.color},null,8,dl),n("circle",{cx:"50",cy:"50",r:"10",fill:s.color},null,8,ml),n("circle",{cx:"75",cy:"75",r:"10",fill:s.color},null,8,pl)]))}}),Ol={width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},El=["fill"],Al=["fill"],Tl=["fill"],Sl=["fill"],Nl=["fill"],Hl=S({__name:"Dice4",props:{color:{},backgroundColor:{}},setup(l){return(s,r)=>(p(),N("svg",Ol,[n("rect",{width:"100",height:"100",rx:"10",ry:"10",fill:s.backgroundColor,stroke:"#000000","stroke-width":"5"},null,8,El),n("circle",{cx:"25",cy:"25",r:"10",fill:s.color},null,8,Al),n("circle",{cx:"25",cy:"75",r:"10",fill:s.color},null,8,Tl),n("circle",{cx:"75",cy:"25",r:"10",fill:s.color},null,8,Sl),n("circle",{cx:"75",cy:"75",r:"10",fill:s.color},null,8,Nl)]))}}),Il={width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},Cl=["fill"],Gl=["fill"],bl=["fill"],Dl=["fill"],Ll=["fill"],$l=["fill"],wl=S({__name:"Dice5",props:{color:{},backgroundColor:{}},setup(l){return(s,r)=>(p(),N("svg",Il,[n("rect",{width:"100",height:"100",rx:"10",ry:"10",fill:s.backgroundColor,stroke:"#000000","stroke-width":"5"},null,8,Cl),n("circle",{cx:"25",cy:"25",r:"10",fill:s.color},null,8,Gl),n("circle",{cx:"25",cy:"75",r:"10",fill:s.color},null,8,bl),n("circle",{cx:"50",cy:"50",r:"10",fill:s.color},null,8,Dl),n("circle",{cx:"75",cy:"25",r:"10",fill:s.color},null,8,Ll),n("circle",{cx:"75",cy:"75",r:"10",fill:s.color},null,8,$l)]))}}),Rl=S({__name:"Dice",props:{dice:{}},setup(l){const s=ol(),{activePlayer:r}=D(s),{selectDice:C}=s,L={1:al,2:vl,3:gl,4:Hl,5:wl,6:el};return(g,O)=>(p(),N("div",{class:Ke(["cursor-pointer",{"animate-spin":g.dice.isRolling}])},[(p(),Qe(Je(L[g.dice.value]),{color:"black",backgroundColor:g.dice.selected?P(r)===P(oe).PLAYER?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:O[0]||(O[0]=V=>P(C)(g.dice))},null,8,["backgroundColor"]))],2))}});export{ll as G,oe as P,tl as S,Rl as _,T as s,ol as u};
