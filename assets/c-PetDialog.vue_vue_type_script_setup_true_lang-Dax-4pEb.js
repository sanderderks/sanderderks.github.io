import{d as te,b as w,c as me,h as l,a6 as f,D as V,f as o,y as S,e as v,i as le,z as n,C as D,q as ve,T as ge,s as ee,v as fe,U as pe,g as U,w as i,a7 as ae,a8 as F,a9 as O,k as B,t as $,aa as k,ab as C,a1 as ce,a2 as we,J as I,a3 as Ve,Y as De,ac as re,ad as be,$ as ye,K as xe,ae as Ue,af as Fe,M as Oe}from"../bundle.js";import{_ as ke}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{u as Ce}from"./c-useUsers-DiKbhbPK.js";const Se={class:"flex flex-col gap-3 md:px-5"},Pe={class:"mt-3 flex justify-evenly font-bold"},Le=te({__name:"PetLogDialogSection",props:{id:{},log:{}},emits:["error","delete"],setup(u,{expose:P,emit:m}){const b=m,y=n(),g=n(),p=n(),c=n(),L=D(()=>[p.value,c.value].some(e=>!!e));return P({test:async()=>{await Promise.all([y.value?.test(),g.value?.test()]),b("error",L.value)}}),(e,s)=>(w(),me("div",Se,[l(f,{ref_key:"dateField",ref:y,id:u.id,name:"logDate",label:"Date",modelValue:u.log.date,"onUpdate:modelValue":s[0]||(s[0]=d=>u.log.date=d),error:p.value,"onUpdate:error":s[1]||(s[1]=d=>p.value=d),"without-time":""},null,8,["id","modelValue","error"]),l(V,{ref_key:"weightField",ref:g,id:u.id,name:"logWeight",label:"Weight (kg)","model-value":`${u.log.weight}`,"onUpdate:modelValue":s[2]||(s[2]=d=>u.log.weight=Number(d)),error:c.value,"onUpdate:error":s[3]||(s[3]=d=>c.value=d),rules:[o(S).Required,o(S).Numeric],"min-value":0,"input-props":{type:"number"}},null,8,["id","model-value","error","rules"]),v("div",Pe,[l(le,{class:"w-full sm:w-2/3 md:w-1/2 xl:w-2/3",variant:"danger",outlined:"",label:"Delete",onClick:s[4]||(s[4]=d=>e.$emit("delete"))})])]))}}),he={class:"pt-6 mb-4 xl:px-16 flex flex-col gap-3"},Be={class:"flex gap-5"},$e={class:"flex justify-center"},Ie={class:"basis-full lg:basis-1/2"},We=te({__name:"PetDialog",props:{isOpen:{type:Boolean},originalPet:{}},emits:["close"],setup(u,{emit:P}){const m=u,b=P,y=ve(),g=ge(),{isMutationLoading:p}=ee(g),{firebaseUser:c}=ee(y),{mappedUsers:L}=Ce(),h=t=>({name:{value:t?.name??"",error:""},description:{value:t?.description??"",error:""},coOwnerId:{value:t?.coOwnerId??"",error:""},avatar:{value:t?.avatar??"",error:""},dateOfBirth:{value:t?.dateOfBirth?new Date(t.dateOfBirth):null,error:""},type:{value:t?.type??"cat",error:""},breed:{value:t?.breed??"",error:""},breedSize:{value:t?.breedSize??"medium",error:""},gender:{value:t?.gender??"male",error:""},weight:{value:t?.weight?t.weight.toString():"",error:""},insideCat:{value:t?.insideCat??!1,error:""},castrated:{value:t?.castrated??!1,error:""},dewormingDate:{value:t?.dewormingDate?new Date(t.dewormingDate):null,error:""},vetDate:{value:t?.vetDate?new Date(t.vetDate):null,error:""},lastVaccinationDate:{value:t?.lastVaccinationDate?new Date(t.lastVaccinationDate):null,error:""},nextVaccinationDate:{value:t?.nextVaccinationDate?new Date(t.nextVaccinationDate):null,error:""},weightLog:{value:t?.weightLog?t.weightLog.map(a=>({...a,date:new Date(a.date)})):[],error:{}}}),e=fe(h(m.originalPet)),s=D(()=>m.originalPet?.userId??c.value?.uid??""),d=D(()=>new Ue({id:m.originalPet?.id,userId:s.value,coOwnerId:e.coOwnerId.value,name:e.name.value,description:e.description.value,avatar:e.avatar.value,dateOfBirth:e.dateOfBirth.value,type:e.type.value,breed:e.breed.value,breedSize:e.breedSize.value,gender:e.gender.value,weight:isNaN(+e.weight.value)?null:+e.weight.value,insideCat:e.type.value==="cat"?e.insideCat.value:null,castrated:e.castrated.value,dewormingDate:e.dewormingDate.value,vetDate:e.vetDate.value,lastVaccinationDate:e.lastVaccinationDate.value,nextVaccinationDate:e.nextVaccinationDate.value,weightLog:e.weightLog.value.map(t=>new Fe(t.date,t.weight))})),z=n(),N=n(),E=n(),W=n(),j=n(),M=n(),R=n(),T=n(),q=n(),K=n(),A=n(),G=n(),H=n(),J=n(),Y=n(),Q=n([]),X=D(()=>!Oe(m.originalPet,d.value)),Z=D(()=>{if(e.name.value)return e.name.value;switch(e.type.value){case"cat":return"Cat";case"dog":return"Dog";default:return"Pet"}}),oe=async()=>{await Promise.all([z.value.test(),N.value.test(),E.value.test(),W.value.test(),j.value.test(),M.value.test(),R.value?.test(),T.value.test(),q.value?.test(),K.value?.test(),A.value.test(),G.value.test(),J.value.test(),Y.value.test(),H.value.test()]);for(const t of Q.value)await t?.test();e.name.error||e.description.error||e.coOwnerId.error||e.avatar.error||e.dateOfBirth.error||e.type.error||e.breed.error||e.breedSize.error||e.gender.error||e.weight.error||e.insideCat.error||e.castrated.error||e.dewormingDate.error||e.vetDate.error||e.lastVaccinationDate.error||e.nextVaccinationDate.error||Object.values(e.weightLog.error).some(t=>!!t)||(m.originalPet?await g.updatePet(d.value):await g.createPet(d.value),b("close"))},ne=()=>{e.weightLog.value.push({date:new Date,weight:0})},_=t=>e.weightLog.value.findIndex(a=>a.date.toString()===t),ie=t=>{e.weightLog.value.splice(_(t),1)},de=(t,a)=>{e.weightLog.error[_(a)]=t},se=()=>{b("close")};return pe(()=>[m.isOpen,m.originalPet],()=>{Object.assign(e,h(m.originalPet))}),(t,a)=>(w(),U(ke,{isOpen:u.isOpen,title:u.originalPet?"Update Pet":"Create Pet",description:"Keep in mind that pet data is visible to all authenticated users.","confirm-text":u.originalPet?X.value?"Update":"Nothing changed":"Create","confirm-loading":o(p),"confirm-props":{disabled:!X.value},onConfirm:oe,onCancel:se},{default:i(()=>[v("form",he,[l(V,{ref_key:"nameField",ref:z,id:"name",name:"name",label:"Name",placeholder:"Mogu",modelValue:e.name.value,"onUpdate:modelValue":a[0]||(a[0]=r=>e.name.value=r),error:e.name.error,"onUpdate:error":a[1]||(a[1]=r=>e.name.error=r),rules:[o(S).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),l(V,{ref_key:"descriptionField",ref:N,id:"description",name:"description",label:"Description",placeholder:"My cute pet.",modelValue:e.description.value,"onUpdate:modelValue":a[2]||(a[2]=r=>e.description.value=r),error:e.description.error,"onUpdate:error":a[3]||(a[3]=r=>e.description.error=r),"max-length":100},null,8,["modelValue","error"]),l(o(ae),null,{default:i(()=>[l(o(F),{value:"details"},{default:i(()=>[l(o(O),null,{default:i(()=>[B($(Z.value)+"'s Details ",1)]),_:1}),l(o(k),{"pt:content":"flex flex-col gap-3"},{default:i(()=>[l(C,{name:"coOwnerId",label:"Co-owner",modelValue:e.coOwnerId.value,"onUpdate:modelValue":a[4]||(a[4]=r=>e.coOwnerId.value=r),error:e.coOwnerId.error,"onUpdate:error":a[5]||(a[5]=r=>e.coOwnerId.error=r),options:[{value:"",label:"No co-owner"},...o(L).filter(r=>r.value!==d.value.userId)]},null,8,["modelValue","error","options"]),l(f,{ref_key:"dateOfBirthField",ref:W,name:"dateOfBirth",label:"Date of birth",modelValue:e.dateOfBirth.value,"onUpdate:modelValue":a[6]||(a[6]=r=>e.dateOfBirth.value=r),error:e.dateOfBirth.error,"onUpdate:error":a[7]||(a[7]=r=>e.dateOfBirth.error=r),"without-time":""},null,8,["modelValue","error"]),l(C,{ref_key:"typeField",ref:j,name:"type",label:"Type",modelValue:e.type.value,"onUpdate:modelValue":a[8]||(a[8]=r=>e.type.value=r),error:e.type.error,"onUpdate:error":a[9]||(a[9]=r=>e.type.error=r),options:o(ce)},null,8,["modelValue","error","options"]),l(V,{ref_key:"breedField",ref:M,id:"breed",name:"breed",label:"Breed",placeholder:e.type.value==="dog"?"Golden Retriever":"Maine Coone",modelValue:e.breed.value,"onUpdate:modelValue":a[10]||(a[10]=r=>e.breed.value=r),error:e.breed.error,"onUpdate:error":a[11]||(a[11]=r=>e.breed.error=r),"min-length":3,"max-length":50},null,8,["placeholder","modelValue","error"]),e.type.value==="dog"?(w(),U(C,{key:0,ref_key:"breedSizeField",ref:R,name:"breedSize",label:"Breed Size",modelValue:e.breedSize.value,"onUpdate:modelValue":a[12]||(a[12]=r=>e.breedSize.value=r),error:e.breedSize.error,"onUpdate:error":a[13]||(a[13]=r=>e.breedSize.error=r),options:o(we)},null,8,["modelValue","error","options"])):I("",!0),l(C,{ref_key:"genderField",ref:T,name:"gender",label:"Gender",modelValue:e.gender.value,"onUpdate:modelValue":a[14]||(a[14]=r=>e.gender.value=r),error:e.gender.error,"onUpdate:error":a[15]||(a[15]=r=>e.gender.error=r),options:o(Ve)},null,8,["modelValue","error","options"])]),_:1})]),_:1}),l(o(F),{value:"health"},{default:i(()=>[l(o(O),null,{default:i(()=>[B($(Z.value)+"'s Health ",1)]),_:1}),l(o(k),{"pt:content":"flex flex-col gap-3"},{default:i(()=>[e.weightLog.value.length?I("",!0):(w(),U(V,De({key:0,ref_key:"weightField",ref:q,name:"weight",label:"Weight (kg)",modelValue:e.weight.value,"onUpdate:modelValue":a[16]||(a[16]=r=>e.weight.value=r),error:e.weight.error,"onUpdate:error":a[17]||(a[17]=r=>e.weight.error=r)},e.weight.value?{rules:[o(S).Numeric],minValue:0}:void 0,{"input-props":{type:"number"}}),null,16,["modelValue","error"])),e.type.value==="cat"?(w(),U(re,{key:1,ref_key:"insideCatField",ref:K,name:"insideCat",label:"Inside Cat",modelValue:e.insideCat.value,"onUpdate:modelValue":a[18]||(a[18]=r=>e.insideCat.value=r)},null,8,["modelValue"])):I("",!0),l(re,{ref_key:"castratedField",ref:A,name:"castrated",label:"Castrated or Sterilized",modelValue:e.castrated.value,"onUpdate:modelValue":a[19]||(a[19]=r=>e.castrated.value=r)},null,8,["modelValue"]),l(f,{ref_key:"vetDateField",ref:H,name:"vetDate",label:"Last vet visit",modelValue:e.vetDate.value,"onUpdate:modelValue":a[20]||(a[20]=r=>e.vetDate.value=r),error:e.vetDate.error,"onUpdate:error":a[21]||(a[21]=r=>e.vetDate.error=r),"without-time":""},null,8,["modelValue","error"]),l(f,{ref_key:"lastVaccinationDateField",ref:J,name:"lastVaccinationDate",label:"Last vaccination",modelValue:e.lastVaccinationDate.value,"onUpdate:modelValue":a[22]||(a[22]=r=>e.lastVaccinationDate.value=r),error:e.lastVaccinationDate.error,"onUpdate:error":a[23]||(a[23]=r=>e.lastVaccinationDate.error=r),"without-time":""},null,8,["modelValue","error"]),l(f,{ref_key:"nextVaccinationDateField",ref:Y,name:"nextVaccinationDate",label:"Next vaccination",modelValue:e.nextVaccinationDate.value,"onUpdate:modelValue":a[24]||(a[24]=r=>e.nextVaccinationDate.value=r),error:e.nextVaccinationDate.error,"onUpdate:error":a[25]||(a[25]=r=>e.nextVaccinationDate.error=r),"without-time":""},null,8,["modelValue","error"]),l(f,{ref_key:"dewormingDateField",ref:G,name:"dewormingDate",label:"Last deworming date",modelValue:e.dewormingDate.value,"onUpdate:modelValue":a[26]||(a[26]=r=>e.dewormingDate.value=r),error:e.dewormingDate.error,"onUpdate:error":a[27]||(a[27]=r=>e.dewormingDate.error=r),"without-time":""},null,8,["modelValue","error"])]),_:1})]),_:1}),l(o(F),{value:"Weight Log"},{default:i(()=>[l(o(O),null,{default:i(()=>[...a[31]||(a[31]=[B(" Weight Log ",-1)])]),_:1}),l(o(k),{"pt:content":"flex flex-col gap-3"},{default:i(()=>[l(o(be),{ref:"draggable",class:"flex flex-col gap-3",modelValue:e.weightLog.value,"onUpdate:modelValue":a[28]||(a[28]=r=>e.weightLog.value=r),itemKey:r=>r.date.toString(),handle:".drag-handle"},{item:i(({element:r,index:ue})=>[l(o(ae),null,{default:i(()=>[l(o(F),{value:"0"},{default:i(()=>[l(o(O),{class:"drag-handle"},{default:i(()=>[v("div",Be,[a[32]||(a[32]=v("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),v("p",null,$(o(ye)(r.date)),1)])]),_:2},1024),l(o(k),null,{default:i(()=>[l(Le,{ref:x=>{Q.value[ue]=x},id:r.date.toString(),log:r,onDelete:x=>ie(r.date.toString()),onError:x=>de(x,r.date.toString())},null,8,["id","log","onDelete","onError"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),v("div",$e,[l(le,{class:"w-1/2",variant:"green",label:"Add Log",onClick:ne})])]),_:1})]),_:1})]),_:1}),v("div",Ie,[l(xe,{ref_key:"avatarField",ref:E,id:"avatar",name:"avatar",label:"Avatar",modelValue:e.avatar.value,"onUpdate:modelValue":a[29]||(a[29]=r=>e.avatar.value=r),error:e.avatar.error,"onUpdate:error":a[30]||(a[30]=r=>e.avatar.error=r),"is-public":"","blog-post":null,"image-props":{class:"rounded-full"},"image-container-props":{class:"!h-64 !w-64"}},null,8,["modelValue","error"])])])]),_:1},8,["isOpen","title","confirm-text","confirm-loading","confirm-props"]))}});export{We as _};
