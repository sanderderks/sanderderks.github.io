import{aW as Re,a_ as Ve,c as $e,aX as ke,aQ as Ye,s as D,a$ as Ue,b0 as K,aS as b,w as g,aR as _,a9 as Y,f as m,o as je,L as N,b3 as We,b4 as ze,aY as C,b5 as Ze,b9 as ee,aq as Me,aZ as Be,d as Xe,g as xe,j as le,l as ye,aT as qe,h as U,z as Qe}from"../bundle.js";import{_ as Je,a as we,b as Ke,c as el,d as ll}from"./c-Dice5.vue_vue_type_script_setup_true_lang-DK-8hWiG.js";import{_ as al}from"./c-Dice6.vue_vue_type_script_setup_true_lang-CbzU1YFL.js";var tl=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.WAITING_FOR_OPPONENTS=2]="WAITING_FOR_OPPONENTS",l[l.HAS_STARTED=3]="HAS_STARTED",l[l.HAS_THROWN_DICES=4]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=5]="HAS_CHOSEN_DICES",l[l.HAS_FINISHED=6]="HAS_FINISHED",l))(tl||{}),sl=(l=>(l[l.ONES=0]="ONES",l[l.TWOS=1]="TWOS",l[l.THREES=2]="THREES",l[l.FOURS=3]="FOURS",l[l.FIVES=4]="FIVES",l[l.SIXES=5]="SIXES",l[l.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",l[l.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",l[l.FULL_HOUSE=8]="FULL_HOUSE",l[l.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",l[l.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",l[l.YAHTZEE=11]="YAHTZEE",l[l.CHANCE=12]="CHANCE",l))(sl||{});const nl=Re("yahtzeeStore",()=>{const l=Ve(),S=$e(),E=ke(),h=Ye(),{personalBest:L,highscorePosition:F}=D(E),{firebaseUser:c}=D(S),{onlineGames:H,onlineGamesLoading:j,onlineGameId:W,onlineGameCreatorId:te,onlineGamePlayers:G,onlineGameOpponents:z,partyName:se,maxPlayers:P,onlineGameChat:ne,isInitializingOnlineGame:Z,isOnlineGameOwner:ue}=D(h),{fetchOnlineGames:ie,createOnlineGame:oe,continueOnlineGame:re,updateOnlineGame:ce,leaveOnlineGame:ve,deleteOnlineGame:fe,getPlayerDisplayName:me,getNextPlayerId:M}=h,{setPreviousHighscores:B,updateHighscores:Oe,sortHighscores:Ee}=E,de={onlineGames:Ue(l,K.GAME_DATA,b.YAHTZEE,K.ONLINE_GAMES)},d=g(_.SOLO),o=g(0),A=g(!1),s=g("soloPlayer"),v=g(s.value),i=g(ae()),f=g(-1),r=Y({}),O=Y({}),u=Y({}),p=m(()=>i.value.some(e=>e.isRolling)),_e=m(()=>f.value===-1&&!i.value.every(e=>e.selected)),he=m(()=>f.value>=0&&f.value<2&&!i.value.every(e=>e.selected)),ge=m(()=>e=>i.value.filter(a=>a.value===e).length),Ie=m(()=>J(3)),Te=m(()=>J(4)),Ae=m(()=>$(2)&&$(3)?T[8].trueValue??!1:!1),pe=m(()=>w(4)?T[9].trueValue??!1:!1),Ne=m(()=>w(5)?T[10].trueValue??!1:!1),X=m(()=>$(5)?T[11].trueValue??!1:!1),Se=m(()=>{let e=0;return i.value.forEach(a=>{e+=a.value}),e}),R=m(()=>(e,a="soloPlayer")=>{var n;let t=0;return(n=r[a])==null||n.filter(I=>T[I.row].section===e).forEach(I=>{I.value!==!1&&(t+=I.value)}),t});je(()=>{E.$init(b.YAHTZEE)}),N(r,e=>{Object.keys(u).length&&Object.keys(u).every(a=>e[a].length===13)&&(o.value=6)},{deep:!0}),N(o,e=>{if(e===6){let a=R.value("top",s.value);a>=63&&(O[s.value]+=35),a+=R.value("bottom",s.value),a+=O[s.value],u[s.value]=a,d.value===_.SOLO&&k(),C(Be)}}),N(()=>u,()=>{console.log("FINAL SCORE CHANGED",u),d.value===_.ONLINE&&G.value.every(e=>!!u[e.userId])&&z.value.every(e=>u[s.value]>=u[e.userId])&&k()},{deep:!0}),N([o,v,p],()=>{d.value===_.ONLINE&&(console.log("CHANGE IN LOCAL DATA DETECTED",o.value,v.value,p.value),x())},{deep:!0}),N(G,()=>{o.value===2&&P.value&&G.value.length===P.value&&(o.value=3)});const V=()=>{h.$reset(),d.value=_.SOLO,o.value=0,A.value=!1,s.value="soloPlayer",v.value=s.value,f.value=-1,i.value=ae(),Object.keys(r).forEach(e=>{delete r[e],delete O[e],delete u[e]}),B()},He=(e,a=null,t=null)=>{c.value&&(e=[{userId:c.value.uid,isOnline:!0},...e],d.value=_.ONLINE,o.value=t?2:3,s.value=c.value.uid,v.value=s.value,e.forEach(n=>{r[n.userId]=[],O[n.userId]=0,u[n.userId]=0}),h.$init(b.YAHTZEE,q,y,V),oe(e,a,t))},Ge=e=>{c.value&&(d.value=_.ONLINE,s.value=c.value.uid,h.$init(b.YAHTZEE,q,y,V),re(e))},x=()=>{console.log("updateOnlineGameCustom.1"),!(!c.value||v.value!==s.value&&!A.value&&!Z.value)&&(console.log("updateOnlineGameCustom.2"),ce())},y=()=>({gameStatus:o.value,activePlayerId:v.value,dices:i.value,reroll:f.value,score:r,bonus:O,finalScore:u}),q=e=>{var t;console.log("updateLocalGameState.1");const a=(t=c.value)==null?void 0:t.uid;!a||v.value===s.value&&!Z.value||(console.log("updateLocalGameState.2"),o.value=e.gameStatus,v.value=e.activePlayerId,i.value=e.dices,f.value=e.reroll,Object.assign(r,e.score),Object.assign(O,e.bonus),Object.assign(u,e.finalScore),Object.keys(r).includes(a)||(r[a]=[],O[a]=0,u[a]=0))},Q=async()=>{for(;p.value;)await new Promise(e=>setTimeout(e,E.diceRollSpeed*1e3));return!0},J=e=>{for(let a=1;a<=6;a++)if(i.value.filter(t=>t.value===a).length>=e){let t=0;return i.value.forEach(n=>{t+=n.value}),t}return!1},$=e=>{for(let a=1;a<=6;a++)if(i.value.filter(t=>t.value===a).length===e)return!0;return!1},w=e=>{let a=0,t=e;do{e:for(let n=t-e+1;n<=t;n++)if(i.value.some(I=>I.value===n))a++;else break e;if(a===e)return!0;a=0,t++}while(t<=6);return!1},be=()=>{o.value=3,r[s.value]=[],O[s.value]=0,u[s.value]=0},Ce=async()=>{const e=E.diceRollSpeed*1e3;f.value++,i.value.forEach(a=>{a.selected||(a.isRolling=!0,setTimeout(()=>{a.value=We(6),a.isRolling=!1,f.value===2&&(a.selected=!0),i.value.sort((t,n)=>t.value-n.value)},ze(e,e/3)))}),await Q(),o.value=4,C(Ze)},De=(e,a)=>{var t;return(t=r[a])==null?void 0:t.find(n=>n.row===e)},Le=(e,a)=>{let t=a;if(t===!1)return!1;const n=T[e];return n.multiplier?t*=n.multiplier:n.trueValue&&(t=n.trueValue),t},Fe=e=>{v.value===s.value&&f.value>=0&&f.value<2&&(e.selected=!e.selected,C(ee))},Pe=(e,a)=>{if(!p.value){if(a!==!1&&X.value){const t=r[s.value].find(n=>n.row===11);t&&t.value!==!1&&(O[s.value]+=100)}r[s.value].push({row:e,value:a}),f.value=-1,i.value.forEach(t=>{t.selected=!1}),C(ee),d.value===_.ONLINE&&(A.value=!0,o.value=5,setTimeout(async()=>{o.value=3,v.value=M(v.value),await Me(),A.value=!1},E.diceRollSpeed*1e3))}},k=()=>{c.value&&u[s.value]&&Oe({gameId:W.value??null,score:u[s.value],bonus:O[s.value]})};return{collections:de,onlineGames:H,onlineGamesLoading:j,onlineGameId:W,onlineGameCreatorId:te,onlineGamePlayers:G,onlineGameOpponents:z,partyName:se,maxPlayers:P,onlineGameChat:ne,isOnlineGameOwner:ue,gameType:d,gameStatus:o,gameStatusLoading:A,myPlayerId:s,activePlayerId:v,score:r,finalScore:u,bonus:O,reroll:f,dices:i,isRolling:p,canRoll:_e,canReroll:he,hasOfValue:ge,hasThreeOfAKind:Ie,hasFourOfAKind:Te,hasFullHouse:Ae,hasSmallStraight:pe,hasLargeStraight:Ne,hasYahtzee:X,diceTotal:Se,scoreTotalOf:R,personalBest:L,highscorePosition:F,$reset:V,start:be,roll:Ce,hasFinishedRolling:Q,getScore:De,getActualValue:Le,selectDice:Fe,selectScore:Pe,setPreviousHighscores:B,updateYahtzeeHighscore:k,sortHighscores:Ee,fetchOnlineGames:ie,createOnlineGame:He,continueOnlineGame:Ge,updateOnlineGame:x,leaveOnlineGame:ve,deleteOnlineGame:fe,getPlayerDisplayName:me,getNextPlayerId:M}},{persist:{enabled:!0}}),ae=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],T={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},rl=Xe({__name:"Dice",props:{dice:{}},setup(l){const S=nl(),{activePlayerId:E,myPlayerId:h}=D(S),{selectDice:L}=S,F={1:ll,2:el,3:Ke,4:we,5:Je,6:al};return(c,H)=>(le(),xe("div",{class:Qe(["cursor-pointer",{"animate-spin":c.dice.isRolling}])},[(le(),ye(qe(F[c.dice.value]),{color:"black",backgroundColor:c.dice.selected?U(E)===U(h)?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:H[0]||(H[0]=j=>U(L)(c.dice))},null,8,["backgroundColor"]))],2))}});export{tl as G,sl as S,rl as _,T as s,nl as u};
