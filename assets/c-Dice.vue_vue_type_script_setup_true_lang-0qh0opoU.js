import{m as A,aS as be,aT as Pe,c as Fe,aU as De,aQ as pe,s as V,aV as Ye,aW as le,aR as k,v as T,aP as _,o as we,K as w,a8 as j,aX as Ce,aY as Ge,aZ as U,a_ as Me,b3 as ke,a$ as te,ap as Ue,b0 as Ve,d as $e,g as ae,h as Ke,k as xe,b1 as Ze,f as W,x as je}from"../bundle.js";import{_ as We,a as ze,b as ye,c as Be,d as Xe}from"./c-Dice5.vue_vue_type_script_setup_true_lang-BmKkT8Zs.js";import{_ as Qe}from"./c-Dice6.vue_vue_type_script_setup_true_lang-D7Xgy2HV.js";const qe=e=>{const N=A(()=>b(3)),S=A(()=>b(4)),i=A(()=>H(2)&&H(3)?P[C.FULL_HOUSE].trueValue??!1:!1),F=A(()=>p(4)?P[C.SMALL_STRAIGHT].trueValue??!1:!1),D=A(()=>p(5)?P[C.LARGE_STRAIGHT].trueValue??!1:!1),f=A(()=>H(5)?P[C.YAHTZEE].trueValue??!1:!1),L=A(()=>{let n=0;return e.value.forEach(r=>{n+=r.value}),n}),b=n=>{for(let r=1;r<=6;r++)if(e.value.filter(d=>d.value===r).length>=n){let d=0;return e.value.forEach(I=>{d+=I.value}),d}return!1},H=n=>{for(let r=1;r<=6;r++)if(e.value.filter(d=>d.value===r).length===n)return!0;return!1},p=n=>{let r=0,d=n;do{e:for(let I=d-n+1;I<=d;I++)if(e.value.some(G=>G.value===I))r++;else break e;if(r===n)return!0;r=0,d++}while(d<=6);return!1};return{hasThreeOfAKind:N,hasFourOfAKind:S,hasFullHouse:i,hasSmallStraight:F,hasLargeStraight:D,hasYahtzee:f,diceTotal:L,hasAtLeastOf:b,hasExactOf:H,hasStraight:p}};var Je=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.WAITING_FOR_OPPONENTS=2]="WAITING_FOR_OPPONENTS",e[e.HAS_STARTED=3]="HAS_STARTED",e[e.HAS_THROWN_DICES=4]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=5]="HAS_CHOSEN_DICES",e[e.HAS_FINISHED=6]="HAS_FINISHED",e))(Je||{}),C=(e=>(e[e.ONES=0]="ONES",e[e.TWOS=1]="TWOS",e[e.THREES=2]="THREES",e[e.FOURS=3]="FOURS",e[e.FIVES=4]="FIVES",e[e.SIXES=5]="SIXES",e[e.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",e[e.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",e[e.FULL_HOUSE=8]="FULL_HOUSE",e[e.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",e[e.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",e[e.YAHTZEE=11]="YAHTZEE",e[e.CHANCE=12]="CHANCE",e))(C||{}),el=(e=>(e[e.TOP=35]="TOP",e[e.YAHTZEE=100]="YAHTZEE",e))(el||{});const ll=be("yahtzeeStore",()=>{const e=Pe(),N=Fe(),S=De(),i=pe(),{personalBest:F,highscorePosition:D}=V(S),{firebaseUser:f}=V(N),{games:L,gamesLoading:b,gameId:H,creatorId:p,players:n,opponents:r,partyName:d,maxPlayers:I,isLocked:G,chat:ue,isOwner:$}=V(i),{setPreviousHighscores:z,updateHighscores:oe,sortHighscores:ie}=S,ne={onlineGames:Ye(e,le.GAME_DATA,k.YAHTZEE,le.ONLINE_GAMES)},g=T(_.SOLO),c=T(0),Y=T(!1),s=T("soloPlayer"),O=T(s.value),h=T(se()),E=T(-1),v=j({}),m=j({}),o=j({}),M=A(()=>h.value.some(l=>l.isRolling)),re=A(()=>E.value===-1&&!h.value.every(l=>l.selected)),ce=A(()=>E.value>=0&&E.value<2&&!h.value.every(l=>l.selected)),ve=A(()=>l=>h.value.filter(a=>a.value===l).length),{hasThreeOfAKind:fe,hasFourOfAKind:de,hasFullHouse:he,hasSmallStraight:Ee,hasLargeStraight:me,hasYahtzee:y,diceTotal:Oe}=qe(h);we(()=>{S.$init(k.YAHTZEE)}),w(v,l=>{c.value!==6&&Object.keys(l).length&&Object.keys(l).every(a=>l[a].length===13)&&(g.value===_.SOLO||$.value)&&(c.value=6)}),w(c,l=>{l===6&&(g.value===_.SOLO?(J(s.value),Z()):$.value&&(n.value.forEach(a=>{J(a.userId)}),Le(),Q()),U(Ve))}),w(o,()=>{g.value===_.MULTIPLAYER&&Z()}),w([c,O,M],()=>{g.value===_.MULTIPLAYER&&Q()},{deep:!0}),w(n,()=>{c.value===2&&I.value&&n.value.length===I.value&&(G.value=!0,c.value=3)});const K=()=>{i.$reset(),g.value=_.SOLO,c.value=0,Y.value=!1,s.value="soloPlayer",O.value=s.value,E.value=-1,h.value=se(),Object.keys(v).forEach(l=>{delete v[l],delete m[l],delete o[l]}),z()},Ae=(l,a=null,t=null)=>{f.value&&(l=[{userId:f.value.uid,isOnline:!0},...l],g.value=_.MULTIPLAYER,c.value=t?2:3,s.value=f.value.uid,O.value=s.value,l.forEach(u=>{v[u.userId]=[],m[u.userId]=[],o[u.userId]=null}),i.$init(k.YAHTZEE,B,X,K),i.createGame(l,a,t))},Se=l=>{f.value&&(g.value=_.MULTIPLAYER,s.value=f.value.uid,i.$init(k.YAHTZEE,B,X,K),i.continueGame(l))},B=()=>({gameStatus:c.value,activePlayerId:O.value,dices:h.value,reroll:E.value,score:v,bonusScore:m,finalScore:o}),X=l=>{var t;const a=(t=f.value)==null?void 0:t.uid;!a||O.value===s.value||(c.value=l.gameStatus,O.value=l.activePlayerId,h.value=l.dices,E.value=l.reroll,Object.assign(v,l.score),Object.assign(m,l.bonusScore),Object.assign(o,l.finalScore),Object.keys(v).includes(a)||(v[a]=[],m[a]=[],o[a]=null))},Q=()=>{!f.value||O.value!==s.value&&!Y.value||i.pushState()},q=async()=>{for(;M.value;)await new Promise(l=>setTimeout(l,S.diceRollSpeed*1e3));return!0},ge=()=>{g.value=_.SOLO,c.value=3,v[s.value]=[],m[s.value]=[],o[s.value]=null},_e=async()=>{const l=S.diceRollSpeed*1e3;E.value++,h.value.forEach(a=>{a.selected||(a.isRolling=!0,setTimeout(()=>{a.value=Ce(6),a.isRolling=!1,E.value===2&&(a.selected=!0),h.value.sort((t,u)=>t.value-u.value)},Ge(l,l/3)))}),await q(),c.value=4,U(Me)},Ie=(l,a)=>{var t;return(t=v[a])==null?void 0:t.find(u=>u.row===l)},Re=(l,a)=>ke(m[a].filter(t=>t===l)),x=(l,a="soloPlayer")=>{var u;let t=0;return(u=v[a])==null||u.filter(R=>P[R.row].section===l).forEach(R=>{R.value!==!1&&(t+=R.value)}),t},He=(l,a)=>{let t=a;if(t===!1)return!1;const u=P[l];return u.multiplier?t*=u.multiplier:u.trueValue&&(t=u.trueValue),t},Te=l=>{O.value===s.value&&E.value>=0&&E.value<2&&(l.selected=!l.selected,U(te))},Ne=(l,a)=>{if(!M.value){if(a!==!1&&y.value){const t=v[s.value].find(u=>u.row===11);t&&t.value!==!1&&m[s.value].push(100)}v[s.value].push({row:l,value:a}),x("top",s.value)>=63&&!m[s.value].includes(35)&&m[s.value].push(35),E.value=-1,h.value.forEach(t=>{t.selected=!1}),U(te),g.value===_.MULTIPLAYER&&(Y.value=!0,c.value=5,setTimeout(async()=>{c.value=3,O.value=i.getNextPlayerId(O.value),await Ue(),Y.value=!1},S.diceRollSpeed*1e3))}},J=l=>{const a=x("top",l),t=x("bottom",l),u=m[l].reduce((R,ee)=>ee===35?R+(a>=63?35:0):ee===100?R+100:R,0);o[l]={top:a,bottom:t,bonus:u,total:a+t+u}},Le=()=>{const l=Math.max(...Object.values(o).map(t=>(t==null?void 0:t.total)??0)),a=Object.keys(o).filter(t=>{var u;return((u=o[t])==null?void 0:u.total)===l});n.value.forEach(t=>{a.includes(t.userId)?a.length===1?o[t.userId].winStatus="win":o[t.userId].winStatus="tie":o[t.userId].winStatus="lose"})},Z=()=>{f!=null&&f.value&&o[s.value]&&oe({gameId:H.value??null,score:o[s.value].total,bonus:o[s.value].bonus})};return{collections:ne,games:L,gamesLoading:b,gameId:H,creatorId:p,players:n,opponents:r,partyName:d,maxPlayers:I,isLocked:G,chat:ue,isOwner:$,gameType:g,gameStatus:c,gameStatusLoading:Y,myPlayerId:s,activePlayerId:O,score:v,finalScore:o,bonusScore:m,reroll:E,dices:h,isRolling:M,canRoll:re,canReroll:ce,hasOfValue:ve,hasThreeOfAKind:fe,hasFourOfAKind:de,hasFullHouse:he,hasSmallStraight:Ee,hasLargeStraight:me,hasYahtzee:y,diceTotal:Oe,personalBest:F,highscorePosition:D,$reset:K,start:ge,roll:_e,hasFinishedRolling:q,getScore:Ie,getBonus:Re,getActualValue:He,selectDice:Te,selectScore:Ne,setPreviousHighscores:z,updateYahtzeeHighscore:Z,sortHighscores:ie,fetchOnlineGames:i.fetchGames,createOnlineGame:Ae,continueOnlineGame:Se,leaveOnlineGame:i.leaveGame,deleteOnlineGame:i.deleteGame,getPlayerDisplayName:i.getPlayerDisplayName,getNextPlayerId:i.getNextPlayerId}},{persist:{enabled:!0}}),se=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],P={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},ul=$e({__name:"Dice",props:{dice:{}},setup(e){const N=ll(),{activePlayerId:S,myPlayerId:i}=V(N),{selectDice:F}=N,D={1:Xe,2:Be,3:ye,4:ze,5:We,6:Qe};return(f,L)=>(ae(),Ke("div",{class:je(["cursor-pointer",{"animate-spin":e.dice.isRolling}])},[(ae(),xe(Ze(D[e.dice.value]),{color:"black",backgroundColor:e.dice.selected?W(S)===W(i)?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:L[0]||(L[0]=b=>W(F)(e.dice))},null,8,["backgroundColor"]))],2))}});export{el as B,Je as G,C as S,ul as _,P as s,ll as u};
