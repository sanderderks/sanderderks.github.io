import{d as oe,E as te,q as ue,u as ne,F as ie,G as de,s as V,H as me,g as n,w as j,I as ve,b as t,f as l,_ as pe,e as v,x as fe,h as o,D as U,y as f,J as i,i as w,K as we,c as ce,R as k,j as Pe,C as p,z as d,v as be,P as W,L as G,M as Y,N as Ne}from"../bundle.js";import{_ as ge}from"./c-Dialog.vue_vue_type_script_setup_true_lang-ChRuyxYJ.js";import{_ as ye,a as x,b as Ve}from"./c-PasswordField.vue_vue_type_script_setup_true_lang-UUDeVZRn.js";import{_ as Ue}from"./c-Page.vue_vue_type_script_setup_true_lang-3zQkaq1W.js";const ke={class:"flex flex-col md:flex-row pt-6 pb-8 mb-4 gap-3"},xe={class:"basis-full lg:basis-1/2"},Ee={class:"flex gap-3 mt-10 flex-wrap"},Se={class:"basis-full lg:basis-1/2"},Ce={key:0,class:"basis-full lg:basis-1/2 flex gap-3 mt-10 flex-wrap"},Re={class:"flex flex-col items-center content-center"},$e={class:"flex flex-col gap-3 items-center content-center"},Oe=oe({__name:"Dashboard",setup(Le){const z=Pe(),H=te(ve).greaterOrEqual("md"),c=ue(),S=ne(),C=ie(),R=de(),{content:J,routeLoading:$}=V(S),{currentUser:u,isMutationLoading:K}=V(C),{publicUser:P,isMutationLoading:Q}=V(R),{firebaseUser:m,isOwner:E,isLogoutLoading:X}=V(c),{fetchAll:Z}=S,{updatePrivateUser:h}=C,{updatePublicUser:ee}=R,L=p(()=>K.value||Q.value),b=d(!1),A=d(),M=d(),T=d(),_=d(),D=d(),N=d(),O=d(),ae=d(),e=be({firstName:{value:"",error:""},lastName:{value:"",error:""},displayName:{value:"",error:""},email:{value:"",error:""},newPassword:{value:"",error:""},currentPassword:{value:"",error:""},repeatPassword:{value:"",error:""},avatar:{value:"",error:""}}),re=p(()=>new G(m.value.uid,e.firstName.value,e.lastName.value)),le=p(()=>new W(m.value.uid,e.displayName.value,e.avatar.value)),q=p(()=>!!u.value&&!Y(u.value,re.value)),B=p(()=>!!P.value&&!Y(P.value,le.value)),g=p(()=>{var s;return e.email.value!==((s=m.value)==null?void 0:s.email)}),y=p(()=>{const s=[];return q.value&&s.push("Details"),B.value&&s.push("Public Profile"),g.value&&s.push("E-mail"),e.newPassword.value&&s.push("Password"),s.length?"Save "+Ne(s):void 0}),se=async()=>{Object.keys(e).forEach(s=>e[s].error=""),e.newPassword.value&&(await Promise.all([D.value.test(),N.value.test(),O.value.test()]),!e.newPassword.error&&!e.currentPassword.error&&!e.repeatPassword.error&&(await c.updatePassword(e.newPassword.value,e.currentPassword.value),e.newPassword.value="",e.currentPassword.value="")),B.value&&(await T.value.test(),!e.displayName.error&&!e.avatar.error&&ee(new W(m.value.uid,e.displayName.value,e.avatar.value))),g.value&&(await Promise.all([_.value.test(),N.value.test()]),!e.email.error&&!e.currentPassword.error&&(await c.updateMail(e.email.value,e.currentPassword.value),e.currentPassword.value="")),q.value&&(await Promise.all([A.value.test(),M.value.test()]),!e.firstName.error&&!e.lastName.error&&h(new G(m.value.uid,e.firstName.value,e.lastName.value))),await Z(!0)};return me(()=>{var s,a,r,I,F;e.firstName.value=((s=u.value)==null?void 0:s.firstName)||"",e.lastName.value=((a=u.value)==null?void 0:a.lastName)||"",e.displayName.value=((r=P.value)==null?void 0:r.displayName)||"",e.email.value=((I=m.value)==null?void 0:I.email)||"",e.avatar.value=((F=P.value)==null?void 0:F.avatar)||""}),(s,a)=>(t(),n(Ue,null,{content:j(()=>[l(u)&&l(m)?(t(),n(pe,{key:0,class:"!bg-secondary-500 !bg-opacity-35 my-5",title:"Welcome "+l(u).firstName+(l(u).lastName?" "+l(u).lastName:""),description:l(J).dashboardDescription},{default:j(()=>[v("div",ke,[v("div",xe,[v("form",{id:"accountForm",class:"flex flex-col gap-3",onSubmit:a[17]||(a[17]=fe(r=>se(),["prevent"]))},[o(U,{name:"accountType",label:"Account Type","model-value":l(E)?"Owner":"Member","input-props":{disabled:!0}},null,8,["model-value"]),o(U,{ref_key:"firstName",ref:A,name:"firstName",label:"First Name",placeholder:"Someone",modelValue:e.firstName.value,"onUpdate:modelValue":a[0]||(a[0]=r=>e.firstName.value=r),error:e.firstName.error,"onUpdate:error":a[1]||(a[1]=r=>e.firstName.error=r),rules:[l(f).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),o(U,{ref_key:"lastName",ref:M,name:"lastName",label:"Last Name",modelValue:e.lastName.value,"onUpdate:modelValue":a[2]||(a[2]=r=>e.lastName.value=r),error:e.lastName.error,"onUpdate:error":a[3]||(a[3]=r=>e.lastName.error=r),"min-length":3,"max-length":50},null,8,["modelValue","error"]),o(U,{ref_key:"displayName",ref:T,name:"displayName",label:"Public Username",modelValue:e.displayName.value,"onUpdate:modelValue":a[4]||(a[4]=r=>e.displayName.value=r),error:e.displayName.error,"onUpdate:error":a[5]||(a[5]=r=>e.displayName.error=r),rules:[l(f).MinLength],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),o(ye,{ref_key:"email",ref:_,name:"email",label:"E-mail",modelValue:e.email.value,"onUpdate:modelValue":a[6]||(a[6]=r=>e.email.value=r),error:e.email.error,"onUpdate:error":a[7]||(a[7]=r=>e.email.error=r),rules:[l(f).Required]},null,8,["modelValue","error","rules"]),g.value?(t(),n(x,{key:0,ref_key:"currentPassword",ref:N,name:"currentPassword",label:"Current Password",modelValue:e.currentPassword.value,"onUpdate:modelValue":a[8]||(a[8]=r=>e.currentPassword.value=r),error:e.currentPassword.error,"onUpdate:error":a[9]||(a[9]=r=>e.currentPassword.error=r),rules:[l(f).Required]},null,8,["modelValue","error","rules"])):i("",!0),o(x,{ref_key:"newPassword",ref:D,name:"newPassword",label:"New Password",modelValue:e.newPassword.value,"onUpdate:modelValue":a[10]||(a[10]=r=>e.newPassword.value=r),error:e.newPassword.error,"onUpdate:error":a[11]||(a[11]=r=>e.newPassword.error=r),min:6,max:50},null,8,["modelValue","error"]),e.newPassword.value?(t(),n(x,{key:1,ref_key:"repeatPassword",ref:O,name:"repeatPassword",label:"Repeat New Password",modelValue:e.repeatPassword.value,"onUpdate:modelValue":a[12]||(a[12]=r=>e.repeatPassword.value=r),error:e.repeatPassword.error,"onUpdate:error":a[13]||(a[13]=r=>e.repeatPassword.error=r),rules:[l(f).Required],compare:{value:e.newPassword.value,name:"New Password"}},null,8,["modelValue","error","rules","compare"])):i("",!0),e.newPassword.value&&!g.value?(t(),n(x,{key:2,ref_key:"currentPassword",ref:N,name:"currentPassword",label:"Current Password",modelValue:e.currentPassword.value,"onUpdate:modelValue":a[14]||(a[14]=r=>e.currentPassword.value=r),error:e.currentPassword.error,"onUpdate:error":a[15]||(a[15]=r=>e.currentPassword.error=r),rules:[l(f).Required]},null,8,["modelValue","error","rules"])):i("",!0),v("div",Ee,[y.value?(t(),n(w,{key:0,class:"w-full",type:"submit",loading:L.value,label:y.value},null,8,["loading","label"])):i("",!0),l(E)?i("",!0):(t(),n(w,{key:1,class:"w-full",variant:"danger",outlined:"",label:"Delete account",onClick:a[16]||(a[16]=r=>b.value=!0)}))])],32)]),v("div",Se,[o(we,{ref_key:"avatar",ref:ae,id:"avatar",name:"avatar",label:"Public Avatar",modelValue:e.avatar.value,"onUpdate:modelValue":a[18]||(a[18]=r=>e.avatar.value=r),error:e.avatar.error,"onUpdate:error":a[19]||(a[19]=r=>e.avatar.error=r),"is-public":"","blog-post":null,"image-props":{class:"rounded-full"},"image-container-props":{class:"!h-64 !w-64"}},null,8,["modelValue","error"])]),l(H)?i("",!0):(t(),ce("div",Ce,[y.value?(t(),n(w,{key:0,class:"w-full",type:"submit",form:"accountForm",loading:L.value,label:y.value},null,8,["loading","label"])):i("",!0),l(E)?i("",!0):(t(),n(w,{key:1,class:"w-full",variant:"danger",outlined:"",label:"Delete account",onClick:a[20]||(a[20]=r=>b.value=!0)}))]))]),v("div",Re,[o(Ve)]),v("div",$e,[o(w,{class:"w-full md:w-1/2",label:"View Your Profile",variant:"purple",loading:l($)===l(k).USER_DETAILS,onClick:a[21]||(a[21]=r=>l(z).push({name:l(k).USER_DETAILS,params:{userId:l(u).id}}))},null,8,["loading"]),o(w,{class:"w-full md:w-1/2",label:"View Your Pets",loading:l($)===l(k).PET_OVERVIEW,route:l(k).PET_OVERVIEW},null,8,["loading","route"])])]),_:1},8,["title","description"])):i("",!0),o(ge,{title:"Delete Account",isOpen:b.value,description:["Are you sure you want to delete your account?","This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":l(X),onConfirm:a[22]||(a[22]=r=>l(c).deleteAccount()),onCancel:a[23]||(a[23]=r=>b.value=!1)},null,8,["isOpen","confirm-loading"])]),_:1}))}});export{Oe as default};
