import{u as ve,b as Se,a as ne,_ as K}from"./c-Bubble.vue_vue_type_script_setup_true_lang-bYHBWxaz.js";import{bO as Oe,cI as He,cJ as re,bX as J,aS as U,aQ as Pe,q as I,aC as Ne,bC as Le,cK as me,cP as Re,cL as $e,cO as Me,aK as d,u as y,v,M as ae,s as x,bH as L,aZ as ce,H as B,b9 as q,at as z,av as Be,F as ge,aV as Qe,bi as e,t as C,bV as je,bT as Fe,I as k,b_ as Ke,cq as Ue}from"../bundle.js";import{_ as Ve}from"./c-GameSettingsDialog.vue_vue_type_script_setup_true_lang-BxDvgQjP.js";import{u as Ge,H as Ze}from"./c-useScoreInfo-p-hvkgQ4.js";import{_ as de}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";import{S as xe}from"./c-Spades-CYpo1pQt.js";import"./c-SwitchField.vue_vue_type_script_setup_true_lang-BLC6R9kK.js";import"./c-SelectField.vue_vue_type_script_setup_true_lang-DejAEVFU.js";import"./c-validation-Bf-E2UlI.js";var S=(s=>(s.HEARTS="hearts",s.SPADES="spades",s.DIAMONDS="diamonds",s.CLUBS="clubs",s))(S||{});const oe={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var u=(s=>(s.STOCK_CLOSED="stock_closed",s.STOCK_OPEN="stock_open",s.PILE1="pile1",s.PILE2="pile2",s.PILE3="pile3",s.PILE4="pile4",s.PILE5="pile5",s.PILE6="pile6",s.PILE7="pile7",s.HEARTS="hearts",s.SPADES="spades",s.DIAMONDS="diamonds",s.CLUBS="clubs",s))(u||{}),g=(s=>(s[s.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",s[s.HAS_STARTED=1]="HAS_STARTED",s[s.HAS_FINISHED=2]="HAS_FINISHED",s))(g||{});const ye=()=>{const s=qe();return Re(s),{pile1:s.splice(0,1).map(l=>({...l,deck:"pile1"})),pile2:s.splice(0,2).map((l,a)=>a<1?{...l,hidden:!0,deck:"pile2"}:{...l,deck:"pile2"}),pile3:s.splice(0,3).map((l,a)=>a<2?{...l,hidden:!0,deck:"pile3"}:{...l,deck:"pile3"}),pile4:s.splice(0,4).map((l,a)=>a<3?{...l,hidden:!0,deck:"pile4"}:{...l,deck:"pile4"}),pile5:s.splice(0,5).map((l,a)=>a<4?{...l,hidden:!0,deck:"pile5"}:{...l,deck:"pile5"}),pile6:s.splice(0,6).map((l,a)=>a<5?{...l,hidden:!0,deck:"pile6"}:{...l,deck:"pile6"}),pile7:s.splice(0,7).map((l,a)=>a<6?{...l,hidden:!0,deck:"pile7"}:{...l,deck:"pile7"}),stock_closed:s.map(l=>({...l,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},ie=Oe("patienceStore",()=>{const s=He(re.PATIENCE)(),{personalBest:l,highscorePosition:a}=J(s),{setPreviousHighscores:E,fetchGameData:Q,updateHighscores:j,sortHighscores:p}=s,A=U(0),H=U(0),f=U(0),D=U(0),w=U(0),R=U(),i=Pe(ye()),h=I(()=>Object.keys(i).flatMap(t=>i[t])),T=1e3,F=10,P=10,O=I(()=>{const t=f.value%10===0?f.value:Math.floor(f.value/10)*10,o=H.value*F,n=w.value*F,c=t+o+n,_=D.value*P;return Math.max(0,T-(c-_))}),$=I(()=>{const t=Math.floor(f.value/60),o=f.value%60;return`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}`}),X=I(()=>i.hearts.length===13&&i.spades.length===13&&i.diamonds.length===13&&i.clubs.length===13);Ne(()=>{f.value&&r()}),Le(X,()=>{N(),A.value=2,j(O.value,{score:O.value,bonus:D.value,time:f.value,turns:H.value,penalty:w.value}),me($e)});const Y=()=>{N(),H.value=0,f.value=0,D.value=0,w.value=0,A.value=0,Object.assign(i,ye()),s.setPreviousHighscores()},ue=()=>{f.value=0,r(),A.value=1,setTimeout(()=>{te()},500)},r=()=>{R.value&&N(),R.value=setInterval(()=>{f.value++},1e3)},N=()=>{clearInterval(R.value)},Ae=()=>{const t=i.stock_open;t.length&&(t.reverse(),G(t[0],!1,o=>{o.deck="stock_closed",o.hidden=!0,i.stock_closed.push(o)}),t.splice(0,t.length),M(1))},Ce=t=>{const o=t.deck,n=h.value.filter(c=>c.selected);if(o==="stock_closed"){const c=i.stock_closed,_=c.indexOf(t);if(_===c.length-1){const V=_-2,b=V<0?0:V,le=c.filter((ke,De)=>De>=b);ee(le,"stock_open",ke=>{ke.hidden=!1}),M(0)}}else if(o==="stock_open"){const c=i.stock_open;c.indexOf(t)===c.length-1&&(t.selected=!t.selected,n.length&&G(n[0],!1))}else if(n.length){const c=n[0];c===t?G(t,!1):Z(o)&&be(c,t)?t.value===c.value+1&&(ee(n,o),c.value===13&&Z(c.deck)?M(5):M(4)):n.length===1&&fe(o)&&Ie(c,t)&&t.value===c.value-1&&(W(c,o),M(3))}else G(t,!0)},we=t=>{const o=h.value.filter(n=>n.selected);if(o.length){const n=o[0],c=n.deck;n.value===13&&(ee(o,t),c==="stock_open"?M(2):Z(n.deck)?M(5):M(4))}},Te=t=>{const o=h.value.filter(n=>n.selected);if(o.length===1){const n=o[0],c=n.type;!i[t].length&&c===t&&n.value===1&&(W(n,t),M(3))}},G=(t,o,n)=>{const c=i[t.deck],_=c.indexOf(t);c.filter((b,le)=>le>=_).forEach(b=>{b.selected=o,n==null||n(b)})},W=(t,o)=>{const n=t.deck,c=i[n].indexOf(t);t.deck=o,t.selected=!1,i[o].push(t),i[n].splice(c,1),(Z(n)||n==="stock_open")&&se(n)},ee=(t,o,n)=>{const c=t[0],_=c.deck,V=i[_].indexOf(c);G(c,!1,b=>{b.deck=o,n==null||n(b),i[o].push(b)}),i[_].splice(V,t.length),fe(_)||se(_!=="stock_closed"?_:o)},pe=t=>{const o=i[t.type],n=o.length?o[o.length-1].value:0;if(t.value===n+1){const c=["hearts","spades","diamonds","clubs"],_=n<=1||c.every(V=>{const b=i[V];return(b.length?b[b.length-1].value:0)>=n});if(n===0||_)return W(t,t.type),M(3),!0}return!1},te=()=>{for(const t of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const o=i[t];if(o.length&&pe(o[o.length-1]))return}},se=t=>{const o=i[t];if(o.length){const n=o[o.length-1],c=n.deck;n.hidden=!1,setTimeout(()=>{n.deck===c&&(pe(n)||te())},500)}else setTimeout(()=>{te()},500)},M=t=>{switch(t!==5&&H.value++,t){case 0:{w.value+=2;break}case 1:{w.value+=5;break}case 2:{D.value+=10;break}case 3:{D.value+=20;break}}me(Me)},be=(t,o)=>t.color!==o.color,Ie=(t,o)=>t.type===o.type,Z=t=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(t),fe=t=>["hearts","spades","diamonds","clubs"].includes(t);return{gameStatus:A,score:O,turns:H,time:f,bonus:D,penalty:w,cards:i,allCards:h,formattedTime:$,personalBest:l,highscorePosition:a,$reset:Y,isPlayDeck:Z,start:ue,shuffle:Ae,selectCard:Ce,selectEmptyDeck:we,selectFinalDeck:Te,setPreviousHighscores:E,fetchGameData:Q,updateHighscores:j,sortHighscores:p}},{persist:{enabled:!0}}),qe=()=>Object.keys(oe).flatMap(s=>{const l=s,a=[];for(let E=0;E<13;E++){const Q={type:l,label:oe[l].label,color:oe[l].color,value:E+1,hidden:!1,selected:!1};a.push(Q)}return a}),ze={},Je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:"100",height:"100"};function Ye(s,l){return d(),y("svg",Je,l[0]||(l[0]=[v("path",{d:"M50 35 Q40 25 50 15 Q60 25 50 35 Z M35 50 Q25 40 35 30 Q45 40 35 50 Z M65 50 Q75 40 65 30 Q55 40 65 50 Z M50 40 Q65 55 50 65 Q35 55 50 40 Z M45 65 Q45 80 55 80 Q55 65 45 65 Z",fill:"black"},null,-1)]))}const he=de(ze,[["render",Ye]]),Xe={},We={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:"100",height:"100"};function et(s,l){return d(),y("svg",We,l[0]||(l[0]=[v("polygon",{points:"50,10 80,50 50,90 20,50",fill:"red"},null,-1)]))}const _e=de(Xe,[["render",et]]),tt={},st={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:"100",height:"100"};function lt(s,l){return d(),y("svg",st,l[0]||(l[0]=[v("path",{d:"M50 70 Q20 50 20 30 Q20 10 40 10 Q50 10 50 20 Q50 10 60 10 Q80 10 80 30 Q80 50 50 70 Z",fill:"red"},null,-1)]))}const Ee=de(tt,[["render",lt]]),ot={key:0,class:"w-full h-full flex justify-center"},nt={key:1,class:"relative w-full flex"},rt={class:"relative flex text-xs md:text-md lg:text-lg font-bold"},ct=ae({__name:"Card",props:{card:{},index:{}},emits:["select"],setup(s,{emit:l}){const a=s,E=l,j=ve(Se).greaterOrEqual("lg"),p=ie(),{gameStatus:A,cards:H}=J(p),{isPlayDeck:f}=p,D=I(()=>{if(a.card.hidden)return"";switch(a.card.value){case 13:return"K";case 12:return"Q";case 11:return"J";case 1:return"A";default:return`${a.card.value}`}}),w=I(()=>a.card.hidden?"text-primary":a.card.color==="black"?"text-black":"text-red-500"),R=I(()=>a.index===H.value[a.card.deck].length-1),i=I(()=>A.value===g.HAS_STARTED&&(R.value||!a.card.hidden)),h=I(()=>f(a.card.deck)||j.value&&a.card.deck===u.STOCK_CLOSED),T=I(()=>f(a.card.deck)?20:10),F={[S.HEARTS]:Ee,[S.SPADES]:xe,[S.DIAMONDS]:_e,[S.CLUBS]:he};return(P,O)=>(d(),x(ne,{class:z(["z-10 absolute h-[90px] w-[40px] xs:h-[100px] xs:w-[50px] sm:h-[110px] sm:w-[60px] lg:h-[120px] lg:w-[80px] !p-1 !pt-0 bg-opacity-100 !rounded-primary flex justify-center border border-white",[w.value,P.card.hidden?"bg-violet-950":"bg-neutral-300",P.card.selected?"border-[3px] !border-red-600":"!border-black"]]),style:Be({top:h.value?`${T.value*P.index}px`:0}),"title-props":{class:"text-xl"},clickable:i.value,onClick:O[0]||(O[0]=$=>E("select"))},{fullControl:L(()=>[P.card.hidden?(d(),y("div",ot,O[1]||(O[1]=[v("div",{class:"flex flex-col justify-center"},[v("p",{class:"mb-2 text-5xl text-yellow-300"},"?")],-1)]))):(d(),y("div",nt,[v("div",rt,[(d(),x(ce(F[P.card.type]),{class:"mt-[5px] sm:mt-[1px] h-[10px] w-[10px] sm:h-[20px] sm:w-[20px] md:h-[25px] md:w-[25px]"})),B(" "+q(D.value),1)]),(d(),x(ce(F[P.card.type]),{class:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[25px] sm:w-[35px] md:w-[50px]"}))]))]),_:1},8,["class","style","clickable"]))}}),m=ae({__name:"CardDeck",props:{deckType:{},cardType:{}},setup(s){const l=s,a=ie(),{cards:E}=J(a),{shuffle:Q,selectCard:j,selectEmptyDeck:p,selectFinalDeck:A}=a,H={[S.HEARTS]:Ee,[S.SPADES]:xe,[S.DIAMONDS]:_e,[S.CLUBS]:he},f=I(()=>E.value[l.deckType]),D=I(()=>!f.value.length&&!l.cardType),w=I(()=>D.value&&l.deckType!==u.STOCK_OPEN),R=()=>{w.value&&p(l.deckType)};return(i,h)=>(d(),y("div",{class:z(["relative h-[90px] w-[40px] xs:h-[100px] xs:w-[50px] sm:h-[110px] sm:w-[60px] lg:h-[120px] lg:w-[80px]",{"border border-neutral-500":f.value.length===0,"cursor-pointer":w.value}]),onClick:R},[f.value.length?(d(!0),y(ge,{key:0},Qe(f.value,(T,F)=>(d(),x(ct,{key:`${T.type}.s${T.value}`,card:T,index:F,onSelect:P=>e(j)(T)},null,8,["card","index","onSelect"]))),128)):i.cardType?(d(),x(ce(H[i.cardType]),{key:1,class:"absolute left-1/2 transform -translate-x-1/2 w-[50px] cursor-pointer",onClick:h[0]||(h[0]=T=>e(A)(i.deckType))})):i.deckType===e(u).STOCK_CLOSED?(d(),y("div",{key:2,class:"w-full h-full flex justify-center",onClick:h[1]||(h[1]=(...T)=>e(Q)&&e(Q)(...T))},h[2]||(h[2]=[v("div",{class:"flex flex-col justify-center"},[v("p",{class:"text-neutral-300 text-xs md:text-md lg:text-lg mb-2"},"Shuffle")],-1)]))):C("",!0)],2))}}),at={class:"flex justify-center"},dt={key:0,class:"w-full flex flex-wrap gap-3 justify-center"},it={key:1,class:"w-full flex flex-col gap-3"},ut={class:"my-3"},pt={key:0,class:"w-full grid grid-cols-4 gap-1 justify-items-center"},ft={key:2,class:"w-full grid grid-cols-4 md:grid-cols-6 justify-items-center"},kt={key:1,class:"mt-5 text-center text-xl md:text-3xl font-bold"},mt={class:"text-purple-500"},yt={key:0,class:"text-blue-500 font-bold"},vt={key:1,class:"text-blue-500 font-bold"},St={key:2,class:"text-blue-500 font-bold"},gt={class:"mt-5 flex flex-wrap gap-3 justify-center"},xt={key:0,class:"flex flex-wrap gap-3 mt-3 justify-center"},Dt=ae({__name:"Patience",setup(s){const l=ve(Se),a=l.greaterOrEqual("md"),E=l.greaterOrEqual("lg"),Q=Fe(),j=ie(),{gameStatus:p,score:A,turns:H,formattedTime:f,personalBest:D}=J(j),{currentHighscorePosition:w,hasImprovedHighscorePosition:R,hasImprovedPersonalBest:i}=Ge(re.PATIENCE),{start:h,$reset:T,updateHighscores:F}=j,{firebaseUser:P}=J(je()),O=U(!1),$=U(!1),X=()=>{$.value=!1,h()},Y=()=>{$.value=!1,T()};return(ue,r)=>(d(),x(ne,{class:"!bg-cyan-800 !bg-opacity-50 my-5 !rounded-secondary",title:"Patience",description:"Play solo."},{right:L(()=>[k(K,{class:"border-none h-fit",type:"neutral",icon:"pi pi-cog",onClick:r[0]||(r[0]=N=>O.value=!0)})]),default:L(()=>[v("div",at,[e(p)===e(g).HAS_NOT_STARTED?(d(),y("div",dt,[k(K,{class:"w-full md:w-1/2",onClick:X},{default:L(()=>r[7]||(r[7]=[B(" Start ")])),_:1})])):C("",!0),e(p)===e(g).HAS_STARTED?(d(),y("div",it,[v("div",ut,[v("p",null,"Time: "+q(e(f)),1),v("p",null,"Turns: "+q(e(H)),1),v("p",null,"Score: "+q(e(A)),1)]),e(a)?C("",!0):(d(),y("div",pt,[k(m,{class:"col-start-2","deck-type":e(u).STOCK_OPEN},null,8,["deck-type"]),k(m,{"deck-type":e(u).STOCK_CLOSED},null,8,["deck-type"])])),v("div",{class:z(["w-full grid gap-1 justify-items-center",e(E)?"grid-cols-8":e(a)?"grid-cols-7":"grid-cols-4"])},[e(a)?(d(),y(ge,{key:0},[k(m,{"deck-type":e(u).STOCK_OPEN},null,8,["deck-type"]),e(E)?C("",!0):(d(),x(m,{key:0,"deck-type":e(u).STOCK_CLOSED},null,8,["deck-type"])),r[8]||(r[8]=v("div",null,null,-1))],64)):C("",!0),k(m,{"deck-type":e(u).HEARTS,"card-type":e(S).HEARTS},null,8,["deck-type","card-type"]),k(m,{"deck-type":e(u).SPADES,"card-type":e(S).SPADES},null,8,["deck-type","card-type"]),k(m,{"deck-type":e(u).DIAMONDS,"card-type":e(S).DIAMONDS},null,8,["deck-type","card-type"]),k(m,{"deck-type":e(u).CLUBS,"card-type":e(S).CLUBS},null,8,["deck-type","card-type"])],2),e(p)===e(g).HAS_STARTED?(d(),y("div",{key:1,class:z(["w-full grid gap-1 justify-items-center",e(E)?"grid-cols-8":"grid-cols-7"])},[e(E)?(d(),x(m,{key:0,"deck-type":e(u).STOCK_CLOSED},null,8,["deck-type"])):C("",!0),k(m,{"deck-type":e(u).PILE1},null,8,["deck-type"]),k(m,{"deck-type":e(u).PILE2},null,8,["deck-type"]),k(m,{"deck-type":e(u).PILE3},null,8,["deck-type"]),k(m,{"deck-type":e(u).PILE4},null,8,["deck-type"]),k(m,{"deck-type":e(u).PILE5},null,8,["deck-type"]),k(m,{"deck-type":e(u).PILE6},null,8,["deck-type"]),k(m,{"deck-type":e(u).PILE7},null,8,["deck-type"])],2)):C("",!0)])):e(p)===e(g).HAS_FINISHED?(d(),y("div",ft,[k(m,{class:"md:col-start-2","deck-type":e(u).HEARTS,"card-type":e(S).HEARTS},null,8,["deck-type","card-type"]),k(m,{"deck-type":e(u).SPADES,"card-type":e(S).SPADES},null,8,["deck-type","card-type"]),k(m,{"deck-type":e(u).DIAMONDS,"card-type":e(S).DIAMONDS},null,8,["deck-type","card-type"]),k(m,{"deck-type":e(u).CLUBS,"card-type":e(S).CLUBS},null,8,["deck-type","card-type"])])):C("",!0)]),$.value?(d(),x(Ze,{key:0,"game-id":e(re).PATIENCE,unit:"point"},null,8,["game-id"])):e(p)===e(g).HAS_FINISHED?(d(),y("div",kt,[v("p",mt,"You won with "+q(e(A))+" points!",1),e(R)&&e(w)===1?(d(),y("p",yt," HIGHSCORE! ")):e(R)?(d(),y("p",vt," LEADERBOARD IMPROVEMENT! ")):e(i)?(d(),y("p",St," PERSONAL BEST! ")):C("",!0)])):C("",!0),v("div",{class:z(["flex flex-col",{"h-[50vh] justify-end":e(p)===e(g).HAS_STARTED}])},[v("div",gt,[e(p)!==e(g).HAS_NOT_STARTED&&e(p)!==e(g).HAS_FINISHED?(d(),x(K,{key:0,class:"w-full md:w-1/2",type:"neutral",onClick:Y},{default:L(()=>r[9]||(r[9]=[B(" Restart ")])),_:1})):e(p)===e(g).HAS_FINISHED?(d(),x(K,{key:1,class:"w-full md:w-1/2",type:"secondary",onClick:Y},{default:L(()=>r[10]||(r[10]=[B(" Play Again ")])),_:1})):C("",!0),!$.value&&(e(p)===e(g).HAS_NOT_STARTED||e(p)===e(g).HAS_FINISHED)?(d(),x(K,{key:2,class:"w-full md:w-1/2",type:"neutral",onClick:r[1]||(r[1]=N=>$.value=!0)},{default:L(()=>r[11]||(r[11]=[B(" View Highscores ")])),_:1})):e(p)===e(g).HAS_NOT_STARTED?(d(),x(K,{key:3,class:"w-full md:w-1/2",type:"neutral",onClick:r[2]||(r[2]=N=>$.value=!1)},{default:L(()=>r[12]||(r[12]=[B(" Go Back ")])),_:1})):e(p)===e(g).HAS_FINISHED?(d(),x(K,{key:4,class:"w-full md:w-1/2",type:"neutral",onClick:r[3]||(r[3]=N=>$.value=!1)},{default:L(()=>r[13]||(r[13]=[B(" View Your Score ")])),_:1})):C("",!0)]),e(p)===e(g).HAS_FINISHED?(d(),y("div",xt,[e(P)?e(A)&&e(D)<e(A)?(d(),x(K,{key:1,class:"w-full md:w-1/2",type:"primary",onClick:r[5]||(r[5]=N=>e(F)(e(A)))},{default:L(()=>r[16]||(r[16]=[B(" Add To Leaderboard ")])),_:1})):C("",!0):(d(),x(ne,{key:0,class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:L(()=>[r[14]||(r[14]=B(" Please ")),v("a",{class:"cursor-pointer",onClick:r[4]||(r[4]=N=>e(Q).push({name:e(Ke).LOGIN,params:{redirect:JSON.stringify({name:e(Ue).GAMES_PATIENCE})}}))}," Login "),r[15]||(r[15]=B(" to add your score to the leaderboard. "))]),_:1}))])):C("",!0)],2),k(Ve,{"is-open":O.value,"onUpdate:isOpen":r[6]||(r[6]=N=>O.value=N)},null,8,["is-open"])]),_:1}))}});export{Dt as default};
