import{b9 as fe,bs as ve,bt as pe,bg as ee,bh as N,bu as ke,ax as P,bv as Te,bw as be,b5 as we,be as xe,q as R,bx as ye,s as V,z as S,au as D,aA as he,by as L,C as $,d as H,v as De,U as Ie,g as B,w as g,f as t,b as A,e as v,h as n,D as te,ab as W,a7 as Se,a8 as Ve,a9 as je,t as _,$ as _e,aa as ze,a6 as Ue,i as U,ad as $e,E as ae,I as ne,c as J,O as se,ai as G,aj as z,k as K,J as Q,ag as Ce,l as Ee,_ as Le,bz as Z,n as Ae,bA as Fe}from"../bundle.js";import{_ as le}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{_ as Oe}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{_ as Ne}from"./c-NumberField.vue_vue_type_script_setup_true_lang-BaJkCxK_.js";class F{id;name;interval;assignedToId;executeLog;constructor({id:a,name:o,interval:x,assignedToId:b,executeLog:k}={}){this.id=a??fe(),this.name=o??"",this.interval=x??{value:0,unit:"day"},this.assignedToId=b??null,this.executeLog=k??[]}static deserialize(a){return new F({id:a.id,name:a.name,interval:a.interval,assignedToId:a.assignedToId,executeLog:a.executeLog.map(O.deserialize)})}serialize(){return{id:this.id,name:this.name,interval:this.interval,assignedToId:this.assignedToId,executeLog:this.executeLog.map(a=>a.serialize())}}clone(){return new F({id:this.id,name:this.name,interval:{...this.interval},assignedToId:this.assignedToId,executeLog:this.executeLog.map(a=>a.clone())})}}class O{date;executorId;constructor(a,o){this.date=o??new Date,this.executorId=a??""}static deserialize(a){return new O(a.executorId,a.date.toDate())}serialize(){return{date:ve.fromDate(this.date),executorId:this.executorId}}clone(){return new O(this.executorId,new Date(this.date.getTime()))}}function Ke(w){return w.map(Re)}function Re(w){return F.deserialize(w)}class Me{async fetchMultiple(a){return pe(ee(a,N.TASKS))}async create(a,o){await ke(P(a,N.TASKS,o.id),o)}async update(a,o){await Te(P(a,N.TASKS,o.id),{...o})}async delete(a,o){await be(P(a,N.TASKS,o))}}const q=new Me,Y=we("taskStore",()=>{const w=xe(),a=R(),o=ye(),{firebaseUser:x}=V(a),{debug:b}=V(o),k=S([]),I=S(!1),T=S(!1),s=S(null),h=()=>{s.value?.(),s.value=null,k.value=[]},j=()=>{I.value=!0,s.value?.(),s.value=he(ee(w,N.TASKS),m=>{const r=m.docs.map(f=>({id:f.id,...f.data()}));k.value=Ke(r),I.value=!1},m=>{I.value=!1,D.firebaseError(b.value,m)})};return{tasks:k,isFetchLoading:I,isMutationLoading:T,$reset:h,fetchTasks:async()=>{if(!x.value){D.error("You must be logged in to fetch tasks."),s.value?.(),s.value=null;return}j()},createTask:async m=>{if(!x.value){D.error("You must be logged in to create tasks.");return}try{T.value=!0,await q.create(w,m.serialize()),D.success("Successfully created task")}catch(r){D.firebaseError(b.value,r)}finally{T.value=!1}},updateTask:async m=>{if(!x.value){D.error("You must be logged in to update tasks.");return}try{T.value=!0,await q.update(w,m.serialize()),D.success("Successfully updated task")}catch(r){D.firebaseError(b.value,r)}finally{T.value=!1}},deleteTask:async m=>{if(!x.value){D.error("You must be logged in to delete tasks.");return}try{T.value=!0,k.value.find(f=>f.id===m)&&(await q.delete(w,m),D.success("Successfully deleted task"))}catch(r){D.firebaseError(b.value,r)}finally{T.value=!1}}}}),oe=()=>{const w=Y(),a=R(),{firebaseUser:o}=V(a),{tasks:x}=V(w),b=$(()=>[...x.value].sort((d,l)=>{const e=h(d),c=h(l);return e===null&&c===null?0:e===null?1:c===null?-1:e.getTime()-c.getTime()})),k=$(()=>{const d=new Date,l=new Date(d.getTime()+7*L);return b.value.filter(e=>{const c=h(e);return c!==null&&c.getTime()>=d.getTime()&&c.getTime()<=l.getTime()&&(!e.assignedToId||e.assignedToId===o.value?.uid)})}),I=d=>[...d.executeLog].filter(l=>!Number.isNaN(l.date.getTime())).sort((l,e)=>l.date.getTime()-e.date.getTime()),T=d=>I(d).at(-1)?.date??null,s=d=>{const{value:l,unit:e}=d;switch(e){case"day":return l*L;case"week":return l*7*L;case"month":return l*30*L;case"year":return l*365*L;default:return null}},h=(d,l=new Date)=>{const e=T(d);if(!e)return new Date;const c=s(d.interval);if(!c)return new Date;const m=new Date(e.getTime()+c);return m.getTime()>=l.getTime()?m:new Date};function j(d){const l=new Date,e=new Date(l.getTime()-7*L);return x.value.filter(c=>c.executeLog.some(m=>m.executorId===d&&m.date.getTime()>=e.getTime()&&m.date.getTime()<=l.getTime()))}return{sortedTasks:b,shortTermTasks:k,getLatestExecuteDate:T,getProjectedReExecuteDate:h,getTasksExecutedInPastWeek:j}},We={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ye={class:"w-full flex gap-3"},Pe={class:"flex gap-5"},qe={class:"flex flex-col gap-3"},Be=H({__name:"TaskEditDialog",props:{isOpen:{type:Boolean},selectedTask:{}},emits:["close"],setup(w,{emit:a}){const o=w,x=a,b=R(),k=Y(),{isMutationLoading:I}=V(k),{firebaseUser:T}=V(b),s=De(l()),h=[{label:"Dagen",value:"day"},{label:"Weken",value:"week"},{label:"Maanden",value:"month"},{label:"Jaren",value:"year"}],j=$(()=>[{value:null,label:"Niemand"},{value:"wEaq28Vfx8aygJ6TUi0hDrNut1F2",label:"Sander"},{value:"2VYQvSoxA6OtwDc2pd9f5AGgLK33",label:"Kasper"}]),d=$(()=>[{value:"wEaq28Vfx8aygJ6TUi0hDrNut1F2",label:"Sander"},{value:"2VYQvSoxA6OtwDc2pd9f5AGgLK33",label:"Kasper"}].sort((r,f)=>{const p=T.value?.uid;return r.value===p?-1:f.value===p?1:0}));function l(){const r=o.selectedTask?.clone()??new F;return{name:r.name,interval:r.interval,assignedToId:r.assignedToId,executeLog:r.executeLog}}async function e(){const r=o.selectedTask?o.selectedTask:new F;Object.assign(r,s),o.selectedTask?await k.updateTask(r):await k.createTask(r),x("close")}function c(){x("close")}function m(){if(!T.value){D.error("You must be logged in to do this.");return}s.executeLog.push(new O(T.value.uid))}return Ie(()=>o.isOpen,r=>{r&&Object.assign(s,l())}),(r,f)=>(A(),B(le,{"is-open":w.isOpen,title:o.selectedTask?`Bewerk ${o.selectedTask.name}`:"Taak toevoegen",description:"","cancel-text":"Annuleren","confirm-text":o.selectedTask?"Bijwerken":"Toevoegen","confirm-loading":t(I),onConfirm:e,onCancel:c},{default:g(()=>[v("div",We,[n(te,{name:"name",label:"Naam",modelValue:s.name,"onUpdate:modelValue":f[0]||(f[0]=p=>s.name=p)},null,8,["modelValue"]),v("div",Ye,[n(Ne,{class:"w-full",name:"intervalValue",label:"Interval",modelValue:s.interval.value,"onUpdate:modelValue":f[1]||(f[1]=p=>s.interval.value=p)},null,8,["modelValue"]),n(W,{class:"!w-full",name:"intervalUnit",label:"Eenheid",modelValue:s.interval.unit,"onUpdate:modelValue":f[2]||(f[2]=p=>s.interval.unit=p),options:h},null,8,["modelValue"])]),n(W,{name:"assignedToId",label:"Toegewezen aan",modelValue:s.assignedToId,"onUpdate:modelValue":f[3]||(f[3]=p=>s.assignedToId=p),options:j.value},null,8,["modelValue","options"]),f[6]||(f[6]=v("b",null,"Logboek",-1)),n(t($e),{ref:"draggable",class:"flex flex-col gap-3",modelValue:s.executeLog,"onUpdate:modelValue":f[4]||(f[4]=p=>s.executeLog=p),itemKey:p=>p.date.toString(),handle:".drag-handle"},{item:g(({element:p,index:C})=>[n(t(Se),null,{default:g(()=>[n(t(Ve),{value:"0"},{default:g(()=>[n(t(je),{class:"drag-handle"},{default:g(()=>[v("div",Pe,[f[5]||(f[5]=v("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),v("p",null,_(t(_e)(p.date)),1)])]),_:2},1024),n(t(ze),null,{default:g(()=>[v("div",qe,[n(Ue,{name:`executeLog-date-${C}`,label:"Datum",modelValue:p.date,"onUpdate:modelValue":E=>p.date=E,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),n(W,{name:`executeLog-executor-${C}`,label:"Uitvoerder",modelValue:p.executorId,"onUpdate:modelValue":E=>p.executorId=E,options:d.value},null,8,["name","modelValue","onUpdate:modelValue","options"]),n(U,{variant:"danger",outlined:"",label:"Delete",onClick:E=>s.executeLog.splice(C,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),n(U,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:m})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),Je={key:0,class:"text-yellow-300"},Ge=H({__name:"TasksReport",setup(w){const a=Y(),o=R(),{isFetchLoading:x}=V(a),{firebaseUser:b}=V(o),k=ae(ne),{getTasksExecutedInPastWeek:I}=oe(),T=k.greaterOrEqual("md"),s=S(b.value?.uid??null),h=$(()=>s.value?I(s.value):[]),j=$(()=>{const l=h.value.length;switch(l){case 0:return"Er zijn geen taken gevonden, je bent een lui ding.";case 1:return"Oké, je bent begonnen deze week. Volgende week graag iets meer actie.";case 2:return"Best goed bezig deze week, maar er is nog ruimte voor verbetering!";case 3:return"Goed bezig deze week, zo door blijven gaan!";case 4:return"Top gedaan deze week, je bent een echte klusjesbaas!";case 10:return"10 taken in één week, dat is echt fantastisch, je bent een ware klusjeskoning!";default:return`Wow, je hebt deze week al ${l} taken uitgevoerd, dat is echt fantastisch!`}}),d=$(()=>[{value:"wEaq28Vfx8aygJ6TUi0hDrNut1F2",label:"Sander"},{value:"2VYQvSoxA6OtwDc2pd9f5AGgLK33",label:"Kasper"}].sort((l,e)=>{const c=b.value?.uid;return l.value===c?-1:e.value===c?1:0}));return(l,e)=>(A(),J(se,null,[e[2]||(e[2]=v("h3",{class:"text-xl mt-10 mb-3 font-bold"},"Weekrapportage",-1)),e[3]||(e[3]=v("p",{class:"mb-3"},"Taken die deze week door jou zijn uitgevoerd:",-1)),n(t(G),{value:h.value,tableStyle:t(T)?"min-width: 40rem":void 0,loading:t(x),size:t(T)?void 0:"small",filterDisplay:"row"},{empty:g(()=>[...e[1]||(e[1]=[K(" Er zijn geen taken gevonden, je bent een lui ding. ",-1)])]),footer:g(()=>[h.value.length>0?(A(),J("p",Je,_(j.value),1)):Q("",!0)]),default:g(()=>[n(t(z),{field:"assignedToId",header:"Naam",showFilterMenu:!1},{filter:g(()=>[n(W,{class:"w-full md:w-1/2 xl:w-1/3",name:"assignedToIdFilter",modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=c=>s.value=c),options:d.value,style:{"min-width":"5rem"}},null,8,["modelValue","options"])]),body:g(({data:c})=>[K(_(c.name),1)]),_:1})]),_:1},8,["value","tableStyle","loading","size"])],64))}}),Qe={class:"text-xl mt-10 mb-3 font-bold"},He={class:"flex flex-wrap gap-x-2 gap-y-1"},Xe={class:"flex justify-end"},Ze={class:"text-xl mt-10 mb-3 font-bold"},et={class:"flex flex-wrap gap-x-2 gap-y-1"},tt={class:"flex justify-end"},at={class:"flex gap-3 place-self-end"},it=H({__name:"Tasks",setup(w){const a=Y(),o=R(),x=Ce(),{isFetchLoading:b,isMutationLoading:k}=V(a),{combinedUsers:I}=V(x),T=ae(ne),{sortedTasks:s,shortTermTasks:h,getProjectedReExecuteDate:j}=oe(),d=T.greaterOrEqual("md"),l=S([]),e=S(null),c=S({name:{value:null,matchMode:"startsWith"}}),m=S(!1),r=S(!1);function f(y){const i=I.value.find(u=>u.id===y.assignedToId);return i?i.displayName:"Onbekend"}function p(y){const i=j(y);return Fe(i)}function C(y){const i=p(y);return`${i} dag${i!==1?"en":""}`}function E(y){const i=p(y);return{"text-red-400":i===0,"text-orange-300":i>0&&i<=3}}async function ie(y){if(!o.firebaseUser){D.error("You must be logged in to do this.");return}const i=y.clone();i.executeLog.push(new O(o.firebaseUser.uid)),await a.updateTask(i)}function re(y){l.value=[y.data]}function X(){e.value=null,r.value=!0}function ue(y){e.value=y,r.value=!0}function de(y){e.value=y,m.value=!0}function ce(){e.value=null,r.value=!1}async function ge(){e.value&&await a.deleteTask(e.value.id),m.value=!1,e.value=null}return Ee(()=>{a.fetchTasks()}),(y,i)=>(A(),J(se,null,[n(Oe,null,{content:g(()=>[n(Le,{class:"!bg-blue-500 !bg-opacity-35 my-5 lg:px-32",title:"Sander's Klusjestool",description:"Nu zul je nooit meer iets vergeten te doen!","description-props":{class:"text-white mb-5"}},{default:g(()=>[i[5]||(i[5]=v("ol",{class:"ms-3 list-decimal list-inside"},[v("li",null,"Voeg een taak toe"),v("li",null,"Registreer wanneer je iets hebt gedaan"),v("li",null,"Weet automatisch wanneer je volgende taak gepland is!")],-1)),v("h3",Qe,"Mijn takenlijst ("+_(t(h).length)+")",1),i[6]||(i[6]=v("p",{class:"mb-3"},"Taken die binnenkort uitgevoerd moeten worden in één overzicht.",-1)),n(t(G),{value:t(h),tableStyle:t(d)?"min-width: 40rem":void 0,loading:t(b),size:t(d)?void 0:"small"},{empty:g(()=>[...i[3]||(i[3]=[K(" Er zijn nog geen taken gevonden. ",-1)])]),default:g(()=>[n(t(z),{field:"name",header:"Naam"},{body:g(({data:u})=>[v("span",He,[v("span",null,_(u.name),1),u.assignedToId?(A(),B(t(Z),{key:0,value:f(u),severity:"info"},null,8,["value"])):Q("",!0)])]),_:1}),n(t(z),{header:"Taakje uitvoeren over"},{body:g(({data:u})=>[v("span",{class:Ae(E(u))},_(C(u)),3)]),_:1}),n(t(z),null,{body:g(({data:u})=>[v("div",Xe,[n(U,{class:"w-fit",icon:"pi pi-check","icon-only":"",variant:"green",loading:t(k),onClick:M=>ie(u)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","tableStyle","loading","size"]),v("h3",Ze," Alle taken ("+_(t(s).length)+") ",1),n(t(G),{value:t(s),expandedRows:l.value,"onUpdate:expandedRows":i[0]||(i[0]=u=>l.value=u),filters:c.value,"onUpdate:filters":i[1]||(i[1]=u=>c.value=u),tableStyle:t(d)?"min-width: 40rem":void 0,loading:t(b),size:t(d)?void 0:"small",filterDisplay:t(s).length>1?"row":void 0,onRowExpand:re},{empty:g(()=>[...i[4]||(i[4]=[K(" Er zijn nog geen taken gevonden. ",-1)])]),default:g(()=>[n(t(z),{field:"name",header:"Naam"},{filter:g(({filterModel:u,filterCallback:M})=>[n(te,{name:"nameFilter",modelValue:u.value,"onUpdate:modelValue":me=>u.value=me,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:M},null,8,["modelValue","onUpdate:modelValue","onInput"])]),body:g(({data:u})=>[v("span",et,[v("span",null,_(u.name),1),u.assignedToId?(A(),B(t(Z),{key:0,value:f(u),severity:"info"},null,8,["value"])):Q("",!0)])]),_:1}),n(t(z),{header:"Taakje uitvoeren over"},{body:g(({data:u})=>[K(_(C(u)),1)]),_:1}),n(t(z),null,{filter:g(()=>[v("div",tt,[n(U,{class:"w-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(k),onClick:X},null,8,["loading"])])]),body:g(({data:u})=>[v("div",at,[n(U,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:t(k),onClick:M=>ue(u)},null,8,["loading","onClick"]),n(U,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:t(k),onClick:M=>de(u)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","tableStyle","loading","size","filterDisplay"]),n(U,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(k),onClick:X},null,8,["loading"]),n(Ge)]),_:1})]),_:1}),n(Be,{"is-open":r.value,"selected-task":e.value,onClose:ce},null,8,["is-open","selected-task"]),n(le,{title:"Taak verwijderen","is-open":m.value,description:[e.value?`Weet je zeker dat je het taakje '${e.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":t(k),onConfirm:ge,onCancel:i[2]||(i[2]=u=>m.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{it as default};
