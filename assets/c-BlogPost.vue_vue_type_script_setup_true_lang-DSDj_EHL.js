import{j as F,s as B,r as M,o as ae,ac as ie,aw as re,ax as J,ay as Y,az as j,aA as oe,i as q,f as V,h as se,c as I,t as i,n as s,E as G,m as u,G as R,R as K,D as H,aB as ne,H as C,q as T,w as r,_ as O,a as ue,l as v,aq as de,p as D,V as ce,O as pe,W as me,x as E,U as N,aC as ge,aD as ve,aE as fe,B as be,aF as ye,y as he,A as Q,z as A,aG as X,M as W,g as ke,C as we,aH as Pe,J as L,K as z,N as Z,aI as x,X as Se,Z as $e,aJ as Ce,L as _,Y as Be,P as Te,Q as Ie}from"../bundle.js";const Re=o=>{const a=F(),{collections:n,fetchBlogPost:b,checkBlogPostForUnreadReactions:h}=a,{blogPosts:f,blogReactions:w,isBlogPostDatabaseActionActive:m}=B(a);let k=[];const P=M(),y=p=>{p.metadata.hasPendingWrites||m.value||(clearTimeout(P.value),P.value=setTimeout(async()=>{await b(o.id,void 0,{loadingIndicator:!1}),h(f.value.previousData.single,!0)},200))};ae(async()=>{w.value.unread=w.value.unread.filter(g=>g.postId!==o.id);const p=ie(o),c=n.blogPosts(p.isPrivate),S=n.blogReactions(p.isPrivate),$=re(c,o.id),U=J(c,Y("id","==",o.id)),e=J(S,Y("post","==",$));k.push(j(U,y)),k.push(j(e,y))}),oe(()=>{clearTimeout(P.value),k.forEach(p=>{p()})})},We=()=>{const o=F(),a=q(),{visibleBlogPosts:n,blogReactions:b,isBlogPostDatabaseActionActive:h}=B(o),{firebaseUser:f,isLoggedIn:w}=B(a),{collections:m,fetchBlogPosts:k,checkBlogPostsForUnreadReactions:P}=o;let y=[];const p=M(),c=S=>{S.metadata.hasPendingWrites||h.value||(clearTimeout(p.value),p.value=setTimeout(async()=>{var $;n.value.length&&(await k(($=f.value)==null?void 0:$.uid,{amount:n.value.length,loadingIndicator:!1}),P())},200))};ae(()=>{b.value.unread=[],y.push(j(m.blogPosts(!1),c)),y.push(j(m.blogReactions(!1),c)),w.value&&(y.push(j(m.blogPosts(!0),c)),y.push(j(m.blogReactions(!0),c)))}),oe(()=>{clearTimeout(p.value),y.forEach(S=>{S()})})},De={class:"flex flex-col gap-2"},ee=V({__name:"BlogReaction",props:{post:{},reaction:{}},setup(o){const a=o,n=se(),b=q(),h=F(),{routeLoading:f,routeLoadingId:w}=B(n),{firebaseUser:m,isLoggedIn:k,isOwner:P}=B(b),{blogReactions:y}=B(h),{deleteBlogReaction:p}=h,c=I(()=>m.value&&a.reaction.user.id===m.value.uid||P.value);return(S,$)=>(s(),i(G,{id:a.reaction.id,class:R(["p-5 w-full md:w-3/4 xl:w-2/3",a.post.colorTertiary,a.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":u(f)===u(K).USER_DETAILS&&u(w)===a.reaction.user.id}},title:a.reaction.user.displayName||"Unknown user",subTitle:u(H)(a.reaction.date),avatar:a.reaction.user.avatar,route:u(k)?{name:u(K).USER_DETAILS,params:{userId:a.reaction.user.id}}:void 0,avatarRoute:u(k)?{name:u(K).USER_DETAILS,params:{userId:a.reaction.user.id}}:void 0,description:a.reaction.message},ne({_:2},[c.value?{name:"right",fn:C(()=>[T("div",De,[c.value&&!a.post.locked?(s(),i(O,{key:0,type:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:u(y).isDatabaseDeletionActive,onClick:$[0]||($[0]=U=>u(p)(a.reaction.id,a.post))},null,8,["disabled"])):r("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),Ee={class:"grid justify-items-center p-5 gap-5"},Ue=V({__name:"BlogReactions",props:{post:{}},setup(o){const a=o,n=se(),b=q(),h=F(),{content:f}=B(n),{firebaseUser:w,isLoggedIn:m}=B(b),{blogReactions:k}=B(h),{createBlogReaction:P}=h,y=M(),p=M(!1),c=ue({reaction:{value:"",error:""}}),S=I(()=>[...a.post.reactions].reverse()),$=I(()=>S.value.filter((l,d)=>d<3)),U=I(()=>S.value.filter((l,d)=>d>=3)),e=I(()=>a.post.locked||!m.value||k.value.isDatabaseCreationActive),g=async()=>{if(!k.value.isDatabaseCreationActive){if(await y.value.test(),!c.reaction.error&&w.value){const l=c.reaction.value;c.reaction.value="Replying...";const d=await P(a.post,{userId:w.value.uid,postId:a.post.id,message:l,date:new Date});c.reaction.value=d?"":l}fe()}};return(l,d)=>(s(),v("form",{action:"",onSubmit:de(g,["prevent"])},[T("div",Ee,[!u(m)||l.post.reactions.filter(t=>t.user.id===u(w).uid).length<20?(s(),i(G,{key:0,class:R(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",l.post.colorTertiary||"bg-secondary-700",l.post.opacityTertiary||"bg-opacity-25"])},{default:C(()=>[D(ce,{class:"w-5/6",id:l.post.id,inputProps:{class:["rounded-primary border-none !placeholder-gray-300",l.post.colorSecondary||l.post.colorPrimary||"bg-secondary-600",l.post.opacitySecondary||"!bg-opacity-20",e.value?{"!bg-gray-900 !bg-opacity-50":!u(k).isDatabaseCreationActive}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!u(m)&&!l.post.locked}],disabled:e.value,autocomplete:"off"},ref_key:"reaction",ref:y,name:"reaction",placeholder:l.post.locked?"Locked for comments":u(m)?"Reply":u(f).blogLoginGuest,modelValue:c.reaction.value,"onUpdate:modelValue":d[0]||(d[0]=t=>c.reaction.value=t),error:c.reaction.error,"onUpdate:error":d[1]||(d[1]=t=>c.reaction.error=t),rules:[u(me).Required],onClick:d[2]||(d[2]=()=>!u(m)&&!l.post.locked?u(pe).push({name:u(K).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):r("",!0),(s(!0),v(E,null,N($.value,t=>(s(),i(ee,{post:l.post,reaction:t},null,8,["post","reaction"]))),256)),(s(!0),v(E,null,N(U.value,t=>ge((s(),i(ee,{post:l.post,reaction:t},null,8,["post","reaction"])),[[ve,p.value]])),256)),l.post.reactions.length>3?(s(),i(O,{key:1,type:"primary",outlined:"",icon:p.value?"pi pi-angle-up":"pi pi-angle-down",label:p.value?"Hide older reactions":"View older reactions",onClick:d[3]||(d[3]=t=>p.value=!p.value)},null,8,["icon","label"])):r("",!0)])],32))}});var Ae={root:function(a){var n=a.props;return["p-chip p-component",{"p-chip-image":n.image!=null}]},icon:"p-chip-icon",label:"p-chip-text",removeIcon:"p-chip-remove-icon"},Le=be.extend({name:"chip",classes:Ae}),je={name:"BaseChip",extends:he,props:{label:{type:String,default:null},icon:{type:String,default:null},image:{type:String,default:null},removable:{type:Boolean,default:!1},removeIcon:{type:String,default:void 0}},style:Le,provide:function(){return{$parentInstance:this}}},le={name:"Chip",extends:je,inheritAttrs:!1,emits:["remove"],data:function(){return{visible:!0}},methods:{onKeydown:function(a){(a.key==="Enter"||a.key==="Backspace")&&this.close(a)},close:function(a){this.visible=!1,this.$emit("remove",a)}},components:{TimesCircleIcon:ye}},Ke=["aria-label"],Ne=["src"];function Oe(o,a,n,b,h,f){return h.visible?(s(),v("div",A({key:0,class:o.cx("root"),"aria-label":o.label},o.ptmi("root")),[Q(o.$slots,"default",{},function(){return[o.image?(s(),v("img",A({key:0,src:o.image},o.ptm("image")),null,16,Ne)):o.$slots.icon?(s(),i(X(o.$slots.icon),A({key:1,class:o.cx("icon")},o.ptm("icon")),null,16,["class"])):o.icon?(s(),v("span",A({key:2,class:[o.cx("icon"),o.icon]},o.ptm("icon")),null,16)):r("",!0),o.label?(s(),v("div",A({key:3,class:o.cx("label")},o.ptm("label")),W(o.label),17)):r("",!0)]}),o.removable?Q(o.$slots,"removeicon",{key:0,onClick:f.close,onKeydown:f.onKeydown,removeCallback:f.close,keydownCallback:f.onKeydown},function(){return[(s(),i(X(o.removeIcon?"span":"TimesCircleIcon"),A({tabindex:"0",class:[o.cx("removeIcon"),o.removeIcon],onClick:f.close,onKeydown:f.onKeydown},o.ptm("removeIcon")),null,16,["class","onClick","onKeydown"]))]}):r("",!0)],16,Ke)):r("",!0)}le.render=Oe;const Ve={class:"flex flex-wrap justify-end h-fit gap-3"},Me=V({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(o){return(a,n)=>(s(),v("div",Ve,[D(O,{class:"min-w-80",label:"Edit",onClick:n[0]||(n[0]=b=>a.$emit("editClicked"))}),D(O,{class:"min-w-80",type:"danger",outlined:"",label:"Delete",onClick:n[1]||(n[1]=b=>a.$emit("deleteClicked"))})]))}}),te=V({__name:"BlogPostSectionTitle",props:{class:{},alignment:{},isExpandable:{type:Boolean},isExpanded:{type:Boolean},isSubTitle:{type:Boolean}},emits:["click"],setup(o){const a=o;return(n,b)=>(s(),v("div",{class:R(["font-bold",{"text-lg md:text-2xl":!n.isSubTitle},{"hover:underline cursor-pointer":n.isExpandable},a.class])},[T("div",{class:R({block:!n.alignment,flex:!!n.alignment,"justify-start":n.alignment==="left","justify-center":n.alignment==="center","justify-end":n.alignment==="right"})},[T("span",{class:"flex",onClick:b[0]||(b[0]=h=>n.$emit("click"))},[n.isExpandable&&n.alignment==="right"?(s(),v("i",{key:0,class:R(["pi pi-angle-down animation",{"rotate-180":n.isExpanded}])},null,2)):r("",!0),Q(n.$slots,"default"),n.isExpandable&&(n.alignment==="left"||n.alignment==="center")?(s(),v("i",{key:1,class:R(["pi pi-angle-down animation",{"rotate-180":n.isExpanded}])},null,2)):r("",!0)])],2)],2))}}),Ge={class:"flex gap-3"},Fe={class:"flex justify-between h-fit mt-2 gap-2"},qe={class:"flex flex-wrap gap-3"},ze={class:"w-full"},He={class:"w-full"},Je=V({__name:"BlogPost",props:{post:{},withoutMutation:{type:Boolean}},emits:["editClicked","deleteClicked"],setup(o){const a=o,n=ke(),b=q(),h=we(),{publicUsers:f}=B(h),{firebaseUser:w,isOwner:m}=B(b);n.currentRoute.value.name!==K.BLOG&&Re(a.post);const k=I(()=>{var e;return(e=a.post.allowedUserIds)!=null&&e.length?f.value.filter(g=>{var l;return(l=a.post.allowedUserIds)==null?void 0:l.includes(g.id)}):[]}),P=I(()=>{const e=H(a.post.date);return a.post.dateUpdated?e+` - updated ${H(a.post.dateUpdated)}`:e}),y=I(()=>{const e=[];return a.post.datePinned&&e.push({value:"Pinned",severity:"success",rounded:!1}),a.post.locked&&e.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),a.post.archived&&e.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),e}),p=I(()=>a.post.sections.map(e=>({...e,isExpandable:S(e)}))),c=I(()=>p.value.some(e=>e.openByDefault)?p.value.flatMap((e,g)=>e.openByDefault?g:[]):null),S=e=>!!e.description||!!e.coverImageUrl||!!e.bullets.length||!!e.table,$=e=>{var g;(g=c.value)!=null&&g.length||Be(e)},U=()=>{const e=document.createElement("textarea"),{protocol:g,hostname:l,port:d}=window.location,t=`${g}//${l}`+(l==="localhost"?`:${d}`:"");e.value=`${t}#${Te.BLOG.path}/${a.post.id}`,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),Ie.success("Copied link!")};return(e,g)=>(s(),i(G,{id:e.post.id,class:R(["border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:P.value,tags:y.value,loading:e.post.loading,clickable:"",route:{name:u(K).BLOG_DETAILS,params:{postId:e.post.id}}},{right:C(()=>[T("div",Ge,[D(O,{class:"border-none h-fit",type:"neutral",icon:"pi pi-copy",onClick:U})])]),default:C(()=>{var l;return[T("div",Fe,[T("div",qe,[(s(!0),v(E,null,N(k.value,d=>{var t;return s(),i(u(le),{class:"h-fit !p-0 !px-4 !py-1 bg-red-800 bg-opacity-50",icon:"pi pi-user",label:d.id===((t=u(w))==null?void 0:t.uid)?"You":d.displayName,rounded:""},null,8,["label"])}),256))]),u(m)&&!e.withoutMutation?(s(),v("div",{key:0,class:R(["flex justify-end ms-5",(l=e.post.allowedUserIds)!=null&&l.length?"flex-col md:flex-row":"flex-row"])},[D(Me,{onEditClicked:g[0]||(g[0]=d=>e.$emit("editClicked")),onDeleteClicked:g[1]||(g[1]=d=>e.$emit("deleteClicked"))})],2)):r("",!0)]),D(G,{class:R(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{default:C(()=>{var d;return[(s(!0),v(E,null,N(e.post.content,t=>(s(),i(Pe,{key:t.id,post:e.post,block:t},null,8,["post","block"]))),128)),T("div",{class:R(["flex relative",e.post.countdown||e.post.alignment==="center"?"flex justify-between":""])},[T("div",ze,[e.post.countdown?(s(),i(L,{key:0,time:new Date(e.post.countdown).getTime(),direction:"down",alignment:e.post.alignment},null,8,["time","alignment"])):r("",!0),e.post.timer?(s(),i(L,{key:1,time:new Date(e.post.timer).getTime(),direction:"up",alignment:e.post.alignment},null,8,["time","alignment"])):r("",!0),e.post.description?(s(),i(z,{key:2,description:e.post.description},null,8,["description"])):r("",!0)])],2),e.post.coverImageUrl?(s(),i(Z,{key:0,post:e.post,"cover-image-url":e.post.coverImageUrl},null,8,["post","cover-image-url"])):r("",!0),e.post.descriptionFooter?(s(),i(z,{key:1,class:"mb-5",description:e.post.descriptionFooter},null,8,["description"])):r("",!0),e.post.table?(s(),i(x,{key:2,tableData:e.post.table,alignment:e.post.tableAlignment},null,8,["tableData","alignment"])):r("",!0),D(u(Se),{multiple:!!((d=c.value)!=null&&d.length),"active-index":c.value,onTabOpen:$},{default:C(()=>[(s(!0),v(E,null,N(p.value,t=>(s(),i(u($e),{disabled:!t.isExpandable,pt:{headerAction:{class:["px-0 bg-transparent",t.isExpandable?void 0:"cursor-auto"]},headerIcon:{class:{invisible:!t.isExpandable}}}},ne({header:C(()=>[T("div",He,[t.title?(s(),i(te,{key:0,alignment:t.alignment},{default:C(()=>[_(W(t.title),1)]),_:2},1032,["alignment"])):r("",!0),t.subTitle?(s(),i(te,{key:1,alignment:t.alignment,"is-sub-title":""},{default:C(()=>[_(W(t.subTitle),1)]),_:2},1032,["alignment"])):r("",!0),t.isExpandable?r("",!0):(s(),v(E,{key:2},[t.countdown?(s(),i(L,{key:0,time:new Date(t.countdown).getTime(),direction:"down",alignment:t.alignment},null,8,["time","alignment"])):r("",!0),t.timer?(s(),i(L,{key:1,time:new Date(t.timer).getTime(),direction:"up",alignment:t.alignment},null,8,["time","alignment"])):r("",!0)],64))])]),default:C(()=>[t.description?(s(),i(z,{key:0,description:t.description,alignment:t.alignment},null,8,["description","alignment"])):r("",!0),t.coverImageUrl?(s(),i(Z,{key:1,post:e.post,"cover-image-url":t.coverImageUrl,alignment:t.alignment,"image-class":"!max-h-[50vh]"},null,8,["post","cover-image-url","alignment"])):r("",!0),D(Ce,{bullets:t.bullets,alignment:t.alignment},null,8,["bullets","alignment"]),t.isExpandable?(s(),v(E,{key:2},[t.countdown?(s(),i(L,{key:0,time:new Date(t.countdown).getTime(),direction:"down",alignment:t.alignment},null,8,["time","alignment"])):r("",!0),t.timer?(s(),i(L,{key:1,time:new Date(t.timer).getTime(),direction:"up",alignment:t.alignment},null,8,["time","alignment"])):r("",!0)],64)):r("",!0),t.table?(s(),i(x,{key:3,tableData:t.table,alignment:t.tableAlignment},null,8,["tableData","alignment"])):r("",!0)]),_:2},[t.isExpandable?void 0:{name:"headericon",fn:C(()=>[]),key:"0"}]),1032,["disabled","pt"]))),256))]),_:1},8,["multiple","active-index"])]}),_:1},8,["class"]),D(Ue,{post:e.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","loading","route"]))}});export{Je as _,Me as a,te as b,le as s,We as u};
