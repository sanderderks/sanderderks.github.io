var ye=Object.defineProperty;var ve=(p,a,t)=>a in p?ye(p,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[a]=t;var L=(p,a,t)=>ve(p,typeof a!="symbol"?a+"":a,t);import{b9 as ce,bs as he,bt as be,bg as Oe,bh as X,bu as ke,ax as ae,bv as we,bw as Be,b5 as Ve,be as De,q as Se,bx as Ce,s as R,z as P,C as M,au as $,by as xe,bz as ze,bA as Z,d as J,bq as $e,U as le,b as D,g as q,D as Y,Y as Pe,br as _e,v as de,w as h,f as e,e as V,h as o,ab as pe,J as Le,i as N,ac as me,a7 as Ue,a8 as je,a9 as qe,t as j,$ as fe,aa as Ne,a6 as Te,ad as Fe,E as Ae,l as Ee,c as T,O as F,I as Ie,_ as Me,ai as oe,aj as x,k as U,bB as ue,n as ne}from"../bundle.js";import{_ as se}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{_ as Re}from"./c-Page.vue_vue_type_script_setup_true_lang-3zQkaq1W.js";import{u as Ge,D as He,_ as We}from"./c-useDateChart-PiIwI4ec.js";class G{constructor({id:a,name:t,size:y,category:g,buyLog:c,isOutOfStock:O}={}){L(this,"id");L(this,"name");L(this,"size");L(this,"category");L(this,"buyLog");L(this,"isOutOfStock");this.id=a??ce(),this.name=t??"",this.size=y??{value:0,unit:""},this.category=g??null,this.buyLog=c??[],this.isOutOfStock=O??!1}static deserialize(a){return new G({id:a.id,name:a.name,size:a.size,category:a.category,buyLog:a.buyLog.map(H.deserialize),isOutOfStock:a.isOutOfStock})}serialize(){return{id:this.id,name:this.name,size:this.size,category:this.category,buyLog:this.buyLog.map(a=>a.serialize()),isOutOfStock:this.isOutOfStock}}clone(){return new G({id:this.id,name:this.name,size:{...this.size},category:this.category?{...this.category}:null,buyLog:this.buyLog.map(a=>a.clone()),isOutOfStock:this.isOutOfStock})}}class H{constructor(a,t,y){L(this,"date");L(this,"price");L(this,"quantity");this.date=a??new Date,this.price=t??0,this.quantity=y??1}static deserialize(a){return new H(a.date.toDate(),a.price,a.quantity)}serialize(){return{date:he.fromDate(this.date),price:this.price,quantity:this.quantity}}clone(){return new H(new Date(this.date.getTime()),this.price,this.quantity)}}function Ye(p){return p.map(Ke)}function Ke(p){return G.deserialize(p)}class Je{async fetchMultiple(a){return be(Oe(a,X.BOODSCHAPPEN))}async create(a,t){await ke(ae(a,X.BOODSCHAPPEN,t.id),t)}async update(a,t){await we(ae(a,X.BOODSCHAPPEN,t.id),{...t})}async delete(a,t){await Be(ae(a,X.BOODSCHAPPEN,t))}}const ee=new Je,te=Ve("boodschappenStore",()=>{const p=De(),a=Se(),t=Ce(),{firebaseUser:y}=R(a),{debug:g}=R(t),c=P([]),O=P(!1),k=P(!1),S=M(()=>c.value.reduce((u,d)=>{const i=d.category;return i&&!u.some(r=>r.id===i.id)&&u.push(i),u},[])),m=M(()=>[{value:null,label:"Geen categorie"},...S.value.map(u=>({value:u,label:u.label}))]);return{boodschappen:c,isFetchLoading:O,isMutationLoading:k,categories:S,categoryOptions:m,$reset:()=>{c.value=[]},fetchBoodschappen:async()=>{if(!y.value){$.error("You must be logged in to fetch products.");return}try{O.value=!0;const u=await ee.fetchMultiple(p);c.value=Ye(u)}catch(u){$.firebaseError(g.value,u)}finally{O.value=!1}},createBoodschap:async u=>{if(!y.value){$.error("You must be logged in to create products.");return}try{k.value=!0,await ee.create(p,u.serialize()),xe(c,u),$.success("Successfully created product")}catch(d){$.firebaseError(g.value,d)}finally{k.value=!1}},updateBoodschap:async u=>{if(!y.value){$.error("You must be logged in to update products.");return}try{k.value=!0,await ee.update(p,u.serialize()),ze(c,u,"id"),$.success("Successfully updated product")}catch(d){$.firebaseError(g.value,d)}finally{k.value=!1}},deleteBoodschap:async u=>{if(!y.value){$.error("You must be logged in to delete products.");return}try{k.value=!0,c.value.find(i=>i.id===u)&&(await ee.delete(p,u),c.value=c.value.filter(i=>i.id!==u),$.success("Successfully deleted product"))}catch(d){$.firebaseError(g.value,d)}finally{k.value=!1}}}}),Qe=()=>{const p=te(),{boodschappen:a}=R(p),t=M(()=>[...a.value].sort((n,l)=>{const s=!!n.isOutOfStock,v=!!l.isOutOfStock;if(s&&!v)return-1;if(!s&&v)return 1;const b=k(n),u=k(l);return b===null&&u===null?0:b===null?1:u===null?-1:b.getTime()-u.getTime()})),y=M(()=>{const n=new Date,l=new Date(n.getTime()+14*Z);return t.value.filter(s=>{const v=k(s);return v!==null&&v.getTime()>=n.getTime()&&v.getTime()<=l.getTime()})}),g=M(()=>{const n=new Date(new Date().getTime()+14*Z);return t.value.filter(l=>{const s=k(l);return!s||s.getTime()>n.getTime()})}),c=n=>[...n.buyLog].filter(l=>Number(l.quantity)>0&&!Number.isNaN(l.date.getTime())).sort((l,s)=>l.date.getTime()-s.date.getTime()),O=n=>{var s;return((s=c(n).at(-1))==null?void 0:s.date)??null},k=(n,l=new Date)=>{const s=c(n),v=n.size.value;if(!Number.isFinite(v)||v<=0)return null;if(s.length<2)return null;let b=0,u=0;for(let A=0;A<s.length-1;A++){const E=s[A],Q=(s[A+1].date.getTime()-E.date.getTime())/Z;!Number.isFinite(E.quantity)||E.quantity<=0||Q<=0||(b+=E.quantity*v,u+=Q)}if(u<=0||b<=0)return null;const d=b/u;if(!Number.isFinite(d)||d<=0)return null;const i=s.at(-1);if(!i)return null;const r=i.quantity;if(!Number.isFinite(r)||r<=0)return null;const C=r*v/d;if(!Number.isFinite(C)||C<=0)return null;const W=new Date(i.date.getTime()+C*Z);return W.getTime()<l.getTime()?l:W};return{sortedBoodschappen:t,shortTermGroceries:y,longTermGroceries:g,getLatestPurchaseDate:O,getProjectedOutOfStockDate:k,getPricePerUnit:n=>{const l=c(n).at(-1);return!l||!Number.isFinite(l.price)||!Number.isFinite(l.quantity)||l.quantity<=0?null:l.price/l.quantity},getPriceIncreasePercentage:n=>{const l=c(n);if(l.length<2)return 0;const s=l.at(-1),v=l.at(-2);return!Number.isFinite(s.price)||!Number.isFinite(s.quantity)||!Number.isFinite(v.price)||!Number.isFinite(v.quantity)||v.quantity===0?0:(s.price/s.quantity-v.price/v.quantity)/(v.price/v.quantity)*100}}},K=J({__name:"NumberField",props:_e({id:{},name:{},label:{},placeholder:{},error:{},rules:{},inputProps:{},labelProps:{},minLength:{},maxLength:{},minValue:{},maxValue:{},compare:{},deleteButton:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(p){const a=p,t=$e(p,"modelValue"),y=P("");function g(){t.value=parseFloat(y.value)||0}return le(t,c=>{y.value=c.toString()},{immediate:!0}),(c,O)=>(D(),q(Y,Pe(a,{modelValue:y.value,"onUpdate:modelValue":O[0]||(O[0]=k=>y.value=k),"input-props":{...a.inputProps,type:"number"},onBlur:g}),null,16,["modelValue","input-props"]))}}),Xe={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ze={class:"flex gap-3"},et={class:"w-full flex gap-3"},tt={class:"flex gap-5"},at={class:"flex flex-col gap-3"},ot=J({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(p,{emit:a}){const t=p,y=a,g=te(),{categories:c,categoryOptions:O,isMutationLoading:k}=R(g),S=P(!1),m=de(n());function n(){var i;const d=((i=t.selectedBoodschap)==null?void 0:i.clone())??new G;return{name:d.name,category:c.value.find(r=>{var _;return r.id===((_=d.category)==null?void 0:_.id)})??null,size:d.size,buyLog:d.buyLog,isOutOfStock:d.isOutOfStock}}async function l(){const d=t.selectedBoodschap?t.selectedBoodschap:new G;Object.assign(d,m),t.selectedBoodschap?await g.updateBoodschap(d):await g.createBoodschap(d),y("close")}function s(){y("close")}function v(){S.value=!0,m.category={id:ce(),label:""}}function b(){S.value=!1,m.category=null}function u(){m.buyLog.push(new H)}return le(()=>t.isOpen,d=>{d?Object.assign(m,n()):S.value=!1}),(d,i)=>(D(),q(se,{"is-open":p.isOpen,title:t.selectedBoodschap?`Bewerk ${t.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":t.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":e(k),onConfirm:l,onCancel:s},{default:h(()=>[V("div",Xe,[o(Y,{name:"name",label:"Naam",modelValue:m.name,"onUpdate:modelValue":i[0]||(i[0]=r=>m.name=r)},null,8,["modelValue"]),V("div",Ze,[S.value?m.category?(D(),q(Y,{key:1,class:"w-full",name:"category",label:"Categorie",modelValue:m.category.label,"onUpdate:modelValue":i[2]||(i[2]=r=>m.category.label=r)},null,8,["modelValue"])):Le("",!0):(D(),q(pe,{key:0,class:"w-full",name:"category",label:"Categorie",modelValue:m.category,"onUpdate:modelValue":i[1]||(i[1]=r=>m.category=r),options:e(O)},null,8,["modelValue","options"])),S.value?(D(),q(N,{key:3,class:"h-fit place-self-end",icon:"pi pi-times","icon-only":"",variant:"neutral",onClick:b})):(D(),q(N,{key:2,class:"h-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",onClick:v}))]),V("div",et,[o(K,{name:"sizeValue",label:"Formaat",modelValue:m.size.value,"onUpdate:modelValue":i[3]||(i[3]=r=>m.size.value=r)},null,8,["modelValue"]),o(Y,{name:"sizeUnit",label:"Eenheid",modelValue:m.size.unit,"onUpdate:modelValue":i[4]||(i[4]=r=>m.size.unit=r)},null,8,["modelValue"])]),o(me,{name:"isOutOfStock",label:"Voorraad leeg",modelValue:m.isOutOfStock,"onUpdate:modelValue":i[5]||(i[5]=r=>m.isOutOfStock=r)},null,8,["modelValue"]),i[8]||(i[8]=V("b",null,"Logboek",-1)),o(e(Fe),{ref:"draggable",class:"flex flex-col gap-3",modelValue:m.buyLog,"onUpdate:modelValue":i[6]||(i[6]=r=>m.buyLog=r),itemKey:r=>r.date.toString(),handle:".drag-handle"},{item:h(({element:r,index:_})=>[o(e(Ue),null,{default:h(()=>[o(e(je),{value:"0"},{default:h(()=>[o(e(qe),{class:"drag-handle"},{default:h(()=>[V("div",tt,[i[7]||(i[7]=V("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),V("p",null,j(e(fe)(r.date)),1)])]),_:2},1024),o(e(Ne),null,{default:h(()=>[V("div",at,[o(Te,{name:`buylog-date-${_}`,label:"Datum",modelValue:r.date,"onUpdate:modelValue":C=>r.date=C,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),o(K,{name:`buylog-quantity-${_}`,label:"Aantal",modelValue:r.quantity,"onUpdate:modelValue":C=>r.quantity=C},null,8,["name","modelValue","onUpdate:modelValue"]),o(K,{name:`buylog-price-${_}`,label:"Prijs",modelValue:r.price,"onUpdate:modelValue":C=>r.price=C},null,8,["name","modelValue","onUpdate:modelValue"]),o(N,{variant:"danger",outlined:"",label:"Delete",onClick:C=>m.buyLog.splice(_,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),o(N,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:u})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),nt={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},lt=J({__name:"BuyLogAddDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(p,{emit:a}){const t=p,y=a,g=te(),{isMutationLoading:c}=R(g),O=de(k());function k(){var l;const n=(l=t.selectedBoodschap)!=null&&l.buyLog.length?t.selectedBoodschap.buyLog[t.selectedBoodschap.buyLog.length-1]:null;return{quantity:n?n.quantity:1,price:n?n.price:0}}async function S(){if(t.selectedBoodschap){const n=t.selectedBoodschap.clone();n.buyLog.push(new H(new Date,O.quantity,O.price)),n.isOutOfStock=!1,await g.updateBoodschap(n)}y("close")}async function m(){if(t.selectedBoodschap){const n=t.selectedBoodschap.clone();n.isOutOfStock=!1,await g.updateBoodschap(n)}y("close")}return le(()=>t.isOpen,n=>{n&&Object.assign(O,k())}),(n,l)=>(D(),q(se,{"is-open":p.isOpen,title:t.selectedBoodschap?"Aankoop toevoegen":"Geen product geselecteerd",description:t.selectedBoodschap?`Voeg een aankoop toe voor ${t.selectedBoodschap.name} (${t.selectedBoodschap.size.value} ${t.selectedBoodschap.size.unit})`:"Selecteer een product om een aankoop toe te voegen","cancel-text":"Overslaan","confirm-text":t.selectedBoodschap?"Toevoegen":"Annuleren","confirm-loading":e(c),onConfirm:S,onCancel:m},{default:h(()=>[V("div",nt,[o(K,{name:"buylog-quantity",label:"Aantal",modelValue:O.quantity,"onUpdate:modelValue":l[0]||(l[0]=s=>O.quantity=s)},null,8,["modelValue"]),o(K,{name:"buylog-price",label:"Prijs",modelValue:O.price,"onUpdate:modelValue":l[1]||(l[1]=s=>O.price=s)},null,8,["modelValue"])])]),_:1},8,["is-open","title","description","confirm-text","confirm-loading"]))}}),st=J({__name:"ProductPriceChart",props:{product:{}},setup(p){const a=p,t=M(()=>a.product.buyLog.map(c=>({date:c.date,value:c.price/c.quantity}))),{headers:y,filteredData:g}=Ge(t,He.MONTHS);return(c,O)=>(D(),q(We,{headers:e(y),datasets:[{label:"Prijsverloop",fill:!1,borderColor:"orange",yAxisID:"y",tension:.4,data:e(g),spanGaps:!0}]},null,8,["headers","datasets"]))}}),it={class:"flex justify-end"},rt={class:"flex gap-3 place-self-end"},ft=J({__name:"Boodschappen",setup(p){const a=te(),{categoryOptions:t,isFetchLoading:y,isMutationLoading:g}=R(a),c=Ae(Ie),{sortedBoodschappen:O,shortTermGroceries:k,getLatestPurchaseDate:S,getPricePerUnit:m,getPriceIncreasePercentage:n,getProjectedOutOfStockDate:l}=Qe(),s=c.greaterOrEqual("md"),v=P([]),b=P(null),u=P({name:{value:null,matchMode:"startsWith"},"category.label":{value:null,matchMode:"startsWith"}}),d=P(!1),i=P(!1),r=P(!1);async function _(z){if(z.isOutOfStock)b.value=z,r.value=!0;else{const w=z.clone();w.isOutOfStock=!z.isOutOfStock,await a.updateBoodschap(w)}}function C(z){v.value=[z.data]}function W(){b.value=null,i.value=!0}function A(z){b.value=z,i.value=!0}function E(z){b.value=z,d.value=!0}function ie(){b.value=null,i.value=!1}function Q(){b.value=null,r.value=!1}async function ge(){b.value&&await a.deleteBoodschap(b.value.id),d.value=!1,b.value=null}return Ee(()=>{a.fetchBoodschappen()}),(z,w)=>(D(),T(F,null,[o(Re,null,{content:h(()=>[o(Me,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"Sander's Boodschappentool",description:"Nu zul je nooit meer iets vergeten in de supermarkt!","description-props":{class:"text-white mb-5"}},{default:h(()=>[w[5]||(w[5]=V("ol",{class:"ms-3 list-decimal list-inside"},[V("li",null,"Voeg een product toe"),V("li",null,"Registreer wanneer je iets hebt gekocht"),V("li",null,"Weet automatisch wanneer je voorraad bijna op is!")],-1)),w[6]||(w[6]=V("h3",{class:"text-xl mt-10 mb-3 font-bold"},"Mijn boodschappenlijstje",-1)),w[7]||(w[7]=V("p",{class:"mb-3"},"Producten die bijna op zijn in één overzicht.",-1)),o(e(oe),{value:e(k),tableStyle:e(s)?"min-width: 40rem":void 0,loading:e(y),size:e(s)?void 0:"small"},{empty:h(()=>[...w[3]||(w[3]=[U(" Er zijn nog geen producten gevonden. ",-1)])]),default:h(()=>[o(e(x),{field:"name",header:"Naam"}),o(e(x),{header:"Voorraad aanvullen over"},{body:h(({data:f})=>[f.isOutOfStock?(D(),T(F,{key:0},[U(" 0 dagen ")],64)):(D(),T(F,{key:1},[U(j(e(l)(f)?`${e(ue)(e(l)(f))} dagen`:"Onbekend"),1)],64))]),_:1}),o(e(x),{header:"Voorraad leeg"},{body:h(({data:f})=>[o(me,{name:`outofstock-${f.id}`,"model-value":f.isOutOfStock,disabled:e(g),onClick:B=>_(f)},null,8,["name","model-value","disabled","onClick"])]),_:1})]),_:1},8,["value","tableStyle","loading","size"]),w[8]||(w[8]=V("h3",{class:"text-xl mt-10 mb-3 font-bold"}," Alle producten ",-1)),o(e(oe),{value:e(O),expandedRows:v.value,"onUpdate:expandedRows":w[0]||(w[0]=f=>v.value=f),filters:u.value,"onUpdate:filters":w[1]||(w[1]=f=>u.value=f),tableStyle:e(s)?"min-width: 40rem":void 0,loading:e(y),size:e(s)?void 0:"small",filterDisplay:"row",onRowExpand:C},{empty:h(()=>[...w[4]||(w[4]=[U(" Er zijn nog geen producten gevonden. ",-1)])]),expansion:h(({data:f})=>[o(e(oe),{value:[f],size:e(s)?void 0:"small"},{default:h(()=>[o(e(x),{class:"!border-0",field:"size.value",header:"Formaat"},{body:h(({data:B})=>[U(j(B.size.value)+" "+j(B.size.unit),1)]),_:2},1024),o(e(x),{class:"!border-0",header:"Laatste aankoop"},{body:h(({data:B})=>[e(S)(B)?(D(),T(F,{key:1},[U(j(e(fe)(e(S)(B))),1)],64)):(D(),T(F,{key:0},[U(" Nog niet gekocht ")],64))]),_:2},1024),o(e(x),{class:"!border-0",header:"Prijs"},{body:h(({data:B})=>[U(j(e(m)(B)?`€${e(m)(B).toFixed(2)}`:""),1)]),_:2},1024),o(e(x),{class:"!border-0",header:"Prijsstijging"},{body:h(({data:B})=>[V("span",{class:ne(e(n)(B)>0?"text-red-500":e(n)(B)<0?"text-green-500":"")},j(e(n)(B)?`${e(n)(B).toFixed(2)}%`:""),3)]),_:2},1024)]),_:2},1032,["value","size"]),o(st,{class:ne(e(s)?"max-h-[50vh]":"max-w-fit"),product:f},null,8,["class","product"])]),default:h(()=>[o(e(x),{class:ne({"w-[5rem]":e(s)}),expander:""},null,8,["class"]),o(e(x),{field:"name",header:"Naam"},{filter:h(({filterModel:f,filterCallback:B})=>[o(Y,{name:"nameFilter",modelValue:f.value,"onUpdate:modelValue":I=>f.value=I,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:B},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),o(e(x),{field:"category.label",header:"Categorie",showFilterMenu:!1},{filter:h(({filterModel:f,filterCallback:B})=>[o(pe,{name:"categoryFilter",modelValue:f.value,"onUpdate:modelValue":[I=>f.value=I,B],options:e(t).map(I=>{var re;return{...I,value:((re=I.value)==null?void 0:re.label)??null}}),placeholder:"Filter...",style:{"min-width":"5rem"}},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),o(e(x),{header:"Voorraad aanvullen over"},{body:h(({data:f})=>[f.isOutOfStock?(D(),T(F,{key:0},[U(" 0 dagen ")],64)):(D(),T(F,{key:1},[U(j(e(l)(f)?`${e(ue)(e(l)(f))} dagen`:"Onbekend"),1)],64))]),_:1}),o(e(x),null,{filter:h(()=>[V("div",it,[o(N,{class:"w-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",loading:e(g),onClick:W},null,8,["loading"])])]),body:h(({data:f})=>[V("div",rt,[o(N,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:e(g),onClick:B=>A(f)},null,8,["loading","onClick"]),o(N,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:e(g),onClick:B=>E(f)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","tableStyle","loading","size"]),o(N,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:e(g),onClick:W},null,8,["loading"])]),_:1})]),_:1}),o(ot,{"is-open":i.value,selectedBoodschap:b.value,onClose:ie},null,8,["is-open","selectedBoodschap"]),o(lt,{"is-open":r.value,"selected-boodschap":b.value,onClose:Q},null,8,["is-open","selected-boodschap"]),o(se,{title:"Product verwijderen","is-open":d.value,description:[b.value?`Weet je zeker dat je het product '${b.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":e(g),onConfirm:ge,onCancel:w[2]||(w[2]=f=>d.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{ft as default};
