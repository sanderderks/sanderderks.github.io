import{e as Ae,f as ke,a9 as Re,s as Y,l as U,t as K,E as Te,k as R,ac as Ve,m as be,H as pe,x as Ne,w as se,q as Ce,R as De,J as Le,d as ye,aT as ae,r as E,a as Ie,c as y,o as re,aU as C,N as Pe,aV as F,c_ as we,aW as Oe,aZ as ce,aX as fe,aY as Me,c0 as Be,cI as xe,n as $e,af as le}from"../bundle.js";import{a as We}from"./c-Bubble.vue_vue_type_script_setup_true_lang-BKzNF-TX.js";import{_ as he,a as Ue}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-E4RvhRYK.js";import{_ as me}from"./c-SelectField.vue_vue_type_script_setup_true_lang-DIXoT02e.js";const tl=Ae({__name:"PleaseLogin",props:{action:{},redirect:{}},setup(e){const u=ke(),p=Re(),{language:H}=Y(p);return(k,N)=>(U(),K(We,{class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:Te(()=>[R(H)===R(Ve).EN?(U(),be(Ne,{key:0},[pe(" Please ")],64)):se("",!0),Ce("a",{class:"cursor-pointer",onClick:N[0]||(N[0]=_=>R(u).push({name:R(De).LOGIN,params:{redirect:JSON.stringify({name:k.redirect})}}))}," Login "),pe(" "+Le(k.action),1)]),_:1}))}});var Fe=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Fe||{});const ie={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Ye=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Ye||{}),je=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(je||{});const Ze={easy:.5,hard:1},ge=()=>{const e=Je();return we(e),{pile1:e.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:e.splice(0,2).map((u,p)=>p<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:e.splice(0,3).map((u,p)=>p<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:e.splice(0,4).map((u,p)=>p<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:e.splice(0,5).map((u,p)=>p<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:e.splice(0,6).map((u,p)=>p<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:e.splice(0,7).map((u,p)=>p<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:e.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},qe=ye("patienceStore",()=>{const e=ae(),{personalBest:u,highscorePosition:p}=Y(e),{setPreviousHighscores:H,updateHighscores:k,sortHighscores:N}=e,_=E("hard"),r=E(0),T=E(0),f=E(0),h=E(0),v=E(0),m=E(),g=E(!0),c=Ie(ge()),D=y(()=>Ze[_.value]),L=y(()=>Object.keys(c).flatMap(l=>c[l])),P=1e3,z=10,M=10,B=y(()=>{const l=f.value%10===0?f.value:Math.floor(f.value/10)*10,o=T.value*z,n=v.value*z,i=l+o+n,S=h.value*M;return Math.max(0,P-(i-S))}),I=y(()=>{const l=Math.floor(f.value/60),o=f.value%60;return`${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")}`}),x=y(()=>c.hearts.length===13&&c.spades.length===13&&c.diamonds.length===13&&c.clubs.length===13);re(()=>{e.$init(C.PATIENCE),f.value&&r.value===1&&V()}),Pe(x,l=>{l&&r.value!==2&&($(),r.value=2,de(),F(Oe))});const oe=()=>{$(),T.value=0,f.value=0,h.value=0,v.value=0,r.value=0,Object.assign(c,ge()),e.setPreviousHighscores()},te=()=>{f.value=0,V(),r.value=1,setTimeout(()=>{a()},500)},V=()=>{m.value&&$(),m.value=setInterval(()=>{f.value++},1e3)},$=()=>{clearInterval(m.value)},X=()=>{const l=c.stock_open;l.length&&(l.reverse(),b(l[0],!1,o=>{o.deck="stock_closed",o.hidden=!0,c.stock_closed.push(o)}),l.splice(0,l.length),s(1))},Q=l=>{const o=l.deck,n=L.value.filter(i=>i.selected);if(o==="stock_closed"){const i=c.stock_closed,S=i.indexOf(l);if(S===i.length-1){const w=_.value==="hard"?S-2:S,O=w<0?0:w,ue=i.filter((ve,He)=>He>=O);W(),q(ue,"stock_open",ve=>{ve.hidden=!1}),s(0)}}else if(o==="stock_open"){const i=c.stock_open;i.indexOf(l)===i.length-1&&(l.selected=!l.selected,n.length&&b(n[0],!1))}else if(n.length){const i=n[0];i===l?b(l,!1):ee(o)&&d(i,l)?l.value===i.value+1&&l.deck!==i.deck&&(q(n,o),i.deck==="stock_open"?s(2):s(4)):n.length===1&&ne(o)&&A(i,l)&&l.value===i.value-1&&(Z(i,o),s(3),i.hasBeenHome=!0)}else b(l,!0)},G=l=>{const o=L.value.filter(n=>n.selected);if(o.length){const n=o[0],i=n.deck;n.value===13&&(q(o,l),i==="stock_open"?s(2):ee(n.deck)&&c[n.deck].every(S=>!S.hidden)?s(5):s(4))}},j=l=>{const o=L.value.filter(n=>n.selected);if(o.length===1){const n=o[0],i=n.type;!c[l].length&&i===l&&n.value===1&&(Z(n,l),s(3))}},b=(l,o,n)=>{const i=c[l.deck],S=i.indexOf(l);i.filter((O,ue)=>ue>=S).forEach(O=>{O.selected=o,n==null||n(O)})},W=()=>{L.value.forEach(l=>{l.selected=!1})},Z=(l,o)=>{const n=l.deck,i=c[n].indexOf(l);l.deck=o,l.selected=!1,c[o].push(l),c[n].splice(i,1),(ee(n)||n==="stock_open")&&t(n)},q=(l,o,n)=>{const i=l[0],S=i.deck,w=c[S].indexOf(i);b(i,!1,O=>{O.deck=o,n==null||n(O),c[o].push(O)}),c[S].splice(w,l.length),ne(S)||t(S!=="stock_closed"?S:o)},J=l=>{if(!g.value)return!0;const o=c[l.type],n=o.length?o[o.length-1].value:0;if(l.value===n+1){const i=["hearts","spades","diamonds","clubs"],S=n<=1||i.every(w=>{const O=c[w];return(O.length?O[O.length-1].value:0)>=n});if(n===0||S)return Z(l,l.type),l.hasBeenHome=!0,s(3),!0}return!1},a=()=>{if(g.value)for(const l of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const o=c[l];if(o.length&&J(o[o.length-1]))return}},t=l=>{const o=c[l];if(o.length){const n=o[o.length-1],i=n.deck;n.hidden=!1,setTimeout(()=>{n.deck===i&&(J(n)||a())},500)}else setTimeout(()=>{a()},500)},s=l=>{switch(l!==5&&T.value++,l){case 0:{v.value+=2*D.value;break}case 1:{v.value+=5*D.value;break}case 2:{h.value+=10*D.value;break}case 3:{h.value+=20*D.value;break}}F(ce)},d=(l,o)=>l.color!==o.color,A=(l,o)=>l.type===o.type,ee=l=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(l),ne=l=>["hearts","spades","diamonds","clubs"].includes(l),de=()=>{k({difficulty:_.value,score:B.value,bonus:h.value,time:f.value,turns:T.value,penalty:v.value})};return{difficulty:_,gameStatus:r,score:B,turns:T,time:f,bonus:h,penalty:v,cards:c,doAutocomplete:g,allCards:L,formattedTime:I,personalBest:u,highscorePosition:p,$reset:oe,start:te,shuffle:X,selectCard:Q,selectEmptyDeck:G,selectFinalDeck:j,deselectAllCards:W,isPlayDeck:ee,isFinalDeck:ne,setPreviousHighscores:H,updatePatienceHighscore:de,sortHighscores:N}},{persist:{enabled:!0}}),Je=()=>Object.keys(ie).flatMap(e=>{const u=e,p=[];for(let H=0;H<13;H++){const k={type:u,label:ie[u].label,color:ie[u].color,value:H+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(k)}return p});var Ke=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_THROWN_DICES=2]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=3]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=4]="HAS_CHOSEN_TILE",e[e.HAS_LOST=5]="HAS_LOST",e[e.HAS_FINISHED=6]="HAS_FINISHED",e))(Ke||{}),ze=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(ze||{}),Xe=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.LOSER=3]="LOSER",e))(Xe||{}),Qe=(e=>(e[e.PLAYER=0]="PLAYER",e[e.ROBOT=1]="ROBOT",e))(Qe||{});const Ge=e=>{for(let u=1;u<=6;u++)if(e.every(p=>p.value===u))return!0;return!1},Se=()=>({0:[],1:[]}),el=ye("rainwormsStore",()=>{const e=ae(),{personalBest:u,highscorePosition:p}=Y(e),{setPreviousHighscores:H,updateHighscores:k,sortHighscores:N}=e,_=E(1),r=E(0),T=E(0),f=E(0),h=E(0),v=E(0),m=E(Ee()),g=E(_e()),c=Ie(Se()),D=y(()=>m.value.some(a=>a.isRolling)),L=y(()=>m.value.filter(a=>a.selected).some(a=>a.value===6)),P=y(()=>a=>m.value.some(t=>t.value===a&&t.selected)),z=y(()=>a=>g.value.some(t=>t.displayValue<=a)),M=y(()=>a=>v.value===(a??0)),B=y(()=>a=>{const t=c[a??0];return t.length?t[t.length-1]:null}),I=y(()=>{let a=0;return m.value.filter(t=>t.selected).forEach(t=>{a+=t.value===6?5:t.value}),a}),x=y(()=>a=>{let t=0;return c[a].forEach(s=>{t+=s.value}),t});re(()=>{e.$init(C.RAINWORMS)});const oe=()=>{r.value=0,T.value=0,f.value=0,h.value=0,v.value=0,m.value=Ee(),g.value=_e(),Object.assign(c,Se()),H()},te=()=>{r.value=1},V=a=>{if(!M.value(a))return;(r.value===1||r.value===4||r.value===5)&&m.value.forEach(s=>{s.selected=!1}),r.value=2;const t=e.diceRollSpeed*1e3;m.value.forEach(s=>{s.selected||(s.isRolling=!0,setTimeout(()=>{s.value=fe(6),s.isRolling=!1,m.value.sort((d,A)=>d.value-A.value),!D.value&&r.value!==5&&X()&&Q(a)},fe(t,t/3)))}),F(Me)},$=async()=>{for(;D.value;)await new Promise(a=>setTimeout(a,500));return!0},X=()=>{const a=m.value.filter(t=>!t.selected&&!P.value(t.value));return!a.length||Ge(a)&&a.every(t=>t.value!==6)},Q=a=>{r.value=5,T.value=a??0,c[T.value].length?h.value=1:h.value=2,G(),g.value.length===0?r.value=6:W()},G=()=>{const a=c[v.value];if(a.length){const t=a.splice(a.length-1,1)[0];g.value.push(t),g.value.sort((s,d)=>s.displayValue-d.displayValue)}g.value.splice(g.value.length-1,1)},j=(a,t)=>{M.value(t)&&!D.value&&r.value===2&&!a.selected&&!P.value(a.value)&&(r.value=3,m.value.filter(s=>s.value===a.value).forEach(s=>{s.selected=!0}),F(ce))},b=(a,t,s)=>{if(M.value(s)&&(r.value===2||r.value===3)){if(r.value=4,T.value=s??0,t){const d=c[v.value===0?1:0];d.splice(d.length-1,1)}else g.value=g.value.filter(d=>d.displayValue!==a.displayValue);c[v.value].push(a),F(ce),g.value.length===0?r.value=6:W()}},W=a=>{(v.value===1||r.value!==5||a)&&(v.value===0?setTimeout(()=>{v.value=1,setTimeout(()=>{r.value=1,T.value=0},1e3)},a?0:_.value*1e3*2):setTimeout(()=>{v.value=0},a?0:_.value*1e3*2))},Z=async()=>{switch(r.value){case 1:{V(1);break}case 2:{await $(),setTimeout(()=>{const a=m.value.filter(s=>!s.selected),t=B.value(0);if(t&&I.value<t.displayValue)for(let s=6;s>=1;s--){const d=a.filter(A=>A.value===s&&!P.value(s));if(d.length){const A=d.length*(s===6?5:s);if(I.value+A===t.displayValue){j(d[0],1);return}}}for(let s=6;s>=1;s--){const d=m.value.find(A=>A.value===s);if(d&&!P.value(s)){j(d,1);return}}},_.value*1e3);break}case 3:{setTimeout(()=>{const a=B.value(0),t=m.value.filter(s=>!s.selected).length;if(!t||I.value>=30){console.log(t?"i am rich":"i can only pick a tile now");for(let s=I.value;s>=21;s--){const d=g.value.find(A=>A.displayValue===s);if(d){b(d,!1,1);return}}t&&V(1)}if(g.value.every(s=>s.displayValue>I.value)&&a&&a.displayValue>I.value)console.log("my score is too low"),V(1);else if(a&&a.displayValue===I.value)console.log("i can steal"),b(a,!0,1);else if(new Set(m.value.filter(s=>s.selected).map(s=>s.value)).size<=3)if(m.value.filter(s=>!s.selected).length<=2){console.log("there aren't that much dices left");const s=g.value.filter(d=>d.displayValue>=I.value-5&&d.displayValue<=I.value).sort((d,A)=>A.displayValue-d.displayValue);s.length?(console.log("i choose the highest score within 5 tiles"),b(s[0],!1,1)):(console.log("i choose to roll again"),V(1))}else console.log("i have nothing to worry about"),V(1);else if(!L.value)console.log("i am worrying and have no worm yet"),V(1);else{console.log("if i can choose, i choose");const s=g.value.filter(d=>d.displayValue<=I.value).sort((d,A)=>A.displayValue-d.displayValue);s.length?(console.log("i choose the highest score"),b(s[0],!1,1)):(console.log("i choose to roll again"),V(1))}},_.value*1e3);break}default:console.log("DEFAULT",r.value)}},q=()=>{const a=x.value(0),t=x.value(1);a>t?f.value=1:a===t&&Math.max(...c[0].map(s=>s.displayValue))>Math.max(...c[1].map(s=>s.displayValue))?f.value=2:f.value=3,(f.value===1||f.value===2)&&(J(),F(Oe))},J=()=>{k({score:x.value(0)})};return{gameStatus:r,gameStatusActivator:T,finishStatus:f,loseStatus:h,activePlayer:v,dices:m,tiles:g,score:c,robotSpeed:_,isRolling:D,hasWorm:L,hasAlreadyChosen:P,canSelectAnyTile:z,canPlay:M,visibleTile:B,selectedDiceTotal:I,totalScore:x,personalBest:u,highscorePosition:p,$reset:oe,start:te,roll:V,hasFinishedRolling:$,hasLostRound:X,loseTurn:Q,popLastTile:G,selectDice:j,selectTile:b,passTurn:W,playRobot:Z,checkFinishStatus:q,setPreviousHighscores:H,updateRainwormsHighscore:J,sortHighscores:N}},{persist:{enabled:!0}}),Ee=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],_e=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],nl=Ae({__name:"GameSettingsDialog",props:Be({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const u=e,p=xe(e,"isOpen"),H=ae(),{useAudio:k,diceRollSpeed:N}=Y(ae()),{robotSpeed:_}=Y(el()),{doAutocomplete:r}=Y(qe()),T=y(()=>{switch(u.gameId){case C.YAHTZEE:return"v5 (12-12-2024)";case C.RAINWORMS:return"v5 (12-12-2024)";case C.PATIENCE:return"v2 (16-12-2024)";case C.GUESS_THE_WORD:return"v2 (10-01-2025)"}});return re(()=>{H.$init(u.gameId)}),(f,h)=>(U(),K(Ue,{isOpen:p.value,title:"Game Settings",description:f.gameId?`Current version: ${T.value}`:"General settings",cancelText:"Close",onCancel:h[4]||(h[4]=v=>p.value=!1)},{default:Te(()=>[$e(he,{name:"useAudio",label:"Audio",modelValue:R(k),"onUpdate:modelValue":h[0]||(h[0]=v=>le(k)?k.value=v:null)},null,8,["modelValue"]),f.gameId===R(C).PATIENCE?(U(),K(he,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:R(r),"onUpdate:modelValue":h[1]||(h[1]=v=>le(r)?r.value=v:null)},null,8,["modelValue"])):se("",!0),f.gameId===R(C).YAHTZEE||f.gameId===R(C).RAINWORMS?(U(),K(me,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:R(N),"onUpdate:modelValue":h[2]||(h[2]=v=>le(N)?N.value=v:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):se("",!0),f.gameId===R(C).RAINWORMS?(U(),K(me,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:R(_),"onUpdate:modelValue":h[3]||(h[3]=v=>le(_)?_.value=v:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):se("",!0)]),_:1},8,["isOpen","description"]))}});export{Fe as C,Ye as D,Xe as F,Ke as G,ze as L,Qe as P,tl as _,nl as a,qe as b,je as c,el as u};
