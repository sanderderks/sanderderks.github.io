import{_ as xe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-B1iNImaq.js";import{aU as Ge,aV as pe,s as Z,w as O,a9 as we,f as H,o as Ne,aS as V,L as Te,aW as ae,b7 as Ue,aX as Me,b8 as _e,aR as Be,c as Fe,aQ as F,b2 as je,b3 as Ye,b4 as ze,d as Ke,b5 as Ze,b6 as qe,l as ve,j as de,A as Qe,k as Xe,m as Ee,h as j,an as fe,U as Ce,T as ye}from"../bundle.js";var Je=(l=>(l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(Je||{});const Ae={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var el=(l=>(l.STOCK_CLOSED="stock_closed",l.STOCK_OPEN="stock_open",l.PILE1="pile1",l.PILE2="pile2",l.PILE3="pile3",l.PILE4="pile4",l.PILE5="pile5",l.PILE6="pile6",l.PILE7="pile7",l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(el||{}),ll=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.HAS_STARTED=1]="HAS_STARTED",l[l.HAS_FINISHED=2]="HAS_FINISHED",l))(ll||{});const sl={easy:.5,hard:1},Pe=()=>{const l=tl();return Ue(l),{pile1:l.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:l.splice(0,2).map((u,m)=>m<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:l.splice(0,3).map((u,m)=>m<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:l.splice(0,4).map((u,m)=>m<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:l.splice(0,5).map((u,m)=>m<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:l.splice(0,6).map((u,m)=>m<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:l.splice(0,7).map((u,m)=>m<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:l.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},al=Ge("patienceStore",()=>{const l=pe(),{personalBest:u,highscorePosition:m}=Z(l),{setPreviousHighscores:M,updateHighscores:W,sortHighscores:k}=l,D=O("hard"),C=O(0),G=O(0),I=O(0),E=O(0),A=O(0),te=O(),q=O(!0),d=we(Pe()),Q=H(()=>sl[D.value]),Y=H(()=>Object.keys(d).flatMap(s=>d[s])),me=1e3,ne=10,he=10,ie=H(()=>{const s=I.value%10===0?I.value:Math.floor(I.value/10)*10,a=G.value*ne,t=A.value*ne,n=s+a+t,S=E.value*he;return Math.max(0,me-(n-S))}),ce=H(()=>{const s=Math.floor(I.value/60),a=I.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),ge=H(()=>d.hearts.length===13&&d.spades.length===13&&d.diamonds.length===13&&d.clubs.length===13);Ne(()=>{l.$init(V.PATIENCE),I.value&&C.value===1&&y()}),Te(ge,s=>{s&&C.value!==2&&(v(),C.value=2,le(),ae(Me))});const Se=()=>{v(),G.value=0,I.value=0,E.value=0,A.value=0,C.value=0,Object.assign(d,Pe()),l.setPreviousHighscores()},$=()=>{I.value=0,y(),C.value=1,setTimeout(()=>{h()},500)},y=()=>{te.value&&v(),te.value=setInterval(()=>{I.value++},1e3)},v=()=>{clearInterval(te.value)},X=()=>{const s=d.stock_open;s.length&&(s.reverse(),f(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,d.stock_closed.push(a)}),s.splice(0,s.length),T(1))},x=s=>{const a=s.deck,t=Y.value.filter(n=>n.selected);if(a==="stock_closed"){const n=d.stock_closed,S=n.indexOf(s);if(S===n.length-1){const B=D.value==="hard"?S-2:S,N=B<0?0:B,se=n.filter((oe,w)=>w>=N);R(),p(se,"stock_open",oe=>{oe.hidden=!1}),T(0)}}else if(a==="stock_open"){const n=d.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,t.length&&f(t[0],!1))}else if(t.length){const n=t[0];n===s?f(s,!1):ee(a)&&re(n,s)?s.value===n.value+1&&s.deck!==n.deck&&(p(t,a),n.deck==="stock_open"?T(2):T(4)):t.length===1&&U(a)&&K(n,s)&&s.value===n.value-1&&(z(n,a),T(3),n.hasBeenHome=!0)}else f(s,!0)},J=s=>{const a=Y.value.filter(t=>t.selected);if(a.length){const t=a[0],n=t.deck;t.value===13&&(p(a,s),n==="stock_open"?T(2):ee(t.deck)&&d[t.deck].every(S=>!S.hidden)?T(5):T(4))}},r=s=>{const a=Y.value.filter(t=>t.selected);if(a.length===1){const t=a[0],n=t.type;!d[s].length&&n===s&&t.value===1&&(z(t,s),T(3))}},f=(s,a,t)=>{const n=d[s.deck],S=n.indexOf(s);n.filter((N,se)=>se>=S).forEach(N=>{N.selected=a,t==null||t(N)})},R=()=>{Y.value.forEach(s=>{s.selected=!1})},z=(s,a)=>{const t=s.deck,n=d[t].indexOf(s);s.deck=a,s.selected=!1,d[a].push(s),d[t].splice(n,1),(ee(t)||t==="stock_open")&&P(t)},p=(s,a,t)=>{const n=s[0],S=n.deck,B=d[S].indexOf(n);f(n,!1,N=>{N.deck=a,t==null||t(N),d[a].push(N)}),d[S].splice(B,s.length),U(S)||P(S!=="stock_closed"?S:a)},g=s=>{if(!q.value)return!0;const a=d[s.type],t=a.length?a[a.length-1].value:0;if(s.value===t+1){const n=["hearts","spades","diamonds","clubs"],S=t<=1||n.every(B=>{const N=d[B];return(N.length?N[N.length-1].value:0)>=t});if(t===0||S)return z(s,s.type),s.hasBeenHome=!0,T(3),!0}return!1},h=()=>{if(q.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=d[s];if(a.length&&g(a[a.length-1]))return}},P=s=>{const a=d[s];if(a.length){const t=a[a.length-1],n=t.deck;t.hidden=!1,setTimeout(()=>{t.deck===n&&(g(t)||h())},500)}else setTimeout(()=>{h()},500)},T=s=>{switch(s!==5&&G.value++,s){case 0:{A.value+=2*Q.value;break}case 1:{A.value+=5*Q.value;break}case 2:{E.value+=10*Q.value;break}case 3:{E.value+=20*Q.value;break}}ae(_e)},re=(s,a)=>s.color!==a.color,K=(s,a)=>s.type===a.type,ee=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),U=s=>["hearts","spades","diamonds","clubs"].includes(s),le=()=>{W({difficulty:D.value,score:ie.value,bonus:E.value,time:I.value,turns:G.value,penalty:A.value})};return{difficulty:D,gameStatus:C,score:ie,turns:G,time:I,bonus:E,penalty:A,cards:d,doAutocomplete:q,allCards:Y,formattedTime:ce,personalBest:u,highscorePosition:m,$reset:Se,start:$,shuffle:X,selectCard:x,selectEmptyDeck:J,selectFinalDeck:r,deselectAllCards:R,isPlayDeck:ee,isFinalDeck:U,setPreviousHighscores:M,updatePatienceHighscore:le,sortHighscores:k}},{persist:{enabled:!0}}),tl=()=>Object.keys(Ae).flatMap(l=>{const u=l,m=[];for(let M=0;M<13;M++){const W={type:u,label:Ae[u].label,color:Ae[u].color,value:M+1,hidden:!1,selected:!1,hasBeenHome:!1};m.push(W)}return m});var ol=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.HAS_STARTED=2]="HAS_STARTED",l[l.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",l[l.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",l[l.HAS_LOST=6]="HAS_LOST",l[l.HAS_FINISHED=7]="HAS_FINISHED",l))(ol||{}),ul=(l=>(l[l.NONE=0]="NONE",l[l.HAS_LOST_TILE=1]="HAS_LOST_TILE",l[l.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",l))(ul||{}),nl=(l=>(l[l.NONE=0]="NONE",l[l.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",l[l.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",l[l.LOSER=3]="LOSER",l))(nl||{});const il=l=>{for(let u=1;u<=6;u++)if(l.every(m=>m.value===u))return!0;return!1},cl=Ge("rainwormsStore",()=>{const l=pe(),u=Be(),m=Fe(),{personalBest:M,highscorePosition:W}=Z(l),{firebaseUser:k}=Z(m),{onlineGames:D,onlineGamesLoading:C,onlineGameId:G,onlineGameCreatorId:I,onlineGamePlayers:E,onlineGameOpponents:A,onlineGameChat:te,isInitializingOnlineGame:q,isOnlineGameOwner:d}=Z(u),{fetchOnlineGames:Q,createOnlineGame:Y,continueOnlineGame:me,updateOnlineGame:ne,leaveOnlineGame:he,deleteOnlineGame:ie}=u,{setPreviousHighscores:ce,updateHighscores:ge,sortHighscores:Se}=l,$=O(1),y=O(F.SOLO),v=O(0),X=O(!1),x=O(0),J=O(0),r=O("soloPlayer"),f=O(r.value),R=O(r.value),z=O(!1),p=O(Le()),g=O(De()),h=we({}),P=H(()=>{var e;return y.value===F.SOLO?"robot":((e=A.value[0])==null?void 0:e.userId)??r.value}),T=H(()=>p.value.some(e=>e.isRolling)),re=H(()=>p.value.filter(e=>e.selected).some(e=>e.value===6)),K=H(()=>e=>p.value.some(o=>o.value===e&&o.selected)),ee=H(()=>g.value.some(e=>e.displayValue<=s.value)),U=H(()=>(e=r.value)=>f.value===e),le=H(()=>(e=r.value)=>{const o=h[e];return o.length?o[o.length-1]:null}),s=H(()=>{let e=0;return p.value.filter(o=>o.selected).forEach(o=>{e+=o.value===6?5:o.value}),e}),a=H(()=>e=>{let o=0;return h[e].forEach(c=>{o+=c.value}),o});Ne(()=>{l.$init(V.RAINWORMS),T.value&&p.value.forEach(e=>{e.isRolling=!1})}),Te(v,e=>{e===7?$e():y.value===F.SOLO&&(z.value||f.value==="robot")&&We(f.value)}),Te([v,f,T],()=>{y.value===F.ONLINE&&N()},{deep:!0});const t=()=>{u.$reset(),y.value=F.SOLO,v.value=0,x.value=0,J.value=0,r.value="soloPlayer",f.value=r.value,R.value=r.value,p.value=Le(),g.value=De(),Object.keys(h).forEach(e=>{delete h[e]}),ce()},n=()=>{y.value=F.SOLO,v.value=2,h[r.value]=[],h[P.value]=[]},S=e=>{k.value&&(e=[{userId:k.value.uid,isOnline:!0},...e],y.value=F.ONLINE,v.value=2,r.value=k.value.uid,f.value=r.value,R.value=r.value,e.forEach(o=>{h[o.userId]=[]}),u.$init(V.RAINWORMS,oe,se,t),Y(e))},B=e=>{k.value&&(y.value=F.ONLINE,r.value=k.value.uid,u.$init(V.RAINWORMS,oe,se,t),me(e))},N=()=>{console.log("updateOnlineGameCustom.1"),!(!k.value||f.value!==r.value&&!X.value&&!q.value)&&(console.log("updateOnlineGameCustom.2"),ne())},se=()=>({gameStatus:v.value,gameStatusActivator:R.value,activePlayer:f.value,dices:p.value,tiles:g.value,score:h}),oe=e=>{var c;console.log("updateLocalGameState.1");const o=(c=k.value)==null?void 0:c.uid;!o||f.value===r.value&&!q.value||(console.log("updateLocalGameState.2"),v.value=e.gameStatus,R.value=e.gameStatusActivator,f.value=e.activePlayer,p.value=e.dices,g.value=e.tiles,Object.assign(h,e.score),Object.keys(h).includes(o)||(h[o]=[]))},w=(e=r.value)=>{if(!U.value(e))return;(v.value===2||v.value===5||v.value===6)&&p.value.forEach(c=>{c.selected=!1}),v.value=3;const o=l.diceRollSpeed*1e3;p.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=je(6),c.isRolling=!1,p.value.sort((b,i)=>b.value-i.value),!T.value&&v.value!==6&&He()&&ke(e)},Ye(o,o/3)))}),ae(ze)},be=async()=>{for(;T.value;)await new Promise(e=>setTimeout(e,l.diceRollSpeed*1e3));return!0},He=()=>{const e=p.value.filter(o=>!o.selected&&!K.value(o.value));return!e.length||il(e)&&e.every(o=>o.value!==6)&&p.value.filter(o=>o.selected).every(o=>o.value!==6)},ke=(e=r.value)=>{v.value=6,R.value=e,h[R.value].length?J.value=1:J.value=2,Re(),g.value.length===0?v.value=7:Ie()},Re=()=>{const e=h[f.value];if(e.length){const o=e.splice(e.length-1,1)[0];g.value.push(o),g.value.sort((c,b)=>c.displayValue-b.displayValue)}g.value.splice(g.value.length-1,1)},Oe=(e,o=r.value)=>{U.value(o)&&!T.value&&v.value===3&&!e.selected&&!K.value(e.value)&&(v.value=4,p.value.filter(c=>c.value===e.value).forEach(c=>{c.selected=!0}),ae(_e))},ue=(e,o,c=r.value)=>{if(U.value(c)&&(v.value===3||v.value===4)){if(o){const b=h[P.value];b.splice(b.length-1,1)}else g.value=g.value.filter(b=>b.displayValue!==e.displayValue);h[f.value].push(e),g.value.length===0?v.value=7:(v.value=5,R.value=c,Ie()),ae(_e)}},Ie=e=>{(z.value||f.value!==r.value||v.value!==6||e)&&(f.value===r.value?setTimeout(()=>{X.value=!0,f.value=P.value,setTimeout(()=>{v.value=2,R.value=r.value,X.value=!1},$.value*1e3)},e?0:$.value*1e3*2):setTimeout(()=>{const o=f.value;f.value=r.value,setTimeout(()=>{v.value=2,R.value=o},$.value*1e3)},e?0:$.value*1e3*2))},We=async e=>{if(await new Promise(c=>setTimeout(c,5)),!U.value(e))return;const o=e===r.value?P.value:r.value;switch(v.value){case 2:{w(e);break}case 3:{await be(),setTimeout(()=>{const c=p.value.filter(i=>!i.selected),b=le.value(o);if(b&&s.value<b.displayValue)for(let i=6;i>=1;i--){const _=c.filter(L=>L.value===i&&!K.value(i));if(_.length){const L=_.length*(i===6?5:i);if(s.value+L===b.displayValue){Oe(_[0],e);return}}}for(let i=6;i>=1;i--){const _=p.value.find(L=>L.value===i);if(_&&!K.value(i)){Oe(_,e);return}}},$.value*1e3);break}case 4:{setTimeout(()=>{const c=le.value(o),b=p.value.filter(i=>!i.selected).length;if(!b||s.value>=30){b?console.log(e,"i am rich"):console.log(e,"i can only pick a tile now");for(let i=s.value;i>=21;i--){const _=g.value.find(L=>L.displayValue===i);if(_){ue(_,!1,e);return}}b&&w(e)}if(g.value.every(i=>i.displayValue>s.value)&&c&&c.displayValue>s.value)console.log(e,"my score is too low"),w(e);else if(c&&c.displayValue===s.value)console.log(e,"i can steal"),ue(c,!0,e);else if(new Set(p.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(p.value.filter(i=>!i.selected).length<=2){console.log(e,"there aren't that much dices left");const i=g.value.filter(_=>_.displayValue>=s.value-5&&_.displayValue<=s.value).sort((_,L)=>L.displayValue-_.displayValue);i.length?(console.log(e,"i choose the highest score within 5 tiles"),ue(i[0],!1,e)):(console.log(e,"i choose to roll again"),w(e))}else console.log(e,"i have nothing to worry about"),w(e);else if(!re.value)console.log(e,"i am worrying and have no worm yet"),w(e);else{console.log(e,"if i can choose, i choose");const i=g.value.filter(_=>_.displayValue<=s.value).sort((_,L)=>L.displayValue-_.displayValue);i.length?(console.log(e,"i choose the highest score"),ue(i[0],!1,e)):(console.log(e,"i choose to roll again"),w(e))}},$.value*1e3);break}default:console.log(e,"DEFAULT",v.value)}},$e=()=>{const e=a.value(r.value),o=a.value(P.value);e>o?x.value=1:e===o&&Math.max(...h[r.value].map(c=>c.displayValue))>Math.max(...h[P.value].map(c=>c.displayValue))?x.value=2:x.value=3,(x.value===1||x.value===2)&&(Ve(),ae(Me))},Ve=()=>{ge({gameId:G.value??null,score:a.value(r.value)})};return{gameType:y,gameStatus:v,gameStatusLoading:X,myPlayerId:r,opponentId:P,gameStatusActivatorId:R,finishStatus:x,loseStatus:J,activePlayerId:f,isFullyAutomatic:z,dices:p,tiles:g,score:h,robotSpeed:$,isRolling:T,hasWorm:re,hasAlreadyChosen:K,canSelectAnyTile:ee,canPlay:U,visibleTile:le,selectedDiceTotal:s,totalScore:a,personalBest:M,highscorePosition:W,onlineGames:D,onlineGamesLoading:C,onlineGameId:G,onlineGameCreatorId:I,onlineGamePlayers:E,onlineGameOpponents:A,onlineGameChat:te,isOnlineGameOwner:d,$reset:t,start:n,roll:w,hasFinishedRolling:be,hasLostRound:He,loseTurn:ke,popLastTile:Re,selectDice:Oe,selectTile:ue,passTurn:Ie,setPreviousHighscores:ce,updateRainwormsHighscore:Ve,sortHighscores:Se,fetchOnlineGames:Q,createOnlineGame:S,continueOnlineGame:B,updateOnlineGame:N,leaveOnlineGame:he,deleteOnlineGame:ie}},{persist:{enabled:!0}}),Le=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],De=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],dl=Ke({__name:"GameSettingsDialog",props:Ze({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(l){const u=l,m=qe(l,"isOpen"),M=pe(),{useAudio:W,diceRollSpeed:k}=Z(pe()),{robotSpeed:D}=Z(cl()),{doAutocomplete:C}=Z(al()),G=H(()=>{switch(u.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)";case V.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Ne(()=>{M.$init(u.gameId)}),(I,E)=>(de(),ve(xe,{isOpen:m.value,title:"Game Settings",description:I.gameId?`Current version: ${G.value}`:"General settings",cancelText:"Close",onCancel:E[4]||(E[4]=A=>m.value=!1)},{default:Qe(()=>[Xe(Ce,{name:"useAudio",label:"Audio",modelValue:j(W),"onUpdate:modelValue":E[0]||(E[0]=A=>fe(W)?W.value=A:null)},null,8,["modelValue"]),I.gameId===j(V).PATIENCE?(de(),ve(Ce,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:j(C),"onUpdate:modelValue":E[1]||(E[1]=A=>fe(C)?C.value=A:null)},null,8,["modelValue"])):Ee("",!0),I.gameId===j(V).YAHTZEE||I.gameId===j(V).RAINWORMS?(de(),ve(ye,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:j(k),"onUpdate:modelValue":E[2]||(E[2]=A=>fe(k)?k.value=A:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Ee("",!0),I.gameId===j(V).RAINWORMS?(de(),ve(ye,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:j(D),"onUpdate:modelValue":E[3]||(E[3]=A=>fe(D)?D.value=A:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Ee("",!0)]),_:1},8,["isOpen","description"]))}});export{Je as C,el as D,nl as F,ol as G,ul as L,dl as _,al as a,ll as b,cl as u};
