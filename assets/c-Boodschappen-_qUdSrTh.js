import{ba as J,bt as X,bu as Z,bh as ee,bi as q,bv as te,ay as j,bw as ae,bx as ne,b6 as oe,bf as se,q as ie,by as le,s as $,z as P,av as b,bz as re,bA as ue,bB as K,C as W,d as R,br as ce,b as U,g as Q,D as M,$ as de,bs as pe,U as me,w as v,f as o,e as V,h as i,aa as ge,ab as fe,ac as ye,t as L,a2 as I,ad as ve,a9 as he,i as N,ag as be,v as Be,l as Ve,c as T,O as E,_ as De,al as ze,am as z,k as w,n as Le}from"../bundle.js";import{_ as G}from"./c-Dialog.vue_vue_type_script_setup_true_lang-w4ekMcIk.js";import{_ as _e}from"./c-Page.vue_vue_type_script_setup_true_lang-DQEn_xOF.js";class x{id;name;size;buyLog;constructor({id:t,name:a,size:c,buyLog:y}={}){this.id=t??J(),this.name=a??"",this.size=c??{value:0,unit:""},this.buyLog=y??[]}static deserialize(t){return new x({id:t.id,name:t.name,size:t.size,buyLog:t.buyLog.map(O.deserialize)})}serialize(){return{id:this.id,name:this.name,size:this.size,buyLog:this.buyLog.map(t=>t.serialize())}}}class O{date;price;quantity;constructor(t,a,c){this.date=t??new Date,this.price=a??0,this.quantity=c??1}static deserialize(t){return new O(t.date.toDate(),t.price,t.quantity)}serialize(){return{date:X.fromDate(this.date),price:this.price,quantity:this.quantity}}}function we(f){return f.map(Pe)}function Pe(f){return x.deserialize(f)}class ke{async fetchMultiple(t){return Z(ee(t,q.BOODSCHAPPEN))}async create(t,a){await te(j(t,q.BOODSCHAPPEN,a.id),a)}async update(t,a){await ae(j(t,q.BOODSCHAPPEN,a.id),{...a})}async delete(t,a){await ne(j(t,q.BOODSCHAPPEN,a))}}const F=new ke,H=oe("boodschappenStore",()=>{const f=se(),t=ie(),a=le(),{firebaseUser:c}=$(t),{debug:y}=$(a),d=P([]),s=P(!1),h=P(!1);return{boodschappen:d,isFetchLoading:s,isMutationLoading:h,$reset:()=>{d.value=[]},fetchBoodschappen:async()=>{if(!c.value){b.error("You must be logged in to fetch products.");return}try{s.value=!0;const u=await F.fetchMultiple(f);d.value=we(u)}catch(u){b.firebaseError(y.value,u)}finally{s.value=!1}},createBoodschap:async u=>{if(!c.value){b.error("You must be logged in to create products.");return}try{h.value=!0,await F.create(f,u.serialize()),re(d,u),b.success("Successfully created product")}catch(g){b.firebaseError(y.value,g)}finally{h.value=!1}},updateBoodschap:async u=>{if(!c.value){b.error("You must be logged in to update products.");return}try{h.value=!0,await F.update(f,u.serialize()),ue(d,u,"id"),b.success("Successfully updated product")}catch(g){b.firebaseError(y.value,g)}finally{h.value=!1}},deleteBoodschap:async u=>{if(!c.value){b.error("You must be logged in to delete products.");return}try{h.value=!0,d.value.find(B=>B.id===u)&&(await F.delete(f,u),d.value=d.value.filter(B=>B.id!==u),b.success("Successfully deleted product"))}catch(g){b.firebaseError(y.value,g)}finally{h.value=!1}}}}),Ce=()=>{const f=H(),{boodschappen:t}=$(f),a=W(()=>[...t.value].sort((m,e)=>{const l=m.buyLog.at(-1),n=e.buyLog.at(-1),r=d(l?m:e)?.getTime()??0,u=d(n?e:m)?.getTime()??0;return r-u})),c=m=>[...m.buyLog].filter(e=>Number(e.quantity)>0&&!Number.isNaN(e.date.getTime())).sort((e,l)=>e.date.getTime()-l.date.getTime()),y=m=>c(m).at(-1)?.date??null,d=(m,e=new Date)=>{const l=c(m),n=m.size.value;if(!Number.isFinite(n)||n<=0)return null;if(l.length<2)return null;let r=0,u=0;for(let _=0;_<l.length-1;_++){const S=l[_],Y=(l[_+1].date.getTime()-S.date.getTime())/K;!Number.isFinite(S.quantity)||S.quantity<=0||Y<=0||(r+=S.quantity*n,u+=Y)}if(u<=0||r<=0)return null;const g=r/u;if(!Number.isFinite(g)||g<=0)return null;const B=l.at(-1);if(!B)return null;const k=B.quantity;if(!Number.isFinite(k)||k<=0)return null;const D=k*n/g;if(!Number.isFinite(D)||D<=0)return null;const p=new Date(B.date.getTime()+D*K);return p.getTime()<e.getTime()?e:p};return{sortedBoodschappen:a,getLatestPurchaseDate:y,getProjectedOutOfStockDate:d,getPricePerUnit:m=>{const e=c(m).at(-1);return!e||!Number.isFinite(e.price)||!Number.isFinite(e.quantity)||e.quantity<=0?null:e.price/e.quantity},getPriceIncreasePercentage:m=>{const e=c(m);if(e.length<2)return 0;const l=e.at(-1),n=e.at(-2);return!Number.isFinite(l.price)||!Number.isFinite(l.quantity)||!Number.isFinite(n.price)||!Number.isFinite(n.quantity)||n.quantity===0?0:(l.price/l.quantity-n.price/n.quantity)/(n.price/n.quantity)*100}}},A=R({__name:"NumberField",props:pe({id:{},name:{},label:{},placeholder:{},error:{},rules:{},inputProps:{},labelProps:{},minLength:{},maxLength:{},minValue:{},maxValue:{},compare:{},deleteButton:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const t=f,a=ce(f,"modelValue"),c=W({get:()=>a.value.toString(),set:y=>{try{const d=parseFloat(y);isNaN(d)?a.value=0:a.value=d}catch{a.value=0}}});return(y,d)=>(U(),Q(M,de(t,{modelValue:c.value,"onUpdate:modelValue":d[0]||(d[0]=s=>c.value=s),"input-props":{...t.inputProps,type:"number"}}),null,16,["modelValue","input-props"]))}}),Ue={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ne={class:"flex gap-3"},$e={class:"flex gap-5"},xe={class:"flex flex-col gap-3"},Se=R({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(f,{emit:t}){const a=f,c=t,y=H(),{isMutationLoading:d}=$(y),s=Be({name:"",sizeValue:0,sizeUnit:"",buyLog:[]});function h(){a.selectedBoodschap?(a.selectedBoodschap.name=s.name,a.selectedBoodschap.size={value:s.sizeValue,unit:s.sizeUnit},a.selectedBoodschap.buyLog=[...s.buyLog],y.updateBoodschap(a.selectedBoodschap)):y.createBoodschap(new x({name:s.name,size:{value:s.sizeValue,unit:s.sizeUnit},buyLog:[...s.buyLog]})),c("close")}function m(){c("close")}function e(){s.buyLog.push(new O)}return me(()=>a.isOpen,()=>{const l=a.selectedBoodschap??new x;Object.assign(s,{...l,sizeValue:l.size.value,sizeUnit:l.size.unit,buyLog:[...l.buyLog]})},{immediate:!0}),(l,n)=>(U(),Q(G,{"is-open":f.isOpen,title:a.selectedBoodschap?`Bewerk ${a.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":a.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":o(d),onConfirm:h,onCancel:m},{default:v(()=>[V("div",Ue,[i(M,{name:"name",label:"Naam",modelValue:s.name,"onUpdate:modelValue":n[0]||(n[0]=r=>s.name=r)},null,8,["modelValue"]),V("div",Ne,[i(A,{name:"sizeValue",label:"Formaat",modelValue:s.sizeValue,"onUpdate:modelValue":n[1]||(n[1]=r=>s.sizeValue=r)},null,8,["modelValue"]),i(M,{name:"sizeUnit",label:"Eenheid",modelValue:s.sizeUnit,"onUpdate:modelValue":n[2]||(n[2]=r=>s.sizeUnit=r)},null,8,["modelValue"])]),n[5]||(n[5]=V("b",null,"Logboek",-1)),i(o(be),{ref:"draggable",class:"flex flex-col gap-3",modelValue:s.buyLog,"onUpdate:modelValue":n[3]||(n[3]=r=>s.buyLog=r),itemKey:r=>r.date.toString(),handle:".drag-handle"},{item:v(({element:r,index:u})=>[i(o(ge),null,{default:v(()=>[i(o(fe),{value:"0"},{default:v(()=>[i(o(ye),{class:"drag-handle"},{default:v(()=>[V("div",$e,[n[4]||(n[4]=V("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),V("p",null,L(o(I)(r.date)),1)])]),_:2},1024),i(o(ve),null,{default:v(()=>[V("div",xe,[i(he,{name:`buylog-date-${u}`,label:"Datum",modelValue:r.date,"onUpdate:modelValue":g=>r.date=g,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),i(A,{name:`buylog-quantity-${u}`,label:"Aantal",modelValue:r.quantity,"onUpdate:modelValue":g=>r.quantity=g},null,8,["name","modelValue","onUpdate:modelValue"]),i(A,{name:`buylog-price-${u}`,label:"Prijs",modelValue:r.price,"onUpdate:modelValue":g=>r.price=g},null,8,["name","modelValue","onUpdate:modelValue"]),i(N,{variant:"danger",outlined:"",label:"Delete",onClick:g=>s.buyLog.splice(u,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),i(N,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:e})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),qe={class:"flex gap-3"},Ee=R({__name:"Boodschappen",setup(f){const t=H(),{isFetchLoading:a,isMutationLoading:c}=$(t),{sortedBoodschappen:y,getLatestPurchaseDate:d,getPricePerUnit:s,getPriceIncreasePercentage:h,getProjectedOutOfStockDate:m}=Ce(),e=P(null),l=P(!1),n=P(!1);function r(){e.value=null,n.value=!0}function u(C){e.value=C,n.value=!0}function g(C){e.value=C,l.value=!0}function B(){e.value=null,n.value=!1}async function k(){e.value&&await t.deleteBoodschap(e.value.id),l.value=!1,e.value=null}return Ve(()=>{t.fetchBoodschappen()}),(C,D)=>(U(),T(E,null,[i(_e,null,{content:v(()=>[i(De,{class:"!bg-primary-500 !bg-opacity-35 my-5",title:"De Booschappen Tool",description:"Dit gaat ons helpen bij het bijhouden van onze boodschappenlijst. We kunnen items toevoegen, verwijderen en markeren als gekocht. Laten we het proberen!"},{default:v(()=>[i(o(ze),{value:o(y),tableStyle:"min-width: 40rem",loading:o(a)},{empty:v(()=>[...D[1]||(D[1]=[w(" Er zijn nog geen boodschappen toegevoegd. Klik op de knop hieronder om er een toe te voegen! ",-1)])]),default:v(()=>[i(o(z),{field:"name",header:"Naam"}),i(o(z),{header:"Formaat"},{body:v(({data:p})=>[w(L(p.size.value)+" "+L(p.size.unit),1)]),_:1}),i(o(z),{header:"Laatste aankoop"},{body:v(({data:p})=>[o(d)(p)?(U(),T(E,{key:1},[w(L(o(I)(o(d)(p))),1)],64)):(U(),T(E,{key:0},[w(" Nog niet gekocht ")],64))]),_:1}),i(o(z),{header:"Voorraad aanvullen op"},{body:v(({data:p})=>[w(L(o(m)(p)?o(I)(o(m)(p)):"Onbekend"),1)]),_:1}),i(o(z),{header:"Prijs"},{body:v(({data:p})=>[w(L(o(s)(p)?`â‚¬${o(s)(p).toFixed(2)}`:""),1)]),_:1}),i(o(z),{header:"Prijsstijging"},{body:v(({data:p})=>[V("span",{class:Le(o(h)(p)>0?"text-red-500":o(h)(p)<0?"text-green-500":"")},L(o(h)(p)?`${o(h)(p).toFixed(2)}%`:""),3)]),_:1}),i(o(z),{header:"Acties"},{body:v(({data:p})=>[V("div",qe,[i(N,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:o(c),onClick:_=>u(p)},null,8,["loading","onClick"]),i(N,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:o(c),onClick:_=>g(p)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","loading"]),i(N,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:o(c),onClick:r},null,8,["loading"])]),_:1})]),_:1}),i(Se,{"is-open":n.value,selectedBoodschap:e.value,onClose:B},null,8,["is-open","selectedBoodschap"]),i(G,{title:"Product verwijderen","is-open":l.value,description:[e.value?`Weet je zeker dat je het product '${e.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":o(c),onConfirm:k,onCancel:D[0]||(D[0]=p=>l.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{Ee as default};
