import{X as fe,Y as ge,Z as me,b as s,c as O,e as h,$ as z,d as K,l as ie,g as p,f as a,z as G,C as v,a0 as Y,q as oe,G as ye,s as q,t as B,T as he,w as M,a1 as be,h as _,R as H,_ as re,J as d,a2 as P,a3 as le,a4 as we,a5 as De,a6 as Se,O as E,Q as xe,a7 as ke,i as L,k as ne,j as Oe,a8 as Ce,B as _e}from"../bundle.js";import{_ as Ae}from"./c-BackButton.vue_vue_type_script_setup_true_lang-oHqvxMiV.js";import{_ as Te}from"./c-Dialog.vue_vue_type_script_setup_true_lang-w4ekMcIk.js";import{_ as $e}from"./c-Page.vue_vue_type_script_setup_true_lang-DQEn_xOF.js";import{u as Pe}from"./c-useCatCalc-BYmUPklD.js";import{_ as Me}from"./c-PetDialog.vue_vue_type_script_setup_true_lang-jf1LxaT2.js";import{_ as Ee}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";import"./c-useUsers-DiKbhbPK.js";var Le={root:{position:"relative"}},Be={root:"p-chart"},Ye=fe.extend({name:"chart",classes:Be,inlineStyles:Le}),Ne={name:"BaseChart",extends:ge,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:Ye,provide:function(){return{$pcChart:this,$parentInstance:this}}},ce={name:"Chart",extends:Ne,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var e=this;me(()=>import("./c-auto-CquwA8NN.js"),[],import.meta.url).then(function(r){e.chart&&(e.chart.destroy(),e.chart=null),r&&r.default&&(e.chart=new r.default(e.$refs.canvas,{type:e.type,data:e.data,options:e.options,plugins:e.plugins})),e.$emit("loaded",e.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(e){if(this.chart){var r=this.chart.getElementsAtEventForMode(e,"nearest",{intersect:!0},!1),u=this.chart.getElementsAtEventForMode(e,"dataset",{intersect:!0},!1);r&&r[0]&&u&&this.$emit("select",{originalEvent:e,element:r[0],dataset:u})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function N(t){"@babel/helpers - typeof";return N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(t)}function se(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);e&&(u=u.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,u)}return r}function ue(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?se(Object(r),!0).forEach(function(u){Re(t,u,r[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(u){Object.defineProperty(t,u,Object.getOwnPropertyDescriptor(r,u))})}return t}function Re(t,e,r){return(e=Fe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fe(t){var e=Ve(t,"string");return N(e)=="symbol"?e:e+""}function Ve(t,e){if(N(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var u=r.call(t,e);if(N(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Ie=["width","height"];function je(t,e,r,u,n,b){return s(),O("div",z({class:t.cx("root"),style:t.sx("root")},t.ptmi("root")),[h("canvas",z({ref:"canvas",width:t.width,height:t.height,onClick:e[0]||(e[0]=function(D){return b.onCanvasClick(D)})},ue(ue({},t.canvasProps),t.ptm("canvas"))),null,16,Ie)],16)}ce.render=je;const He=K({__name:"Chart",props:{headers:{},datasets:{}},setup(t){const e=G(),r=()=>{const u=getComputedStyle(document.documentElement),n="white",b="white",D=u.getPropertyValue("--p-content-border-color");return{stacked:!1,maintainAspectRatio:!1,aspectRatio:.6,plugins:{legend:{labels:{color:n}}},scales:{x:{ticks:{color:b},grid:{color:D}},y:{type:"linear",display:!0,position:"left",beginAtZero:!0,ticks:{color:b},grid:{color:D}},y1:{type:"linear",display:!1,position:"right",ticks:{color:b},grid:{drawOnChartArea:!1,color:D}}}}};return ie(()=>{e.value=r()}),(u,n)=>(s(),p(a(ce),{type:"line",data:{labels:t.headers,datasets:t.datasets},options:e.value,class:"h-[30rem]"},null,8,["data","options"]))}});var T=(t=>(t[t.MONTHS=0]="MONTHS",t[t.YEARS_HALF=1]="YEARS_HALF",t[t.YEARS=2]="YEARS",t))(T||{});const $={0:{amount:12,getStartDate:t=>{const e=new Date(t);return e.setMonth(e.getMonth()-$[0].amount+1,1),e},calculateStartDate:(t,e)=>{const r=new Date(t);return r.setMonth(r.getMonth()+e),r},calculateEndDate:t=>{const e=new Date(t);return e.setMonth(t.getMonth()+1,0),e},getLabel:t=>U[t.getMonth()]},1:{amount:10,getStartDate:t=>{const e=new Date(t);return e.setMonth(e.getMonth()-6*$[1].amount+1,1),e},calculateStartDate:(t,e)=>{const r=new Date(t);return r.setMonth(r.getMonth()+e*6),r},calculateEndDate:t=>{const e=new Date(t);return e.setMonth(e.getMonth()+6,0),e},getLabel:(t,e)=>{const r=U[t.getMonth()].substring(0,3),u=U[e.getMonth()].substring(0,3);return`${r}-${u} ${e.getFullYear()}`}},2:{amount:10,getStartDate:t=>{const e=new Date(t);return e.setFullYear(e.getFullYear()-$[2].amount+1,0,1),e},calculateStartDate:(t,e)=>{const r=new Date(t);return r.setFullYear(r.getFullYear()+e,0,1),r},calculateEndDate:t=>{const e=new Date(t);return e.setFullYear(e.getFullYear(),12,0),e},getLabel:t=>`${t.getFullYear()}`}},U=["January","February","March","April","May","June","July","August","September","October","November","December"],ze=(t,e)=>{const r=v(()=>Y(t)),u=v(()=>Y(e)),n=v(()=>{const i=new Date,f=new Date(i.getFullYear(),i.getMonth(),i.getDate());return $[u.value].getStartDate(f).getTime()}),b=v(()=>{const i=n.value;return r.value.filter(f=>f.date.getTime()>=i)}),D=v(()=>{const i=m=>{const x=$[u.value].calculateStartDate(new Date(n.value),m),k=$[u.value].calculateEndDate(x);return[x.getTime(),k.getTime()]},f=(m,x)=>b.value.some(k=>k.date.getTime()>=m&&k.date.getTime()<x),S=[];let l=!1;for(let m=0;m<$[u.value].amount;m++){const[x,k]=i(m);(l||f(x,k))&&(l=!0,S.push({label:$[u.value].getLabel(new Date(x),new Date(k)),startTime:x,endTime:k}))}return S}),A=v(()=>D.value.map(i=>i.label)),c=v(()=>{const i=[];return D.value.forEach(f=>{const S=b.value.filter(l=>{const m=l.date.getTime();return m>=f.startTime&&m<f.endTime});S.length?i.push({x:f.label,y:S.reduce((l,m)=>l+m.value,0)/S.length}):i.push({x:f.label,y:null})}),i});return{headers:A,filteredData:c}},Z=t=>{const e=oe(),r=ye(),{isOwner:u,firebaseUser:n}=q(e),{publicUsers:b}=q(r),D=1e3*60*60*24*365.25,A=G(T.MONTHS),c=v(()=>Y(t)),i=v(()=>c.value?.dateOfBirth?(new Date().getTime()-new Date(c.value.dateOfBirth).getTime())/D:0),f=v(()=>i.value*12),S=v(()=>i.value*52),l=v(()=>b.value.find(g=>g.id===c.value?.userId)),m=v(()=>b.value.find(g=>g.id===c.value?.coOwnerId)),x=v(()=>c.value?.userId===n.value?.uid||u.value),k=v(()=>c.value?.weightLog.map(g=>({date:new Date(g.date),value:g.weight}))??[]),{headers:W,filteredData:R}=ze(k,A),F=v(()=>{if(!c.value||!c.value.dateOfBirth)return null;const g=c.value.vetDate?new Date(c.value.vetDate):null;if(g)return i.value<=7?C(g,1,1):C(g,2,1);if(c.value.type==="cat")return C(new Date(c.value.dateOfBirth),52,10);if(c.value.type==="dog")return C(new Date(c.value.dateOfBirth),52,4)}),J=v(()=>{if(!c.value||!c.value.dateOfBirth)return null;const g=c.value.dewormingDate?new Date(c.value.dewormingDate):null;if(g){if(S.value<=9)return C(g,52,2);if(f.value<=3)return C(g,12,3);if(f.value<=6)return C(g,12,1);if(c.value.type==="cat")return C(g,12,c.value.insideCat?6:3);if(c.value.type==="dog")return C(g,12,3)}else return C(new Date(c.value.dateOfBirth),52,3)}),C=(g,V,I)=>new Date(g.getTime()+D/V*I);return{weightLogPeriod:A,petAgeYears:i,petAgeMonths:f,petAgeWeeks:S,petOwner:l,petCoOwner:m,isMyPet:x,nextVetVisit:F,nextDeworming:J,chartHeaders:W,chartData:R}},Ge=t=>{const e=v(()=>Y(t)),{petAgeYears:r,petAgeMonths:u}=Z(e),n=v(()=>{if(e.value?.type!=="cat"||!e.value?.dateOfBirth)return null;const i=r.value;switch(!0){case i<1:return{value:"kitten",label:"Kitten (0-12 months)"};case(i>=1&&i<3):return{value:"junior",label:"Junior (1-2 years)"};case(i>=3&&i<7):return{value:"adult",label:"Adult (3-6 years)"};case(i>=7&&i<11):return{value:"mature",label:"Mature (7-10 years)"};case(i>=11&&i<15):return{value:"senior",label:"Senior (11-14 years)"};case i>=15:return{value:"geriatric",label:"Geriatric (15+ years)"};default:return null}}),b=v(()=>e.value?e.value.weightLog.length?e.value.weightLog.map(f=>({...f,date:new Date(f.date).getTime()})).sort((f,S)=>S.date-f.date)[0].weight:e.value.weight??null:null),D=v(()=>e.value?.dateOfBirth?n.value?.value==="kitten"?u.value<=4?"kitten0.4":"kitten1":e.value?.castrated?"castrated":"default":null),{requiredCaloriesByWeightAndAgeAndSize:A,requiredFoodDry:c}=Pe("average",b.value??"",D.value??"default",e.value?.gender??"male","35","default");return{catLifeStage:n,petWeight:b,requiredCaloriesByWeightAndAgeAndSize:n?A:null,requiredFoodDry:n?c:null}},qe=t=>{const e=v(()=>Y(t)),{petAgeYears:r}=Z(e);return{dogLifeStage:v(()=>{if(e.value?.type!=="dog"||!e.value?.dateOfBirth||!e.value?.breedSize)return null;const n=r.value;switch(e.value.breedSize){case"small":return n<1?{value:"puppy",label:"Puppy (0-12 months)"}:n<3?{value:"young_adult",label:"Young Adult (1-2 years)"}:n<8?{value:"adult",label:"Adult (3-7 years)"}:n<11?{value:"mature",label:"Mature (8-10 years)"}:n<15?{value:"senior",label:"Senior (11-14 years)"}:{value:"geriatric",label:"Geriatric (15+ years)"};case"medium":return n<1?{value:"puppy",label:"Puppy (0-12 months)"}:n<3?{value:"young_adult",label:"Young Adult (1-2 years)"}:n<7?{value:"adult",label:"Adult (3-6 years)"}:n<10?{value:"mature",label:"Mature (7-9 years)"}:n<13?{value:"senior",label:"Senior (10-12 years)"}:{value:"geriatric",label:"Geriatric (13+ years)"};case"large":return n<1?{value:"puppy",label:"Puppy (0-12 months)"}:n<3?{value:"young_adult",label:"Young Adult (1-2 years)"}:n<6?{value:"adult",label:"Adult (3-5 years)"}:n<9?{value:"mature",label:"Mature (6-8 years)"}:n<12?{value:"senior",label:"Senior (9-11 years)"}:{value:"geriatric",label:"Geriatric (12+ years)"};case"giant":return n<1?{value:"puppy",label:"Puppy (0-12 months)"}:n<2?{value:"young_adult",label:"Young Adult (1-1.5 years)"}:n<5?{value:"adult",label:"Adult (2-4 years)"}:n<8?{value:"mature",label:"Mature (5-7 years)"}:n<10?{value:"senior",label:"Senior (8-9 years)"}:{value:"geriatric",label:"Geriatric (10+ years)"};default:return null}})}},We={class:"ms-5 max-sm:mt-3 md:ms-10 grid grid-cols-1 sm:grid-cols-[1fr_2fr] gap-1 sm:gap-3 justify-between"},y=K({__name:"KeyValuePair",props:{title:{},value:{},titleProps:{},valueProps:{}},setup(t){return(e,r)=>(s(),O("div",We,[h("p",z({class:"font-bold text-nowrap"},t.titleProps),B(t.title),17),h("p",z({class:"text-neutral-300"},t.valueProps),B(t.value),17)]))}}),Je={class:"break-words text-neutral-300"},Ue={class:"flex flex-col gap-10"},Ke={key:2,class:"max-sm:mt-5 ms-5 md:ms-10 pi pi-sync animate-spin text-neutral-300"},Ze={key:0,class:"flex flex-wrap md:flex-nowrap gap-3 justify-around"},Qe={class:"flex flex-col md:items-center"},Xe={class:"text-indigo-300 font-bold"},et={class:"text-gray-300 italic"},tt={class:"mt-3 flex justify-center gap-3"},at={key:0,class:"w-full text-neutral-300"},rt={key:1,class:"flex gap-3"},lt={key:1,class:"flex justify-center"},nt=K({__name:"Pet",setup(t){const e=_e(),r=Oe(),u=he(),n=oe(),{pets:b}=q(u),{isLoggedIn:D}=q(n),{deletePet:A}=u,c=Ce("statisticsRef"),i=G(!1),f=G(!1),S=v(()=>e.params.petId),l=v(()=>b.value.find(j=>j.id===S.value)),{weightLogPeriod:m,petOwner:x,petCoOwner:k,isMyPet:W,nextVetVisit:R,nextDeworming:F,chartHeaders:J,chartData:C}=Z(l),{catLifeStage:g,petWeight:V,requiredCaloriesByWeightAndAgeAndSize:I,requiredFoodDry:Q}=Ge(l),{dogLifeStage:X}=qe(l),{births:ee,holidays:te,isLoading:de,fetchData:ve}=be(),pe=async j=>{await A(j),r.push({name:H.PET_OVERVIEW})};return ie(()=>{l.value?.dateOfBirth&&setTimeout(()=>{ve(new Date(l.value.dateOfBirth),"all",{reverse:!0})},1e3)}),(j,o)=>(s(),p($e,null,{content:M(()=>[a(D)?(s(),O(E,{key:0},[_(Ae,{"back-route":a(H).PET_OVERVIEW,label:"Back to all pets"},null,8,["back-route"]),l.value?(s(),p(re,{key:0,class:"!bg-primary-500 !bg-opacity-35 my-5",title:l.value.name,"title-props":{class:"text-3xl md:text-5xl"},"title-wrapper-props":{class:"ms-5"},avatar:l.value.avatar??void 0,"avatar-props":{class:"h-20 w-20 md:h-32 md:w-32"}},{underTitle:M(()=>[h("p",Je,B(l.value.description),1)]),default:M(()=>[h("div",Ue,[h("div",null,[o[9]||(o[9]=h("h3",null,"Details",-1)),a(x)?(s(),p(y,{key:0,title:a(k)?"Owners:":"Owner:",value:a(k)?`${a(x).displayName} & ${a(k).displayName}`:a(x).displayName},null,8,["title","value"])):d("",!0),l.value.dateOfBirth?(s(),p(y,{key:1,title:"Date of birth:",value:a(P)(l.value.dateOfBirth)},null,8,["value"])):d("",!0),a(de)?(s(),O("i",Ke)):d("",!0),a(te).length?(s(),p(y,{key:3,title:"On this date:",value:`~ ${a(le)(a(te)).text}`,"title-props":{class:"text-yellow-300 italic"},"value-props":{class:"max-sm:ms-0 ms-2 text-neutral-100 italic"}},null,8,["value"])):d("",!0),a(ee).length?(s(),p(y,{key:4,class:"max-sm:ms-3",title:"",value:`~ ${a(le)(a(ee)).text} was born`,"title-props":{class:"hidden sm:block"},"value-props":{class:"ms-2 text-neutral-100 italic"}},null,8,["value"])):d("",!0),l.value.type?(s(),p(y,{key:5,title:"Type:",value:a(we).find(({value:w})=>w===l.value?.type)?.label??""},null,8,["value"])):d("",!0),l.value.breed?(s(),p(y,{key:6,title:"Breed:",value:l.value.breed},null,8,["value"])):d("",!0),l.value.breedSize&&l.value.type==="dog"?(s(),p(y,{key:7,title:"Breed size:",value:a(De).find(({value:w})=>w===l.value?.breedSize)?.label??""},null,8,["value"])):d("",!0),l.value.gender?(s(),p(y,{key:8,title:"Gender:",value:a(Se).find(({value:w})=>w===l.value?.gender)?.label??""},null,8,["value"])):d("",!0),o[10]||(o[10]=h("h3",null,"Health",-1)),a(V)?(s(),p(y,{key:9,title:"Weight:",value:a(V)+"kg"},null,8,["value"])):d("",!0),typeof l.value.insideCat=="boolean"?(s(),p(y,{key:10,title:"Inside Cat:",value:l.value.insideCat?"Yes":"No"},null,8,["value"])):d("",!0),l.value.castrated!==void 0?(s(),p(y,{key:11,title:"Castrated:",value:l.value.castrated?"Yes":"No"},null,8,["value"])):d("",!0),l.value.vetDate?(s(),p(y,{key:12,title:"Last vet visit:",value:a(P)(l.value.vetDate)},null,8,["value"])):d("",!0),l.value.lastVaccinationDate?(s(),p(y,{key:13,title:"Last vaccination:",value:a(P)(l.value.lastVaccinationDate)},null,8,["value"])):d("",!0),l.value.dewormingDate?(s(),p(y,{key:14,title:"Last deworming:",value:a(P)(l.value.dewormingDate)},null,8,["value"])):d("",!0)]),l.value.dateOfBirth?(s(),O("div",Ze,[_(ke,{class:"w-full md:w-3/4 text-neutral-300 bg-neutral-900 rounded-secondary",time:new Date(l.value.dateOfBirth).getTime(),direction:"up"},{birthdayText:M(()=>[...o[11]||(o[11]=[h("h4",{class:"text-xl xl:text-3xl text-pink-500 font-bold italic"},"Happy birthday!",-1)])]),onThisDay:M(({selected:w})=>[o[12]||(o[12]=h("h5",{class:"place-self-center xl:text-xl text-slate-400 font-bold"},"Also on this day:",-1)),(s(!0),O(E,null,xe(w,ae=>(s(),O("div",Qe,[h("p",Xe,B(ae.year),1),h("p",et,B(ae.text),1)]))),256))]),_:1},8,["time"])])):d("",!0),h("div",null,[o[13]||(o[13]=h("h3",null,"Statistics",-1)),h("div",{ref_key:"statisticsRef",ref:c},[l.value.type==="cat"?(s(),O(E,{key:0},[a(g)?(s(),p(y,{key:0,title:"Life stage:",value:a(g).label},null,8,["value"])):d("",!0),a(I)?(s(),p(y,{key:1,title:"Required energy per day:",value:a(I).toFixed(1)+" kcal"},null,8,["value"])):d("",!0),a(Q)?(s(),p(y,{key:2,title:"Required dry food per day:",value:a(Q).toFixed(1)+" g"},null,8,["value"])):d("",!0)],64)):l.value.type==="dog"?(s(),O(E,{key:1},[a(X)?(s(),p(y,{key:0,title:"Life stage:",value:a(X).label},null,8,["value"])):d("",!0)],64)):d("",!0),a(R)?(s(),p(y,{key:2,title:"Next vet visit:",value:a(P)(a(R))},null,8,["value"])):d("",!0),l.value.nextVaccinationDate?(s(),p(y,{key:3,title:"Next vaccination:",value:a(P)(new Date(l.value.nextVaccinationDate))},null,8,["value"])):d("",!0),a(F)?(s(),p(y,{key:4,title:"Next deworming:",value:a(P)(a(F))},null,8,["value"])):d("",!0),l.value.weightLog.length?(s(),O(E,{key:5},[h("div",tt,[_(L,{variant:"neutral",label:"1 Year",outlined:a(m)===a(T).MONTHS,onClick:o[0]||(o[0]=w=>m.value=a(T).MONTHS)},null,8,["outlined"]),_(L,{variant:"neutral",label:"3 Years",outlined:a(m)===a(T).YEARS_HALF,onClick:o[1]||(o[1]=w=>m.value=a(T).YEARS_HALF)},null,8,["outlined"]),_(L,{variant:"neutral",label:"10 Years",outlined:a(m)===a(T).YEARS,onClick:o[2]||(o[2]=w=>m.value=a(T).YEARS)},null,8,["outlined"])]),_(He,{headers:a(J),datasets:[{label:`${l.value.name}'s weight (kg)`,fill:!1,borderColor:"red",yAxisID:"y",tension:.4,data:a(C),spanGaps:!0}]},null,8,["headers","datasets"])],64)):d("",!0)],512),c.value?.childElementCount?d("",!0):(s(),O("p",at," Nothing to show yet. "))]),a(W)?(s(),O("div",rt,[_(L,{label:"Edit",outlined:"",onClick:o[3]||(o[3]=w=>i.value=!0)}),_(L,{label:"Delete",variant:"danger",outlined:"",onClick:o[4]||(o[4]=w=>f.value=!0)})])):d("",!0),_(Me,{"is-open":i.value,"original-pet":l.value??null,onClose:o[5]||(o[5]=w=>i.value=!1)},null,8,["is-open","original-pet"]),_(Te,{"is-open":f.value,title:"Delete Pet",description:"Are you sure you want to delete your pet?","confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:o[6]||(o[6]=w=>pe(l.value.id)),onCancel:o[7]||(o[7]=w=>f.value=!1)},null,8,["is-open"])])]),_:1},8,["title","avatar"])):d("",!0)],64)):(s(),O("div",lt,[_(re,{class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:M(()=>[o[14]||(o[14]=ne(" Please ",-1)),h("a",{class:"cursor-pointer",onClick:o[8]||(o[8]=w=>a(r).push({name:a(H).LOGIN,params:{redirect:JSON.stringify({name:a(H).PET_DETAILS,params:{petId:S.value}})}}))}," Login "),o[15]||(o[15]=ne(" to view this pet. ",-1))]),_:1})]))]),_:1}))}}),ft=Ee(nt,[["__scopeId","data-v-de03ee83"]]);export{ft as default};
