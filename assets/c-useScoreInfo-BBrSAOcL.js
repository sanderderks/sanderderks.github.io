import{_ as x}from"./c-Bubble.vue_vue_type_script_setup_true_lang-DwnbaZC0.js";import{r as H,c as u,ax as T,e as q,C as z,aS as $,s as S,o as A,ap as F,N as J,l,m as a,q as s,n as G,k as o,w as r,x as w,P as M,J as v,H as P,D as O,p as K,G as Q,t as U,h as W}from"../bundle.js";import{_ as X}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const Y=(i,c)=>{const f=H(0),d=u(()=>T(i)),y=u(()=>(f.value+1)*c),p=u(()=>y.value-c),g=u(()=>f.value>0),m=u(()=>d.value.length>y.value),_=u(()=>d.value.filter((k,n)=>n>=p.value&&n<y.value));return{page:f,perPage:c,visibleData:_,hasPrevious:g,hasNext:m}},Z={class:"mt-5 flex justify-center"},ee={class:"w-full overflow-x-auto"},te={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},se={key:0},oe={key:0},ne={key:1},le={key:1},ae={key:0},re={key:1},ue={key:2},ie={key:3},ce={key:2},de={key:3},he={key:4},ve={colspan:"100%"},fe=q({__name:"Highscores",props:{gameId:{},unit:{}},setup(i){const c=i,f=z(),d=$(),{publicUsers:y}=S(f),{allGameData:p,fetchLoading:g}=S(d),{fetchGameData:m,fetchHighscores:_,fetchScores:k}=d,n=H("highscores"),B=H(),V=u(()=>p.value[c.gameId].gameData[n.value]),{page:D,perPage:E,visibleData:h,hasPrevious:I,hasNext:C}=Y(()=>V.value,10),L=b=>{var e;return((e=y.value.find(t=>t.id===b))==null?void 0:e.displayName)??"Unknown"},j=()=>{n.value==="highscores"?_():k()};return A(()=>{d.$init(c.gameId),m(),B.value=setInterval(()=>{m()},1e3*60*5)}),F(()=>{clearInterval(B.value)}),J(n,()=>{p.value[c.gameId].gameData[n.value].length||j()}),(b,e)=>(l(),a(w,null,[s("div",Z,[G(x,{class:"w-1/2 md:w-1/4 rounded-r-none",type:"secondary",outlined:n.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=t=>n.value="highscores")},null,8,["outlined"]),G(x,{class:"w-1/2 md:w-1/4 rounded-l-none",type:"secondary",outlined:n.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=t=>n.value="scores")},null,8,["outlined"])]),s("div",ee,[s("table",te,[o(h).length?(l(),a("thead",se,[s("tr",null,[e[4]||(e[4]=s("th",null,"Rank",-1)),e[5]||(e[5]=s("th",null,"User",-1)),e[6]||(e[6]=s("th",null,"Score",-1)),o(h).length&&o(h).some(t=>t.difficulty)?(l(),a("th",oe,"Difficulty")):r("",!0),e[7]||(e[7]=s("th",null,"Date",-1)),o(h).length&&o(h).some(t=>t.bonus)?(l(),a("th",ne,"Bonus")):r("",!0)])])):r("",!0),o(h).length?(l(),a("tbody",le,[(l(!0),a(w,null,M(o(h),(t,R)=>(l(),a("tr",null,[s("th",null,v(R+1+o(D)*o(E)),1),s("th",null,v(L(t.userId??t.id)),1),s("td",null,[P(v(t.score)+" ",1),b.unit?(l(),a(w,{key:0},[P(v(b.unit),1),t.score!==1?(l(),a(w,{key:0},[P("s")],64)):r("",!0)],64)):r("",!0)]),t.difficulty?(l(),a("td",ae,v(t.difficulty),1)):o(h).some(N=>N.difficulty)?(l(),a("td",re)):r("",!0),s("td",null,v(o(O)(t.date)),1),t.bonus?(l(),a("td",ue,v(t.bonus),1)):o(h).some(N=>N.bonus)?(l(),a("td",ie)):r("",!0)]))),256))])):o(g)?(l(),a("tbody",ce,[s("tr",null,[s("th",null,v(o(K)("GENERAL_LOADING"))+" highscores...",1)])])):(l(),a("tbody",de,[s("tr",null,[s("th",null,"There are no "+v(n.value==="highscores"?"highscores":"scores")+" yet.",1)])])),o(I)||o(C)?(l(),a("tfoot",he,[s("tr",null,[s("td",ve,[s("div",{class:Q(["w-full p-2 flex",[o(I)?"justify-between":"justify-end"]])},[o(I)?(l(),U(x,{key:0,class:"w-fit",label:"Previous",type:"neutral",onClick:e[2]||(e[2]=t=>D.value-=1)})):r("",!0),o(C)?(l(),U(x,{key:1,class:"w-fit",label:"Next",type:"neutral",onClick:e[3]||(e[3]=t=>D.value+=1)})):r("",!0)],2)])])])):r("",!0)])])],64))}}),ge=X(fe,[["__scopeId","data-v-53ba3295"]]),_e=i=>{const c=W(),f=$(),{allGameData:d,highscorePosition:y,personalBest:p}=S(f),{firebaseUser:g}=S(c),m=u(()=>g.value?y.value:null),_=u(()=>{if(!i)return!1;const n=d.value[i].previousHighscorePosition;return m.value&&n?n>m.value:!1}),k=u(()=>{if(!i)return!1;const n=d.value[i].previousPersonalBest;return g.value&&n?n<p.value:!1});return A(()=>{f.$init(i)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:_,hasImprovedPersonalBest:k}};export{ge as H,_e as u};
