import{d as j,j as ae,E as re,F as le,q as se,u as oe,G as te,H as ue,s as _,I as ne,b as o,g as t,w as B,f as l,_ as ie,e as m,x as de,h as s,D as g,y as v,J as i,i as p,K as me,c as ve,R as V,z as d,v as pe,C as f,L as fe,M as F,N as we,O as ce}from"../bundle.js";import{_ as Pe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DI3Y1UAH.js";import{_ as Ne,a as U,b as be}from"./c-PasswordField.vue_vue_type_script_setup_true_lang-tE0yoL03.js";import{_ as ye}from"./c-Page.vue_vue_type_script_setup_true_lang-abQPoI-C.js";const ge={class:"flex flex-col md:flex-row pt-6 pb-8 mb-4 gap-3"},Ve={class:"basis-full lg:basis-1/2"},Ue={class:"flex gap-3 mt-10 flex-wrap"},ke={class:"basis-full lg:basis-1/2"},xe={key:0,class:"basis-full lg:basis-1/2 flex gap-3 mt-10 flex-wrap"},_e={class:"flex flex-col items-center content-center"},Ee={class:"flex flex-col gap-3 items-center content-center"},Se=j({__name:"Dashboard",setup(W){const E=ae(),Y=re(le).greaterOrEqual("md"),w=se(),S=oe(),$=te();ue();const{content:z,routeLoading:C}=_(S),{currentUser:u,publicUser:c,isMutationLoading:R}=_($),{firebaseUser:k,isOwner:x,isLogoutLoading:H}=_(w),{fetchAll:J}=S,{updateUser:K,updatePublicUser:Q}=$,P=d(!1),D=d(),A=d(),O=d(),T=d(),L=d(),N=d(),q=d(),X=d(),e=pe({firstName:{value:"",error:""},lastName:{value:"",error:""},displayName:{value:"",error:""},email:{value:"",error:""},newPassword:{value:"",error:""},currentPassword:{value:"",error:""},repeatPassword:{value:"",error:""},avatar:{value:"",error:""}}),Z=f(()=>({firstName:e.firstName.value,lastName:e.lastName.value})),h=f(()=>({displayName:e.displayName.value,avatar:e.avatar.value})),I=f(()=>!!u.value&&!F(we.convert(u.value),Z.value)),M=f(()=>!!c.value&&!F(ce.convert(c.value),h.value)),b=f(()=>e.email.value!==k.value?.email),y=f(()=>{const n=[];return I.value&&n.push("Details"),M.value&&n.push("Public Profile"),b.value&&n.push("E-mail"),e.newPassword.value&&n.push("Password"),n.length?"Save "+fe(n):void 0}),ee=async()=>{Object.keys(e).forEach(n=>e[n].error=""),e.newPassword.value&&(await Promise.all([L.value.test(),N.value.test(),q.value.test()]),!e.newPassword.error&&!e.currentPassword.error&&!e.repeatPassword.error&&(await w.updatePassword(e.newPassword.value,e.currentPassword.value),e.newPassword.value="",e.currentPassword.value="")),M.value&&(await O.value.test(),!e.displayName.error&&!e.avatar.error&&Q({displayName:e.displayName.value,avatar:e.avatar.value})),b.value&&(await Promise.all([T.value.test(),N.value.test()]),!e.email.error&&!e.currentPassword.error&&(await w.updateMail(e.email.value,e.currentPassword.value),e.currentPassword.value="")),I.value&&(await Promise.all([D.value.test(),A.value.test()]),!e.firstName.error&&!e.lastName.error&&K({firstName:e.firstName.value,lastName:e.lastName.value})),await J(!0)};return ne(()=>{e.firstName.value=u.value?.firstName||"",e.lastName.value=u.value?.lastName||"",e.displayName.value=c.value?.displayName||"",e.email.value=k.value?.email||"",e.avatar.value=c.value?.avatar||""}),(n,a)=>(o(),t(ye,null,{content:B(()=>[l(u)&&l(k)?(o(),t(ie,{key:0,class:"!bg-secondary-500 !bg-opacity-35 my-5",title:"Welcome "+l(u).firstName+(l(u).lastName?" "+l(u).lastName:""),description:l(z).dashboardDescription},{default:B(()=>[m("div",ge,[m("div",Ve,[m("form",{id:"accountForm",class:"flex flex-col gap-3",onSubmit:a[17]||(a[17]=de(r=>ee(),["prevent"]))},[s(g,{name:"accountType",label:"Account Type","model-value":l(x)?"Owner":"Member","input-props":{disabled:!0}},null,8,["model-value"]),s(g,{ref_key:"firstName",ref:D,name:"firstName",label:"First Name",placeholder:"Someone",modelValue:e.firstName.value,"onUpdate:modelValue":a[0]||(a[0]=r=>e.firstName.value=r),error:e.firstName.error,"onUpdate:error":a[1]||(a[1]=r=>e.firstName.error=r),rules:[l(v).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),s(g,{ref_key:"lastName",ref:A,name:"lastName",label:"Last Name",modelValue:e.lastName.value,"onUpdate:modelValue":a[2]||(a[2]=r=>e.lastName.value=r),error:e.lastName.error,"onUpdate:error":a[3]||(a[3]=r=>e.lastName.error=r),"min-length":3,"max-length":50},null,8,["modelValue","error"]),s(g,{ref_key:"displayName",ref:O,name:"displayName",label:"Public Username",modelValue:e.displayName.value,"onUpdate:modelValue":a[4]||(a[4]=r=>e.displayName.value=r),error:e.displayName.error,"onUpdate:error":a[5]||(a[5]=r=>e.displayName.error=r),rules:[l(v).MinLength],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),s(Ne,{ref_key:"email",ref:T,name:"email",label:"E-mail",modelValue:e.email.value,"onUpdate:modelValue":a[6]||(a[6]=r=>e.email.value=r),error:e.email.error,"onUpdate:error":a[7]||(a[7]=r=>e.email.error=r),rules:[l(v).Required]},null,8,["modelValue","error","rules"]),b.value?(o(),t(U,{key:0,ref_key:"currentPassword",ref:N,name:"currentPassword",label:"Current Password",modelValue:e.currentPassword.value,"onUpdate:modelValue":a[8]||(a[8]=r=>e.currentPassword.value=r),error:e.currentPassword.error,"onUpdate:error":a[9]||(a[9]=r=>e.currentPassword.error=r),rules:[l(v).Required]},null,8,["modelValue","error","rules"])):i("",!0),s(U,{ref_key:"newPassword",ref:L,name:"newPassword",label:"New Password",modelValue:e.newPassword.value,"onUpdate:modelValue":a[10]||(a[10]=r=>e.newPassword.value=r),error:e.newPassword.error,"onUpdate:error":a[11]||(a[11]=r=>e.newPassword.error=r),min:6,max:50},null,8,["modelValue","error"]),e.newPassword.value?(o(),t(U,{key:1,ref_key:"repeatPassword",ref:q,name:"repeatPassword",label:"Repeat New Password",modelValue:e.repeatPassword.value,"onUpdate:modelValue":a[12]||(a[12]=r=>e.repeatPassword.value=r),error:e.repeatPassword.error,"onUpdate:error":a[13]||(a[13]=r=>e.repeatPassword.error=r),rules:[l(v).Required],compare:{value:e.newPassword.value,name:"New Password"}},null,8,["modelValue","error","rules","compare"])):i("",!0),e.newPassword.value&&!b.value?(o(),t(U,{key:2,ref_key:"currentPassword",ref:N,name:"currentPassword",label:"Current Password",modelValue:e.currentPassword.value,"onUpdate:modelValue":a[14]||(a[14]=r=>e.currentPassword.value=r),error:e.currentPassword.error,"onUpdate:error":a[15]||(a[15]=r=>e.currentPassword.error=r),rules:[l(v).Required]},null,8,["modelValue","error","rules"])):i("",!0),m("div",Ue,[y.value?(o(),t(p,{key:0,class:"w-full",type:"submit",loading:l(R),label:y.value},null,8,["loading","label"])):i("",!0),l(x)?i("",!0):(o(),t(p,{key:1,class:"w-full",variant:"danger",outlined:"",label:"Delete account",onClick:a[16]||(a[16]=r=>P.value=!0)}))])],32)]),m("div",ke,[s(me,{ref_key:"avatar",ref:X,id:"avatar",name:"avatar",label:"Public Avatar",modelValue:e.avatar.value,"onUpdate:modelValue":a[18]||(a[18]=r=>e.avatar.value=r),error:e.avatar.error,"onUpdate:error":a[19]||(a[19]=r=>e.avatar.error=r),"is-public":"","blog-post":null,"image-props":{class:"rounded-full"},"image-container-props":{class:"!h-64 !w-64"}},null,8,["modelValue","error"])]),l(Y)?i("",!0):(o(),ve("div",xe,[y.value?(o(),t(p,{key:0,class:"w-full",type:"submit",form:"accountForm",loading:l(R),label:y.value},null,8,["loading","label"])):i("",!0),l(x)?i("",!0):(o(),t(p,{key:1,class:"w-full",variant:"danger",outlined:"",label:"Delete account",onClick:a[20]||(a[20]=r=>P.value=!0)}))]))]),m("div",_e,[s(be)]),m("div",Ee,[s(p,{class:"w-full md:w-1/2",label:"View Your Profile",variant:"purple",loading:l(C)===l(V).USER_DETAILS,onClick:a[21]||(a[21]=r=>l(E).push({name:l(V).USER_DETAILS,params:{userId:l(u).id}}))},null,8,["loading"]),s(p,{class:"w-full md:w-1/2",label:"View Your Pets",loading:l(C)===l(V).PET_OVERVIEW,route:l(V).PET_OVERVIEW},null,8,["loading","route"])])]),_:1},8,["title","description"])):i("",!0),s(Pe,{title:"Delete Account",isOpen:P.value,description:["Are you sure you want to delete your account?","This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":l(H),onConfirm:a[22]||(a[22]=r=>l(w).deleteAccount()),onCancel:a[23]||(a[23]=r=>P.value=!1)},null,8,["isOpen","confirm-loading"])]),_:1}))}}),Ae=j({__name:"Dashboard",setup(W){return(E,G)=>(o(),t(Se))}});export{Ae as default};
