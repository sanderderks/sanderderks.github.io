import{b9 as Q,bs as te,bt as ae,bg as ne,bh as T,bu as oe,ax as I,bv as se,bw as le,b5 as ie,be as re,q as ue,bx as ce,s as O,z as U,C as F,au as k,by as de,bz as pe,bA as J,d as R,bq as me,b as z,g as P,D as E,Y as ge,br as fe,U as ye,w as h,f as t,e as L,h as l,ab as ve,J as X,i as $,a7 as be,a8 as he,a9 as Ve,t as N,$ as G,aa as Be,a6 as De,ad as we,v as ke,E as ze,l as Ce,c as H,O as Y,I as _e,_ as Le,ai as xe,aj as x,k as S,n as Pe}from"../bundle.js";import{_ as Z}from"./c-Dialog.vue_vue_type_script_setup_true_lang-BvpiYg2Q.js";import{_ as Ue}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{u as Ne,D as $e,_ as qe}from"./c-useDateChart-DM47Wxlr.js";class j{id;name;size;category;buyLog;constructor({id:a,name:n,size:c,category:y,buyLog:o}={}){this.id=a??Q(),this.name=n??"",this.size=c??{value:0,unit:""},this.category=y??null,this.buyLog=o??[]}static deserialize(a){return new j({id:a.id,name:a.name,size:a.size,category:a.category??null,buyLog:a.buyLog.map(M.deserialize)})}serialize(){return{id:this.id,name:this.name,size:this.size,category:this.category,buyLog:this.buyLog.map(a=>a.serialize())}}}class M{date;price;quantity;constructor(a,n,c){this.date=a??new Date,this.price=n??0,this.quantity=c??1}static deserialize(a){return new M(a.date.toDate(),a.price,a.quantity)}serialize(){return{date:te.fromDate(this.date),price:this.price,quantity:this.quantity}}}function Se(g){return g.map(Oe)}function Oe(g){return j.deserialize(g)}class je{async fetchMultiple(a){return ae(ne(a,T.BOODSCHAPPEN))}async create(a,n){await oe(I(a,T.BOODSCHAPPEN,n.id),n)}async update(a,n){await se(I(a,T.BOODSCHAPPEN,n.id),{...n})}async delete(a,n){await le(I(a,T.BOODSCHAPPEN,n))}}const A=new je,W=ie("boodschappenStore",()=>{const g=re(),a=ue(),n=ce(),{firebaseUser:c}=O(a),{debug:y}=O(n),o=U([]),B=U(!1),b=U(!1),e=F(()=>o.value.reduce((u,m)=>{const s=m.category;return s&&!u.some(d=>d.id===s.id)&&u.push(s),u},[]));return{boodschappen:o,isFetchLoading:B,isMutationLoading:b,categories:e,$reset:()=>{o.value=[]},fetchBoodschappen:async()=>{if(!c.value){k.error("You must be logged in to fetch products.");return}try{B.value=!0;const u=await A.fetchMultiple(g);o.value=Se(u)}catch(u){k.firebaseError(y.value,u)}finally{B.value=!1}},createBoodschap:async u=>{if(!c.value){k.error("You must be logged in to create products.");return}try{b.value=!0,await A.create(g,u.serialize()),de(o,u),k.success("Successfully created product")}catch(m){k.firebaseError(y.value,m)}finally{b.value=!1}},updateBoodschap:async u=>{if(!c.value){k.error("You must be logged in to update products.");return}try{b.value=!0,await A.update(g,u.serialize()),pe(o,u,"id"),k.success("Successfully updated product")}catch(m){k.firebaseError(y.value,m)}finally{b.value=!1}},deleteBoodschap:async u=>{if(!c.value){k.error("You must be logged in to delete products.");return}try{b.value=!0,o.value.find(s=>s.id===u)&&(await A.delete(g,u),o.value=o.value.filter(s=>s.id!==u),k.success("Successfully deleted product"))}catch(m){k.firebaseError(y.value,m)}finally{b.value=!1}}}}),Fe=()=>{const g=W(),{boodschappen:a}=O(g),n=F(()=>[...a.value].sort((e,i)=>{const f=e.buyLog.at(-1),p=i.buyLog.at(-1),v=o(f?e:i)?.getTime()??0,V=o(p?i:e)?.getTime()??0;return v-V})),c=e=>[...e.buyLog].filter(i=>Number(i.quantity)>0&&!Number.isNaN(i.date.getTime())).sort((i,f)=>i.date.getTime()-f.date.getTime()),y=e=>c(e).at(-1)?.date??null,o=(e,i=new Date)=>{const f=c(e),p=e.size.value;if(!Number.isFinite(p)||p<=0)return null;if(f.length<2)return null;let v=0,V=0;for(let q=0;q<f.length-1;q++){const D=f[q],r=(f[q+1].date.getTime()-D.date.getTime())/J;!Number.isFinite(D.quantity)||D.quantity<=0||r<=0||(v+=D.quantity*p,V+=r)}if(V<=0||v<=0)return null;const u=v/V;if(!Number.isFinite(u)||u<=0)return null;const m=f.at(-1);if(!m)return null;const s=m.quantity;if(!Number.isFinite(s)||s<=0)return null;const C=s*p/u;if(!Number.isFinite(C)||C<=0)return null;const w=new Date(m.date.getTime()+C*J);return w.getTime()<i.getTime()?i:w};return{sortedBoodschappen:n,getLatestPurchaseDate:y,getProjectedOutOfStockDate:o,getPricePerUnit:e=>{const i=c(e).at(-1);return!i||!Number.isFinite(i.price)||!Number.isFinite(i.quantity)||i.quantity<=0?null:i.price/i.quantity},getPriceIncreasePercentage:e=>{const i=c(e);if(i.length<2)return 0;const f=i.at(-1),p=i.at(-2);return!Number.isFinite(f.price)||!Number.isFinite(f.quantity)||!Number.isFinite(p.price)||!Number.isFinite(p.quantity)||p.quantity===0?0:(f.price/f.quantity-p.price/p.quantity)/(p.price/p.quantity)*100}}},K=R({__name:"NumberField",props:fe({id:{},name:{},label:{},placeholder:{},error:{},rules:{},inputProps:{},labelProps:{},minLength:{},maxLength:{},minValue:{},maxValue:{},compare:{},deleteButton:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const a=g,n=me(g,"modelValue"),c=F({get:()=>n.value.toString(),set:y=>{try{const o=parseFloat(y);isNaN(o)?n.value=0:n.value=o}catch{n.value=0}}});return(y,o)=>(z(),P(E,ge(a,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=B=>c.value=B),"input-props":{...a.inputProps,type:"number"}}),null,16,["modelValue","input-props"]))}}),Te={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ae={class:"flex gap-3"},Ee={class:"w-full flex gap-3"},Re={class:"flex gap-5"},Me={class:"flex flex-col gap-3"},Ie=R({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(g,{emit:a}){const n=g,c=a,y=W(),{isMutationLoading:o,categories:B}=O(y),b=U(!1),e=ke({name:"",category:null,sizeValue:0,sizeUnit:"",buyLog:[]}),i=F(()=>[{value:null,label:"Geen categorie"},...B.value.map(m=>({value:m,label:m.label}))]);function f(){n.selectedBoodschap?(n.selectedBoodschap.name=e.name,n.selectedBoodschap.category=e.category,n.selectedBoodschap.size={value:e.sizeValue,unit:e.sizeUnit},n.selectedBoodschap.buyLog=[...e.buyLog],y.updateBoodschap(n.selectedBoodschap)):y.createBoodschap(new j({name:e.name,category:e.category,size:{value:e.sizeValue,unit:e.sizeUnit},buyLog:[...e.buyLog]})),c("close")}function p(){c("close")}function v(){b.value=!0,e.category={id:Q(),label:""}}function V(){b.value=!1,e.category=null}function u(){e.buyLog.push(new M)}return ye(()=>n.isOpen,()=>{const m=n.selectedBoodschap??new j;Object.assign(e,{...m,sizeValue:m.size.value,sizeUnit:m.size.unit,buyLog:[...m.buyLog]}),b.value=!1},{immediate:!0}),(m,s)=>(z(),P(Z,{"is-open":g.isOpen,title:n.selectedBoodschap?`Bewerk ${n.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":n.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":t(o),onConfirm:f,onCancel:p},{default:h(()=>[L("div",Te,[l(E,{name:"name",label:"Naam",modelValue:e.name,"onUpdate:modelValue":s[0]||(s[0]=d=>e.name=d)},null,8,["modelValue"]),L("div",Ae,[b.value?e.category?(z(),P(E,{key:1,class:"w-full",name:"category",label:"Categorie",modelValue:e.category.label,"onUpdate:modelValue":s[2]||(s[2]=d=>e.category.label=d)},null,8,["modelValue"])):X("",!0):(z(),P(ve,{key:0,class:"w-full",name:"category",label:"Categorie",modelValue:e.category,"onUpdate:modelValue":s[1]||(s[1]=d=>e.category=d),options:i.value},null,8,["modelValue","options"])),b.value?(z(),P($,{key:3,class:"h-fit place-self-end",icon:"pi pi-times","icon-only":"",variant:"neutral",onClick:V})):(z(),P($,{key:2,class:"h-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",onClick:v}))]),L("div",Ee,[l(K,{name:"sizeValue",label:"Formaat",modelValue:e.sizeValue,"onUpdate:modelValue":s[3]||(s[3]=d=>e.sizeValue=d)},null,8,["modelValue"]),l(E,{name:"sizeUnit",label:"Eenheid",modelValue:e.sizeUnit,"onUpdate:modelValue":s[4]||(s[4]=d=>e.sizeUnit=d)},null,8,["modelValue"])]),s[7]||(s[7]=L("b",null,"Logboek",-1)),l(t(we),{ref:"draggable",class:"flex flex-col gap-3",modelValue:e.buyLog,"onUpdate:modelValue":s[5]||(s[5]=d=>e.buyLog=d),itemKey:d=>d.date.toString(),handle:".drag-handle"},{item:h(({element:d,index:C})=>[l(t(be),null,{default:h(()=>[l(t(he),{value:"0"},{default:h(()=>[l(t(Ve),{class:"drag-handle"},{default:h(()=>[L("div",Re,[s[6]||(s[6]=L("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),L("p",null,N(t(G)(d.date)),1)])]),_:2},1024),l(t(Be),null,{default:h(()=>[L("div",Me,[l(De,{name:`buylog-date-${C}`,label:"Datum",modelValue:d.date,"onUpdate:modelValue":w=>d.date=w,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),l(K,{name:`buylog-quantity-${C}`,label:"Aantal",modelValue:d.quantity,"onUpdate:modelValue":w=>d.quantity=w},null,8,["name","modelValue","onUpdate:modelValue"]),l(K,{name:`buylog-price-${C}`,label:"Prijs",modelValue:d.price,"onUpdate:modelValue":w=>d.price=w},null,8,["name","modelValue","onUpdate:modelValue"]),l($,{variant:"danger",outlined:"",label:"Delete",onClick:w=>e.buyLog.splice(C,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),l($,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:u})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),He=R({__name:"ProductPriceChart",props:{product:{}},setup(g){const a=g,n=F(()=>a.product.buyLog.map(o=>({date:o.date,value:o.price/o.quantity}))),{headers:c,filteredData:y}=Ne(n,$e.MONTHS);return(o,B)=>(z(),P(qe,{headers:t(c),datasets:[{label:"Prijsverloop",fill:!1,borderColor:"orange",yAxisID:"y",tension:.4,data:t(y),spanGaps:!0}]},null,8,["headers","datasets"]))}}),Ye={class:"flex gap-3"},Qe=R({__name:"Boodschappen",setup(g){const a=W(),{isFetchLoading:n,isMutationLoading:c}=O(a),y=ze(_e),{sortedBoodschappen:o,getLatestPurchaseDate:B,getPricePerUnit:b,getPriceIncreasePercentage:e,getProjectedOutOfStockDate:i}=Fe(),f=y.greaterOrEqual("md"),p=U([]),v=U(null),V=U(!1),u=U(!1);function m(D){const _=p.value.findIndex(r=>r.id===D.data.id);_>=0?p.value.splice(_,1):p.value.push(D.data)}function s(){v.value=null,u.value=!0}function d(D){v.value=D,u.value=!0}function C(D){v.value=D,V.value=!0}function w(){v.value=null,u.value=!1}async function q(){v.value&&await a.deleteBoodschap(v.value.id),V.value=!1,v.value=null}return Ce(()=>{a.fetchBoodschappen()}),(D,_)=>(z(),H(Y,null,[l(Ue,null,{content:h(()=>[l(Le,{class:"!bg-primary-500 !bg-opacity-35 my-5",title:"De Booschappen Tool",description:"Dit gaat ons helpen bij het bijhouden van onze boodschappenlijst. We kunnen items toevoegen, verwijderen en markeren als gekocht. Laten we het proberen!"},{default:h(()=>[l(t(xe),{value:t(o),expandedRows:p.value,"onUpdate:expandedRows":_[0]||(_[0]=r=>p.value=r),tableStyle:"min-width: 40rem",loading:t(n),size:t(f)?void 0:"small",onRowClick:m},{empty:h(()=>[..._[2]||(_[2]=[S(" Er zijn nog geen boodschappen toegevoegd. Klik op de knop hieronder om er een toe te voegen! ",-1)])]),expansion:h(({data:r})=>[l(He,{product:r},null,8,["product"])]),default:h(()=>[l(t(x),{expander:"",style:{width:"5rem"}}),l(t(x),{field:"name",header:"Naam"}),l(t(x),{field:"category.label",header:"Categorie"}),t(f)?(z(),P(t(x),{key:0,header:"Formaat"},{body:h(({data:r})=>[S(N(r.size.value)+" "+N(r.size.unit),1)]),_:1})):X("",!0),l(t(x),{header:"Laatste aankoop"},{body:h(({data:r})=>[t(B)(r)?(z(),H(Y,{key:1},[S(N(t(G)(t(B)(r))),1)],64)):(z(),H(Y,{key:0},[S(" Nog niet gekocht ")],64))]),_:1}),l(t(x),{header:"Voorraad aanvullen op"},{body:h(({data:r})=>[S(N(t(i)(r)?t(G)(t(i)(r)):"Onbekend"),1)]),_:1}),l(t(x),{header:"Prijs"},{body:h(({data:r})=>[S(N(t(b)(r)?`â‚¬${t(b)(r).toFixed(2)}`:""),1)]),_:1}),l(t(x),{header:"Prijsstijging"},{body:h(({data:r})=>[L("span",{class:Pe(t(e)(r)>0?"text-red-500":t(e)(r)<0?"text-green-500":"")},N(t(e)(r)?`${t(e)(r).toFixed(2)}%`:""),3)]),_:1}),l(t(x),{header:"Acties"},{body:h(({data:r})=>[L("div",Ye,[l($,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:t(c),onClick:ee=>d(r)},null,8,["loading","onClick"]),l($,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:t(c),onClick:ee=>C(r)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","loading","size"]),l($,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(c),onClick:s},null,8,["loading"])]),_:1})]),_:1}),l(Ie,{"is-open":u.value,selectedBoodschap:v.value,onClose:w},null,8,["is-open","selectedBoodschap"]),l(Z,{title:"Product verwijderen","is-open":V.value,description:[v.value?`Weet je zeker dat je het product '${v.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":t(c),onConfirm:q,onCancel:_[1]||(_[1]=r=>V.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{Qe as default};
