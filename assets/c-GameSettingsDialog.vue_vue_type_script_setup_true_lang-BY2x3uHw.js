import{_ as oe,a as ue}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-JQE6dSwt.js";import{_ as q}from"./c-SelectField.vue_vue_type_script_setup_true_lang-Bu9S1e-e.js";import{d as ie,aG as X,aH as T,s as B,r as m,a as te,c as p,aK as j,aI as D,aL as ne,aM as z,aJ as ve,e as ce,bQ as re,cx as de,l as k,q as W,D as fe,n as pe,k as V,ab as M,t as J}from"../bundle.js";var ge=(a=>(a[a.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",a[a.HAS_STARTED=1]="HAS_STARTED",a[a.HAS_THROWN_DICES=2]="HAS_THROWN_DICES",a[a.HAS_CHOSEN_DICES=3]="HAS_CHOSEN_DICES",a[a.HAS_CHOSEN_TILE=4]="HAS_CHOSEN_TILE",a[a.HAS_LOST=5]="HAS_LOST",a[a.HAS_FINISHED=6]="HAS_FINISHED",a))(ge||{}),me=(a=>(a[a.NONE=0]="NONE",a[a.HAS_LOST_TILE=1]="HAS_LOST_TILE",a[a.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",a))(me||{}),Te=(a=>(a[a.NONE=0]="NONE",a[a.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",a[a.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",a[a.LOSER=3]="LOSER",a))(Te||{}),Se=(a=>(a[a.PLAYER=0]="PLAYER",a[a.ROBOT=1]="ROBOT",a))(Se||{});const ye=a=>{for(let S=1;S<=6;S++)if(a.every(E=>E.value===S))return!0;return!1},K=()=>({0:[],1:[]}),Ee=ie("rainwormsStore",()=>{const a=X(T.RAINWORMS)(),{personalBest:S,highscorePosition:E}=B(a),{setPreviousHighscores:h,updateHighscores:R,sortHighscores:A}=a,y=m(1),u=m(0),t=m(0),v=m(0),_=m(0),d=m(0),i=m(Q()),n=m(G()),f=te(K()),I=p(()=>i.value.some(e=>e.isRolling)),P=p(()=>i.value.filter(e=>e.selected).some(e=>e.value===6)),H=p(()=>e=>i.value.some(s=>s.value===e&&s.selected)),F=p(()=>e=>n.value.some(s=>s.displayValue<=e)),N=p(()=>e=>d.value===(e??0)),w=p(()=>e=>{const s=f[e??0];return s.length?s[s.length-1]:null}),r=p(()=>{let e=0;return i.value.filter(s=>s.selected).forEach(s=>{e+=s.value===6?5:s.value}),e}),b=p(()=>e=>{let s=0;return f[e].forEach(l=>{s+=l.value}),s}),ee=()=>{u.value=0,t.value=0,v.value=0,_.value=0,d.value=0,i.value=Q(),n.value=G(),Object.assign(f,K()),h()},le=()=>{u.value=1},g=e=>{if(!N.value(e))return;(u.value===1||u.value===4||u.value===5)&&i.value.forEach(l=>{l.selected=!1}),u.value=2;const s=a.diceRollSpeed*1e3;i.value.forEach(l=>{l.selected||(l.isRolling=!0,setTimeout(()=>{l.value=j(6),l.isRolling=!1,i.value.sort((o,c)=>o.value-c.value),!I.value&&u.value!==5&&Y()&&U(e)},j(s,s/3)))}),D(ne)},$=async()=>{for(;I.value;)await new Promise(e=>setTimeout(e,500));return!0},Y=()=>{const e=i.value.filter(s=>!s.selected&&!H.value(s.value));return!e.length||ye(e)&&e.every(s=>s.value!==6)},U=e=>{u.value=5,t.value=e??0,f[t.value].length?_.value=1:_.value=2,x(),n.value.length===0?u.value=6:L()},x=()=>{const e=f[d.value];if(e.length){const s=e.splice(e.length-1,1)[0];n.value.push(s),n.value.sort((l,o)=>l.displayValue-o.displayValue)}n.value.splice(n.value.length-1,1)},C=(e,s)=>{N.value(s)&&!I.value&&u.value===2&&!e.selected&&!H.value(e.value)&&(u.value=3,i.value.filter(l=>l.value===e.value).forEach(l=>{l.selected=!0}),D(z))},O=(e,s,l)=>{if(N.value(l)&&(u.value===2||u.value===3)){if(u.value=4,t.value=l??0,s){const o=f[d.value===0?1:0];o.splice(o.length-1,1)}else n.value=n.value.filter(o=>o.displayValue!==e.displayValue);f[d.value].push(e),D(z),n.value.length===0?u.value=6:L()}},L=e=>{(d.value===1||u.value!==5||e)&&(d.value===0?setTimeout(()=>{d.value=1,setTimeout(()=>{u.value=1,t.value=0},1e3)},e?0:y.value*1e3*2):setTimeout(()=>{d.value=0},e?0:y.value*1e3*2))},ae=async()=>{switch(u.value){case 1:{g(1);break}case 2:{await $(),setTimeout(()=>{const e=i.value.filter(l=>!l.selected),s=w.value(0);if(s&&r.value<s.displayValue)for(let l=6;l>=1;l--){const o=e.filter(c=>c.value===l&&!H.value(l));if(o.length){const c=o.length*(l===6?5:l);if(r.value+c===s.displayValue){C(o[0],1);return}}}for(let l=6;l>=1;l--){const o=i.value.find(c=>c.value===l);if(o&&!H.value(l)){C(o,1);return}}},y.value*1e3);break}case 3:{setTimeout(()=>{const e=w.value(0),s=i.value.filter(l=>!l.selected).length;if(!s||r.value>=30){console.log(s?"i am rich":"i can only pick a tile now");for(let l=r.value;l>=21;l--){const o=n.value.find(c=>c.displayValue===l);if(o){O(o,!1,1);return}}s&&g(1)}if(n.value.every(l=>l.displayValue>r.value)&&e&&e.displayValue>r.value)console.log("my score is too low"),g(1);else if(e&&e.displayValue===r.value)console.log("i can steal"),O(e,!0,1);else if(new Set(i.value.filter(l=>l.selected).map(l=>l.value)).size<=3)if(i.value.filter(l=>!l.selected).length<=2){console.log("there aren't that much dices left");const l=n.value.filter(o=>o.displayValue>=r.value-5&&o.displayValue<=r.value).sort((o,c)=>c.displayValue-o.displayValue);l.length?(console.log("i choose the highest score within 5 tiles"),O(l[0],!1,1)):(console.log("i choose to roll again"),g(1))}else console.log("i have nothing to worry about"),g(1);else if(!P.value)console.log("i am worrying and have no worm yet"),g(1);else{console.log("if i can choose, i choose");const l=n.value.filter(o=>o.displayValue<=r.value).sort((o,c)=>c.displayValue-o.displayValue);l.length?(console.log("i choose the highest score"),O(l[0],!1,1)):(console.log("i choose to roll again"),g(1))}},y.value*1e3);break}default:console.log("DEFAULT",u.value)}},se=()=>{const e=b.value(0),s=b.value(1);e>s?v.value=1:e===s&&Math.max(...f[0].map(l=>l.displayValue))>Math.max(...f[1].map(l=>l.displayValue))?v.value=2:v.value=3,(v.value===1||v.value===2)&&(Z(),D(ve))},Z=()=>{R({score:b.value(0)})};return{gameStatus:u,gameStatusActivator:t,finishStatus:v,loseStatus:_,activePlayer:d,dices:i,tiles:n,score:f,robotSpeed:y,isRolling:I,hasWorm:P,hasAlreadyChosen:H,canSelectAnyTile:F,canPlay:N,visibleTile:w,selectedDiceTotal:r,totalScore:b,personalBest:S,highscorePosition:E,$reset:ee,start:le,roll:g,hasFinishedRolling:$,hasLostRound:Y,loseTurn:U,popLastTile:x,selectDice:C,selectTile:O,passTurn:L,playRobot:ae,checkFinishStatus:se,setPreviousHighscores:h,updateRainwormsHighscore:Z,sortHighscores:A}},{persist:{enabled:!0}}),Q=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],G=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],Ae=ce({__name:"GameSettingsDialog",props:re({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(a){const S=a,E=de(a,"isOpen"),{useAudio:h,diceRollSpeed:R}=B(X(T.YAHTZEE)()),{robotSpeed:A}=B(Ee()),y=p(()=>{switch(S.gameId){case T.YAHTZEE:return"v5 (12-12-2024)";case T.RAINWORMS:return"v5 (12-12-2024)";case T.PATIENCE:return"v2 (16-12-2024)"}});return(u,t)=>(k(),W(ue,{isOpen:E.value,title:"Game Settings",description:u.gameId?`Current version: ${y.value}`:"General settings",cancelText:"Close",onCancel:t[3]||(t[3]=v=>E.value=!1)},{default:fe(()=>[pe(oe,{name:"useAudio",label:"Audio",modelValue:V(h),"onUpdate:modelValue":t[0]||(t[0]=v=>M(h)?h.value=v:null)},null,8,["modelValue"]),u.gameId===V(T).YAHTZEE||u.gameId===V(T).RAINWORMS?(k(),W(q,{key:0,name:"diceSpeed",label:"Dice rolling speed",modelValue:V(R),"onUpdate:modelValue":t[1]||(t[1]=v=>M(R)?R.value=v:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):J("",!0),u.gameId===V(T).RAINWORMS?(k(),W(q,{key:1,name:"robotSpeed",label:"Rainworms robot speed",modelValue:V(A),"onUpdate:modelValue":t[2]||(t[2]=v=>M(A)?A.value=v:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):J("",!0)]),_:1},8,["isOpen","description"]))}});export{Te as F,ge as G,me as L,Se as P,Ae as _,Ee as u};
