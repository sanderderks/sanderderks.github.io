import{a as K,al as Y,s as C,l as fe,av as ye,aw as ke,ax as de,ay as pe,az as j,aA as ge,q as Q,z as i,d as L,u as be,G as re,b as w,g as E,_ as H,f as e,R as N,a8 as le,n as G,aB as Ue,w as V,e as q,i as z,J as F,C as h,c as $,x as xe,h as u,D as Pe,ar as Ce,y as ne,P as A,Q as J,aC as Ve,aD as he,v as Te,aE as Be,aF as Re,ao as W,ap as Ie,aq as $e,j as Ee,as as De,at as se,aG as Oe,U as Ae,af as M,ag as Z,V as me,aH as _,aI as Le,aJ as Me,ab as je,aK as Ne,ac as ee,ad as te,k as oe,ae}from"../bundle.js";import{_ as we}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DI3Y1UAH.js";import{u as Ge}from"./c-useUsers-Cf6IoDz_.js";const qe=t=>{const s=K(),p=Y(),{blogPosts:S,isBlogPostDatabaseActionActive:k}=C(s);let a=[];const n=i(),m=d=>{d.metadata.hasPendingWrites||k.value||(clearTimeout(n.value),n.value=setTimeout(async()=>{await s.fetchBlogPost(t.id,void 0,{loadingIndicator:!1}),s.checkBlogPostForUnreadReactions(S.value.previousData.single,!0)},200))};fe(async()=>{p.unread=p.unread.filter(v=>v.postId!==t.id);const d=ye(t),b=s.collections.blogPosts(d.isPrivate),P=p.collections.blogReactions(d.isPrivate),c=ke(b,t.id),g=de(b,pe("id","==",t.id)),f=de(P,pe("post","==",c));a.push(j(g,m)),a.push(j(f,m))}),ge(()=>{clearTimeout(n.value),a.forEach(d=>{d()})})},at=()=>{const t=K(),s=Q(),p=Y(),{visibleBlogPosts:S,isBlogPostDatabaseActionActive:k}=C(t),{isLoggedIn:a}=C(s);let n=[];const m=i(),d=b=>{b.metadata.hasPendingWrites||k.value||(clearTimeout(m.value),m.value=setTimeout(async()=>{S.value.length&&(await t.fetchBlogPosts({amount:S.value.length,loadingIndicator:!1}),t.checkBlogPostsForUnreadReactions())},200))};fe(()=>{p.unread=[],n.push(j(t.collections.blogPosts(!1),d)),n.push(j(p.collections.blogReactions(!1),d)),a.value&&(n.push(j(t.collections.blogPosts(!0),d)),n.push(j(p.collections.blogReactions(!0),d)))}),ge(()=>{clearTimeout(m.value),n.forEach(b=>{b()})})},ze={class:"flex flex-col gap-2"},ve=L({__name:"BlogReaction",props:{post:{},reaction:{}},setup(t){const s=t,p=be(),S=Q(),k=re(),a=Y(),{routeLoading:n,routeLoadingId:m}=C(p),{firebaseUser:d,isLoggedIn:b,isOwner:P}=C(S),{publicUsers:c}=C(k),{isDatabaseDeletionActive:g}=C(a),f=h(()=>c.value.find(T=>T.id===s.reaction.userId)),v=h(()=>d.value&&s.reaction.userId===d.value.uid||P.value);return(T,B)=>{var U,y,r;return w(),E(H,{id:t.reaction.id,class:G(["p-5 w-full md:w-3/4 xl:w-2/3",t.post.colorTertiary,t.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":e(n)===e(N).USER_DETAILS&&e(m)===((U=f.value)==null?void 0:U.id)}},title:((y=f.value)==null?void 0:y.displayName)||"Unknown user",subTitle:e(le)(t.reaction.date),avatar:(r=f.value)==null?void 0:r.avatar,route:e(b)?{name:e(N).USER_DETAILS,params:{userId:t.reaction.userId}}:void 0,avatarRoute:e(b)?{name:e(N).USER_DETAILS,params:{userId:t.reaction.userId}}:void 0,description:t.reaction.message},Ue({_:2},[v.value?{name:"right",fn:V(()=>[q("div",ze,[v.value&&!t.post.locked?(w(),E(z,{key:0,variant:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:e(g),onClick:B[0]||(B[0]=I=>e(a).deleteBlogReaction(t.post,t.reaction.id,{mutatePost:!0,fetch:!0}))},null,8,["disabled"])):F("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"])}}}),Fe={class:"grid justify-items-center p-5 gap-5"},Qe=L({__name:"BlogReactions",props:{post:{}},setup(t){const s=t,p=be(),S=Q(),k=Y(),{content:a}=C(p),{firebaseUser:n,isLoggedIn:m}=C(S),{isDatabaseCreationActive:d}=C(k),b=i(),P=i(!1),c=Te({reaction:{value:"",error:""}}),g=h(()=>[...s.post.reactions].reverse()),f=h(()=>g.value.filter((U,y)=>y<3)),v=h(()=>g.value.filter((U,y)=>y>=3)),T=h(()=>s.post.locked||!m.value||d.value),B=async()=>{if(!d.value){if(await b.value.test(),!c.reaction.error&&n.value){const U=c.reaction.value;c.reaction.value="Replying...";const y=await k.createBlogReaction(s.post,new Be(n.value.uid,s.post.id,U));c.reaction.value=y?"":U}Re()}};return(U,y)=>(w(),$("form",{action:"",onSubmit:xe(B,["prevent"])},[q("div",Fe,[!e(m)||t.post.reactions.filter(r=>r.userId===e(n).uid).length<20?(w(),E(H,{key:0,class:G(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",t.post.colorTertiary||"bg-secondary-700",t.post.opacityTertiary||"bg-opacity-25"])},{default:V(()=>[u(Pe,{class:"w-5/6",id:t.post.id,inputProps:{class:["!bg-neutral-900 rounded-primary border-none !placeholder-gray-300",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-600",t.post.opacitySecondary||"!bg-opacity-20",T.value?{"!bg-gray-900 !bg-opacity-50":!e(d)}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!e(m)&&!t.post.locked}],disabled:T.value,autocomplete:"off"},ref_key:"reaction",ref:b,name:"reaction",placeholder:t.post.locked?"Locked for comments":e(m)?"Reply":e(a).blogLoginGuest,modelValue:c.reaction.value,"onUpdate:modelValue":y[0]||(y[0]=r=>c.reaction.value=r),error:c.reaction.error,"onUpdate:error":y[1]||(y[1]=r=>c.reaction.error=r),rules:[e(ne).Required],onClick:y[2]||(y[2]=()=>!e(m)&&!t.post.locked?e(Ce).push({name:e(N).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):F("",!0),(w(!0),$(A,null,J(f.value,r=>(w(),E(ve,{post:t.post,reaction:r},null,8,["post","reaction"]))),256)),(w(!0),$(A,null,J(v.value,r=>Ve((w(),E(ve,{post:t.post,reaction:r},null,8,["post","reaction"])),[[he,P.value]])),256)),t.post.reactions.length>3?(w(),E(z,{key:1,outlined:"",icon:P.value?"pi pi-angle-up":"pi pi-angle-down",label:P.value?"Hide older reactions":"View older reactions",onClick:y[3]||(y[3]=r=>P.value=!P.value)},null,8,["icon","label"])):F("",!0)])],32))}}),We={class:"flex flex-wrap justify-end h-fit gap-3"},He=L({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(t){return(s,p)=>(w(),$("div",We,[u(z,{class:"min-w-80",label:"Edit",onClick:p[0]||(p[0]=S=>s.$emit("editClicked"))}),u(z,{class:"min-w-80",variant:"danger",outlined:"",label:"Delete",onClick:p[1]||(p[1]=S=>s.$emit("deleteClicked"))})]))}}),Je={class:"flex justify-between h-fit mt-2 gap-2"},Ke={class:"flex flex-wrap gap-3"},lt=L({__name:"BlogPost",props:{post:{}},setup(t){const s=t,p=Ee(),S=Q(),k=re(),a=K(),n=W(),{publicUsers:m}=C(k),{firebaseUser:d,isOwner:b}=C(S),{deleteBlogPost:P}=a,c=i(!1);p.currentRoute.value.name!==N.BLOG&&qe(s.post);const g=h(()=>{var r;return(r=s.post.allowedUserIds)!=null&&r.length?m.value.filter(I=>{var x;return(x=s.post.allowedUserIds)==null?void 0:x.includes(I.id)}):[]}),f=h(()=>{const r=le(s.post.date);return s.post.dateUpdated?r+` - updated ${le(s.post.dateUpdated)}`:r}),v=h(()=>{const r=[];return s.post.datePinned&&r.push({value:"Pinned",severity:"success",rounded:!1}),s.post.locked&&r.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),s.post.archived&&r.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),r}),T=()=>{n.openWith(s.post)},B=()=>{c.value=!0},U=async()=>{await P(s.post.id)&&(c.value=!1)},y=()=>{const r=document.createElement("textarea"),{protocol:I,hostname:x,port:o}=window.location,l=`${I}//${x}`+(x==="localhost"?`:${o}`:"");r.value=`${l}#${De.BLOG.path}/${s.post.id}`,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),se.success("Copied link!")};return(r,I)=>(w(),$(A,null,[u(H,{id:t.post.id,class:G(["border-4 border-transparent","!rounded-primary",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-900",t.post.opacitySecondary||"bg-opacity-50"]),title:t.post.title,subTitle:f.value,tags:v.value,clickable:"",route:{name:e(N).BLOG_DETAILS,params:{postId:t.post.id}}},{right:V(()=>[u(z,{class:"h-fit",variant:"neutral",icon:"pi pi-copy",text:"",onClick:y})]),default:V(()=>{var x;return[q("div",Je,[q("div",Ke,[(w(!0),$(A,null,J(g.value,o=>{var l;return w(),E(e(Ie),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:o.id===((l=e(d))==null?void 0:l.uid)?"You":o.displayName,rounded:""},null,8,["label"])}),256))]),e(b)?(w(),$("div",{key:0,class:G(["flex justify-end ms-5",(x=t.post.allowedUserIds)!=null&&x.length?"flex-col md:flex-row":"flex-row"])},[u(He,{onEditClicked:T,onDeleteClicked:B})],2)):F("",!0)]),u(H,{class:G(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5 flex flex-col gap-3",t.post.colorPrimary,t.post.opacityPrimary||"bg-opacity-50"])},{default:V(()=>[(w(!0),$(A,null,J(t.post.content,o=>(w(),E($e,{key:o.id,post:t.post,block:o},null,8,["post","block"]))),128))]),_:1},8,["class"]),u(Qe,{post:t.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","route"]),u(we,{title:"Delete Post",isOpen:c.value,description:[` Are you sure you want to delete this post called '${t.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:U,onCancel:I[0]||(I[0]=x=>c.value=!1)},null,8,["isOpen","description"])],64))}}),Ye=L({__name:"BlogPostContentDialog",emits:["update:selected","error"],setup(t,{expose:s,emit:p}){const S=p,k=W(),{blogPostMutation:a}=C(k),n=i(),m=i(),d=h(()=>[m.value].some(P=>!!P));return s({test:async()=>{await Promise.all([n.value.test()]),S("error",d.value)}}),(P,c)=>(w(),$(A,null,[u(Pe,{ref_key:"title",ref:n,class:"w-full",name:"title",label:"Title",placeholder:"Amazing Post",modelValue:e(a).title,"onUpdate:modelValue":c[0]||(c[0]=g=>e(a).title=g),error:m.value,"onUpdate:error":c[1]||(c[1]=g=>m.value=g),rules:[e(ne).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),u(Oe,{modelValue:e(a).content,"onUpdate:modelValue":c[2]||(c[2]=g=>e(a).content=g)},null,8,["modelValue"])],64))}}),Xe=L({__name:"BlogPostSettingsDialog",emits:["error"],setup(t,{expose:s,emit:p}){const S=p,k=re(),a=W(),{blogPostMutation:n}=C(a),{allowedPublicUsers:m}=k,{mappedUsers:d}=Ge(),b=i(),P=i(),c=i(),g=i(),f=h({get(){return!!n.value.datePinned},set(o){n.value.datePinned=o?new Date:null}}),v=i(),T=i(),B=i(),U=i(),y=h(()=>[v.value,T.value,B.value,U.value].some(o=>!!o)),r=i([]),I=o=>{n.value.allowedUserIds=o},x=async()=>{n.value.allowedUserIds.length&&!r.value.length&&(v.value="Invalid user ID's"),await Promise.all([P.value.test(),c.value.test(),g.value.test()]),S("error",y.value)};return Ae(()=>n.value.allowedUserIds,async o=>{r.value=await m(o)},{immediate:!0}),s({test:x}),(o,l)=>(w(),$(A,null,[u(M,{ref_key:"allowedUsers",ref:b,class:"w-full md:w-1/2",name:"allowedUserIds",label:"Allowed users",placeholder:"This post is public","model-value":e(n).allowedUserIds,error:v.value,"onUpdate:error":l[0]||(l[0]=D=>v.value=D),"onUpdate:arrayValue":I,options:e(d),multiple:""},null,8,["model-value","error","options"]),u(Z,{ref_key:"pinned",ref:g,class:"w-full md:w-1/2",name:"pinned",label:"Pinned",modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=D=>f.value=D)},null,8,["modelValue"]),u(Z,{ref_key:"locked",ref:P,class:"w-full md:w-1/2",name:"locked",label:"Locked for commenting",modelValue:e(n).locked,"onUpdate:modelValue":l[2]||(l[2]=D=>e(n).locked=D)},null,8,["modelValue"]),u(Z,{ref_key:"archived",ref:c,class:"w-full md:w-1/2",name:"archived",label:"Archived",modelValue:e(n).archived,"onUpdate:modelValue":l[3]||(l[3]=D=>e(n).archived=D)},null,8,["modelValue"])],64))}}),Ze=L({__name:"BlogPostStylingDialog",emits:["error"],setup(t,{expose:s,emit:p}){const S=p,k=W(),{blogPostMutation:a}=C(k),n=i(),m=i(),d=i(),b=i(),P=i(),c=i(),g=i(),f=i(),v=i(),T=i(),B=i(),U=i(),y=h(()=>[g.value,f.value,v.value,T.value,B.value,U.value].some(x=>!!x)),r=h(()=>Me(me.find(x=>x.value===a.value.colorPrimary)));return s({test:async()=>{await Promise.all([n.value.test(),m.value.test(),d.value.test(),b.value.test(),P.value.test(),c.value.test()]),S("error",y.value)}}),(x,o)=>(w(),$(A,null,[u(M,{ref_key:"colorPrimary",ref:n,class:"w-full md:w-1/2",name:"colorPrimary",label:"Primary Style",modelValue:e(a).colorPrimary,"onUpdate:modelValue":o[0]||(o[0]=l=>e(a).colorPrimary=l),error:g.value,"onUpdate:error":o[1]||(o[1]=l=>g.value=l),options:e(me),rules:[e(ne).Required]},null,8,["modelValue","error","options","rules"]),u(M,{ref_key:"opacityPrimary",ref:b,class:"w-full md:w-1/2",name:"opacityPrimary",label:"Primary Opacity",modelValue:e(a).opacityPrimary,"onUpdate:modelValue":o[2]||(o[2]=l=>e(a).opacityPrimary=l),error:T.value,"onUpdate:error":o[3]||(o[3]=l=>T.value=l),options:e(_)},null,8,["modelValue","error","options"]),u(M,{ref_key:"colorSecondary",ref:m,class:"w-full md:w-1/2",name:"colorSecondary",label:"Secondary Style",modelValue:e(a).colorSecondary,"onUpdate:modelValue":o[4]||(o[4]=l=>e(a).colorSecondary=l),error:f.value,"onUpdate:error":o[5]||(o[5]=l=>f.value=l),options:r.value},null,8,["modelValue","error","options"]),u(M,{ref_key:"opacitySecondary",ref:P,class:"w-full md:w-1/2",name:"opacitySecondary",label:"Secondary Opacity",modelValue:e(a).opacitySecondary,"onUpdate:modelValue":o[6]||(o[6]=l=>e(a).opacitySecondary=l),error:B.value,"onUpdate:error":o[7]||(o[7]=l=>B.value=l),options:e(_)},null,8,["modelValue","error","options"]),u(M,{ref_key:"colorTertiary",ref:d,class:"w-full md:w-1/2",name:"colorTertiary",label:"Tertiary Style",modelValue:e(a).colorTertiary,"onUpdate:modelValue":o[8]||(o[8]=l=>e(a).colorTertiary=l),error:v.value,"onUpdate:error":o[9]||(o[9]=l=>v.value=l),options:e(Le)},null,8,["modelValue","error","options"]),u(M,{ref_key:"opacityTertiary",ref:c,class:"w-full md:w-1/2",name:"opacityTertiary",label:"Tertiary Opacity",modelValue:e(a).opacityTertiary,"onUpdate:modelValue":o[10]||(o[10]=l=>e(a).opacityTertiary=l),error:U.value,"onUpdate:error":o[11]||(o[11]=l=>U.value=l),options:e(_)},null,8,["modelValue","error","options"])],64))}}),_e={ref:"dialog",class:"pt-6 mb-4 xl:px-16"},st=L({__name:"BlogPostDialog",emits:["scroll-to-updated"],setup(t,{emit:s}){const p=s,S=Q(),k=K(),a=W(),{firebaseUser:n}=C(S),{isBlogPostsMutationLoading:m}=C(k),{createBlogPost:d,updateBlogPost:b,deleteFilesOfBlogPost:P,toggleBlogPostVisibility:c}=k,{isOpen:g,blogPostOriginal:f,blogPostMutation:v,hasChanges:T}=C(a),B=i(),U=i(),y=i(),r=i(!1),I=i(!1),x=i(!1),o=h(()=>{var X,R,O,ie,ue,ce;return!!((R=(X=f.value)==null?void 0:X.allowedUserIds)!=null&&R.length)&&!((O=v.value.allowedUserIds)!=null&&O.length)||!((ue=(ie=f.value)==null?void 0:ie.allowedUserIds)!=null&&ue.length)&&!!((ce=v.value.allowedUserIds)!=null&&ce.length)}),l=h(()=>ye(f.value)),D=async()=>{await Promise.all([B.value.test(),U.value.test(),y.value.test()]),!(r.value||I.value||x.value)&&(f.value?o.value?(a.isOpen=!1,await c(f.value,v.value.allowedUserIds.length?"private":"public")&&(a.close(),se.success("Successfully updated Post Visibility"),p("scroll-to-updated",v.value.id))):await b(v.value,l.value)&&(se.success("Successfully updated Post"),a.close(),p("scroll-to-updated",v.value.id)):await d(v.value)&&(a.close(),p("scroll-to-updated",v.value.id)))},Se=async()=>{P(v.value,f.value??void 0),a.close()};return(X,R)=>(w(),E(we,{isOpen:e(g),title:e(f)?"Update Post":"Create Post",description:e(f)?"Update this post":"Create a new post","confirm-text":e(f)?"Update":"Create","confirm-loading":e(m),"confirm-props":{disabled:!e(T)},onConfirm:D,onCancel:Se},{default:V(()=>[q("form",_e,[e(g)?(w(),E(e(je),{key:0,"active-index":0,onTabOpen:e(Ne)},{default:V(()=>[u(e(ee),{value:"content"},{default:V(()=>[u(e(te),null,{default:V(()=>[...R[3]||(R[3]=[oe(" Content ",-1)])]),_:1}),u(e(ae),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:V(()=>[u(Ye,{ref_key:"content",ref:B,onError:R[0]||(R[0]=O=>r.value=O)},null,512)]),_:1})]),_:1}),u(e(ee),{value:"styling"},{default:V(()=>[u(e(te),null,{default:V(()=>[...R[4]||(R[4]=[oe(" Styling ",-1)])]),_:1}),u(e(ae),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:V(()=>[u(Ze,{ref_key:"styling",ref:U,onError:R[1]||(R[1]=O=>I.value=O)},null,512)]),_:1})]),_:1}),u(e(ee),{value:"settings"},{default:V(()=>[u(e(te),null,{default:V(()=>[...R[5]||(R[5]=[oe(" Settings ",-1)])]),_:1}),u(e(ae),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:V(()=>[u(Xe,{ref_key:"settings",ref:y,onError:R[2]||(R[2]=O=>x.value=O)},null,512)]),_:1})]),_:1})]),_:1},8,["onTabOpen"])):F("",!0)],512)]),_:1},8,["isOpen","title","description","confirm-text","confirm-loading","confirm-props"]))}});export{lt as _,st as a,He as b,at as u};
