import{_ as re}from"./c-Page.vue_vue_type_script_setup_true_lang-3zQkaq1W.js";import{ak as de,al as ce,b as t,c as i,Y as P,r as E,J as m,e as n,d as F,q as Y,a as q,am as ue,s as w,l as Z,an as pe,ao as fe,R as L,f as s,h as v,g as u,B as me,j as ee,C as R,i as O,u as te,G as se,ap as oe,z as D,O as N,w as A,aq as V,n as j,Q as H,ar as ve,as as Q,t as ge,_ as W,at as ye,au as he,$ as K,U as ae,W as be,av as J}from"../bundle.js";import{_ as ke}from"./c-BackButton.vue_vue_type_script_setup_true_lang-DVCFWGtb.js";import{_ as le,b as X,u as $e,a as we}from"./c-BlogPostDialog.vue_vue_type_script_setup_true_lang-C5Fw6UVS.js";import{_ as xe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import"./c-useUsers-Rsmxr7ei.js";var Ce=`
    .p-card {
        background: dt('card.background');
        color: dt('card.color');
        box-shadow: dt('card.shadow');
        border-radius: dt('card.border.radius');
        display: flex;
        flex-direction: column;
    }

    .p-card-caption {
        display: flex;
        flex-direction: column;
        gap: dt('card.caption.gap');
    }

    .p-card-body {
        padding: dt('card.body.padding');
        display: flex;
        flex-direction: column;
        gap: dt('card.body.gap');
    }

    .p-card-title {
        font-size: dt('card.title.font.size');
        font-weight: dt('card.title.font.weight');
    }

    .p-card-subtitle {
        color: dt('card.subtitle.color');
    }
`,Se={root:"p-card p-component",header:"p-card-header",body:"p-card-body",caption:"p-card-caption",title:"p-card-title",subtitle:"p-card-subtitle",content:"p-card-content",footer:"p-card-footer"},Pe=de.extend({name:"card",style:Ce,classes:Se}),_e={name:"BaseCard",extends:ce,style:Pe,provide:function(){return{$pcCard:this,$parentInstance:this}}},ne={name:"Card",extends:_e,inheritAttrs:!1};function Be(e,l,g,x,k,d){return t(),i("div",P({class:e.cx("root")},e.ptmi("root")),[e.$slots.header?(t(),i("div",P({key:0,class:e.cx("header")},e.ptm("header")),[E(e.$slots,"header")],16)):m("",!0),n("div",P({class:e.cx("body")},e.ptm("body")),[e.$slots.title||e.$slots.subtitle?(t(),i("div",P({key:0,class:e.cx("caption")},e.ptm("caption")),[e.$slots.title?(t(),i("div",P({key:0,class:e.cx("title")},e.ptm("title")),[E(e.$slots,"title")],16)):m("",!0),e.$slots.subtitle?(t(),i("div",P({key:1,class:e.cx("subtitle")},e.ptm("subtitle")),[E(e.$slots,"subtitle")],16)):m("",!0)],16)):m("",!0),n("div",P({class:e.cx("content")},e.ptm("content")),[E(e.$slots,"content")],16),e.$slots.footer?(t(),i("div",P({key:1,class:e.cx("footer")},e.ptm("footer")),[E(e.$slots,"footer")],16)):m("",!0)],16)],16)}ne.render=Be;const Ie={key:0,class:"flex justify-center mt-5"},Le={key:1,class:"flex flex-col gap-3"},Oe=F({__name:"BlogDetails",setup(e){const l=me(),g=ee(),x=Y(),k=q(),d=ue(),{isLoggedIn:y}=w(x),{currentBlogPost:h,isFetchLoading:$}=w(k),{fetchBlogPost:C}=k,p=R(()=>l.params.postId);return Z(async()=>{var c;if(d.unread=[],p.value&&((c=h.value)==null?void 0:c.id)!==p.value){const f=await C(p.value);if(pe(f)&&f===fe.PERMISSION_DENIED&&!y.value){g.push({name:L.LOGIN,params:{redirect:JSON.stringify({name:L.BLOG_DETAILS,params:{postId:p.value}})}});return}}}),(c,f)=>s($)?(t(),i("div",Ie,[v(O,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:"",label:"Loading..."})])):(t(),i("div",Le,[v(ke,{"back-route":s(L).BLOG,label:"Back to other posts"},null,8,["back-route"]),s(h)?(t(),u(le,{key:0,post:s(h)},null,8,["post"])):m("",!0)]))}}),De={class:"flex gap-3"},Ue={class:"min-h-[50vh] flex flex-col"},Te={class:"flex justify-between h-fit mt-2 gap-2"},Ee={class:"flex flex-wrap gap-3"},Re={class:"relative mt-5 min-h-[20vh] max-h-screen flex flex-col justify-end"},Ne={class:"relative min-h-[20vh] max-h-full flex-grow"},Ae={class:"flex flex-col gap-1"},Ge={class:"flex justify-center mt-5"},Me={class:"flex justify-center mt-3"},je=F({__name:"BlogPostOverview",props:{post:{}},setup(e){const l=e,g=te(),x=Y(),k=se(),d=q(),y=oe(),{routeLoading:h,routeLoadingId:$}=w(g),{publicUsers:C}=w(k),{isOwner:p}=w(x),{deleteBlogPost:c}=d,f=D(!1),U=D(l.post.archived),S=R(()=>{var o;return(o=l.post.allowedUserIds)!=null&&o.length?C.value.filter(a=>{var b;return(b=l.post.allowedUserIds)==null?void 0:b.includes(a.id)}):[]}),_=R(()=>{const o=K(l.post.date);return l.post.dateUpdated?o+` - updated ${K(l.post.dateUpdated)}`:o}),T=R(()=>{const o=[];return l.post.datePinned&&o.push({value:"Pinned",severity:"success",rounded:!1}),l.post.locked&&o.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),l.post.archived&&o.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),o}),G=()=>{y.openWith(l.post)},B=()=>{f.value=!0},z=async()=>{await c(l.post.id)&&(f.value=!1)},r=()=>{const o=document.createElement("textarea"),{protocol:a,hostname:b,port:M}=window.location,I=`${a}//${b}`+(b==="localhost"?`:${M}`:"");o.value=`${I}#${ye.BLOG.path}/${l.post.id}`,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),he.success("Copied link!")};return(o,a)=>(t(),i(N,null,[v(W,{id:e.post.id,class:j([{"min-h-[50vh]":!U.value},"border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:_.value,tags:T.value,isCollapsed:U.value,clickable:"",route:{name:s(L).BLOG_DETAILS,params:{postId:e.post.id}}},{right:A(()=>[n("div",De,[U.value?s(p)?(t(),u(X,{key:1,onEditClicked:G,onDeleteClicked:B})):m("",!0):(t(),u(O,{key:0,class:"border-none h-fit",variant:"neutral",icon:"pi pi-copy",onClick:r}))])]),default:A(()=>{var b,M;return[n("div",Ue,[n("div",Te,[n("div",Ee,[S.value.length?(t(),i(N,{key:0},[v(s(V),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:(b=S.value[0])==null?void 0:b.displayName,rounded:""},null,8,["label"]),S.value.length>1?(t(),u(s(V),{key:0,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:"You",rounded:""})):m("",!0),S.value.length>2?(t(),u(s(V),{key:1,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",label:`${S.value.length-2} others`,rounded:""},null,8,["label"])):m("",!0)],64)):m("",!0)]),s(p)?(t(),i("div",{key:0,class:j(["flex justify-end ms-5",(M=e.post.allowedUserIds)!=null&&M.length?"flex-col md:flex-row":"flex-row"])},[v(X,{onEditClicked:G,onDeleteClicked:B})],2)):m("",!0)]),n("div",Re,[a[3]||(a[3]=n("div",{class:"absolute inset-0 rounded-primary bg-gradient-to-t from-neutral-500 to-transparent"},null,-1)),n("div",Ne,[v(s(ne),{class:j(["z-10 min-h-[20vh] p-5 text-neutral-300",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{content:A(()=>[n("div",Ae,[(t(!0),i(N,null,H(e.post.content.filter((I,ie)=>ie<2),I=>(t(),u(ve,{key:I.id,class:"max-h-[150px] overflow-hidden",post:e.post,block:I},null,8,["post","block"]))),128))])]),_:1},8,["class"])])]),n("div",Ge,[v(O,{class:"w-full md:w-1/2",variant:"neutral",label:"Read more",loading:s(h)===s(L).BLOG_DETAILS&&s($)===e.post.id,onClick:a[0]||(a[0]=I=>s(Q).push({name:s(L).BLOG_DETAILS,params:{postId:e.post.id}}))},null,8,["loading"])]),n("div",Me,[n("p",{class:j(e.post.reactions.length?"text-yellow-400 hover:text-yellow-500 cursor-pointer":"text-neutral-200"),onClick:a[1]||(a[1]=I=>s(Q).push({name:s(L).BLOG_DETAILS,params:{postId:e.post.id}}))},ge(e.post.reactions.length)+" replies ",3)])])]}),_:1},8,["id","class","title","subTitle","tags","isCollapsed","route"]),v(xe,{title:"Delete Post",isOpen:f.value,description:[` Are you sure you want to delete this post called '${e.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:z,onCancel:a[2]||(a[2]=b=>f.value=!1)},null,8,["isOpen","description"])],64))}}),Fe={class:"w-full grid gap-4 md:gap-10 xl:gap-20"},ze={key:2,class:"w-full flex justify-center mt-5"},Ve=F({__name:"BlogPosts",props:{single:{type:Boolean}},setup(e){const l=Y(),g=q(),x=oe(),{blogPosts:k,visibleBlogPosts:d,isFetchLoading:y,visibility:h,isLastPage:$,loadedOnce:C}=w(g),{firebaseUser:p,isLoggedIn:c,isOwner:f}=w(l),{fetchBlogPosts:U}=g;$e();const S=D(),_=D(),T=D(),G=()=>{x.openWith(null)},B=async r=>{g.visibility!==r&&(k.value[r].length||await U({visibility:r}),g.visibility=r,$.value=!1,J(S.value))},z=async()=>{const r=d.value.length;await U(),d.value[r]&&J(_.value[r])};return Z(()=>{C.value||(c.value?B("private"):h.value!=="public"&&B("public"),C.value=!0)}),ae(()=>{var r;return(r=_.value)==null?void 0:r.length},()=>{var r;if((r=_.value)!=null&&r.length&&T.value){const o=d.value.find(a=>a.id===T.value);if(o){const a=d.value.indexOf(o);J(_.value[a]),T.value=void 0}}}),(r,o)=>(t(),i("div",{ref_key:"container",ref:S,class:"flex flex-col gap-5 items-center"},[s(f)?(t(),u(O,{key:0,class:"w-full md:w-1/2",variant:"tertiary",label:"New Post",onClick:G})):m("",!0),s(c)?(t(),u(s(be),{key:1,class:"w-full md:w-1/2"},{default:A(()=>[v(O,{class:"w-full",variant:"secondary",outlined:s(h)!=="public",loading:s(y),label:"Public Posts",onClick:o[0]||(o[0]=a=>B("public"))},null,8,["outlined","loading"]),v(O,{class:"w-full",variant:"secondary",outlined:s(h)!=="private",loading:s(y),label:"Private Posts",onClick:o[1]||(o[1]=a=>B("private"))},null,8,["outlined","loading"])]),_:1})):m("",!0),n("div",Fe,[s(d).length?(t(!0),i(N,{key:0},H(s(d),(a,b)=>(t(),i("div",{key:a.id,ref_for:!0,ref_key:"posts",ref:_},[b===0||a.datePinned?(t(),u(le,{key:0,post:a},null,8,["post"])):(t(),u(je,{key:1,post:a},null,8,["post"]))]))),128)):s(y)?(t(),u(W,{key:1,class:"!bg-neutral-600 !bg-opacity-40 !rounded-primary",title:"Loading..."})):(t(),u(W,{key:2,class:"!bg-red-900 !bg-opacity-40 !rounded-primary",title:"No posts"}))]),s($)?m("",!0):(t(),i("div",ze,[v(O,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:s(d).length>0&&s(y),label:"Load more posts",onClick:z},null,8,["loading"])]))],512))}}),Je={class:"grid mt-10 md:mt-15"},We={class:"grid justify-center"},Ye={class:"text-lg md:text-xl text-white"},qe=["innerHTML"],He={class:"grid my-5 xl:px-20"},st=F({__name:"Blog",setup(e){const l=ee(),g=te(),x=se(),{menuItems:k,content:d}=w(g),{publicUser:y}=w(x),h=D(),$=D(l.currentRoute.value.params.postId),C=R(()=>{var p;return y.value?[...d.value.blogDescriptionUser.map(c=>c.replace("%USER%",y.value.displayName||"Unknown user")),...((p=k.value.find(c=>c.id==="nfNQM4SMESU2VOkJtcgY"))==null?void 0:p.description)||[]]:d.value.blogDescriptionGuest});return ae(l.currentRoute,p=>{$.value=p.params.postId}),(p,c)=>(t(),u(re,null,{content:A(()=>[n("div",Je,[n("div",We,[(t(!0),i(N,null,H(C.value,f=>(t(),i("h1",Ye,[n("span",{innerHTML:f},null,8,qe)]))),256))]),n("div",He,[$.value?(t(),u(Oe,{key:0})):(t(),u(Ve,{key:1})),v(we,{onScrollToUpdated:c[0]||(c[0]=f=>h.value=f)})])])]),_:1}))}});export{st as default};
