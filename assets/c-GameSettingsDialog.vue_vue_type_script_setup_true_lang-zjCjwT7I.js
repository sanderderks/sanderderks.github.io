import{_ as Ce}from"./c-Dialog.vue_vue_type_script_setup_true_lang-ChRuyxYJ.js";import{b6 as He,bg as pe,s as X,v as ye,l as Ae,be as V,U as Ie,z as E,C as R,bk as re,bn as Te,b7 as Pe,bl as Le,bd as De,q as Me,bc as z,bj as we,b9 as xe,bm as We,d as Ue,br as $e,b as ve,g as de,w as Be,e as je,h as Fe,bp as fe,f as K,af as be,J as Se,ae as _e,bs as Ge}from"../bundle.js";var Ye=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Ye||{});const Ee={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var qe=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(qe||{}),ze=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(ze||{});const Ke={easy:.5,hard:1},ke=()=>{const e=Je();return Pe(e),{pile1:e.splice(0,1).map(o=>({...o,deck:"pile1"})),pile2:e.splice(0,2).map((o,p)=>p<1?{...o,hidden:!0,deck:"pile2"}:{...o,deck:"pile2"}),pile3:e.splice(0,3).map((o,p)=>p<2?{...o,hidden:!0,deck:"pile3"}:{...o,deck:"pile3"}),pile4:e.splice(0,4).map((o,p)=>p<3?{...o,hidden:!0,deck:"pile4"}:{...o,deck:"pile4"}),pile5:e.splice(0,5).map((o,p)=>p<4?{...o,hidden:!0,deck:"pile5"}:{...o,deck:"pile5"}),pile6:e.splice(0,6).map((o,p)=>p<5?{...o,hidden:!0,deck:"pile6"}:{...o,deck:"pile6"}),pile7:e.splice(0,7).map((o,p)=>p<6?{...o,hidden:!0,deck:"pile7"}:{...o,deck:"pile7"}),stock_closed:e.map(o=>({...o,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},Ze=He("patienceStore",()=>{const e=pe(),{personalBest:o,highscorePosition:p}=X(e),{setPreviousHighscores:x,updateHighscores:W,sortHighscores:H}=e,D=E("hard"),C=E(0),M=E(0),N=E(0),I=E(0),O=E(0),ue=E(),ne=E(!0),v=ye(ke()),ee=R(()=>Ke[D.value]),Z=R(()=>Object.keys(v).flatMap(s=>v[s])),U=1e3,P=10,d=10,J=R(()=>{const s=N.value%10===0?N.value:Math.floor(N.value/10)*10,a=M.value*P,u=O.value*P,n=s+a+u,g=I.value*d;return Math.max(0,U-(n-g))}),j=R(()=>{const s=Math.floor(N.value/60),a=N.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),le=R(()=>v.hearts.length===13&&v.spades.length===13&&v.diamonds.length===13&&v.clubs.length===13);Ae(()=>{e.$init(V.PATIENCE),N.value&&C.value===1&&y()}),Ie(le,s=>{s&&C.value!==2&&(Q(),C.value=2,ie(),re(Le))});const r=()=>{Q(),M.value=0,N.value=0,I.value=0,O.value=0,C.value=0,Object.assign(v,ke()),e.setPreviousHighscores()},S=()=>{N.value=0,y(),C.value=1,setTimeout(()=>{_()},500)},y=()=>{ue.value&&Q(),ue.value=setInterval(()=>{N.value++},1e3)},Q=()=>{clearInterval(ue.value)},h=()=>{const s=v.stock_open;s.length&&(s.reverse(),G(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,v.stock_closed.push(a)}),s.splice(0,s.length),k(1))},T=s=>{const a=s.deck,u=Z.value.filter(n=>n.selected);if(a==="stock_closed"){const n=v.stock_closed,g=n.indexOf(s);if(g===n.length-1){const w=D.value==="hard"?g-2:g,b=w<0?0:w,B=n.filter((oe,ge)=>ge>=b);Y(),$(B,"stock_open",oe=>{oe.hidden=!1}),k(0)}}else if(a==="stock_open"){const n=v.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,u.length&&G(u[0],!1))}else if(u.length){const n=u[0];n===s?G(s,!1):ae(a)&&he(n,s)?s.value===n.value+1&&s.deck!==n.deck&&($(u,a),n.deck==="stock_open"?k(2):k(4)):u.length===1&&te(a)&&me(n,s)&&s.value===n.value-1&&(ce(n,a),k(3),n.hasBeenHome=!0)}else G(s,!0)},m=s=>{const a=Z.value.filter(u=>u.selected);if(a.length){const u=a[0],n=u.deck;u.value===13&&($(a,s),n==="stock_open"?k(2):ae(u.deck)&&v[u.deck].every(g=>!g.hidden)?k(5):k(4))}},F=s=>{const a=Z.value.filter(u=>u.selected);if(a.length===1){const u=a[0],n=u.type;!v[s].length&&n===s&&u.value===1&&(ce(u,s),k(3))}},G=(s,a,u)=>{const n=v[s.deck],g=n.indexOf(s);n.filter((b,B)=>B>=g).forEach(b=>{b.selected=a,u?.(b)})},Y=()=>{Z.value.forEach(s=>{s.selected=!1})},ce=(s,a)=>{const u=s.deck,n=v[u].indexOf(s);s.deck=a,s.selected=!1,v[a].push(s),v[u].splice(n,1),(ae(u)||u==="stock_open")&&q(u)},$=(s,a,u)=>{const n=s[0],g=n.deck,w=v[g].indexOf(n);G(n,!1,b=>{b.deck=a,u?.(b),v[a].push(b)}),v[g].splice(w,s.length),te(g)||q(g!=="stock_closed"?g:a)},se=s=>{if(!ne.value)return!0;const a=v[s.type],u=a.length?a[a.length-1].value:0;if(s.value===u+1){const n=["hearts","spades","diamonds","clubs"],g=u<=1||n.every(w=>{const b=v[w];return(b.length?b[b.length-1].value:0)>=u});if(u===0||g)return ce(s,s.type),s.hasBeenHome=!0,k(3),!0}return!1},_=()=>{if(ne.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=v[s];if(a.length&&se(a[a.length-1]))return}},q=s=>{const a=v[s];if(a.length){const u=a[a.length-1],n=u.deck;u.hidden=!1,setTimeout(()=>{u.deck===n&&(se(u)||_())},500)}else setTimeout(()=>{_()},500)},k=s=>{switch(s!==5&&M.value++,s){case 0:{O.value+=2*ee.value;break}case 1:{O.value+=5*ee.value;break}case 2:{I.value+=10*ee.value;break}case 3:{I.value+=20*ee.value;break}}re(Te)},he=(s,a)=>s.color!==a.color,me=(s,a)=>s.type===a.type,ae=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),te=s=>["hearts","spades","diamonds","clubs"].includes(s),ie=()=>{W({difficulty:D.value,score:J.value,bonus:I.value,time:N.value,turns:M.value,penalty:O.value})};return{difficulty:D,gameStatus:C,score:J,turns:M,time:N,bonus:I,penalty:O,cards:v,doAutocomplete:ne,allCards:Z,formattedTime:j,personalBest:o,highscorePosition:p,$reset:r,start:S,shuffle:h,selectCard:T,selectEmptyDeck:m,selectFinalDeck:F,deselectAllCards:Y,isPlayDeck:ae,isFinalDeck:te,setPreviousHighscores:x,updatePatienceHighscore:ie,sortHighscores:H}},{}),Je=()=>Object.keys(Ee).flatMap(e=>{const o=e,p=[];for(let x=0;x<13;x++){const W={type:o,label:Ee[o].label,color:Ee[o].color,value:x+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(W)}return p});var Qe=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.HAS_STARTED=2]="HAS_STARTED",e[e.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",e[e.HAS_LOST=6]="HAS_LOST",e[e.HAS_FINISHED=7]="HAS_FINISHED",e))(Qe||{}),Xe=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(Xe||{}),el=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.WINNER_TIE=3]="WINNER_TIE",e[e.LOSER=4]="LOSER",e))(el||{});const ll=e=>{for(let o=1;o<=6;o++)if(e.every(p=>p.value===o))return!0;return!1},sl=He("rainwormsStore",()=>{const e=pe(),o=De(),p=Me(),{personalBest:x,highscorePosition:W}=X(e),{firebaseUser:H}=X(p),{games:D,gamesLoading:C,gameId:M,creatorId:N,players:I,opponents:O,chat:ue,isOwner:ne}=X(o),{setPreviousHighscores:v,updateHighscores:ee,sortHighscores:Z}=e,U=E(1),P=E(z.SOLO),d=E(0),J=E(!1),j=E(0),le=E(0),r=E("soloPlayer"),S=E(r.value),y=E(r.value),Q=E(!1),h=E(Ne()),T=E(Re()),m=ye({}),F=R(()=>h.value.some(l=>l.isRolling)),G=R(()=>h.value.filter(l=>l.selected).some(l=>l.value===6)),Y=R(()=>l=>h.value.some(t=>t.value===l&&t.selected)),ce=R(()=>T.value.some(l=>l.displayValue<=_.value)),$=R(()=>(l=r.value)=>S.value===l),se=R(()=>(l=r.value)=>{const t=m[l];return t.length?t[t.length-1]:null}),_=R(()=>{let l=0;return h.value.filter(t=>t.selected).forEach(t=>{l+=t.value===6?5:t.value}),l}),q=R(()=>l=>{let t=0;return m[l].forEach(i=>{t+=i.value}),t});Ae(()=>{e.$init(V.RAINWORMS),F.value&&h.value.forEach(l=>{l.isRolling=!1})}),Ie(d,l=>{l===7?Ve():P.value===z.SOLO&&(Q.value||S.value==="robot")&&ge(S.value)}),Ie([d,S,F],()=>{P.value===z.MULTIPLAYER&&s()},{deep:!0});const k=()=>{o.$reset(),P.value=z.SOLO,d.value=0,j.value=0,le.value=0,r.value="soloPlayer",S.value=r.value,y.value=r.value,h.value=Ne(),T.value=Re(),Object.keys(m).forEach(l=>{delete m[l]}),v()},he=()=>{P.value=z.SOLO,d.value=2,m[r.value]=[],m.robot=[]},me=l=>{H.value&&(l=[{userId:H.value.uid,isOnline:!0},...l],P.value=z.MULTIPLAYER,d.value=2,r.value=H.value.uid,S.value=r.value,y.value=r.value,l.forEach(t=>{m[t.userId]=[]}),o.$init(V.RAINWORMS,te,ie,k),o.createGame(l))},ae=l=>{H.value&&(P.value=z.MULTIPLAYER,r.value=H.value.uid,o.$init(V.RAINWORMS,te,ie,k),o.continueGame(l))},te=()=>({gameStatus:d.value,gameStatusActivator:y.value,activePlayer:S.value,dices:h.value,tiles:T.value,score:m}),ie=l=>{const t=H.value?.uid;!t||S.value===r.value||(d.value=l.gameStatus,y.value=l.gameStatusActivator,S.value=l.activePlayer,h.value=l.dices,T.value=l.tiles,Object.assign(m,l.score),Object.keys(m).includes(t)||(m[t]=[]))},s=()=>{!H.value||S.value!==r.value&&!J.value||o.pushState()},a=(l=r.value)=>{if(!$.value(l))return;(d.value===2||d.value===5||d.value===6)&&h.value.forEach(i=>{i.selected=!1}),d.value=3;const t=e.diceRollSpeed*1e3;h.value.forEach(i=>{i.selected||(i.isRolling=!0,setTimeout(()=>{i.value=we(6),i.isRolling=!1,h.value.sort((A,c)=>A.value-c.value),!F.value&&d.value!==6&&n()&&g(l)},xe(t,t/3)))}),re(We)},u=async()=>{for(;F.value;)await new Promise(l=>setTimeout(l,e.diceRollSpeed*1e3));return!0},n=()=>{const l=h.value.filter(t=>!t.selected&&!Y.value(t.value));return!l.length||ll(l)&&l.every(t=>t.value!==6)&&h.value.filter(t=>t.selected).every(t=>t.value!==6)},g=(l=r.value)=>{d.value=6,y.value=l,m[y.value].length?le.value=1:le.value=2,w(),T.value.length===0?d.value=7:oe()},w=()=>{const l=m[S.value];if(l.length){const t=l.splice(l.length-1,1)[0];T.value.push(t),T.value.sort((i,A)=>i.displayValue-A.displayValue)}T.value.splice(T.value.length-1,1)},b=(l,t=r.value)=>{$.value(t)&&!F.value&&d.value===3&&!l.selected&&!Y.value(l.value)&&(d.value=4,h.value.filter(i=>i.value===l.value).forEach(i=>{i.selected=!0}),re(Te))},B=(l,t,i=r.value)=>{if($.value(i)&&(d.value===3||d.value===4)){if(t){const A=m[t];A.splice(A.length-1,1)}else T.value=T.value.filter(A=>A.displayValue!==l.displayValue);m[S.value].push(l),T.value.length===0?d.value=7:(d.value=5,y.value=i,oe()),re(Te)}},oe=l=>{(Q.value||S.value!==r.value||d.value!==6||l)&&(S.value===r.value?setTimeout(()=>{J.value=!0,S.value=P.value===z.SOLO?"robot":o.getNextPlayerId(r.value),setTimeout(()=>{d.value=2,y.value=r.value,J.value=!1},U.value*1e3)},l?0:U.value*1e3*2):setTimeout(()=>{const t=S.value;S.value=r.value,setTimeout(()=>{d.value=2,y.value=t},U.value*1e3)},l?0:U.value*1e3*2))},ge=async l=>{if(await new Promise(i=>setTimeout(i,5)),!$.value(l))return;const t=l===r.value?"robot":r.value;switch(d.value){case 2:{a(l);break}case 3:{await u(),setTimeout(()=>{const i=h.value.filter(c=>!c.selected),A=se.value(t);if(A&&_.value<A.displayValue)for(let c=6;c>=1;c--){const f=i.filter(L=>L.value===c&&!Y.value(c));if(f.length){const L=f.length*(c===6?5:c);if(_.value+L===A.displayValue){b(f[0],l);return}}}for(let c=6;c>=1;c--){const f=h.value.find(L=>L.value===c);if(f&&!Y.value(c)){b(f,l);return}}},U.value*1e3);break}case 4:{setTimeout(()=>{const i=se.value(t),A=h.value.filter(c=>!c.selected).length;if(!A||_.value>=30){A?console.log(l,"i am rich"):console.log(l,"i can only pick a tile now");for(let c=_.value;c>=21;c--){const f=T.value.find(L=>L.displayValue===c);if(f){B(f,void 0,l);return}}A&&a(l)}if(T.value.every(c=>c.displayValue>_.value)&&i&&i.displayValue>_.value)console.log(l,"my score is too low"),a(l);else if(i&&i.displayValue===_.value)console.log(l,"i can steal"),B(i,t,l);else if(new Set(h.value.filter(c=>c.selected).map(c=>c.value)).size<=3)if(h.value.filter(c=>!c.selected).length<=2){console.log(l,"there aren't that much dices left");const c=T.value.filter(f=>f.displayValue>=_.value-5&&f.displayValue<=_.value).sort((f,L)=>L.displayValue-f.displayValue);c.length?(console.log(l,"i choose the highest score within 5 tiles"),B(c[0],void 0,l)):(console.log(l,"i choose to roll again"),a(l))}else console.log(l,"i have nothing to worry about"),a(l);else if(!G.value)console.log(l,"i am worrying and have no worm yet"),a(l);else{console.log(l,"if i can choose, i choose");const c=T.value.filter(f=>f.displayValue<=_.value).sort((f,L)=>L.displayValue-f.displayValue);c.length?(console.log(l,"i choose the highest score"),B(c[0],void 0,l)):(console.log(l,"i choose to roll again"),a(l))}},U.value*1e3);break}default:console.log(l,"DEFAULT",d.value)}},Ve=()=>{const l=Math.max(...Object.keys(m).map(i=>q.value(i))),t=Object.keys(m).filter(i=>q.value(i)===l);if(t.includes(r.value))if(t.length===1)j.value=1;else{const i=Math.max(...m[r.value].map(f=>f.displayValue)),A=t.filter(f=>f!==r.value)[0],c=Math.max(...m[A].map(f=>f.displayValue));i>c?j.value=2:j.value=3}else j.value=4;Oe()},Oe=()=>{ee({gameId:M.value??null,score:q.value(r.value)})};return{gameType:P,gameStatus:d,gameStatusLoading:J,myPlayerId:r,gameStatusActivatorId:y,finishStatus:j,loseStatus:le,activePlayerId:S,isFullyAutomatic:Q,dices:h,tiles:T,score:m,robotSpeed:U,isRolling:F,hasWorm:G,hasAlreadyChosen:Y,canSelectAnyTile:ce,canPlay:$,visibleTile:se,selectedDiceTotal:_,totalScore:q,personalBest:x,highscorePosition:W,games:D,gamesLoading:C,gameId:M,creatorId:N,players:I,opponents:O,chat:ue,isOwner:ne,$reset:k,start:he,roll:a,hasFinishedRolling:u,hasLostRound:n,loseTurn:g,popLastTile:w,selectDice:b,selectTile:B,passTurn:oe,setPreviousHighscores:v,updateRainwormsHighscore:Oe,sortHighscores:Z,fetchOnlineGames:o.fetchGames,createOnlineGame:me,continueOnlineGame:ae,leaveOnlineGame:o.leaveGame,deleteOnlineGame:o.deleteGame}},{}),Ne=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],Re=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],al={class:"flex flex-col gap-3"},ul=Ue({__name:"GameSettingsDialog",props:Ge({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const o=e,p=$e(e,"isOpen"),x=pe(),{useAudio:W,diceRollSpeed:H}=X(pe()),{robotSpeed:D}=X(sl()),{doAutocomplete:C}=X(Ze()),M=R(()=>{switch(o.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)";case V.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Ae(()=>{x.$init(o.gameId)}),(N,I)=>(ve(),de(Ce,{isOpen:p.value,title:"Game Settings",description:e.gameId?`Current version: ${M.value}`:"General settings",cancelText:"Close",onCancel:I[4]||(I[4]=O=>p.value=!1)},{default:Be(()=>[je("div",al,[Fe(be,{name:"useAudio",label:"Audio",modelValue:K(W),"onUpdate:modelValue":I[0]||(I[0]=O=>fe(W)?W.value=O:null)},null,8,["modelValue"]),e.gameId===K(V).PATIENCE?(ve(),de(be,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:K(C),"onUpdate:modelValue":I[1]||(I[1]=O=>fe(C)?C.value=O:null)},null,8,["modelValue"])):Se("",!0),e.gameId===K(V).YAHTZEE||e.gameId===K(V).RAINWORMS?(ve(),de(_e,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:K(H),"onUpdate:modelValue":I[2]||(I[2]=O=>fe(H)?H.value=O:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),e.gameId===K(V).RAINWORMS?(ve(),de(_e,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:K(D),"onUpdate:modelValue":I[3]||(I[3]=O=>fe(D)?D.value=O:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)])]),_:1},8,["isOpen","description"]))}});export{Ye as C,qe as D,el as F,Qe as G,Xe as L,ul as _,Ze as a,ze as b,sl as u};
