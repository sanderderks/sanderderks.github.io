import{d as R,a as q,g as s,h as r,k as $,w as F,y as N,a0 as k,q as l,f as t,R as J,_ as x,l as u,m as f,v as L,aC as K,t as Q,aU as A,s as B,o as T,aw as W,K as X,j as P,M as Y,z as D,C as Z,G as g,H as ee,x as te,c as se}from"../bundle.js";import{_ as oe}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"flex flex-wrap gap-3 mt-3 justify-center"},Ie=R({__name:"AddToLeaderboard",props:{isLoggedIn:{type:Boolean},isSolo:{type:Boolean},isGameOver:{type:Boolean},finalScore:{},personalBest:{},redirectRoute:{},showIf:{type:Boolean}},emits:["updateHighscore"],setup(n){const d=q();return(c,o)=>n.isGameOver?(s(),r("div",ne,[n.isLoggedIn?n.showIf!==!1&&n.isSolo&&n.finalScore>n.personalBest?(s(),$(x,{key:1,class:"w-full md:w-1/2",variant:"primary",onClick:o[1]||(o[1]=v=>c.$emit("updateHighscore"))},{default:N(()=>[...o[4]||(o[4]=[k(" Add To Leaderboard ",-1)])]),_:1})):u("",!0):(s(),$(F,{key:0,class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:N(()=>[o[2]||(o[2]=k(" Please ",-1)),l("a",{class:"cursor-pointer",onClick:o[0]||(o[0]=v=>t(d).push({name:t(J).LOGIN,params:{redirect:JSON.stringify({name:n.redirectRoute})}}))}," Login "),o[3]||(o[3]=k(" to add your score to the leaderboard. ",-1))]),_:1}))])):u("",!0)}}),ae=(n,d)=>{const c=L(0),o=f(()=>K(n)),v=f(()=>(c.value+1)*d),y=f(()=>v.value-d),p=f(()=>c.value>0),m=f(()=>o.value.length>v.value),b=f(()=>o.value.filter((i,w)=>w>=y.value&&w<v.value));return{page:c,perPage:d,visibleData:b,hasPrevious:p,hasNext:m,$reset:()=>{c.value=0}}},le={class:"mt-5 flex flex-col items-center"},re={class:"w-full overflow-x-auto"},ie={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},ue={key:0},de={key:0},ce={key:1},fe={key:1},ve={key:0},he={key:1},me={key:2},ge={key:3},ye={key:2},pe={key:3},ke={key:4},be={colspan:"100%"},we=R({__name:"Highscores",props:{gameId:{},unit:{}},setup(n){const d=n,c=Q(),o=A(),{publicUsers:v}=B(c),{allGameData:y,fetchLoading:p}=B(o),{fetchGameData:m,fetchHighscores:b,fetchScores:S}=o,i=L("highscores"),w=L(),V=f(()=>y.value[d.gameId].gameData[i.value]),{page:_,perPage:j,visibleData:h,hasPrevious:C,hasNext:G,$reset:O}=ae(()=>V.value,10),z=I=>{var e;return((e=v.value.find(a=>a.id===I))==null?void 0:e.displayName)??"Unknown"},U=I=>{O(),i.value=I},E=()=>{i.value==="highscores"?b():S()};return T(()=>{o.$init(d.gameId),m(),w.value=setInterval(()=>{m()},1e3*60*5)}),W(()=>{clearInterval(w.value)}),X(i,()=>{y.value[d.gameId].gameData[i.value].length||E()}),(I,e)=>(s(),r("div",le,[P(t(Y),{class:"w-full md:w-1/2"},{default:N(()=>[P(x,{class:"w-full",variant:"secondary",outlined:i.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=a=>U("highscores"))},null,8,["outlined"]),P(x,{class:"w-full",variant:"secondary",outlined:i.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=a=>U("scores"))},null,8,["outlined"])]),_:1}),l("div",re,[l("table",ie,[t(h).length?(s(),r("thead",ue,[l("tr",null,[e[4]||(e[4]=l("th",null,"Rank",-1)),e[5]||(e[5]=l("th",null,"User",-1)),e[6]||(e[6]=l("th",null,"Score",-1)),t(h).length&&t(h).some(a=>a.difficulty)?(s(),r("th",de,"Difficulty")):u("",!0),e[7]||(e[7]=l("th",null,"Date",-1)),t(h).length&&t(h).some(a=>a.bonus)?(s(),r("th",ce,"Bonus")):u("",!0)])])):u("",!0),t(h).length?(s(),r("tbody",fe,[(s(!0),r(D,null,Z(t(h),(a,M)=>(s(),r("tr",null,[l("th",null,g(M+1+t(_)*t(j)),1),l("th",null,g(z(a.userId??a.id)),1),l("td",null,[k(g(a.score)+" ",1),n.unit?(s(),r(D,{key:0},[k(g(n.unit),1),a.score!==1?(s(),r(D,{key:0},[k("s")],64)):u("",!0)],64)):u("",!0)]),a.difficulty?(s(),r("td",ve,g(a.difficulty),1)):t(h).some(H=>H.difficulty)?(s(),r("td",he)):u("",!0),l("td",null,g(t(ee)(a.date)),1),a.bonus?(s(),r("td",me,g(a.bonus),1)):t(h).some(H=>H.bonus)?(s(),r("td",ge)):u("",!0)]))),256))])):t(p)?(s(),r("tbody",ye,[...e[8]||(e[8]=[l("tr",null,[l("th",null,"Loading highscores...")],-1)])])):(s(),r("tbody",pe,[l("tr",null,[l("th",null,"There are no "+g(i.value==="highscores"?"highscores":"scores")+" yet.",1)])])),t(C)||t(G)?(s(),r("tfoot",ke,[l("tr",null,[l("td",be,[l("div",{class:te(["w-full p-2 flex",[t(C)?"justify-between":"justify-end"]])},[t(C)?(s(),$(x,{key:0,class:"w-fit",label:"Previous",variant:"neutral",onClick:e[2]||(e[2]=a=>_.value-=1)})):u("",!0),t(G)?(s(),$(x,{key:1,class:"w-fit",label:"Next",variant:"neutral",onClick:e[3]||(e[3]=a=>_.value+=1)})):u("",!0)],2)])])])):u("",!0)])])]))}}),$e=oe(we,[["__scopeId","data-v-b42fb3e6"]]),Be=n=>{const d=se(),c=A(),{allGameData:o,highscorePosition:v,personalBest:y}=B(c),{firebaseUser:p}=B(d),m=f(()=>p.value?v.value:null),b=f(()=>{if(!n)return!1;const i=o.value[n].previousHighscorePosition;return m.value&&i?i>m.value:!1}),S=f(()=>{if(!n)return!1;const i=o.value[n].previousPersonalBest;return p.value&&i?i<y.value:!1});return T(()=>{c.$init(n)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:S}};export{$e as H,Ie as _,Be as u};
