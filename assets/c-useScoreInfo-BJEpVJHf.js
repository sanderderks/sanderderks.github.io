import{_ as V}from"./c-Bubble.vue_vue_type_script_setup_true_lang-iHAaGDxw.js";import{e as $,A,aG as B,s as _,r as D,c as y,o as P,as as C,M as L,l as n,m as l,p as t,t as u,w as p,O as T,H as r,G as w,k as x,C as M,n as R,h as j}from"../bundle.js";import{_ as E}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"w-full overflow-x-auto"},O={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},q={key:0},z={key:0},J={key:1},K={key:1},Q={key:0},W={key:1},X={key:2},Y={key:3},Z={key:2},ee={key:3},te={class:"mt-5 flex justify-center"},se=$({__name:"Highscores",props:{gameId:{},unit:{}},setup(h){const d=h,f=A(),i=B(),{publicUsers:k}=_(f),{allGameData:v,fetchLoading:m}=_(i),{fetchGameData:c,fetchHighscores:b,fetchScores:S}=i,s=D("highscores"),H=D(),a=y(()=>v.value[d.gameId].gameData[s.value]),U=g=>{var o;return((o=k.value.find(e=>e.id===g))==null?void 0:o.displayName)??"Unknown"},G=()=>{s.value==="highscores"?b():S()};return P(()=>{i.$init(d.gameId),c(),H.value=setInterval(()=>{c()},1e3*60*5)}),C(()=>{clearInterval(H.value)}),L(s,()=>{v.value[d.gameId].gameData[s.value].length||G()}),(g,o)=>(n(),l(p,null,[t("div",F,[t("table",O,[a.value.length?(n(),l("thead",q,[t("tr",null,[o[1]||(o[1]=t("th",null,"Rank",-1)),o[2]||(o[2]=t("th",null,"User",-1)),o[3]||(o[3]=t("th",null,"Score",-1)),a.value.length&&a.value.some(e=>e.difficulty)?(n(),l("th",z,"Difficulty")):u("",!0),o[4]||(o[4]=t("th",null,"Date",-1)),a.value.length&&a.value.some(e=>e.bonus)?(n(),l("th",J,"Bonus")):u("",!0)])])):u("",!0),a.value.length?(n(),l("tbody",K,[(n(!0),l(p,null,T(a.value,(e,N)=>(n(),l("tr",null,[t("th",null,r(N+1),1),t("th",null,r(U(e.userId??e.id)),1),t("td",null,[w(r(e.score)+" ",1),g.unit?(n(),l(p,{key:0},[w(r(g.unit),1),e.score!==1?(n(),l(p,{key:0},[w("s")],64)):u("",!0)],64)):u("",!0)]),e.difficulty?(n(),l("td",Q,r(e.difficulty),1)):a.value.some(I=>I.difficulty)?(n(),l("td",W)):u("",!0),t("td",null,r(x(M)(e.date)),1),e.bonus?(n(),l("td",X,r(e.bonus),1)):a.value.some(I=>I.bonus)?(n(),l("td",Y)):u("",!0)]))),256))])):x(m)?(n(),l("tbody",Z,o[5]||(o[5]=[t("tr",null,[t("th",null,"Loading highscores...")],-1)]))):(n(),l("tbody",ee,[t("tr",null,[t("th",null,"There are no "+r(s.value==="highscores"?"highscores":"scores")+" yet.",1)])]))])]),t("div",te,[R(V,{class:"w-full md:w-1/2",label:`View ${s.value==="highscores"?"All Scores":"Highscores"}`,type:"secondary",onClick:o[0]||(o[0]=e=>s.value==="highscores"?s.value="scores":s.value="highscores")},null,8,["label"])])],64))}}),ae=E(se,[["__scopeId","data-v-cc551ef2"]]),re=h=>{const d=j(),f=B(),{allGameData:i,highscorePosition:k,personalBest:v}=_(f),{firebaseUser:m}=_(d),c=y(()=>m.value?k.value:null),b=y(()=>{const s=i.value[h].previousHighscorePosition;return c.value&&s?s>c.value:!1}),S=y(()=>{const s=i.value[h].previousPersonalBest;return m.value&&s?s<v.value:!1});return P(()=>{f.$init(h)}),{currentHighscorePosition:c,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:S}};export{ae as H,re as u};
