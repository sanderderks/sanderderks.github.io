import{_ as Be}from"./c-Dialog.vue_vue_type_script_setup_true_lang-BGsOqr_m.js";import{aW as Me,aX as pe,s as Z,w as E,a9 as $e,f as R,o as Re,aS as k,L as _e,aY as J,a_ as Fe,aZ as We,a$ as Ne,aR as Ye,c as je,aQ as j,b0 as Ze,b1 as ze,b2 as Ke,d as qe,aU as Qe,aV as Xe,l as ve,j as de,A as Je,k as el,m as Ie,h as Y,an as fe,U as Le,T as Pe}from"../bundle.js";var ll=(l=>(l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(ll||{});const Te={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var sl=(l=>(l.STOCK_CLOSED="stock_closed",l.STOCK_OPEN="stock_open",l.PILE1="pile1",l.PILE2="pile2",l.PILE3="pile3",l.PILE4="pile4",l.PILE5="pile5",l.PILE6="pile6",l.PILE7="pile7",l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(sl||{}),al=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.HAS_STARTED=1]="HAS_STARTED",l[l.HAS_FINISHED=2]="HAS_FINISHED",l))(al||{});const ol={easy:.5,hard:1},ye=()=>{const l=nl();return Fe(l),{pile1:l.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:l.splice(0,2).map((u,p)=>p<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:l.splice(0,3).map((u,p)=>p<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:l.splice(0,4).map((u,p)=>p<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:l.splice(0,5).map((u,p)=>p<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:l.splice(0,6).map((u,p)=>p<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:l.splice(0,7).map((u,p)=>p<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:l.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},tl=Me("patienceStore",()=>{const l=pe(),{personalBest:u,highscorePosition:p}=Z(l),{setPreviousHighscores:P,updateHighscores:y,sortHighscores:D}=l,b=E("hard"),H=E(0),G=E(0),O=E(0),g=E(0),I=E(0),ee=E(),z=E(!0),r=$e(ye()),K=R(()=>ol[b.value]),W=R(()=>Object.keys(r).flatMap(s=>r[s])),me=1e3,te=10,he=10,ne=R(()=>{const s=O.value%10===0?O.value:Math.floor(O.value/10)*10,a=G.value*te,o=I.value*te,n=s+a+o,S=g.value*he;return Math.max(0,me-(n-S))}),ge=R(()=>{const s=Math.floor(O.value/60),a=O.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),Se=R(()=>r.hearts.length===13&&r.spades.length===13&&r.diamonds.length===13&&r.clubs.length===13);Re(()=>{l.$init(k.PATIENCE),O.value&&H.value===1&&ie()}),_e(Se,s=>{s&&H.value!==2&&(le(),H.value=2,B(),J(We))});const Oe=()=>{le(),G.value=0,O.value=0,g.value=0,I.value=0,H.value=0,Object.assign(r,ye()),l.setPreviousHighscores()},ue=()=>{O.value=0,ie(),H.value=1,setTimeout(()=>{f()},500)},ie=()=>{ee.value&&le(),ee.value=setInterval(()=>{O.value++},1e3)},le=()=>{clearInterval(ee.value)},w=()=>{const s=r.stock_open;s.length&&(s.reverse(),_(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,r.stock_closed.push(a)}),s.splice(0,s.length),d(1))},M=s=>{const a=s.deck,o=W.value.filter(n=>n.selected);if(a==="stock_closed"){const n=r.stock_closed,S=n.indexOf(s);if(S===n.length-1){const $=b.value==="hard"?S-2:S,N=$<0?0:$,X=n.filter((ae,re)=>re>=N);C(),m(X,"stock_open",ae=>{ae.hidden=!1}),d(0)}}else if(a==="stock_open"){const n=r.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,o.length&&_(o[0],!1))}else if(o.length){const n=o[0];n===s?_(s,!1):L(a)&&U(n,s)?s.value===n.value+1&&s.deck!==n.deck&&(m(o,a),n.deck==="stock_open"?d(2):d(4)):o.length===1&&se(a)&&ce(n,s)&&s.value===n.value-1&&(x(n,a),d(3),n.hasBeenHome=!0)}else _(s,!0)},v=s=>{const a=W.value.filter(o=>o.selected);if(a.length){const o=a[0],n=o.deck;o.value===13&&(m(a,s),n==="stock_open"?d(2):L(o.deck)&&r[o.deck].every(S=>!S.hidden)?d(5):d(4))}},q=s=>{const a=W.value.filter(o=>o.selected);if(a.length===1){const o=a[0],n=o.type;!r[s].length&&n===s&&o.value===1&&(x(o,s),d(3))}},_=(s,a,o)=>{const n=r[s.deck],S=n.indexOf(s);n.filter((N,X)=>X>=S).forEach(N=>{N.selected=a,o==null||o(N)})},C=()=>{W.value.forEach(s=>{s.selected=!1})},x=(s,a)=>{const o=s.deck,n=r[o].indexOf(s);s.deck=a,s.selected=!1,r[a].push(s),r[o].splice(n,1),(L(o)||o==="stock_open")&&h(o)},m=(s,a,o)=>{const n=s[0],S=n.deck,$=r[S].indexOf(n);_(n,!1,N=>{N.deck=a,o==null||o(N),r[a].push(N)}),r[S].splice($,s.length),se(S)||h(S!=="stock_closed"?S:a)},Q=s=>{if(!z.value)return!0;const a=r[s.type],o=a.length?a[a.length-1].value:0;if(s.value===o+1){const n=["hearts","spades","diamonds","clubs"],S=o<=1||n.every($=>{const N=r[$];return(N.length?N[N.length-1].value:0)>=o});if(o===0||S)return x(s,s.type),s.hasBeenHome=!0,d(3),!0}return!1},f=()=>{if(z.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=r[s];if(a.length&&Q(a[a.length-1]))return}},h=s=>{const a=r[s];if(a.length){const o=a[a.length-1],n=o.deck;o.hidden=!1,setTimeout(()=>{o.deck===n&&(Q(o)||f())},500)}else setTimeout(()=>{f()},500)},d=s=>{switch(s!==5&&G.value++,s){case 0:{I.value+=2*K.value;break}case 1:{I.value+=5*K.value;break}case 2:{g.value+=10*K.value;break}case 3:{g.value+=20*K.value;break}}J(Ne)},U=(s,a)=>s.color!==a.color,ce=(s,a)=>s.type===a.type,L=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),se=s=>["hearts","spades","diamonds","clubs"].includes(s),B=()=>{y({difficulty:b.value,score:ne.value,bonus:g.value,time:O.value,turns:G.value,penalty:I.value})};return{difficulty:b,gameStatus:H,score:ne,turns:G,time:O,bonus:g,penalty:I,cards:r,doAutocomplete:z,allCards:W,formattedTime:ge,personalBest:u,highscorePosition:p,$reset:Oe,start:ue,shuffle:w,selectCard:M,selectEmptyDeck:v,selectFinalDeck:q,deselectAllCards:C,isPlayDeck:L,isFinalDeck:se,setPreviousHighscores:P,updatePatienceHighscore:B,sortHighscores:D}},{persist:{enabled:!0}}),nl=()=>Object.keys(Te).flatMap(l=>{const u=l,p=[];for(let P=0;P<13;P++){const y={type:u,label:Te[u].label,color:Te[u].color,value:P+1,hidden:!1,selected:!1,hasBeenHome:!1};p.push(y)}return p});var ul=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.HAS_STARTED=2]="HAS_STARTED",l[l.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",l[l.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",l[l.HAS_LOST=6]="HAS_LOST",l[l.HAS_FINISHED=7]="HAS_FINISHED",l))(ul||{}),il=(l=>(l[l.NONE=0]="NONE",l[l.HAS_LOST_TILE=1]="HAS_LOST_TILE",l[l.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",l))(il||{}),cl=(l=>(l[l.NONE=0]="NONE",l[l.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",l[l.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",l[l.LOSER=3]="LOSER",l))(cl||{}),rl=(l=>(l[l.PLAYER=0]="PLAYER",l[l.OPPONENT=1]="OPPONENT",l))(rl||{});const vl=l=>{for(let u=1;u<=6;u++)if(l.every(p=>p.value===u))return!0;return!1},De=()=>({0:[],1:[]}),dl=Me("rainwormsStore",()=>{const l=pe(),u=Ye(),p=je(),{personalBest:P,highscorePosition:y}=Z(l),{firebaseUser:D}=Z(p),{onlineGames:b,onlineGamesLoading:H,onlineGameId:G,onlineGameCreatorId:O,onlineGameOpponentId:g,onlineGameOpponentActive:I,onlineGameChat:ee,isInitializingOnlineGame:z,isOnlineGameOwner:r,onlineGameOpponentName:K}=Z(u),{$init:W,$reset:me,fetchOnlineGames:te,createOnlineGame:he,continueOnlineGame:ne,updateOnlineGame:ge,leaveOnlineGame:Se,deleteOnlineGame:Oe}=u,{setPreviousHighscores:ue,updateHighscores:ie,sortHighscores:le}=l,w=E(1),M=E(j.SOLO),v=E(0),q=E(!1),_=E(0),C=E(0),x=E(0),m=E(0),Q=E(!1),f=E(Ge()),h=E(we()),d=$e(De()),U=R(()=>f.value.some(e=>e.isRolling)),ce=R(()=>f.value.filter(e=>e.selected).some(e=>e.value===6)),L=R(()=>e=>f.value.some(t=>t.value===e&&t.selected)),se=R(()=>h.value.some(e=>e.displayValue<=a.value)),B=R(()=>e=>m.value===(e??0)),s=R(()=>e=>{const t=d[e??0];return t.length?t[t.length-1]:null}),a=R(()=>{let e=0;return f.value.filter(t=>t.selected).forEach(t=>{e+=t.value===6?5:t.value}),e}),o=R(()=>e=>{let t=0;return d[e].forEach(c=>{t+=c.value}),t});Re(()=>{l.$init(k.RAINWORMS),U.value&&f.value.forEach(e=>{e.isRolling=!1})}),_e(v,e=>{e===7?Ue():M.value===j.SOLO&&(Q.value||m.value===1)&&xe(m.value)}),_e([v,m,U],()=>{M.value===j.ONLINE&&X()},{deep:!0});const n=()=>{me(),M.value=j.SOLO,v.value=0,_.value=0,C.value=0,x.value=0,m.value=0,f.value=Ge(),h.value=we(),Object.assign(d,De()),ue()},S=()=>{M.value=j.SOLO,v.value=2},$=e=>{D.value&&(M.value=j.ONLINE,v.value=2,W(k.RAINWORMS,re,ae,n),he(e))},N=e=>{M.value=j.ONLINE,W(k.RAINWORMS,re,ae,n),ne(e)},X=()=>{console.log("updateOnlineGameCustom.1"),!(!D.value||!g.value||m.value===1&&!q.value&&!z.value)&&(console.log("updateOnlineGameCustom.2"),ge())},ae=(e,t)=>({gameStatus:v.value,gameStatusActivator:_.value===0?e:t,activePlayer:m.value===0?e:t,dices:f.value,tiles:h.value,score:{[e]:d[0],[t]:d[1]}}),re=e=>{var c;console.log("updateLocalGameState.1");const t=(c=D.value)==null?void 0:c.uid;!t||m.value===0&&!z.value||(console.log("updateLocalGameState.2"),v.value=e.gameStatus,_.value=e.gameStatusActivator===t?0:1,m.value=e.activePlayer===t?0:1,f.value=e.dices,h.value=e.tiles,r.value?(d[0]=e.score[e.creatorId],d[1]=e.score[e.opponentId]):(d[0]=e.score[e.opponentId],d[1]=e.score[e.creatorId]))},F=e=>{if(!B.value(e))return;(v.value===2||v.value===5||v.value===6)&&f.value.forEach(c=>{c.selected=!1}),v.value=3;const t=l.diceRollSpeed*1e3;f.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=Ze(6),c.isRolling=!1,f.value.sort((T,i)=>T.value-i.value),!U.value&&v.value!==6&&ke()&&Ve(e)},ze(t,t/3)))}),J(Ke)},He=async()=>{for(;U.value;)await new Promise(e=>setTimeout(e,l.diceRollSpeed*1e3));return!0},ke=()=>{const e=f.value.filter(t=>!t.selected&&!L.value(t.value));return!e.length||vl(e)&&e.every(t=>t.value!==6)&&f.value.filter(t=>t.selected).every(t=>t.value!==6)},Ve=e=>{v.value=6,_.value=e??0,d[_.value].length?x.value=1:x.value=2,be(),h.value.length===0?v.value=7:Ae()},be=()=>{const e=d[m.value];if(e.length){const t=e.splice(e.length-1,1)[0];h.value.push(t),h.value.sort((c,T)=>c.displayValue-T.displayValue)}h.value.splice(h.value.length-1,1)},Ee=(e,t)=>{B.value(t)&&!U.value&&v.value===3&&!e.selected&&!L.value(e.value)&&(v.value=4,f.value.filter(c=>c.value===e.value).forEach(c=>{c.selected=!0}),J(Ne))},oe=(e,t,c)=>{if(B.value(c)&&(v.value===3||v.value===4)){if(t){const T=d[m.value===0?1:0];T.splice(T.length-1,1)}else h.value=h.value.filter(T=>T.displayValue!==e.displayValue);d[m.value].push(e),h.value.length===0?v.value=7:(v.value=5,_.value=c??0,Ae()),J(Ne)}},Ae=e=>{(Q.value||m.value===1||v.value!==6||e)&&(m.value===0?setTimeout(()=>{q.value=!0,m.value=1,setTimeout(()=>{v.value=2,_.value=0,q.value=!1},w.value*1e3)},e?0:w.value*1e3*2):setTimeout(()=>{m.value=0,setTimeout(()=>{v.value=2,_.value=1},w.value*1e3)},e?0:w.value*1e3*2))},xe=async e=>{if(await new Promise(c=>setTimeout(c,5)),!B.value(e))return;const t=e===0?0:1;switch(v.value){case 2:{F(e);break}case 3:{await He(),setTimeout(()=>{const c=f.value.filter(i=>!i.selected),T=s.value(t);if(T&&a.value<T.displayValue)for(let i=6;i>=1;i--){const A=c.filter(V=>V.value===i&&!L.value(i));if(A.length){const V=A.length*(i===6?5:i);if(a.value+V===T.displayValue){Ee(A[0],e);return}}}for(let i=6;i>=1;i--){const A=f.value.find(V=>V.value===i);if(A&&!L.value(i)){Ee(A,e);return}}},w.value*1e3);break}case 4:{setTimeout(()=>{const c=s.value(t),T=f.value.filter(i=>!i.selected).length;if(!T||a.value>=30){T?console.log(e,"i am rich"):console.log(e,"i can only pick a tile now");for(let i=a.value;i>=21;i--){const A=h.value.find(V=>V.displayValue===i);if(A){oe(A,!1,e);return}}T&&F(e)}if(h.value.every(i=>i.displayValue>a.value)&&c&&c.displayValue>a.value)console.log(e,"my score is too low"),F(e);else if(c&&c.displayValue===a.value)console.log(e,"i can steal"),oe(c,!0,e);else if(new Set(f.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(f.value.filter(i=>!i.selected).length<=2){console.log(e,"there aren't that much dices left");const i=h.value.filter(A=>A.displayValue>=a.value-5&&A.displayValue<=a.value).sort((A,V)=>V.displayValue-A.displayValue);i.length?(console.log(e,"i choose the highest score within 5 tiles"),oe(i[0],!1,e)):(console.log(e,"i choose to roll again"),F(e))}else console.log(e,"i have nothing to worry about"),F(e);else if(!ce.value)console.log(e,"i am worrying and have no worm yet"),F(e);else{console.log(e,"if i can choose, i choose");const i=h.value.filter(A=>A.displayValue<=a.value).sort((A,V)=>V.displayValue-A.displayValue);i.length?(console.log(e,"i choose the highest score"),oe(i[0],!1,e)):(console.log(e,"i choose to roll again"),F(e))}},w.value*1e3);break}default:console.log(e,"DEFAULT",v.value)}},Ue=()=>{const e=o.value(0),t=o.value(1);e>t?C.value=1:e===t&&Math.max(...d[0].map(c=>c.displayValue))>Math.max(...d[1].map(c=>c.displayValue))?C.value=2:C.value=3,(C.value===1||C.value===2)&&(Ce(),J(We))},Ce=()=>{ie({score:o.value(0)})};return{gameType:M,gameStatus:v,gameStatusLoading:q,gameStatusActivator:_,finishStatus:C,loseStatus:x,activePlayer:m,isFullyAutomatic:Q,dices:f,tiles:h,score:d,robotSpeed:w,isRolling:U,hasWorm:ce,hasAlreadyChosen:L,canSelectAnyTile:se,canPlay:B,visibleTile:s,selectedDiceTotal:a,totalScore:o,personalBest:P,highscorePosition:y,onlineGames:b,onlineGamesLoading:H,onlineGameId:G,onlineGameCreatorId:O,onlineGameOpponentId:g,onlineGameOpponentActive:I,onlineGameChat:ee,isOnlineGameOwner:r,onlineGameOpponentName:K,$reset:n,start:S,roll:F,hasFinishedRolling:He,hasLostRound:ke,loseTurn:Ve,popLastTile:be,selectDice:Ee,selectTile:oe,passTurn:Ae,setPreviousHighscores:ue,updateRainwormsHighscore:Ce,sortHighscores:le,fetchOnlineGames:te,createOnlineGame:$,continueOnlineGame:N,updateOnlineGame:X,leaveOnlineGame:Se,deleteOnlineGame:Oe}},{persist:{enabled:!0}}),Ge=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],we=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],ml=qe({__name:"GameSettingsDialog",props:Qe({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(l){const u=l,p=Xe(l,"isOpen"),P=pe(),{useAudio:y,diceRollSpeed:D}=Z(pe()),{robotSpeed:b}=Z(dl()),{doAutocomplete:H}=Z(tl()),G=R(()=>{switch(u.gameId){case k.YAHTZEE:return"v5 (12-12-2024)";case k.RAINWORMS:return"v5 (12-12-2024)";case k.PATIENCE:return"v2 (16-12-2024)";case k.GUESS_THE_WORD:return"v2 (10-01-2025)"}});return Re(()=>{P.$init(u.gameId)}),(O,g)=>(de(),ve(Be,{isOpen:p.value,title:"Game Settings",description:O.gameId?`Current version: ${G.value}`:"General settings",cancelText:"Close",onCancel:g[4]||(g[4]=I=>p.value=!1)},{default:Je(()=>[el(Le,{name:"useAudio",label:"Audio",modelValue:Y(y),"onUpdate:modelValue":g[0]||(g[0]=I=>fe(y)?y.value=I:null)},null,8,["modelValue"]),O.gameId===Y(k).PATIENCE?(de(),ve(Le,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:Y(H),"onUpdate:modelValue":g[1]||(g[1]=I=>fe(H)?H.value=I:null)},null,8,["modelValue"])):Ie("",!0),O.gameId===Y(k).YAHTZEE||O.gameId===Y(k).RAINWORMS?(de(),ve(Pe,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:Y(D),"onUpdate:modelValue":g[2]||(g[2]=I=>fe(D)?D.value=I:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Ie("",!0),O.gameId===Y(k).RAINWORMS?(de(),ve(Pe,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:Y(b),"onUpdate:modelValue":g[3]||(g[3]=I=>fe(b)?b.value=I:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Ie("",!0)]),_:1},8,["isOpen","description"]))}});export{ll as C,sl as D,cl as F,ul as G,il as L,rl as P,ml as _,tl as a,al as b,dl as u};
