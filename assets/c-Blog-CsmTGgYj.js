import{_ as ie}from"./c-Page.vue_vue_type_script_setup_true_lang-DQEn_xOF.js";import{X as re,Y as de,b as t,c as n,$ as P,r as T,J as u,e as l,d as M,q as W,a as Y,an as ce,s as w,l as K,ao as ue,ap as pe,R as I,f as s,h as f,g as c,B as fe,j as Z,C as E,i as L,u as ee,G as te,aq as se,z as O,O as R,w as N,ar as z,n as G,Q as q,as as me,at as H,t as ve,_ as J,au as ge,av as ye,a2 as Q,U as oe,W as he,aw as V}from"../bundle.js";import{_ as be}from"./c-BackButton.vue_vue_type_script_setup_true_lang-oHqvxMiV.js";import{_ as ae,b as X,u as ke,a as $e}from"./c-BlogPostDialog.vue_vue_type_script_setup_true_lang-BrkfkPGL.js";import{_ as we}from"./c-Dialog.vue_vue_type_script_setup_true_lang-ChRuyxYJ.js";import"./c-useUsers-DiKbhbPK.js";var xe=`
    .p-card {
        background: dt('card.background');
        color: dt('card.color');
        box-shadow: dt('card.shadow');
        border-radius: dt('card.border.radius');
        display: flex;
        flex-direction: column;
    }

    .p-card-caption {
        display: flex;
        flex-direction: column;
        gap: dt('card.caption.gap');
    }

    .p-card-body {
        padding: dt('card.body.padding');
        display: flex;
        flex-direction: column;
        gap: dt('card.body.gap');
    }

    .p-card-title {
        font-size: dt('card.title.font.size');
        font-weight: dt('card.title.font.weight');
    }

    .p-card-subtitle {
        color: dt('card.subtitle.color');
    }
`,Ce={root:"p-card p-component",header:"p-card-header",body:"p-card-body",caption:"p-card-caption",title:"p-card-title",subtitle:"p-card-subtitle",content:"p-card-content",footer:"p-card-footer"},Se=re.extend({name:"card",style:xe,classes:Ce}),Pe={name:"BaseCard",extends:de,style:Se,provide:function(){return{$pcCard:this,$parentInstance:this}}},le={name:"Card",extends:Pe,inheritAttrs:!1};function _e(e,a,m,x,k,r){return t(),n("div",P({class:e.cx("root")},e.ptmi("root")),[e.$slots.header?(t(),n("div",P({key:0,class:e.cx("header")},e.ptm("header")),[T(e.$slots,"header")],16)):u("",!0),l("div",P({class:e.cx("body")},e.ptm("body")),[e.$slots.title||e.$slots.subtitle?(t(),n("div",P({key:0,class:e.cx("caption")},e.ptm("caption")),[e.$slots.title?(t(),n("div",P({key:0,class:e.cx("title")},e.ptm("title")),[T(e.$slots,"title")],16)):u("",!0),e.$slots.subtitle?(t(),n("div",P({key:1,class:e.cx("subtitle")},e.ptm("subtitle")),[T(e.$slots,"subtitle")],16)):u("",!0)],16)):u("",!0),l("div",P({class:e.cx("content")},e.ptm("content")),[T(e.$slots,"content")],16),e.$slots.footer?(t(),n("div",P({key:1,class:e.cx("footer")},e.ptm("footer")),[T(e.$slots,"footer")],16)):u("",!0)],16)],16)}le.render=_e;const Be={key:0,class:"flex justify-center mt-5"},Ie={key:1,class:"flex flex-col gap-3"},Le=M({__name:"BlogDetails",setup(e){const a=fe(),m=Z(),x=W(),k=Y(),r=ce(),{isLoggedIn:v}=w(x),{currentBlogPost:g,isFetchLoading:$}=w(k),{fetchBlogPost:C}=k,d=E(()=>a.params.postId);return K(async()=>{if(r.unread=[],d.value&&g.value?.id!==d.value){const y=await C(d.value);if(ue(y)&&y===pe.PERMISSION_DENIED&&!v.value){m.push({name:I.LOGIN,params:{redirect:JSON.stringify({name:I.BLOG_DETAILS,params:{postId:d.value}})}});return}}}),(y,h)=>s($)?(t(),n("div",Be,[f(L,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:"",label:"Loading..."})])):(t(),n("div",Ie,[f(be,{"back-route":s(I).BLOG,label:"Back to other posts"},null,8,["back-route"]),s(g)?(t(),c(ae,{key:0,post:s(g)},null,8,["post"])):u("",!0)]))}}),Oe={class:"flex gap-3"},De={class:"min-h-[50vh] flex flex-col"},Ue={class:"flex justify-between h-fit mt-2 gap-2"},Te={class:"flex flex-wrap gap-3"},Ee={class:"relative mt-5 min-h-[20vh] max-h-screen flex flex-col justify-end"},Re={class:"relative min-h-[20vh] max-h-full flex-grow"},Ne={class:"flex flex-col gap-1"},Ae={class:"flex justify-center mt-5"},Ge={class:"flex justify-center mt-3"},Me=M({__name:"BlogPostOverview",props:{post:{}},setup(e){const a=e,m=ee(),x=W(),k=te(),r=Y(),v=se(),{routeLoading:g,routeLoadingId:$}=w(m),{publicUsers:C}=w(k),{isOwner:d}=w(x),{deleteBlogPost:y}=r,h=O(!1),D=O(a.post.archived),S=E(()=>a.post.allowedUserIds?.length?C.value.filter(o=>a.post.allowedUserIds?.includes(o.id)):[]),_=E(()=>{const o=Q(a.post.date);return a.post.dateUpdated?o+` - updated ${Q(a.post.dateUpdated)}`:o}),U=E(()=>{const o=[];return a.post.datePinned&&o.push({value:"Pinned",severity:"success",rounded:!1}),a.post.locked&&o.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),a.post.archived&&o.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),o}),A=()=>{v.openWith(a.post)},B=()=>{h.value=!0},j=async()=>{await y(a.post.id)&&(h.value=!1)},p=()=>{const o=document.createElement("textarea"),{protocol:i,hostname:b,port:F}=window.location,ne=`${i}//${b}`+(b==="localhost"?`:${F}`:"");o.value=`${ne}#${ge.BLOG.path}/${a.post.id}`,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),ye.success("Copied link!")};return(o,i)=>(t(),n(R,null,[f(J,{id:e.post.id,class:G([{"min-h-[50vh]":!D.value},"border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:_.value,tags:U.value,isCollapsed:D.value,clickable:"",route:{name:s(I).BLOG_DETAILS,params:{postId:e.post.id}}},{right:N(()=>[l("div",Oe,[D.value?s(d)?(t(),c(X,{key:1,onEditClicked:A,onDeleteClicked:B})):u("",!0):(t(),c(L,{key:0,class:"border-none h-fit",variant:"neutral",icon:"pi pi-copy",onClick:p}))])]),default:N(()=>[l("div",De,[l("div",Ue,[l("div",Te,[S.value.length?(t(),n(R,{key:0},[f(s(z),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:S.value[0]?.displayName,rounded:""},null,8,["label"]),S.value.length>1?(t(),c(s(z),{key:0,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:"You",rounded:""})):u("",!0),S.value.length>2?(t(),c(s(z),{key:1,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",label:`${S.value.length-2} others`,rounded:""},null,8,["label"])):u("",!0)],64)):u("",!0)]),s(d)?(t(),n("div",{key:0,class:G(["flex justify-end ms-5",e.post.allowedUserIds?.length?"flex-col md:flex-row":"flex-row"])},[f(X,{onEditClicked:A,onDeleteClicked:B})],2)):u("",!0)]),l("div",Ee,[i[3]||(i[3]=l("div",{class:"absolute inset-0 rounded-primary bg-gradient-to-t from-neutral-500 to-transparent"},null,-1)),l("div",Re,[f(s(le),{class:G(["z-10 min-h-[20vh] p-5 text-neutral-300",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{content:N(()=>[l("div",Ne,[(t(!0),n(R,null,q(e.post.content.filter((b,F)=>F<2),b=>(t(),c(me,{key:b.id,class:"max-h-[150px] overflow-hidden",post:e.post,block:b},null,8,["post","block"]))),128))])]),_:1},8,["class"])])]),l("div",Ae,[f(L,{class:"w-full md:w-1/2",variant:"neutral",label:"Read more",loading:s(g)===s(I).BLOG_DETAILS&&s($)===e.post.id,onClick:i[0]||(i[0]=b=>s(H).push({name:s(I).BLOG_DETAILS,params:{postId:e.post.id}}))},null,8,["loading"])]),l("div",Ge,[l("p",{class:G(e.post.reactions.length?"text-yellow-400 hover:text-yellow-500 cursor-pointer":"text-neutral-200"),onClick:i[1]||(i[1]=b=>s(H).push({name:s(I).BLOG_DETAILS,params:{postId:e.post.id}}))},ve(e.post.reactions.length)+" replies ",3)])])]),_:1},8,["id","class","title","subTitle","tags","isCollapsed","route"]),f(we,{title:"Delete Post",isOpen:h.value,description:[` Are you sure you want to delete this post called '${e.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:j,onCancel:i[2]||(i[2]=b=>h.value=!1)},null,8,["isOpen","description"])],64))}}),je={class:"w-full grid gap-4 md:gap-10 xl:gap-20"},Fe={key:2,class:"w-full flex justify-center mt-5"},ze=M({__name:"BlogPosts",props:{single:{type:Boolean}},setup(e){const a=W(),m=Y(),x=se(),{blogPosts:k,visibleBlogPosts:r,isFetchLoading:v,visibility:g,isLastPage:$,loadedOnce:C}=w(m),{firebaseUser:d,isLoggedIn:y,isOwner:h}=w(a),{fetchBlogPosts:D}=m;ke();const S=O(),_=O(),U=O(),A=()=>{x.openWith(null)},B=async p=>{m.visibility!==p&&(k.value[p].length||await D({visibility:p}),m.visibility=p,$.value=!1,V(S.value))},j=async()=>{const p=r.value.length;await D(),r.value[p]&&V(_.value[p])};return K(()=>{C.value||(y.value?B("private"):g.value!=="public"&&B("public"),C.value=!0)}),oe(()=>_.value?.length,()=>{if(_.value?.length&&U.value){const p=r.value.find(o=>o.id===U.value);if(p){const o=r.value.indexOf(p);V(_.value[o]),U.value=void 0}}}),(p,o)=>(t(),n("div",{ref_key:"container",ref:S,class:"flex flex-col gap-5 items-center"},[s(h)?(t(),c(L,{key:0,class:"w-full md:w-1/2",variant:"tertiary",label:"New Post",onClick:A})):u("",!0),s(y)?(t(),c(s(he),{key:1,class:"w-full md:w-1/2"},{default:N(()=>[f(L,{class:"w-full",variant:"secondary",outlined:s(g)!=="public",loading:s(v),label:"Public Posts",onClick:o[0]||(o[0]=i=>B("public"))},null,8,["outlined","loading"]),f(L,{class:"w-full",variant:"secondary",outlined:s(g)!=="private",loading:s(v),label:"Private Posts",onClick:o[1]||(o[1]=i=>B("private"))},null,8,["outlined","loading"])]),_:1})):u("",!0),l("div",je,[s(r).length?(t(!0),n(R,{key:0},q(s(r),(i,b)=>(t(),n("div",{key:i.id,ref_for:!0,ref_key:"posts",ref:_},[b===0||i.datePinned?(t(),c(ae,{key:0,post:i},null,8,["post"])):(t(),c(Me,{key:1,post:i},null,8,["post"]))]))),128)):s(v)?(t(),c(J,{key:1,class:"!bg-neutral-600 !bg-opacity-40 !rounded-primary",title:"Loading..."})):(t(),c(J,{key:2,class:"!bg-red-900 !bg-opacity-40 !rounded-primary",title:"No posts"}))]),s($)?u("",!0):(t(),n("div",Fe,[f(L,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:s(r).length>0&&s(v),label:"Load more posts",onClick:j},null,8,["loading"])]))],512))}}),Ve={class:"grid mt-10 md:mt-15"},Je={class:"grid justify-center"},We={class:"text-lg md:text-xl text-white"},Ye=["innerHTML"],qe={class:"grid my-5 xl:px-20"},tt=M({__name:"Blog",setup(e){const a=Z(),m=ee(),x=te(),{menuItems:k,content:r}=w(m),{publicUser:v}=w(x),g=O(),$=O(a.currentRoute.value.params.postId),C=E(()=>v.value?[...r.value.blogDescriptionUser.map(d=>d.replace("%USER%",v.value.displayName||"Unknown user")),...k.value.find(d=>d.id==="nfNQM4SMESU2VOkJtcgY")?.description||[]]:r.value.blogDescriptionGuest);return oe(a.currentRoute,d=>{$.value=d.params.postId}),(d,y)=>(t(),c(ie,null,{content:N(()=>[l("div",Ve,[l("div",Je,[(t(!0),n(R,null,q(C.value,h=>(t(),n("h1",We,[l("span",{innerHTML:h},null,8,Ye)]))),256))]),l("div",qe,[$.value?(t(),c(Le,{key:0})):(t(),c(ze,{key:1})),f($e,{onScrollToUpdated:y[0]||(y[0]=h=>g.value=h)})])])]),_:1}))}});export{tt as default};
