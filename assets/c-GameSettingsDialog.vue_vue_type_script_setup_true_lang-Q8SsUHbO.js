import{_ as pe,a as ye}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-BocIXFtA.js";import{_ as fe}from"./c-SelectField.vue_vue_type_script_setup_true_lang-Bu9S1e-e.js";import{d as Ae,aG as se,s as q,r as E,a as Ie,c as _,o as re,aH as N,M as He,aI as U,cP as Oe,aJ as Te,aM as ce,aK as he,aL as ke,e as Re,bP as Ve,cw as be,l as G,q as ee,D as Ne,n as Ce,k as D,ab as le,t as ue}from"../bundle.js";var De=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(De||{});const ie={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Pe=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Pe||{}),Le=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(Le||{});const Me={easy:.5,hard:1},me=()=>{const e=xe();return Oe(e),{pile1:e.splice(0,1).map(i=>({...i,deck:"pile1"})),pile2:e.splice(0,2).map((i,f)=>f<1?{...i,hidden:!0,deck:"pile2"}:{...i,deck:"pile2"}),pile3:e.splice(0,3).map((i,f)=>f<2?{...i,hidden:!0,deck:"pile3"}:{...i,deck:"pile3"}),pile4:e.splice(0,4).map((i,f)=>f<3?{...i,hidden:!0,deck:"pile4"}:{...i,deck:"pile4"}),pile5:e.splice(0,5).map((i,f)=>f<4?{...i,hidden:!0,deck:"pile5"}:{...i,deck:"pile5"}),pile6:e.splice(0,6).map((i,f)=>f<5?{...i,hidden:!0,deck:"pile6"}:{...i,deck:"pile6"}),pile7:e.splice(0,7).map((i,f)=>f<6?{...i,hidden:!0,deck:"pile7"}:{...i,deck:"pile7"}),stock_closed:e.map(i=>({...i,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},we=Ae("patienceStore",()=>{const e=se(),{personalBest:i,highscorePosition:f}=q(e),{setPreviousHighscores:R,updateHighscores:V,sortHighscores:P}=e,I=E("hard"),r=E(0),T=E(0),p=E(0),h=E(0),v=E(0),m=E(),g=E(!0),c=Ie(me()),b=_(()=>Me[I.value]),C=_(()=>Object.keys(c).flatMap(l=>c[l])),L=1e3,Z=10,w=10,x=_(()=>{const l=p.value%10===0?p.value:Math.floor(p.value/10)*10,o=T.value*Z,n=v.value*Z,u=l+o+n,S=h.value*w;return Math.max(0,L-(u-S))}),y=_(()=>{const l=Math.floor(p.value/60),o=p.value%60;return`${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")}`}),B=_(()=>c.hearts.length===13&&c.spades.length===13&&c.diamonds.length===13&&c.clubs.length===13);re(()=>{e.$init(N.PATIENCE),p.value&&r.value===1&&O()}),He(B,l=>{l&&r.value!==2&&($(),r.value=2,de(),U(Te))});const ae=()=>{$(),T.value=0,p.value=0,h.value=0,v.value=0,r.value=0,Object.assign(c,me()),e.setPreviousHighscores()},oe=()=>{p.value=0,O(),r.value=1,setTimeout(()=>{a()},500)},O=()=>{m.value&&$(),m.value=setInterval(()=>{p.value++},1e3)},$=()=>{clearInterval(m.value)},z=()=>{const l=c.stock_open;l.length&&(l.reverse(),k(l[0],!1,o=>{o.deck="stock_closed",o.hidden=!0,c.stock_closed.push(o)}),l.splice(0,l.length),s(1))},J=l=>{const o=l.deck,n=C.value.filter(u=>u.selected);if(o==="stock_closed"){const u=c.stock_closed,S=u.indexOf(l);if(S===u.length-1){const M=I.value==="hard"?S-2:S,H=M<0?0:M,ne=u.filter((ve,_e)=>_e>=H);W(),j(ne,"stock_open",ve=>{ve.hidden=!1}),s(0)}}else if(o==="stock_open"){const u=c.stock_open;u.indexOf(l)===u.length-1&&(l.selected=!l.selected,n.length&&k(n[0],!1))}else if(n.length){const u=n[0];u===l?k(l,!1):X(o)&&d(u,l)?l.value===u.value+1&&l.deck!==u.deck&&(j(n,o),u.deck==="stock_open"?s(2):s(4)):n.length===1&&te(o)&&A(u,l)&&l.value===u.value-1&&(Y(u,o),s(3),u.hasBeenHome=!0)}else k(l,!0)},Q=l=>{const o=C.value.filter(n=>n.selected);if(o.length){const n=o[0],u=n.deck;n.value===13&&(j(o,l),u==="stock_open"?s(2):X(n.deck)&&c[n.deck].every(S=>!S.hidden)?s(5):s(4))}},F=l=>{const o=C.value.filter(n=>n.selected);if(o.length===1){const n=o[0],u=n.type;!c[l].length&&u===l&&n.value===1&&(Y(n,l),s(3))}},k=(l,o,n)=>{const u=c[l.deck],S=u.indexOf(l);u.filter((H,ne)=>ne>=S).forEach(H=>{H.selected=o,n==null||n(H)})},W=()=>{C.value.forEach(l=>{l.selected=!1})},Y=(l,o)=>{const n=l.deck,u=c[n].indexOf(l);l.deck=o,l.selected=!1,c[o].push(l),c[n].splice(u,1),(X(n)||n==="stock_open")&&t(n)},j=(l,o,n)=>{const u=l[0],S=u.deck,M=c[S].indexOf(u);k(u,!1,H=>{H.deck=o,n==null||n(H),c[o].push(H)}),c[S].splice(M,l.length),te(S)||t(S!=="stock_closed"?S:o)},K=l=>{if(!g.value)return!0;const o=c[l.type],n=o.length?o[o.length-1].value:0;if(l.value===n+1){const u=["hearts","spades","diamonds","clubs"],S=n<=1||u.every(M=>{const H=c[M];return(H.length?H[H.length-1].value:0)>=n});if(n===0||S)return Y(l,l.type),l.hasBeenHome=!0,s(3),!0}return!1},a=()=>{if(g.value)for(const l of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const o=c[l];if(o.length&&K(o[o.length-1]))return}},t=l=>{const o=c[l];if(o.length){const n=o[o.length-1],u=n.deck;n.hidden=!1,setTimeout(()=>{n.deck===u&&(K(n)||a())},500)}else setTimeout(()=>{a()},500)},s=l=>{switch(l!==5&&T.value++,l){case 0:{v.value+=2*b.value;break}case 1:{v.value+=5*b.value;break}case 2:{h.value+=10*b.value;break}case 3:{h.value+=20*b.value;break}}U(ce)},d=(l,o)=>l.color!==o.color,A=(l,o)=>l.type===o.type,X=l=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(l),te=l=>["hearts","spades","diamonds","clubs"].includes(l),de=()=>{V({difficulty:I.value,score:x.value,bonus:h.value,time:p.value,turns:T.value,penalty:v.value})};return{difficulty:I,gameStatus:r,score:x,turns:T,time:p,bonus:h,penalty:v,cards:c,doAutocomplete:g,allCards:C,formattedTime:y,personalBest:i,highscorePosition:f,$reset:ae,start:oe,shuffle:z,selectCard:J,selectEmptyDeck:Q,selectFinalDeck:F,deselectAllCards:W,isPlayDeck:X,isFinalDeck:te,setPreviousHighscores:R,updatePatienceHighscore:de,sortHighscores:P}},{persist:{enabled:!0}}),xe=()=>Object.keys(ie).flatMap(e=>{const i=e,f=[];for(let R=0;R<13;R++){const V={type:i,label:ie[i].label,color:ie[i].color,value:R+1,hidden:!1,selected:!1,hasBeenHome:!1};f.push(V)}return f});var Be=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_THROWN_DICES=2]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=3]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=4]="HAS_CHOSEN_TILE",e[e.HAS_LOST=5]="HAS_LOST",e[e.HAS_FINISHED=6]="HAS_FINISHED",e))(Be||{}),$e=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))($e||{}),We=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.LOSER=3]="LOSER",e))(We||{}),Ue=(e=>(e[e.PLAYER=0]="PLAYER",e[e.ROBOT=1]="ROBOT",e))(Ue||{});const Fe=e=>{for(let i=1;i<=6;i++)if(e.every(f=>f.value===i))return!0;return!1},ge=()=>({0:[],1:[]}),Ye=Ae("rainwormsStore",()=>{const e=se(),{personalBest:i,highscorePosition:f}=q(e),{setPreviousHighscores:R,updateHighscores:V,sortHighscores:P}=e,I=E(1),r=E(0),T=E(0),p=E(0),h=E(0),v=E(0),m=E(Se()),g=E(Ee()),c=Ie(ge()),b=_(()=>m.value.some(a=>a.isRolling)),C=_(()=>m.value.filter(a=>a.selected).some(a=>a.value===6)),L=_(()=>a=>m.value.some(t=>t.value===a&&t.selected)),Z=_(()=>a=>g.value.some(t=>t.displayValue<=a)),w=_(()=>a=>v.value===(a??0)),x=_(()=>a=>{const t=c[a??0];return t.length?t[t.length-1]:null}),y=_(()=>{let a=0;return m.value.filter(t=>t.selected).forEach(t=>{a+=t.value===6?5:t.value}),a}),B=_(()=>a=>{let t=0;return c[a].forEach(s=>{t+=s.value}),t});re(()=>{e.$init(N.RAINWORMS)});const ae=()=>{r.value=0,T.value=0,p.value=0,h.value=0,v.value=0,m.value=Se(),g.value=Ee(),Object.assign(c,ge()),R()},oe=()=>{r.value=1},O=a=>{if(!w.value(a))return;(r.value===1||r.value===4||r.value===5)&&m.value.forEach(s=>{s.selected=!1}),r.value=2;const t=e.diceRollSpeed*1e3;m.value.forEach(s=>{s.selected||(s.isRolling=!0,setTimeout(()=>{s.value=he(6),s.isRolling=!1,m.value.sort((d,A)=>d.value-A.value),!b.value&&r.value!==5&&z()&&J(a)},he(t,t/3)))}),U(ke)},$=async()=>{for(;b.value;)await new Promise(a=>setTimeout(a,500));return!0},z=()=>{const a=m.value.filter(t=>!t.selected&&!L.value(t.value));return!a.length||Fe(a)&&a.every(t=>t.value!==6)},J=a=>{r.value=5,T.value=a??0,c[T.value].length?h.value=1:h.value=2,Q(),g.value.length===0?r.value=6:W()},Q=()=>{const a=c[v.value];if(a.length){const t=a.splice(a.length-1,1)[0];g.value.push(t),g.value.sort((s,d)=>s.displayValue-d.displayValue)}g.value.splice(g.value.length-1,1)},F=(a,t)=>{w.value(t)&&!b.value&&r.value===2&&!a.selected&&!L.value(a.value)&&(r.value=3,m.value.filter(s=>s.value===a.value).forEach(s=>{s.selected=!0}),U(ce))},k=(a,t,s)=>{if(w.value(s)&&(r.value===2||r.value===3)){if(r.value=4,T.value=s??0,t){const d=c[v.value===0?1:0];d.splice(d.length-1,1)}else g.value=g.value.filter(d=>d.displayValue!==a.displayValue);c[v.value].push(a),U(ce),g.value.length===0?r.value=6:W()}},W=a=>{(v.value===1||r.value!==5||a)&&(v.value===0?setTimeout(()=>{v.value=1,setTimeout(()=>{r.value=1,T.value=0},1e3)},a?0:I.value*1e3*2):setTimeout(()=>{v.value=0},a?0:I.value*1e3*2))},Y=async()=>{switch(r.value){case 1:{O(1);break}case 2:{await $(),setTimeout(()=>{const a=m.value.filter(s=>!s.selected),t=x.value(0);if(t&&y.value<t.displayValue)for(let s=6;s>=1;s--){const d=a.filter(A=>A.value===s&&!L.value(s));if(d.length){const A=d.length*(s===6?5:s);if(y.value+A===t.displayValue){F(d[0],1);return}}}for(let s=6;s>=1;s--){const d=m.value.find(A=>A.value===s);if(d&&!L.value(s)){F(d,1);return}}},I.value*1e3);break}case 3:{setTimeout(()=>{const a=x.value(0),t=m.value.filter(s=>!s.selected).length;if(!t||y.value>=30){console.log(t?"i am rich":"i can only pick a tile now");for(let s=y.value;s>=21;s--){const d=g.value.find(A=>A.displayValue===s);if(d){k(d,!1,1);return}}t&&O(1)}if(g.value.every(s=>s.displayValue>y.value)&&a&&a.displayValue>y.value)console.log("my score is too low"),O(1);else if(a&&a.displayValue===y.value)console.log("i can steal"),k(a,!0,1);else if(new Set(m.value.filter(s=>s.selected).map(s=>s.value)).size<=3)if(m.value.filter(s=>!s.selected).length<=2){console.log("there aren't that much dices left");const s=g.value.filter(d=>d.displayValue>=y.value-5&&d.displayValue<=y.value).sort((d,A)=>A.displayValue-d.displayValue);s.length?(console.log("i choose the highest score within 5 tiles"),k(s[0],!1,1)):(console.log("i choose to roll again"),O(1))}else console.log("i have nothing to worry about"),O(1);else if(!C.value)console.log("i am worrying and have no worm yet"),O(1);else{console.log("if i can choose, i choose");const s=g.value.filter(d=>d.displayValue<=y.value).sort((d,A)=>A.displayValue-d.displayValue);s.length?(console.log("i choose the highest score"),k(s[0],!1,1)):(console.log("i choose to roll again"),O(1))}},I.value*1e3);break}default:console.log("DEFAULT",r.value)}},j=()=>{const a=B.value(0),t=B.value(1);a>t?p.value=1:a===t&&Math.max(...c[0].map(s=>s.displayValue))>Math.max(...c[1].map(s=>s.displayValue))?p.value=2:p.value=3,(p.value===1||p.value===2)&&(K(),U(Te))},K=()=>{V({score:B.value(0)})};return{gameStatus:r,gameStatusActivator:T,finishStatus:p,loseStatus:h,activePlayer:v,dices:m,tiles:g,score:c,robotSpeed:I,isRolling:b,hasWorm:C,hasAlreadyChosen:L,canSelectAnyTile:Z,canPlay:w,visibleTile:x,selectedDiceTotal:y,totalScore:B,personalBest:i,highscorePosition:f,$reset:ae,start:oe,roll:O,hasFinishedRolling:$,hasLostRound:z,loseTurn:J,popLastTile:Q,selectDice:F,selectTile:k,passTurn:W,playRobot:Y,checkFinishStatus:j,setPreviousHighscores:R,updateRainwormsHighscore:K,sortHighscores:P}},{persist:{enabled:!0}}),Se=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],Ee=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],Ze=Re({__name:"GameSettingsDialog",props:Ve({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const i=e,f=be(e,"isOpen"),R=se(),{useAudio:V,diceRollSpeed:P}=q(se()),{robotSpeed:I}=q(Ye()),{doAutocomplete:r}=q(we()),T=_(()=>{switch(i.gameId){case N.YAHTZEE:return"v5 (12-12-2024)";case N.RAINWORMS:return"v5 (12-12-2024)";case N.PATIENCE:return"v2 (16-12-2024)"}});return re(()=>{R.$init(i.gameId)}),(p,h)=>(G(),ee(ye,{isOpen:f.value,title:"Game Settings",description:p.gameId?`Current version: ${T.value}`:"General settings",cancelText:"Close",onCancel:h[4]||(h[4]=v=>f.value=!1)},{default:Ne(()=>[Ce(pe,{name:"useAudio",label:"Audio",modelValue:D(V),"onUpdate:modelValue":h[0]||(h[0]=v=>le(V)?V.value=v:null)},null,8,["modelValue"]),p.gameId===D(N).PATIENCE?(G(),ee(pe,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:D(r),"onUpdate:modelValue":h[1]||(h[1]=v=>le(r)?r.value=v:null)},null,8,["modelValue"])):ue("",!0),p.gameId===D(N).YAHTZEE||p.gameId===D(N).RAINWORMS?(G(),ee(fe,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:D(P),"onUpdate:modelValue":h[2]||(h[2]=v=>le(P)?P.value=v:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):ue("",!0),p.gameId===D(N).RAINWORMS?(G(),ee(fe,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:D(I),"onUpdate:modelValue":h[3]||(h[3]=v=>le(I)?I.value=v:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):ue("",!0)]),_:1},8,["isOpen","description"]))}});export{De as C,Pe as D,We as F,Be as G,$e as L,Ue as P,Ze as _,we as a,Le as b,Ye as u};
