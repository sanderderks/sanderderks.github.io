import{f as h,aW as Ye,a_ as ke,c as Ve,aX as $e,aQ as je,s as $,a$ as Ke,b0 as ae,aS as k,w as R,aR as I,a9 as M,o as Ze,L as w,b3 as ze,b4 as Ue,aY as V,b5 as We,b1 as Me,b9 as se,aq as Be,aZ as xe,d as Xe,g as qe,j as ne,l as Qe,aT as Je,h as B,z as ye}from"../bundle.js";import{_ as el,a as ll,b as tl,c as al,d as sl}from"./c-Dice5.vue_vue_type_script_setup_true_lang-DK-8hWiG.js";import{_ as nl}from"./c-Dice6.vue_vue_type_script_setup_true_lang-CbzU1YFL.js";const ol=l=>{const T=h(()=>L(3)),S=h(()=>L(4)),g=h(()=>N(2)&&N(3)?b[Y.FULL_HOUSE].trueValue??!1:!1),F=h(()=>C(4)?b[Y.SMALL_STRAIGHT].trueValue??!1:!1),D=h(()=>C(5)?b[Y.LARGE_STRAIGHT].trueValue??!1:!1),u=h(()=>N(5)?b[Y.YAHTZEE].trueValue??!1:!1),G=h(()=>{let i=0;return l.value.forEach(c=>{i+=c.value}),i}),L=i=>{for(let c=1;c<=6;c++)if(l.value.filter(f=>f.value===c).length>=i){let f=0;return l.value.forEach(A=>{f+=A.value}),f}return!1},N=i=>{for(let c=1;c<=6;c++)if(l.value.filter(f=>f.value===c).length===i)return!0;return!1},C=i=>{let c=0,f=i;do{e:for(let A=f-i+1;A<=f;A++)if(l.value.some(j=>j.value===A))c++;else break e;if(c===i)return!0;c=0,f++}while(f<=6);return!1};return{hasThreeOfAKind:T,hasFourOfAKind:S,hasFullHouse:g,hasSmallStraight:F,hasLargeStraight:D,hasYahtzee:u,diceTotal:G,hasAtLeastOf:L,hasExactOf:N,hasStraight:C}};var ul=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.WAITING_FOR_OPPONENTS=2]="WAITING_FOR_OPPONENTS",l[l.HAS_STARTED=3]="HAS_STARTED",l[l.HAS_THROWN_DICES=4]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=5]="HAS_CHOSEN_DICES",l[l.HAS_FINISHED=6]="HAS_FINISHED",l))(ul||{}),Y=(l=>(l[l.ONES=0]="ONES",l[l.TWOS=1]="TWOS",l[l.THREES=2]="THREES",l[l.FOURS=3]="FOURS",l[l.FIVES=4]="FIVES",l[l.SIXES=5]="SIXES",l[l.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",l[l.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",l[l.FULL_HOUSE=8]="FULL_HOUSE",l[l.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",l[l.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",l[l.YAHTZEE=11]="YAHTZEE",l[l.CHANCE=12]="CHANCE",l))(Y||{}),il=(l=>(l[l.TOP=35]="TOP",l[l.YAHTZEE=100]="YAHTZEE",l))(il||{});const rl=Ye("yahtzeeStore",()=>{const l=ke(),T=Ve(),S=$e(),g=je(),{personalBest:F,highscorePosition:D}=$(S),{firebaseUser:u}=$(T),{onlineGames:G,onlineGamesLoading:L,onlineGameId:N,onlineGameCreatorId:C,onlineGamePlayers:i,onlineGameOpponents:c,partyName:f,maxPlayers:A,onlineGameChat:j,isInitializingOnlineGame:x,isOnlineGameOwner:K}=$(g),{fetchOnlineGames:ue,createOnlineGame:ie,continueOnlineGame:re,updateOnlineGame:ce,leaveOnlineGame:ve,deleteOnlineGame:fe,getPlayerDisplayName:de,getNextPlayerId:X}=g,{setPreviousHighscores:q,updateHighscores:me,sortHighscores:Oe}=S,Ee={onlineGames:Ke(l,ae.GAME_DATA,k.YAHTZEE,ae.ONLINE_GAMES)},_=R(I.SOLO),r=R(0),P=R(!1),s=R("soloPlayer"),d=R(s.value),m=R(oe()),O=R(-1),v=M({}),E=M({}),o=M({}),p=h(()=>m.value.some(e=>e.isRolling)),he=h(()=>O.value===-1&&!m.value.every(e=>e.selected)),Se=h(()=>O.value>=0&&O.value<2&&!m.value.every(e=>e.selected)),ge=h(()=>e=>m.value.filter(t=>t.value===e).length),{hasThreeOfAKind:Ae,hasFourOfAKind:_e,hasFullHouse:Ie,hasSmallStraight:He,hasLargeStraight:Ne,hasYahtzee:Q,diceTotal:Re}=ol(m);Ze(()=>{S.$init(k.YAHTZEE)}),w(v,e=>{r.value!==6&&Object.keys(e).length&&Object.keys(e).every(t=>e[t].length===13)&&(_.value===I.SOLO||K.value)&&(r.value=6)}),w(r,e=>{e===6&&(_.value===I.SOLO?(le(s.value),W()):K.value&&(i.value.forEach(t=>{le(t.userId)}),we(),z()),V(xe))}),w(o,()=>{var e;if(_.value===I.ONLINE){const t=(e=o[s.value])==null?void 0:e.winStatus;(t==="win"||t==="tie")&&W()}}),w([r,d,p],()=>{_.value===I.ONLINE&&(console.log("CHANGE IN LOCAL DATA DETECTED",r.value,d.value,p.value),z())},{deep:!0}),w(i,()=>{r.value===2&&A.value&&i.value.length===A.value&&(r.value=3)});const Z=()=>{g.$reset(),_.value=I.SOLO,r.value=0,P.value=!1,s.value="soloPlayer",d.value=s.value,O.value=-1,m.value=oe(),Object.keys(v).forEach(e=>{delete v[e],delete E[e],delete o[e]}),q()},Te=(e,t=null,a=null)=>{u.value&&(e=[{userId:u.value.uid,isOnline:!0},...e],_.value=I.ONLINE,r.value=a?2:3,s.value=u.value.uid,d.value=s.value,e.forEach(n=>{v[n.userId]=[],E[n.userId]=[],o[n.userId]=null}),g.$init(k.YAHTZEE,y,J,Z),ie(e,t,a))},Ge=e=>{u.value&&(_.value=I.ONLINE,s.value=u.value.uid,g.$init(k.YAHTZEE,y,J,Z),re(e))},z=()=>{console.log("updateOnlineGameCustom.1"),!(!u.value||d.value!==s.value&&!P.value&&!x.value)&&(console.log("updateOnlineGameCustom.2"),ce())},J=()=>({gameStatus:r.value,activePlayerId:d.value,dices:m.value,reroll:O.value,score:v,bonusScore:E,finalScore:o}),y=e=>{var a;console.log("updateLocalGameState.1");const t=(a=u.value)==null?void 0:a.uid;!t||d.value===s.value&&!x.value||(console.log("updateLocalGameState.2"),r.value=e.gameStatus,d.value=e.activePlayerId,m.value=e.dices,O.value=e.reroll,Object.assign(v,e.score),Object.assign(E,e.bonusScore),Object.assign(o,e.finalScore),Object.keys(v).includes(t)||(v[t]=[],E[t]=[],o[t]=null))},ee=async()=>{for(;p.value;)await new Promise(e=>setTimeout(e,S.diceRollSpeed*1e3));return!0},Le=()=>{r.value=3,v[s.value]=[],E[s.value]=[],o[s.value]=null},be=async()=>{const e=S.diceRollSpeed*1e3;O.value++,m.value.forEach(t=>{t.selected||(t.isRolling=!0,setTimeout(()=>{t.value=ze(6),t.isRolling=!1,O.value===2&&(t.selected=!0),m.value.sort((a,n)=>a.value-n.value)},Ue(e,e/3)))}),await ee(),r.value=4,V(We)},Fe=(e,t)=>{var a;return(a=v[t])==null?void 0:a.find(n=>n.row===e)},De=(e,t)=>Me(E[t].filter(a=>a===e)),U=(e,t="soloPlayer")=>{var n;let a=0;return(n=v[t])==null||n.filter(H=>b[H.row].section===e).forEach(H=>{H.value!==!1&&(a+=H.value)}),a},Ce=(e,t)=>{let a=t;if(a===!1)return!1;const n=b[e];return n.multiplier?a*=n.multiplier:n.trueValue&&(a=n.trueValue),a},Pe=e=>{d.value===s.value&&O.value>=0&&O.value<2&&(e.selected=!e.selected,V(se))},pe=(e,t)=>{if(!p.value){if(t!==!1&&Q.value){const a=v[s.value].find(n=>n.row===11);a&&a.value!==!1&&E[s.value].push(100)}v[s.value].push({row:e,value:t}),U("top",s.value)>=63&&!E[s.value].includes(35)&&E[s.value].push(35),O.value=-1,m.value.forEach(a=>{a.selected=!1}),V(se),_.value===I.ONLINE&&(P.value=!0,r.value=5,setTimeout(async()=>{r.value=3,d.value=X(d.value),await Be(),P.value=!1},S.diceRollSpeed*1e3))}},le=e=>{const t=U("top",e),a=U("bottom",e),n=E[e].reduce((H,te)=>te===35?H+(t>=63?35:0):te===100?H+100:H,0);o[e]={top:t,bottom:a,bonus:n,total:t+a+n}},we=()=>{const e=Math.max(...Object.values(o).map(a=>(a==null?void 0:a.total)??0)),t=Object.keys(o).filter(a=>{var n;return((n=o[a])==null?void 0:n.total)===e});i.value.forEach(a=>{t.includes(a.userId)?t.length===1?o[a.userId].winStatus="win":o[a.userId].winStatus="tie":o[a.userId].winStatus="lose"})},W=()=>{u!=null&&u.value&&o[s.value]&&me({gameId:N.value??null,score:o[s.value].total,bonus:o[s.value].bonus})};return{collections:Ee,onlineGames:G,onlineGamesLoading:L,onlineGameId:N,onlineGameCreatorId:C,onlineGamePlayers:i,onlineGameOpponents:c,partyName:f,maxPlayers:A,onlineGameChat:j,isOnlineGameOwner:K,gameType:_,gameStatus:r,gameStatusLoading:P,myPlayerId:s,activePlayerId:d,score:v,finalScore:o,bonusScore:E,reroll:O,dices:m,isRolling:p,canRoll:he,canReroll:Se,hasOfValue:ge,hasThreeOfAKind:Ae,hasFourOfAKind:_e,hasFullHouse:Ie,hasSmallStraight:He,hasLargeStraight:Ne,hasYahtzee:Q,diceTotal:Re,personalBest:F,highscorePosition:D,$reset:Z,start:Le,roll:be,hasFinishedRolling:ee,getScore:Fe,getBonus:De,getActualValue:Ce,selectDice:Pe,selectScore:pe,setPreviousHighscores:q,updateYahtzeeHighscore:W,sortHighscores:Oe,fetchOnlineGames:ue,createOnlineGame:Te,continueOnlineGame:Ge,updateOnlineGame:z,leaveOnlineGame:ve,deleteOnlineGame:fe,getPlayerDisplayName:de,getNextPlayerId:X}},{persist:{enabled:!0}}),oe=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],b={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},dl=Xe({__name:"Dice",props:{dice:{}},setup(l){const T=rl(),{activePlayerId:S,myPlayerId:g}=$(T),{selectDice:F}=T,D={1:sl,2:al,3:tl,4:ll,5:el,6:nl};return(u,G)=>(ne(),qe("div",{class:ye(["cursor-pointer",{"animate-spin":u.dice.isRolling}])},[(ne(),Qe(Je(D[u.dice.value]),{color:"black",backgroundColor:u.dice.selected?B(S)===B(g)?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:G[0]||(G[0]=L=>B(F)(u.dice))},null,8,["backgroundColor"]))],2))}});export{il as B,ul as G,Y as S,dl as _,b as s,rl as u};
