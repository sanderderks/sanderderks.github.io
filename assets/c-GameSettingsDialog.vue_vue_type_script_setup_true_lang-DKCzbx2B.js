import{_ as ue,a as ie}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-JQE6dSwt.js";import{_ as j}from"./c-SelectField.vue_vue_type_script_setup_true_lang-Bu9S1e-e.js";import{d as te,aG as $,s as B,r as y,a as ne,c as m,o as F,aH as h,aK as z,aI as D,aL as ce,aM as J,aJ as re,e as ve,bQ as de,cx as fe,l as k,q as M,D as pe,n as ge,k as E,ab as W,t as K}from"../bundle.js";var me=(a=>(a[a.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",a[a.HAS_STARTED=1]="HAS_STARTED",a[a.HAS_THROWN_DICES=2]="HAS_THROWN_DICES",a[a.HAS_CHOSEN_DICES=3]="HAS_CHOSEN_DICES",a[a.HAS_CHOSEN_TILE=4]="HAS_CHOSEN_TILE",a[a.HAS_LOST=5]="HAS_LOST",a[a.HAS_FINISHED=6]="HAS_FINISHED",a))(me||{}),Se=(a=>(a[a.NONE=0]="NONE",a[a.HAS_LOST_TILE=1]="HAS_LOST_TILE",a[a.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",a))(Se||{}),Te=(a=>(a[a.NONE=0]="NONE",a[a.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",a[a.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",a[a.LOSER=3]="LOSER",a))(Te||{}),ye=(a=>(a[a.PLAYER=0]="PLAYER",a[a.ROBOT=1]="ROBOT",a))(ye||{});const he=a=>{for(let S=1;S<=6;S++)if(a.every(V=>V.value===S))return!0;return!1},Q=()=>({0:[],1:[]}),Ve=te("rainwormsStore",()=>{const a=$(),{personalBest:S,highscorePosition:V}=B(a),{setPreviousHighscores:_,updateHighscores:R,sortHighscores:A}=a,g=y(1),u=y(0),r=y(0),i=y(0),v=y(0),f=y(0),t=y(G()),n=y(X()),p=ne(Q()),I=m(()=>t.value.some(e=>e.isRolling)),P=m(()=>t.value.filter(e=>e.selected).some(e=>e.value===6)),H=m(()=>e=>t.value.some(s=>s.value===e&&s.selected)),ee=m(()=>e=>n.value.some(s=>s.displayValue<=e)),N=m(()=>e=>f.value===(e??0)),w=m(()=>e=>{const s=p[e??0];return s.length?s[s.length-1]:null}),d=m(()=>{let e=0;return t.value.filter(s=>s.selected).forEach(s=>{e+=s.value===6?5:s.value}),e}),b=m(()=>e=>{let s=0;return p[e].forEach(l=>{s+=l.value}),s});F(()=>{a.$init(h.RAINWORMS)});const le=()=>{u.value=0,r.value=0,i.value=0,v.value=0,f.value=0,t.value=G(),n.value=X(),Object.assign(p,Q()),_()},ae=()=>{u.value=1},T=e=>{if(!N.value(e))return;(u.value===1||u.value===4||u.value===5)&&t.value.forEach(l=>{l.selected=!1}),u.value=2;const s=a.diceRollSpeed*1e3;t.value.forEach(l=>{l.selected||(l.isRolling=!0,setTimeout(()=>{l.value=z(6),l.isRolling=!1,t.value.sort((o,c)=>o.value-c.value),!I.value&&u.value!==5&&Y()&&x(e)},z(s,s/3)))}),D(ce)},U=async()=>{for(;I.value;)await new Promise(e=>setTimeout(e,500));return!0},Y=()=>{const e=t.value.filter(s=>!s.selected&&!H.value(s.value));return!e.length||he(e)&&e.every(s=>s.value!==6)},x=e=>{u.value=5,r.value=e??0,p[r.value].length?v.value=1:v.value=2,q(),n.value.length===0?u.value=6:L()},q=()=>{const e=p[f.value];if(e.length){const s=e.splice(e.length-1,1)[0];n.value.push(s),n.value.sort((l,o)=>l.displayValue-o.displayValue)}n.value.splice(n.value.length-1,1)},C=(e,s)=>{N.value(s)&&!I.value&&u.value===2&&!e.selected&&!H.value(e.value)&&(u.value=3,t.value.filter(l=>l.value===e.value).forEach(l=>{l.selected=!0}),D(J))},O=(e,s,l)=>{if(N.value(l)&&(u.value===2||u.value===3)){if(u.value=4,r.value=l??0,s){const o=p[f.value===0?1:0];o.splice(o.length-1,1)}else n.value=n.value.filter(o=>o.displayValue!==e.displayValue);p[f.value].push(e),D(J),n.value.length===0?u.value=6:L()}},L=e=>{(f.value===1||u.value!==5||e)&&(f.value===0?setTimeout(()=>{f.value=1,setTimeout(()=>{u.value=1,r.value=0},1e3)},e?0:g.value*1e3*2):setTimeout(()=>{f.value=0},e?0:g.value*1e3*2))},se=async()=>{switch(u.value){case 1:{T(1);break}case 2:{await U(),setTimeout(()=>{const e=t.value.filter(l=>!l.selected),s=w.value(0);if(s&&d.value<s.displayValue)for(let l=6;l>=1;l--){const o=e.filter(c=>c.value===l&&!H.value(l));if(o.length){const c=o.length*(l===6?5:l);if(d.value+c===s.displayValue){C(o[0],1);return}}}for(let l=6;l>=1;l--){const o=t.value.find(c=>c.value===l);if(o&&!H.value(l)){C(o,1);return}}},g.value*1e3);break}case 3:{setTimeout(()=>{const e=w.value(0),s=t.value.filter(l=>!l.selected).length;if(!s||d.value>=30){console.log(s?"i am rich":"i can only pick a tile now");for(let l=d.value;l>=21;l--){const o=n.value.find(c=>c.displayValue===l);if(o){O(o,!1,1);return}}s&&T(1)}if(n.value.every(l=>l.displayValue>d.value)&&e&&e.displayValue>d.value)console.log("my score is too low"),T(1);else if(e&&e.displayValue===d.value)console.log("i can steal"),O(e,!0,1);else if(new Set(t.value.filter(l=>l.selected).map(l=>l.value)).size<=3)if(t.value.filter(l=>!l.selected).length<=2){console.log("there aren't that much dices left");const l=n.value.filter(o=>o.displayValue>=d.value-5&&o.displayValue<=d.value).sort((o,c)=>c.displayValue-o.displayValue);l.length?(console.log("i choose the highest score within 5 tiles"),O(l[0],!1,1)):(console.log("i choose to roll again"),T(1))}else console.log("i have nothing to worry about"),T(1);else if(!P.value)console.log("i am worrying and have no worm yet"),T(1);else{console.log("if i can choose, i choose");const l=n.value.filter(o=>o.displayValue<=d.value).sort((o,c)=>c.displayValue-o.displayValue);l.length?(console.log("i choose the highest score"),O(l[0],!1,1)):(console.log("i choose to roll again"),T(1))}},g.value*1e3);break}default:console.log("DEFAULT",u.value)}},oe=()=>{const e=b.value(0),s=b.value(1);e>s?i.value=1:e===s&&Math.max(...p[0].map(l=>l.displayValue))>Math.max(...p[1].map(l=>l.displayValue))?i.value=2:i.value=3,(i.value===1||i.value===2)&&(Z(),D(re))},Z=()=>{R({score:b.value(0)})};return{gameStatus:u,gameStatusActivator:r,finishStatus:i,loseStatus:v,activePlayer:f,dices:t,tiles:n,score:p,robotSpeed:g,isRolling:I,hasWorm:P,hasAlreadyChosen:H,canSelectAnyTile:ee,canPlay:N,visibleTile:w,selectedDiceTotal:d,totalScore:b,personalBest:S,highscorePosition:V,$reset:le,start:ae,roll:T,hasFinishedRolling:U,hasLostRound:Y,loseTurn:x,popLastTile:q,selectDice:C,selectTile:O,passTurn:L,playRobot:se,checkFinishStatus:oe,setPreviousHighscores:_,updateRainwormsHighscore:Z,sortHighscores:A}},{persist:{enabled:!0}}),G=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],X=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],He=ve({__name:"GameSettingsDialog",props:de({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(a){const S=a,V=fe(a,"isOpen"),_=$(),{useAudio:R,diceRollSpeed:A}=B($()),{robotSpeed:g}=B(Ve()),u=m(()=>{switch(S.gameId){case h.YAHTZEE:return"v5 (12-12-2024)";case h.RAINWORMS:return"v5 (12-12-2024)";case h.PATIENCE:return"v2 (16-12-2024)"}});return F(()=>{_.$init(S.gameId)}),(r,i)=>(k(),M(ie,{isOpen:V.value,title:"Game Settings",description:r.gameId?`Current version: ${u.value}`:"General settings",cancelText:"Close",onCancel:i[3]||(i[3]=v=>V.value=!1)},{default:pe(()=>[ge(ue,{name:"useAudio",label:"Audio",modelValue:E(R),"onUpdate:modelValue":i[0]||(i[0]=v=>W(R)?R.value=v:null)},null,8,["modelValue"]),r.gameId===E(h).YAHTZEE||r.gameId===E(h).RAINWORMS?(k(),M(j,{key:0,name:"diceSpeed",label:"Dice rolling speed",modelValue:E(A),"onUpdate:modelValue":i[1]||(i[1]=v=>W(A)?A.value=v:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):K("",!0),r.gameId===E(h).RAINWORMS?(k(),M(j,{key:1,name:"robotSpeed",label:"Rainworms robot speed",modelValue:E(g),"onUpdate:modelValue":i[2]||(i[2]=v=>W(g)?g.value=v:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):K("",!0)]),_:1},8,["isOpen","description"]))}});export{Te as F,me as G,Se as L,ye as P,He as _,Ve as u};
