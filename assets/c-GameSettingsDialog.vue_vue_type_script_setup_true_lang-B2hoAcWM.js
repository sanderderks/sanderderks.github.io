import{_ as Le}from"./c-Dialog.vue_vue_type_script_setup_true_lang-B1iNImaq.js";import{aU as ye,aV as he,s as ee,w as S,a9 as Ne,f as k,o as Oe,aS as V,L as Ee,aW as te,b7 as De,aX as Ve,b8 as Ae,aR as Me,c as we,aQ as K,b2 as Ue,b3 as Ge,b4 as We,d as $e,b5 as xe,b6 as Be,l as fe,j as pe,A as Fe,k as je,m as Se,h as Z,an as me,U as _e,T as Re}from"../bundle.js";var Ye=(l=>(l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(Ye||{});const Ie={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Ke=(l=>(l.STOCK_CLOSED="stock_closed",l.STOCK_OPEN="stock_open",l.PILE1="pile1",l.PILE2="pile2",l.PILE3="pile3",l.PILE4="pile4",l.PILE5="pile5",l.PILE6="pile6",l.PILE7="pile7",l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(Ke||{}),Ze=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.HAS_STARTED=1]="HAS_STARTED",l[l.HAS_FINISHED=2]="HAS_FINISHED",l))(Ze||{});const qe={easy:.5,hard:1},be=()=>{const l=Qe();return De(l),{pile1:l.splice(0,1).map(u=>({...u,deck:"pile1"})),pile2:l.splice(0,2).map((u,f)=>f<1?{...u,hidden:!0,deck:"pile2"}:{...u,deck:"pile2"}),pile3:l.splice(0,3).map((u,f)=>f<2?{...u,hidden:!0,deck:"pile3"}:{...u,deck:"pile3"}),pile4:l.splice(0,4).map((u,f)=>f<3?{...u,hidden:!0,deck:"pile4"}:{...u,deck:"pile4"}),pile5:l.splice(0,5).map((u,f)=>f<4?{...u,hidden:!0,deck:"pile5"}:{...u,deck:"pile5"}),pile6:l.splice(0,6).map((u,f)=>f<5?{...u,hidden:!0,deck:"pile6"}:{...u,deck:"pile6"}),pile7:l.splice(0,7).map((u,f)=>f<6?{...u,hidden:!0,deck:"pile7"}:{...u,deck:"pile7"}),stock_closed:l.map(u=>({...u,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},ze=ye("patienceStore",()=>{const l=he(),{personalBest:u,highscorePosition:f}=ee(l),{setPreviousHighscores:G,updateHighscores:W,sortHighscores:y}=l,M=S("hard"),C=S(0),w=S(0),I=S(0),E=S(0),O=S(0),oe=S(),ue=S(!0),v=Ne(be()),le=k(()=>qe[M.value]),q=k(()=>Object.keys(v).flatMap(s=>v[s])),$=1e3,L=10,d=10,z=k(()=>{const s=I.value%10===0?I.value:Math.floor(I.value/10)*10,t=w.value*L,a=O.value*L,n=s+t+a,m=E.value*d;return Math.max(0,$-(n-m))}),x=k(()=>{const s=Math.floor(I.value/60),t=I.value%60;return`${String(s).padStart(2,"0")}:${String(t).padStart(2,"0")}`}),se=k(()=>v.hearts.length===13&&v.spades.length===13&&v.diamonds.length===13&&v.clubs.length===13);Oe(()=>{l.$init(V.PATIENCE),I.value&&C.value===1&&N()}),Ee(se,s=>{s&&C.value!==2&&(Q(),C.value=2,ve(),te(Ve))});const r=()=>{Q(),w.value=0,I.value=0,E.value=0,O.value=0,C.value=0,Object.assign(v,be()),l.setPreviousHighscores()},h=()=>{I.value=0,N(),C.value=1,setTimeout(()=>{X()},500)},N=()=>{oe.value&&Q(),oe.value=setInterval(()=>{I.value++},1e3)},Q=()=>{clearInterval(oe.value)},p=()=>{const s=v.stock_open;s.length&&(s.reverse(),P(s[0],!1,t=>{t.deck="stock_closed",t.hidden=!0,v.stock_closed.push(t)}),s.splice(0,s.length),R(1))},A=s=>{const t=s.deck,a=q.value.filter(n=>n.selected);if(t==="stock_closed"){const n=v.stock_closed,m=n.indexOf(s);if(m===n.length-1){const U=M.value==="hard"?m-2:m,b=U<0?0:U,J=n.filter((Y,de)=>de>=b);ne(),ie(J,"stock_open",Y=>{Y.hidden=!1}),R(0)}}else if(t==="stock_open"){const n=v.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,a.length&&P(a[0],!1))}else if(a.length){const n=a[0];n===s?P(s,!1):ae(t)&&ce(n,s)?s.value===n.value+1&&s.deck!==n.deck&&(ie(a,t),n.deck==="stock_open"?R(2):R(4)):a.length===1&&re(t)&&ge(n,s)&&s.value===n.value-1&&(F(n,t),R(3),n.hasBeenHome=!0)}else P(s,!0)},g=s=>{const t=q.value.filter(a=>a.selected);if(t.length){const a=t[0],n=a.deck;a.value===13&&(ie(t,s),n==="stock_open"?R(2):ae(a.deck)&&v[a.deck].every(m=>!m.hidden)?R(5):R(4))}},B=s=>{const t=q.value.filter(a=>a.selected);if(t.length===1){const a=t[0],n=a.type;!v[s].length&&n===s&&a.value===1&&(F(a,s),R(3))}},P=(s,t,a)=>{const n=v[s.deck],m=n.indexOf(s);n.filter((b,J)=>J>=m).forEach(b=>{b.selected=t,a==null||a(b)})},ne=()=>{q.value.forEach(s=>{s.selected=!1})},F=(s,t)=>{const a=s.deck,n=v[a].indexOf(s);s.deck=t,s.selected=!1,v[t].push(s),v[a].splice(n,1),(ae(a)||a==="stock_open")&&_(a)},ie=(s,t,a)=>{const n=s[0],m=n.deck,U=v[m].indexOf(n);P(n,!1,b=>{b.deck=t,a==null||a(b),v[t].push(b)}),v[m].splice(U,s.length),re(m)||_(m!=="stock_closed"?m:t)},j=s=>{if(!ue.value)return!0;const t=v[s.type],a=t.length?t[t.length-1].value:0;if(s.value===a+1){const n=["hearts","spades","diamonds","clubs"],m=a<=1||n.every(U=>{const b=v[U];return(b.length?b[b.length-1].value:0)>=a});if(a===0||m)return F(s,s.type),s.hasBeenHome=!0,R(3),!0}return!1},X=()=>{if(ue.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const t=v[s];if(t.length&&j(t[t.length-1]))return}},_=s=>{const t=v[s];if(t.length){const a=t[t.length-1],n=a.deck;a.hidden=!1,setTimeout(()=>{a.deck===n&&(j(a)||X())},500)}else setTimeout(()=>{X()},500)},R=s=>{switch(s!==5&&w.value++,s){case 0:{O.value+=2*le.value;break}case 1:{O.value+=5*le.value;break}case 2:{E.value+=10*le.value;break}case 3:{E.value+=20*le.value;break}}te(Ae)},ce=(s,t)=>s.color!==t.color,ge=(s,t)=>s.type===t.type,ae=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),re=s=>["hearts","spades","diamonds","clubs"].includes(s),ve=()=>{W({difficulty:M.value,score:z.value,bonus:E.value,time:I.value,turns:w.value,penalty:O.value})};return{difficulty:M,gameStatus:C,score:z,turns:w,time:I,bonus:E,penalty:O,cards:v,doAutocomplete:ue,allCards:q,formattedTime:x,personalBest:u,highscorePosition:f,$reset:r,start:h,shuffle:p,selectCard:A,selectEmptyDeck:g,selectFinalDeck:B,deselectAllCards:ne,isPlayDeck:ae,isFinalDeck:re,setPreviousHighscores:G,updatePatienceHighscore:ve,sortHighscores:y}},{persist:{enabled:!0}}),Qe=()=>Object.keys(Ie).flatMap(l=>{const u=l,f=[];for(let G=0;G<13;G++){const W={type:u,label:Ie[u].label,color:Ie[u].color,value:G+1,hidden:!1,selected:!1,hasBeenHome:!1};f.push(W)}return f});var Xe=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.HAS_STARTED=2]="HAS_STARTED",l[l.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",l[l.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",l[l.HAS_LOST=6]="HAS_LOST",l[l.HAS_FINISHED=7]="HAS_FINISHED",l))(Xe||{}),Je=(l=>(l[l.NONE=0]="NONE",l[l.HAS_LOST_TILE=1]="HAS_LOST_TILE",l[l.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",l))(Je||{}),el=(l=>(l[l.NONE=0]="NONE",l[l.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",l[l.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",l[l.LOSER=3]="LOSER",l))(el||{});const ll=l=>{for(let u=1;u<=6;u++)if(l.every(f=>f.value===u))return!0;return!1},sl=ye("rainwormsStore",()=>{const l=he(),u=Me(),f=we(),{personalBest:G,highscorePosition:W}=ee(l),{firebaseUser:y}=ee(f),{games:M,gamesLoading:C,gameId:w,creatorId:I,players:E,opponents:O,chat:oe,isOwner:ue}=ee(u),{setPreviousHighscores:v,updateHighscores:le,sortHighscores:q}=l,$=S(1),L=S(K.SOLO),d=S(0),z=S(!1),x=S(0),se=S(0),r=S("soloPlayer"),h=S(r.value),N=S(r.value),Q=S(!1),p=S(He()),A=S(ke()),g=Ne({}),B=k(()=>{var e;return L.value===K.SOLO?"robot":((e=O.value[0])==null?void 0:e.userId)??r.value}),P=k(()=>p.value.some(e=>e.isRolling)),ne=k(()=>p.value.filter(e=>e.selected).some(e=>e.value===6)),F=k(()=>e=>p.value.some(o=>o.value===e&&o.selected)),ie=k(()=>A.value.some(e=>e.displayValue<=_.value)),j=k(()=>(e=r.value)=>h.value===e),X=k(()=>(e=r.value)=>{const o=g[e];return o.length?o[o.length-1]:null}),_=k(()=>{let e=0;return p.value.filter(o=>o.selected).forEach(o=>{e+=o.value===6?5:o.value}),e}),R=k(()=>e=>{let o=0;return g[e].forEach(c=>{o+=c.value}),o});Oe(()=>{l.$init(V.RAINWORMS),P.value&&p.value.forEach(e=>{e.isRolling=!1})}),Ee(d,e=>{e===7?Pe():L.value===K.SOLO&&(Q.value||h.value==="robot")&&Ce(h.value)}),Ee([d,h,P],()=>{L.value===K.MULTIPLAYER&&t()},{deep:!0});const ce=()=>{u.$reset(),L.value=K.SOLO,d.value=0,x.value=0,se.value=0,r.value="soloPlayer",h.value=r.value,N.value=r.value,p.value=He(),A.value=ke(),Object.keys(g).forEach(e=>{delete g[e]}),v()},ge=()=>{L.value=K.SOLO,d.value=2,g[r.value]=[],g[B.value]=[]},ae=e=>{y.value&&(e=[{userId:y.value.uid,isOnline:!0},...e],L.value=K.MULTIPLAYER,d.value=2,r.value=y.value.uid,h.value=r.value,N.value=r.value,e.forEach(o=>{g[o.userId]=[]}),u.$init(V.RAINWORMS,ve,s,ce),u.createGame(e))},re=e=>{y.value&&(L.value=K.MULTIPLAYER,r.value=y.value.uid,u.$init(V.RAINWORMS,ve,s,ce),u.continueGame(e))},ve=()=>({gameStatus:d.value,gameStatusActivator:N.value,activePlayer:h.value,dices:p.value,tiles:A.value,score:g}),s=e=>{var c;const o=(c=y.value)==null?void 0:c.uid;!o||h.value===r.value||(d.value=e.gameStatus,N.value=e.gameStatusActivator,h.value=e.activePlayer,p.value=e.dices,A.value=e.tiles,Object.assign(g,e.score),Object.keys(g).includes(o)||(g[o]=[]))},t=()=>{!y.value||h.value!==r.value&&!z.value||u.pushState()},a=(e=r.value)=>{if(!j.value(e))return;(d.value===2||d.value===5||d.value===6)&&p.value.forEach(c=>{c.selected=!1}),d.value=3;const o=l.diceRollSpeed*1e3;p.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=Ue(6),c.isRolling=!1,p.value.sort((H,i)=>H.value-i.value),!P.value&&d.value!==6&&m()&&U(e)},Ge(o,o/3)))}),te(We)},n=async()=>{for(;P.value;)await new Promise(e=>setTimeout(e,l.diceRollSpeed*1e3));return!0},m=()=>{const e=p.value.filter(o=>!o.selected&&!F.value(o.value));return!e.length||ll(e)&&e.every(o=>o.value!==6)&&p.value.filter(o=>o.selected).every(o=>o.value!==6)},U=(e=r.value)=>{d.value=6,N.value=e,g[N.value].length?se.value=1:se.value=2,b(),A.value.length===0?d.value=7:de()},b=()=>{const e=g[h.value];if(e.length){const o=e.splice(e.length-1,1)[0];A.value.push(o),A.value.sort((c,H)=>c.displayValue-H.displayValue)}A.value.splice(A.value.length-1,1)},J=(e,o=r.value)=>{j.value(o)&&!P.value&&d.value===3&&!e.selected&&!F.value(e.value)&&(d.value=4,p.value.filter(c=>c.value===e.value).forEach(c=>{c.selected=!0}),te(Ae))},Y=(e,o,c=r.value)=>{if(j.value(c)&&(d.value===3||d.value===4)){if(o){const H=g[B.value];H.splice(H.length-1,1)}else A.value=A.value.filter(H=>H.displayValue!==e.displayValue);g[h.value].push(e),A.value.length===0?d.value=7:(d.value=5,N.value=c,de()),te(Ae)}},de=e=>{(Q.value||h.value!==r.value||d.value!==6||e)&&(h.value===r.value?setTimeout(()=>{z.value=!0,h.value=B.value,setTimeout(()=>{d.value=2,N.value=r.value,z.value=!1},$.value*1e3)},e?0:$.value*1e3*2):setTimeout(()=>{const o=h.value;h.value=r.value,setTimeout(()=>{d.value=2,N.value=o},$.value*1e3)},e?0:$.value*1e3*2))},Ce=async e=>{if(await new Promise(c=>setTimeout(c,5)),!j.value(e))return;const o=e===r.value?B.value:r.value;switch(d.value){case 2:{a(e);break}case 3:{await n(),setTimeout(()=>{const c=p.value.filter(i=>!i.selected),H=X.value(o);if(H&&_.value<H.displayValue)for(let i=6;i>=1;i--){const T=c.filter(D=>D.value===i&&!F.value(i));if(T.length){const D=T.length*(i===6?5:i);if(_.value+D===H.displayValue){J(T[0],e);return}}}for(let i=6;i>=1;i--){const T=p.value.find(D=>D.value===i);if(T&&!F.value(i)){J(T,e);return}}},$.value*1e3);break}case 4:{setTimeout(()=>{const c=X.value(o),H=p.value.filter(i=>!i.selected).length;if(!H||_.value>=30){H?console.log(e,"i am rich"):console.log(e,"i can only pick a tile now");for(let i=_.value;i>=21;i--){const T=A.value.find(D=>D.displayValue===i);if(T){Y(T,!1,e);return}}H&&a(e)}if(A.value.every(i=>i.displayValue>_.value)&&c&&c.displayValue>_.value)console.log(e,"my score is too low"),a(e);else if(c&&c.displayValue===_.value)console.log(e,"i can steal"),Y(c,!0,e);else if(new Set(p.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(p.value.filter(i=>!i.selected).length<=2){console.log(e,"there aren't that much dices left");const i=A.value.filter(T=>T.displayValue>=_.value-5&&T.displayValue<=_.value).sort((T,D)=>D.displayValue-T.displayValue);i.length?(console.log(e,"i choose the highest score within 5 tiles"),Y(i[0],!1,e)):(console.log(e,"i choose to roll again"),a(e))}else console.log(e,"i have nothing to worry about"),a(e);else if(!ne.value)console.log(e,"i am worrying and have no worm yet"),a(e);else{console.log(e,"if i can choose, i choose");const i=A.value.filter(T=>T.displayValue<=_.value).sort((T,D)=>D.displayValue-T.displayValue);i.length?(console.log(e,"i choose the highest score"),Y(i[0],!1,e)):(console.log(e,"i choose to roll again"),a(e))}},$.value*1e3);break}default:console.log(e,"DEFAULT",d.value)}},Pe=()=>{const e=R.value(r.value),o=R.value(B.value);e>o?x.value=1:e===o&&Math.max(...g[r.value].map(c=>c.displayValue))>Math.max(...g[B.value].map(c=>c.displayValue))?x.value=2:x.value=3,(x.value===1||x.value===2)&&(Te(),te(Ve))},Te=()=>{le({gameId:w.value??null,score:R.value(r.value)})};return{gameType:L,gameStatus:d,gameStatusLoading:z,myPlayerId:r,opponentId:B,gameStatusActivatorId:N,finishStatus:x,loseStatus:se,activePlayerId:h,isFullyAutomatic:Q,dices:p,tiles:A,score:g,robotSpeed:$,isRolling:P,hasWorm:ne,hasAlreadyChosen:F,canSelectAnyTile:ie,canPlay:j,visibleTile:X,selectedDiceTotal:_,totalScore:R,personalBest:G,highscorePosition:W,onlineGames:M,onlineGamesLoading:C,onlineGameId:w,onlineGameCreatorId:I,onlineGamePlayers:E,onlineGameOpponents:O,onlineGameChat:oe,isOnlineGameOwner:ue,$reset:ce,start:ge,roll:a,hasFinishedRolling:n,hasLostRound:m,loseTurn:U,popLastTile:b,selectDice:J,selectTile:Y,passTurn:de,setPreviousHighscores:v,updateRainwormsHighscore:Te,sortHighscores:q,fetchOnlineGames:u.fetchGames,createOnlineGame:ae,continueOnlineGame:re,leaveOnlineGame:u.leaveGame,deleteOnlineGame:u.deleteGame}},{persist:{enabled:!0}}),He=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],ke=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],ol=$e({__name:"GameSettingsDialog",props:xe({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(l){const u=l,f=Be(l,"isOpen"),G=he(),{useAudio:W,diceRollSpeed:y}=ee(he()),{robotSpeed:M}=ee(sl()),{doAutocomplete:C}=ee(ze()),w=k(()=>{switch(u.gameId){case V.YAHTZEE:return"v5 (12-12-2024)";case V.RAINWORMS:return"v5 (12-12-2024)";case V.PATIENCE:return"v2 (16-12-2024)";case V.GUESS_THE_WORD:return"v2 (10-01-2025)";case V.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Oe(()=>{G.$init(u.gameId)}),(I,E)=>(pe(),fe(Le,{isOpen:f.value,title:"Game Settings",description:I.gameId?`Current version: ${w.value}`:"General settings",cancelText:"Close",onCancel:E[4]||(E[4]=O=>f.value=!1)},{default:Fe(()=>[je(_e,{name:"useAudio",label:"Audio",modelValue:Z(W),"onUpdate:modelValue":E[0]||(E[0]=O=>me(W)?W.value=O:null)},null,8,["modelValue"]),I.gameId===Z(V).PATIENCE?(pe(),fe(_e,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:Z(C),"onUpdate:modelValue":E[1]||(E[1]=O=>me(C)?C.value=O:null)},null,8,["modelValue"])):Se("",!0),I.gameId===Z(V).YAHTZEE||I.gameId===Z(V).RAINWORMS?(pe(),fe(Re,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:Z(y),"onUpdate:modelValue":E[2]||(E[2]=O=>me(y)?y.value=O:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),I.gameId===Z(V).RAINWORMS?(pe(),fe(Re,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:Z(M),"onUpdate:modelValue":E[3]||(E[3]=O=>me(M)?M.value=O:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)]),_:1},8,["isOpen","description"]))}});export{Ye as C,Ke as D,el as F,Xe as G,Je as L,ol as _,ze as a,Ze as b,sl as u};
