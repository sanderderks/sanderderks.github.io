import{_ as _e,a as Le}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-R6e5xvIM.js";import{_ as Te}from"./c-SelectField.vue_vue_type_script_setup_true_lang-DIKuGEia.js";import{d as Ce,aO as he,s as se,r as m,a as Pe,c as b,o as Oe,aP as M,M as Ie,aQ as le,cV as we,aR as De,aU as Ae,cW as Me,h as xe,cX as We,cY as Ne,al as $e,L as K,ai as ve,cZ as Be,c_ as Ue,c$ as Fe,d0 as Ge,aS as Re,aT as Ye,e as je,bX as Ze,cD as qe,l as de,q as fe,D as Ke,n as Xe,k as j,ad as pe,t as Se}from"../bundle.js";var ze=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(ze||{});const Ee={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Qe=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Qe||{}),Je=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(Je||{});const el={easy:.5,hard:1},He=()=>{const e=sl();return we(e),{pile1:e.splice(0,1).map(c=>({...c,deck:"pile1"})),pile2:e.splice(0,2).map((c,f)=>f<1?{...c,hidden:!0,deck:"pile2"}:{...c,deck:"pile2"}),pile3:e.splice(0,3).map((c,f)=>f<2?{...c,hidden:!0,deck:"pile3"}:{...c,deck:"pile3"}),pile4:e.splice(0,4).map((c,f)=>f<3?{...c,hidden:!0,deck:"pile4"}:{...c,deck:"pile4"}),pile5:e.splice(0,5).map((c,f)=>f<4?{...c,hidden:!0,deck:"pile5"}:{...c,deck:"pile5"}),pile6:e.splice(0,6).map((c,f)=>f<5?{...c,hidden:!0,deck:"pile6"}:{...c,deck:"pile6"}),pile7:e.splice(0,7).map((c,f)=>f<6?{...c,hidden:!0,deck:"pile7"}:{...c,deck:"pile7"}),stock_closed:e.map(c=>({...c,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},ll=Ce("patienceStore",()=>{const e=he(),{personalBest:c,highscorePosition:f}=se(e),{setPreviousHighscores:$,updateHighscores:B,sortHighscores:N}=e,D=m("hard"),P=m(0),U=m(0),d=m(0),p=m(0),I=m(0),Z=m(),T=m(!0),i=Pe(He()),R=b(()=>el[D.value]),H=b(()=>Object.keys(i).flatMap(s=>i[s])),F=1e3,v=10,L=10,x=b(()=>{const s=d.value%10===0?d.value:Math.floor(d.value/10)*10,o=U.value*v,u=I.value*v,n=s+o+u,g=p.value*L;return Math.max(0,F-(n-g))}),X=b(()=>{const s=Math.floor(d.value/60),o=d.value%60;return`${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`}),A=b(()=>i.hearts.length===13&&i.spades.length===13&&i.diamonds.length===13&&i.clubs.length===13);Oe(()=>{e.$init(M.PATIENCE),d.value&&P.value===1&&S()}),Ie(A,s=>{s&&P.value!==2&&(W(),P.value=2,w(),le(De))});const h=()=>{W(),U.value=0,d.value=0,p.value=0,I.value=0,P.value=0,Object.assign(i,He()),e.setPreviousHighscores()},E=()=>{d.value=0,S(),P.value=1,setTimeout(()=>{ae()},500)},S=()=>{Z.value&&W(),Z.value=setInterval(()=>{d.value++},1e3)},W=()=>{clearInterval(Z.value)},ne=()=>{const s=i.stock_open;s.length&&(s.reverse(),G(s[0],!1,o=>{o.deck="stock_closed",o.hidden=!0,i.stock_closed.push(o)}),s.splice(0,s.length),V(1))},q=s=>{const o=s.deck,u=H.value.filter(n=>n.selected);if(o==="stock_closed"){const n=i.stock_closed,g=n.indexOf(s);if(g===n.length-1){const C=D.value==="hard"?g-2:g,O=C<0?0:C,ue=n.filter((ie,re)=>re>=O);k(),Q(ue,"stock_open",ie=>{ie.hidden=!1}),V(0)}}else if(o==="stock_open"){const n=i.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,u.length&&G(u[0],!1))}else if(u.length){const n=u[0];n===s?G(s,!1):J(o)&&ge(n,s)?s.value===n.value+1&&s.deck!==n.deck&&(Q(u,o),n.deck==="stock_open"?V(2):V(4)):u.length===1&&ee(o)&&oe(n,s)&&s.value===n.value-1&&(Y(n,o),V(3),n.hasBeenHome=!0)}else G(s,!0)},me=s=>{const o=H.value.filter(u=>u.selected);if(o.length){const u=o[0],n=u.deck;u.value===13&&(Q(o,s),n==="stock_open"?V(2):J(u.deck)&&i[u.deck].every(g=>!g.hidden)?V(5):V(4))}},z=s=>{const o=H.value.filter(u=>u.selected);if(o.length===1){const u=o[0],n=u.type;!i[s].length&&n===s&&u.value===1&&(Y(u,s),V(3))}},G=(s,o,u)=>{const n=i[s.deck],g=n.indexOf(s);n.filter((O,ue)=>ue>=g).forEach(O=>{O.selected=o,u==null||u(O)})},k=()=>{H.value.forEach(s=>{s.selected=!1})},Y=(s,o)=>{const u=s.deck,n=i[u].indexOf(s);s.deck=o,s.selected=!1,i[o].push(s),i[u].splice(n,1),(J(u)||u==="stock_open")&&te(u)},Q=(s,o,u)=>{const n=s[0],g=n.deck,C=i[g].indexOf(n);G(n,!1,O=>{O.deck=o,u==null||u(O),i[o].push(O)}),i[g].splice(C,s.length),ee(g)||te(g!=="stock_closed"?g:o)},ce=s=>{if(!T.value)return!0;const o=i[s.type],u=o.length?o[o.length-1].value:0;if(s.value===u+1){const n=["hearts","spades","diamonds","clubs"],g=u<=1||n.every(C=>{const O=i[C];return(O.length?O[O.length-1].value:0)>=u});if(u===0||g)return Y(s,s.type),s.hasBeenHome=!0,V(3),!0}return!1},ae=()=>{if(T.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const o=i[s];if(o.length&&ce(o[o.length-1]))return}},te=s=>{const o=i[s];if(o.length){const u=o[o.length-1],n=u.deck;u.hidden=!1,setTimeout(()=>{u.deck===n&&(ce(u)||ae())},500)}else setTimeout(()=>{ae()},500)},V=s=>{switch(s!==5&&U.value++,s){case 0:{I.value+=2*R.value;break}case 1:{I.value+=5*R.value;break}case 2:{p.value+=10*R.value;break}case 3:{p.value+=20*R.value;break}}le(Ae)},ge=(s,o)=>s.color!==o.color,oe=(s,o)=>s.type===o.type,J=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),ee=s=>["hearts","spades","diamonds","clubs"].includes(s),w=()=>{B({difficulty:D.value,score:x.value,bonus:p.value,time:d.value,turns:U.value,penalty:I.value})};return{difficulty:D,gameStatus:P,score:x,turns:U,time:d,bonus:p,penalty:I,cards:i,doAutocomplete:T,allCards:H,formattedTime:X,personalBest:c,highscorePosition:f,$reset:h,start:E,shuffle:ne,selectCard:q,selectEmptyDeck:me,selectFinalDeck:z,deselectAllCards:k,isPlayDeck:J,isFinalDeck:ee,setPreviousHighscores:$,updatePatienceHighscore:w,sortHighscores:N}},{persist:{enabled:!0}}),sl=()=>Object.keys(Ee).flatMap(e=>{const c=e,f=[];for(let $=0;$<13;$++){const B={type:c,label:Ee[c].label,color:Ee[c].color,value:$+1,hidden:!1,selected:!1,hasBeenHome:!1};f.push(B)}return f});var al=(e=>(e[e.SOLO=0]="SOLO",e[e.ONLINE=1]="ONLINE",e))(al||{}),tl=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.HAS_STARTED=2]="HAS_STARTED",e[e.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",e[e.HAS_LOST=6]="HAS_LOST",e[e.HAS_FINISHED=7]="HAS_FINISHED",e))(tl||{}),ol=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(ol||{}),ul=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.LOSER=3]="LOSER",e))(ul||{}),nl=(e=>(e[e.PLAYER=0]="PLAYER",e[e.OPPONENT=1]="OPPONENT",e))(nl||{});const cl=e=>{for(let c=1;c<=6;c++)if(e.every(f=>f.value===c))return!0;return!1},ke=()=>({0:[],1:[]}),il=Ce("rainwormsStore",()=>{const e=Me(),c=he(),f=xe(),{personalBest:$,highscorePosition:B}=se(c),{firebaseUser:N}=se(f),{setPreviousHighscores:D,updateHighscores:P,sortHighscores:U}=c,d={onlineGames:We(e,Ne.GAME_DATA,M.RAINWORMS,Ne.ONLINE_GAMES)},p=m(1),I=m([]),Z=m(!1),T=m(null),i=m(null),R=m(null),H=m(null),F=m(0),v=m(0),L=m(0),x=m(0),X=m(0),A=m(0),h=m(be()),E=m(Ve()),S=Pe(ke()),W=b(()=>h.value.some(l=>l.isRolling)),ne=b(()=>h.value.filter(l=>l.selected).some(l=>l.value===6)),q=b(()=>l=>h.value.some(t=>t.value===l&&t.selected)),me=b(()=>l=>E.value.some(t=>t.displayValue<=l)),z=b(()=>l=>A.value===(l??0)),G=b(()=>l=>{const t=S[l??0];return t.length?t[t.length-1]:null}),k=b(()=>{let l=0;return h.value.filter(t=>t.selected).forEach(t=>{l+=t.value===6?5:t.value}),l}),Y=b(()=>l=>{let t=0;return S[l].forEach(a=>{t+=a.value}),t});Oe(()=>{c.$init(M.RAINWORMS),T.value&&oe(),W.value&&h.value.forEach(l=>{l.isRolling=!1})}),Ie([v,A,W],()=>{F.value===1&&J()},{deep:!0}),Ie(v,l=>{l===7?ie():F.value!==1&&A.value===1&&ue()});const Q=()=>{ee(),T.value=null,H.value=null,i.value=null,v.value=0,L.value=0,x.value=0,X.value=0,A.value=0,h.value=be(),E.value=Ve(),Object.assign(S,ke()),D()},ce=()=>{F.value=0,v.value=2},ae=async l=>{if(!N.value)return;i.value=N.value.uid,H.value=l,F.value=1,v.value=2;const t=N.value.uid;await V(t,l)},te=async()=>{try{Z.value=!0,I.value=await Ue(d.onlineGames)}catch(l){K.firebaseError(!0,l)}finally{Z.value=!1}},V=async(l,t)=>{try{const a=ve(d.onlineGames);await Fe(a,{userId:l,opponentId:t,gameStatus:v.value,gameStatusActivator:L.value===0?l:t,activePlayer:A.value===0?l:t,dices:h.value,tiles:E.value,score:{[l]:S[0],[t]:S[1]}}),T.value=a.id,oe(!0),K.success("The game has been created")}catch(a){K.firebaseError(!0,a)}},ge=l=>{T.value=l,F.value=1,oe(),K.success("You joined the game")},oe=(l=!1)=>{var r;if(!T.value||!N.value)return;const t=N.value.uid;let a=!0;(r=R.value)==null||r.call(R),R.value=$e(ve(d.onlineGames,T.value),_=>{if(!(l||A.value===0&&!a))if(a=!1,_.exists()){const y=_.data(),ye=y.userId===t;i.value=y.userId,H.value=ye?y.opponentId:y.userId,v.value=y.gameStatus,L.value=y.gameStatusActivator===t?0:1,A.value=y.activePlayer===t?0:1,h.value=y.dices,E.value=y.tiles,ye?(S[0]=y.score[y.userId],S[1]=y.score[y.opponentId]):(S[0]=y.score[y.opponentId],S[1]=y.score[y.userId])}else Q(),K.update("The game has been stopped by the creator")})},J=async()=>{try{if(!T.value||!N.value||!H.value)return;const l=N.value.uid;await Be(ve(d.onlineGames,T.value),{gameStatus:v.value,gameStatusActivator:L.value===0?l:H.value,activePlayer:A.value===0?l:H.value,dices:h.value,tiles:E.value,score:{[l]:S[0],[H.value]:S[1]}})}catch(l){K.firebaseError(!0,l)}},ee=async()=>{var l,t;try{if(!T.value)return;(l=R.value)==null||l.call(R),R.value=null,F.value===1&&((t=N.value)==null?void 0:t.uid)===i.value&&await Ge(ve(d.onlineGames,T.value))}catch(a){K.firebaseError(!0,a)}},w=l=>{if(!z.value(l))return;(v.value===2||v.value===5||v.value===6)&&h.value.forEach(a=>{a.selected=!1}),v.value=3;const t=c.diceRollSpeed*1e3;h.value.forEach(a=>{a.selected||(a.isRolling=!0,setTimeout(()=>{a.value=Re(6),a.isRolling=!1,h.value.sort((r,_)=>r.value-_.value),!W.value&&v.value!==6&&o()&&u(l)},Re(t,t/3)))}),le(Ye)},s=async()=>{for(;W.value;)await new Promise(l=>setTimeout(l,500));return!0},o=()=>{const l=h.value.filter(t=>!t.selected&&!q.value(t.value));return!l.length||cl(l)&&l.every(t=>t.value!==6)&&h.value.filter(t=>t.selected).every(t=>t.value!==6)},u=l=>{v.value=6,L.value=l??0,S[L.value].length?X.value=1:X.value=2,n(),E.value.length===0?v.value=7:O()},n=()=>{const l=S[A.value];if(l.length){const t=l.splice(l.length-1,1)[0];E.value.push(t),E.value.sort((a,r)=>a.displayValue-r.displayValue)}E.value.splice(E.value.length-1,1)},g=(l,t)=>{z.value(t)&&!W.value&&v.value===3&&!l.selected&&!q.value(l.value)&&(v.value=4,h.value.filter(a=>a.value===l.value).forEach(a=>{a.selected=!0}),le(Ae))},C=(l,t,a)=>{if(z.value(a)&&(v.value===3||v.value===4)){if(t){const r=S[A.value===0?1:0];r.splice(r.length-1,1)}else E.value=E.value.filter(r=>r.displayValue!==l.displayValue);S[A.value].push(l),le(Ae),E.value.length===0?v.value=7:(v.value=5,L.value=a??0,O())}},O=l=>{(A.value===1||v.value!==6||l)&&(A.value===0?setTimeout(()=>{A.value=1,setTimeout(()=>{v.value=2,L.value=0},1e3)},l?0:p.value*1e3*2):setTimeout(()=>{A.value=0},l?0:p.value*1e3*2))},ue=async()=>{switch(v.value){case 2:{w(1);break}case 3:{await s(),setTimeout(()=>{const l=h.value.filter(a=>!a.selected),t=G.value(0);if(t&&k.value<t.displayValue)for(let a=6;a>=1;a--){const r=l.filter(_=>_.value===a&&!q.value(a));if(r.length){const _=r.length*(a===6?5:a);if(k.value+_===t.displayValue){g(r[0],1);return}}}for(let a=6;a>=1;a--){const r=h.value.find(_=>_.value===a);if(r&&!q.value(a)){g(r,1);return}}},p.value*1e3);break}case 4:{setTimeout(()=>{const l=G.value(0),t=h.value.filter(a=>!a.selected).length;if(!t||k.value>=30){console.log(t?"i am rich":"i can only pick a tile now");for(let a=k.value;a>=21;a--){const r=E.value.find(_=>_.displayValue===a);if(r){C(r,!1,1);return}}t&&w(1)}if(E.value.every(a=>a.displayValue>k.value)&&l&&l.displayValue>k.value)console.log("my score is too low"),w(1);else if(l&&l.displayValue===k.value)console.log("i can steal"),C(l,!0,1);else if(new Set(h.value.filter(a=>a.selected).map(a=>a.value)).size<=3)if(h.value.filter(a=>!a.selected).length<=2){console.log("there aren't that much dices left");const a=E.value.filter(r=>r.displayValue>=k.value-5&&r.displayValue<=k.value).sort((r,_)=>_.displayValue-r.displayValue);a.length?(console.log("i choose the highest score within 5 tiles"),C(a[0],!1,1)):(console.log("i choose to roll again"),w(1))}else console.log("i have nothing to worry about"),w(1);else if(!ne.value)console.log("i am worrying and have no worm yet"),w(1);else{console.log("if i can choose, i choose");const a=E.value.filter(r=>r.displayValue<=k.value).sort((r,_)=>_.displayValue-r.displayValue);a.length?(console.log("i choose the highest score"),C(a[0],!1,1)):(console.log("i choose to roll again"),w(1))}},p.value*1e3);break}default:console.log("DEFAULT",v.value)}},ie=()=>{const l=Y.value(0),t=Y.value(1);l>t?x.value=1:l===t&&Math.max(...S[0].map(a=>a.displayValue))>Math.max(...S[1].map(a=>a.displayValue))?x.value=2:x.value=3,(x.value===1||x.value===2)&&(re(),le(De)),ee()},re=()=>{P({score:Y.value(0)})};return{collections:d,onlineGames:I,onlineGamesLoading:Z,onlineGameId:T,onlineGameCreatorId:i,unsubscribeOnlineGame:R,opponentId:H,gameType:F,gameStatus:v,gameStatusActivator:L,finishStatus:x,loseStatus:X,activePlayer:A,dices:h,tiles:E,score:S,robotSpeed:p,isRolling:W,hasWorm:ne,hasAlreadyChosen:q,canSelectAnyTile:me,canPlay:z,visibleTile:G,selectedDiceTotal:k,totalScore:Y,personalBest:$,highscorePosition:B,$reset:Q,start:ce,startOnline:ae,continueOnlineGame:ge,fetchOnlineGames:te,roll:w,hasFinishedRolling:s,hasLostRound:o,loseTurn:u,popLastTile:n,selectDice:g,selectTile:C,passTurn:O,setPreviousHighscores:D,updateRainwormsHighscore:re,sortHighscores:U}},{persist:{enabled:!0}}),be=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],Ve=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],fl=je({__name:"GameSettingsDialog",props:Ze({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const c=e,f=qe(e,"isOpen"),$=he(),{useAudio:B,diceRollSpeed:N}=se(he()),{robotSpeed:D}=se(il()),{doAutocomplete:P}=se(ll()),U=b(()=>{switch(c.gameId){case M.YAHTZEE:return"v5 (12-12-2024)";case M.RAINWORMS:return"v5 (12-12-2024)";case M.PATIENCE:return"v2 (16-12-2024)";case M.GUESS_THE_WORD:return"v2 (10-01-2025)"}});return Oe(()=>{$.$init(c.gameId)}),(d,p)=>(de(),fe(Le,{isOpen:f.value,title:"Game Settings",description:d.gameId?`Current version: ${U.value}`:"General settings",cancelText:"Close",onCancel:p[4]||(p[4]=I=>f.value=!1)},{default:Ke(()=>[Xe(_e,{name:"useAudio",label:"Audio",modelValue:j(B),"onUpdate:modelValue":p[0]||(p[0]=I=>pe(B)?B.value=I:null)},null,8,["modelValue"]),d.gameId===j(M).PATIENCE?(de(),fe(_e,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:j(P),"onUpdate:modelValue":p[1]||(p[1]=I=>pe(P)?P.value=I:null)},null,8,["modelValue"])):Se("",!0),d.gameId===j(M).YAHTZEE||d.gameId===j(M).RAINWORMS?(de(),fe(Te,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:j(N),"onUpdate:modelValue":p[2]||(p[2]=I=>pe(N)?N.value=I:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),d.gameId===j(M).RAINWORMS?(de(),fe(Te,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:j(D),"onUpdate:modelValue":p[3]||(p[3]=I=>pe(D)?D.value=I:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)]),_:1},8,["isOpen","description"]))}});export{ze as C,Qe as D,ul as F,tl as G,ol as L,nl as P,fl as _,al as a,ll as b,Je as c,il as u};
