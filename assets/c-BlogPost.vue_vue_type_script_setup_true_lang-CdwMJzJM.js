import{i as q,s as U,r as A,o as J,a3 as ie,ai as re,aj as X,ak as Y,al as O,am as oe,h as F,e as L,g as ne,c as D,l as a,q as m,an as se,D as B,p as S,k as g,t as c,E as C,R as N,C as Q,a as ue,m as d,n as E,J as ce,w as R,O as j,ao as de,ap as pe,ac as me,aq as ge,B as ve,ar as fe,x as be,z as W,y as M,as as Z,H,ae as ye,T as he,f as ke,A as we,G as _,X as $e,K as Ce,L as Te}from"../bundle.js";import{_ as V}from"./c-Bubble.vue_vue_type_script_setup_true_lang-C0Ws0B4Z.js";import{_ as G}from"./c-CustomButton.vue_vue_type_script_setup_true_lang-DBbKX02O.js";import{_ as K}from"./c-Countdown.vue_vue_type_script_setup_true_lang-DSMslq4c.js";import{_ as Se}from"./c-TextField.vue_vue_type_script_setup_true_lang-BcDK9ofr.js";import{R as Pe}from"./c-validation-DokkLKHB.js";import{a as Be,s as Ie}from"./c-accordiontab.esm-fhxUpLlW.js";import{_ as De}from"./c-Image.vue_vue_type_script_setup_true_lang-iF2dFUUq.js";const Re=o=>{const t=q(),{collections:s,fetchBlogPost:v,checkBlogPostForUnreadReactions:l}=t,{blogPosts:y,blogReactions:k,isBlogPostDatabaseActionActive:b}=U(t);let $=[];const P=A(),i=u=>{u.metadata.hasPendingWrites||b.value||(clearTimeout(P.value),P.value=setTimeout(async()=>{await v(o.id,void 0,{loadingIndicator:!1}),l(y.value.previousData.single,!0)},200))};J(async()=>{k.value.unread=k.value.unread.filter(w=>w.postId!==o.id);const u=ie(o),r=s.blogPosts(u.isPrivate),h=s.blogReactions(u.isPrivate),T=re(r,o.id),I=X(r,Y("id","==",o.id)),e=X(h,Y("post","==",T));$.push(O(I,i)),$.push(O(e,i))}),oe(()=>{clearTimeout(P.value),$.forEach(u=>{u()})})},it=()=>{const o=q(),t=F(),{visibleBlogPosts:s,blogReactions:v,isBlogPostDatabaseActionActive:l}=U(o),{firebaseUser:y,isLoggedIn:k}=U(t),{collections:b,fetchBlogPosts:$,checkBlogPostsForUnreadReactions:P}=o;let i=[];const u=A(),r=h=>{h.metadata.hasPendingWrites||l.value||(clearTimeout(u.value),u.value=setTimeout(async()=>{var T;s.value.length&&(await $((T=y.value)==null?void 0:T.uid,{amount:s.value.length,loadingIndicator:!1}),P())},200))};J(()=>{v.value.unread=[],i.push(O(b.blogPosts(!1),r)),i.push(O(b.blogReactions(!1),r)),k.value&&(i.push(O(b.blogPosts(!0),r)),i.push(O(b.blogReactions(!0),r)))}),oe(()=>{clearTimeout(u.value),i.forEach(h=>{h()})})},Ue={class:"flex flex-col gap-2"},x=L({__name:"BlogReaction",props:{post:{},reaction:{}},setup(o){const t=o,s=ne(),v=F(),l=q(),{routeLoading:y,routeLoadingId:k}=U(s),{firebaseUser:b,isLoggedIn:$,isOwner:P}=U(v),{blogReactions:i}=U(l),{deleteBlogReaction:u}=l,r=D(()=>b.value&&t.reaction.user.id===b.value.uid||P.value);return(h,T)=>(a(),m(V,{id:t.reaction.id,class:C(["p-5 w-full md:w-3/4 xl:w-2/3",t.post.colorTertiary,t.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":g(y)===g(N).USER_DETAILS&&g(k)===t.reaction.user.id}},title:t.reaction.user.displayName||"Unknown user",subTitle:g(Q)(t.reaction.date),avatar:t.reaction.user.avatar,route:g($)?{name:g(N).USER_DETAILS,params:{userId:t.reaction.user.id}}:void 0,avatarRoute:g($)?{name:g(N).USER_DETAILS,params:{userId:t.reaction.user.id}}:void 0,description:t.reaction.message},se({_:2},[r.value?{name:"right",fn:B(()=>[S("div",Ue,[r.value&&!t.post.locked?(a(),m(G,{key:0,type:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:g(i).isDatabaseDeletionActive,onClick:T[0]||(T[0]=I=>g(u)(t.reaction.id,t.post))},null,8,["disabled"])):c("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),Ee={class:"grid justify-items-center p-5 gap-5"},Ae=L({__name:"BlogReactions",props:{post:{}},setup(o){const t=o,s=ne(),v=F(),l=q(),{content:y}=U(s),{firebaseUser:k,isLoggedIn:b}=U(v),{blogReactions:$}=U(l),{createBlogReaction:P}=l,i=A(),u=A(!1),r=ue({reaction:{value:"",error:""}}),h=D(()=>[...t.post.reactions].reverse()),T=D(()=>h.value.filter((p,f)=>f<3)),I=D(()=>h.value.filter((p,f)=>f>=3)),e=D(()=>t.post.locked||!b.value||$.value.isDatabaseCreationActive),w=async()=>{if(!$.value.isDatabaseCreationActive){if(await i.value.test(),!r.reaction.error&&k.value){const p=r.reaction.value;r.reaction.value="Replying...";const f=await P(t.post,{userId:k.value.uid,postId:t.post.id,message:p,date:new Date});r.reaction.value=f?"":p}ge()}};return(p,f)=>(a(),d("form",{action:"",onSubmit:me(w,["prevent"])},[S("div",Ee,[!g(b)||p.post.reactions.filter(n=>n.user.id===g(k).uid).length<20?(a(),m(V,{key:0,class:C(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",p.post.colorTertiary||"bg-secondary-700",p.post.opacityTertiary||"bg-opacity-25"])},{default:B(()=>[E(Se,{class:"w-5/6",id:p.post.id,inputProps:{class:["rounded-primary border-none !placeholder-gray-300",p.post.colorSecondary||p.post.colorPrimary||"bg-secondary-600",p.post.opacitySecondary||"!bg-opacity-20",e.value?{"!bg-gray-900 !bg-opacity-50":!g($).isDatabaseCreationActive}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!g(b)&&!p.post.locked}],disabled:e.value,autocomplete:"off"},ref_key:"reaction",ref:i,name:"reaction",placeholder:p.post.locked?"Locked for comments":g(b)?"Reply":g(y).blogLoginGuest,modelValue:r.reaction.value,"onUpdate:modelValue":f[0]||(f[0]=n=>r.reaction.value=n),error:r.reaction.error,"onUpdate:error":f[1]||(f[1]=n=>r.reaction.error=n),rules:[g(Pe).Required],onClick:f[2]||(f[2]=()=>!g(b)&&!p.post.locked?g(ce).push({name:g(N).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):c("",!0),(a(!0),d(R,null,j(T.value,n=>(a(),m(x,{post:p.post,reaction:n},null,8,["post","reaction"]))),256)),(a(!0),d(R,null,j(I.value,n=>de((a(),m(x,{post:p.post,reaction:n},null,8,["post","reaction"])),[[pe,u.value]])),256)),p.post.reactions.length>3?(a(),m(G,{key:1,type:"primary",outlined:"",icon:u.value?"pi pi-angle-up":"pi pi-angle-down",label:u.value?"Hide older reactions":"View older reactions",onClick:f[3]||(f[3]=n=>u.value=!u.value)},null,8,["icon","label"])):c("",!0)])],32))}});var Le={root:function(t){var s=t.props;return["p-chip p-component",{"p-chip-image":s.image!=null}]},icon:"p-chip-icon",label:"p-chip-text",removeIcon:"p-chip-remove-icon"},je=ve.extend({name:"chip",classes:Le}),Me={name:"BaseChip",extends:be,props:{label:{type:String,default:null},icon:{type:String,default:null},image:{type:String,default:null},removable:{type:Boolean,default:!1},removeIcon:{type:String,default:void 0}},style:je,provide:function(){return{$parentInstance:this}}},le={name:"Chip",extends:Me,inheritAttrs:!1,emits:["remove"],data:function(){return{visible:!0}},methods:{onKeydown:function(t){(t.key==="Enter"||t.key==="Backspace")&&this.close(t)},close:function(t){this.visible=!1,this.$emit("remove",t)}},components:{TimesCircleIcon:fe}},Ke=["aria-label"],Oe=["src"];function Ne(o,t,s,v,l,y){return l.visible?(a(),d("div",M({key:0,class:o.cx("root"),"aria-label":o.label},o.ptmi("root")),[W(o.$slots,"default",{},function(){return[o.image?(a(),d("img",M({key:0,src:o.image},o.ptm("image")),null,16,Oe)):o.$slots.icon?(a(),m(Z(o.$slots.icon),M({key:1,class:o.cx("icon")},o.ptm("icon")),null,16,["class"])):o.icon?(a(),d("span",M({key:2,class:[o.cx("icon"),o.icon]},o.ptm("icon")),null,16)):c("",!0),o.label?(a(),d("div",M({key:3,class:o.cx("label")},o.ptm("label")),H(o.label),17)):c("",!0)]}),o.removable?W(o.$slots,"removeicon",{key:0,onClick:y.close,onKeydown:y.onKeydown,removeCallback:y.close,keydownCallback:y.onKeydown},function(){return[(a(),m(Z(o.removeIcon?"span":"TimesCircleIcon"),M({tabindex:"0",class:[o.cx("removeIcon"),o.removeIcon],onClick:y.close,onKeydown:y.onKeydown},o.ptm("removeIcon")),null,16,["class","onClick","onKeydown"]))]}):c("",!0)],16,Ke)):c("",!0)}le.render=Ne;const Ve=L({__name:"BlogPostBullets",props:{bullets:{},alignment:{}},setup(o){return(t,s)=>(a(),d("div",null,[S("div",{class:C({block:!t.alignment,flex:!!t.alignment,"justify-start":t.alignment==="left","justify-center":t.alignment==="center","justify-end":t.alignment==="right"})},[S("ul",{class:C(["list-disc",{"ms-5":t.alignment==="left"}])},[(a(!0),d(R,null,j(t.bullets,v=>(a(),d("li",null,H(v),1))),256))],2)],2)]))}}),Ge={class:"ql-editor no-input"},He=["innerHTML"],z=L({__name:"BlogPostDescription",props:{description:{}},setup(o){return(t,s)=>(a(),d("div",Ge,[S("div",{innerHTML:t.description},null,8,He)]))}}),ee=L({__name:"BlogPostImage",props:{coverImageUrl:{},post:{},alignment:{},thumb:{type:Boolean},imageClass:{}},setup(o){const t=o,s=A(0),v=A(0);return J(()=>{const l=new Image;l.src=t.coverImageUrl,l.onload=()=>{s.value=l.height,v.value=l.width}}),(l,y)=>{var k,b;return a(),d("div",{class:C({flex:!0,"justify-start":l.alignment==="left","justify-center":l.alignment===void 0||l.alignment==="center","justify-end":l.alignment==="right"})},[E(V,{class:C(["!p-0 md:!p-3 my-5",l.thumb?"w-full":"w-fit xl:!p-5 border border-white md:border-none !rounded-none md:!rounded-primary",(k=l.post)==null?void 0:k.colorTertiary,((b=l.post)==null?void 0:b.opacityTertiary)||"bg-opacity-50"])},{default:B(()=>[l.thumb?(a(),d("div",{key:0,class:"h-[20vh] inset-0 rounded-primary bg-cover bg-center",style:ye({backgroundImage:`url(${l.coverImageUrl})`})},null,4)):(a(),m(De,{key:1,src:l.coverImageUrl,"image-class":["cover-image md:rounded-primary",l.imageClass]},null,8,["src","image-class"]))]),_:1},8,["class"])],2)}}}),qe={class:"flex flex-wrap justify-end h-fit gap-3"},Fe=L({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(o){return(t,s)=>(a(),d("div",qe,[E(G,{class:"min-w-80",label:"Edit",onClick:s[0]||(s[0]=v=>t.$emit("editClicked"))}),E(G,{class:"min-w-80",type:"danger",outlined:"",label:"Delete",onClick:s[1]||(s[1]=v=>t.$emit("deleteClicked"))})]))}}),te=L({__name:"BlogPostSectionTitle",props:{class:{},alignment:{},isExpandable:{type:Boolean},isExpanded:{type:Boolean},isSubTitle:{type:Boolean}},emits:["click"],setup(o){const t=o;return(s,v)=>(a(),d("div",{class:C(["font-bold",{"text-lg md:text-2xl":!s.isSubTitle},{"hover:underline cursor-pointer":s.isExpandable},t.class])},[S("div",{class:C({block:!s.alignment,flex:!!s.alignment,"justify-start":s.alignment==="left","justify-center":s.alignment==="center","justify-end":s.alignment==="right"})},[S("span",{class:"flex",onClick:v[0]||(v[0]=l=>s.$emit("click"))},[s.isExpandable&&s.alignment==="right"?(a(),d("i",{key:0,class:C(["pi pi-angle-down animation",{"rotate-180":s.isExpanded}])},null,2)):c("",!0),W(s.$slots,"default"),s.isExpandable&&(s.alignment==="left"||s.alignment==="center")?(a(),d("i",{key:1,class:C(["pi pi-angle-down animation",{"rotate-180":s.isExpanded}])},null,2)):c("",!0)])],2)],2))}}),ze={class:"table-auto min-w-full text-left"},Qe={key:0,class:"border border-white"},We=["onClick","innerHTML"],ae=L({__name:"BlogPostTable",props:{tableData:{},alignment:{}},setup(o){const t=o,s=A(0),v=A("asc"),l=D(()=>he(t.tableData)),y=A(l.value.slice(1)),k=(i,u)=>{i===0&&(s.value=u,b(),$())},b=()=>{v.value==="asc"?v.value="desc":v.value="asc"},$=()=>{const i=s.value;y.value=y.value.sort((u,r)=>v.value==="asc"?r[i].localeCompare(u[i]):u[i].localeCompare(r[i]))},P=i=>{const u=/(https?:\/\/[^\s]+)/g;return i.replace(u,r=>{let h=r.replace("http://","").replace("https://","").replace("www.","");return h.length>15&&(h=h.substring(0,15)+"..."),`<a href="${r}" target="_blank">${h}</a>`})};return(i,u)=>(a(),d("div",{class:C(["my-8 flex max-w-[65vw] md:max-w-[50vw] lg:max-w-[60vw] overflow-x-auto",{"justify-start":i.alignment==="left","justify-center":i.alignment==="center"||!i.alignment,"justify-end":i.alignment==="right"}])},[S("table",ze,[S("tbody",null,[(a(!0),d(R,null,j([l.value[0],...y.value],(r,h)=>(a(),d(R,{key:h},[r.every(T=>!T)?c("",!0):(a(),d("tr",Qe,[(a(!0),d(R,null,j(r,(T,I)=>(a(),d(R,{key:I},[I!==0||!l.value.every(e=>!e.length||!e[0])?(a(),d("td",{key:0,class:C(["px-2 border border-white text-nowrap",{"font-bold":h===0||I===0},{"cursor-pointer underline":h===0},{"text-left":i.alignment==="left"||!i.alignment,"text-center":i.alignment==="center","text-right":i.alignment==="right"}]),onClick:e=>k(h,I),innerHTML:P(T)},null,10,We)):c("",!0)],64))),128))]))],64))),128))])])],2))}}),Je={class:"flex gap-3"},Xe={class:"flex justify-between h-fit mt-2 gap-2"},Ye={class:"flex flex-wrap gap-3"},Ze={class:"w-full"},_e={class:"w-full"},rt=L({__name:"BlogPost",props:{post:{},withoutMutation:{type:Boolean}},emits:["editClicked","deleteClicked"],setup(o){const t=o,s=ke(),v=F(),l=we(),{publicUsers:y}=U(l),{firebaseUser:k,isOwner:b}=U(v);s.currentRoute.value.name!==N.BLOG&&Re(t.post);const $=D(()=>{var e;return(e=t.post.allowedUserIds)!=null&&e.length?y.value.filter(w=>{var p;return(p=t.post.allowedUserIds)==null?void 0:p.includes(w.id)}):[]}),P=D(()=>{const e=Q(t.post.date);return t.post.dateUpdated?e+` - updated ${Q(t.post.dateUpdated)}`:e}),i=D(()=>{const e=[];return t.post.datePinned&&e.push({value:"Pinned",severity:"success",rounded:!1}),t.post.locked&&e.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),t.post.archived&&e.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),e}),u=D(()=>t.post.sections.map(e=>({...e,isExpandable:h(e)}))),r=D(()=>u.value.some(e=>e.openByDefault)?u.value.flatMap((e,w)=>e.openByDefault?w:[]):null),h=e=>!!e.description||!!e.coverImageUrl||!!e.bullets.length||!!e.table,T=e=>{var w;(w=r.value)!=null&&w.length||$e(e)},I=()=>{const e=document.createElement("textarea"),{protocol:w,hostname:p,port:f}=window.location,n=`${w}//${p}`+(p==="localhost"?`:${f}`:"");e.value=`${n}#${Ce.BLOG.path}/${t.post.id}`,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),Te.success("Copied link!")};return(e,w)=>(a(),m(V,{id:e.post.id,class:C(["border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:P.value,tags:i.value,loading:e.post.loading,clickable:"",route:{name:g(N).BLOG_DETAILS,params:{postId:e.post.id}}},{right:B(()=>[S("div",Je,[E(G,{class:"border-none h-fit",type:"neutral",icon:"pi pi-copy",onClick:I})])]),default:B(()=>{var p;return[S("div",Xe,[S("div",Ye,[(a(!0),d(R,null,j($.value,f=>{var n;return a(),m(g(le),{class:"h-fit !p-0 !px-4 !py-1 bg-red-800 bg-opacity-50",icon:"pi pi-user",label:f.id===((n=g(k))==null?void 0:n.uid)?"You":f.displayName,rounded:""},null,8,["label"])}),256))]),g(b)&&!e.withoutMutation?(a(),d("div",{key:0,class:C(["flex justify-end ms-5",(p=e.post.allowedUserIds)!=null&&p.length?"flex-col md:flex-row":"flex-row"])},[E(Fe,{onEditClicked:w[0]||(w[0]=f=>e.$emit("editClicked")),onDeleteClicked:w[1]||(w[1]=f=>e.$emit("deleteClicked"))})],2)):c("",!0)]),E(V,{class:C(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{default:B(()=>{var f;return[S("div",{class:C(["flex relative",e.post.countdown||e.post.alignment==="center"?"flex justify-between":""])},[S("div",Ze,[e.post.countdown?(a(),m(K,{key:0,time:new Date(e.post.countdown).getTime(),direction:"down",alignment:e.post.alignment},null,8,["time","alignment"])):c("",!0),e.post.timer?(a(),m(K,{key:1,time:new Date(e.post.timer).getTime(),direction:"up",alignment:e.post.alignment},null,8,["time","alignment"])):c("",!0),e.post.description?(a(),m(z,{key:2,description:e.post.description},null,8,["description"])):c("",!0)])],2),e.post.coverImageUrl?(a(),m(ee,{key:0,post:e.post,"cover-image-url":e.post.coverImageUrl},null,8,["post","cover-image-url"])):c("",!0),e.post.descriptionFooter?(a(),m(z,{key:1,class:"mb-5",description:e.post.descriptionFooter},null,8,["description"])):c("",!0),e.post.table?(a(),m(ae,{key:2,tableData:e.post.table,alignment:e.post.tableAlignment},null,8,["tableData","alignment"])):c("",!0),E(g(Be),{multiple:!!((f=r.value)!=null&&f.length),"active-index":r.value,onTabOpen:T},{default:B(()=>[(a(!0),d(R,null,j(u.value,n=>(a(),m(g(Ie),{disabled:!n.isExpandable,pt:{headerAction:{class:["px-0 bg-transparent",n.isExpandable?void 0:"cursor-auto"]},headerIcon:{class:{invisible:!n.isExpandable}}}},se({header:B(()=>[S("div",_e,[n.title?(a(),m(te,{key:0,alignment:n.alignment},{default:B(()=>[_(H(n.title),1)]),_:2},1032,["alignment"])):c("",!0),n.subTitle?(a(),m(te,{key:1,alignment:n.alignment,"is-sub-title":""},{default:B(()=>[_(H(n.subTitle),1)]),_:2},1032,["alignment"])):c("",!0),n.isExpandable?c("",!0):(a(),d(R,{key:2},[n.countdown?(a(),m(K,{key:0,time:new Date(n.countdown).getTime(),direction:"down",alignment:n.alignment},null,8,["time","alignment"])):c("",!0),n.timer?(a(),m(K,{key:1,time:new Date(n.timer).getTime(),direction:"up",alignment:n.alignment},null,8,["time","alignment"])):c("",!0)],64))])]),default:B(()=>[n.description?(a(),m(z,{key:0,description:n.description,alignment:n.alignment},null,8,["description","alignment"])):c("",!0),n.coverImageUrl?(a(),m(ee,{key:1,post:e.post,"cover-image-url":n.coverImageUrl,alignment:n.alignment,"image-class":"!max-h-[50vh]"},null,8,["post","cover-image-url","alignment"])):c("",!0),E(Ve,{bullets:n.bullets,alignment:n.alignment},null,8,["bullets","alignment"]),n.isExpandable?(a(),d(R,{key:2},[n.countdown?(a(),m(K,{key:0,time:new Date(n.countdown).getTime(),direction:"down",alignment:n.alignment},null,8,["time","alignment"])):c("",!0),n.timer?(a(),m(K,{key:1,time:new Date(n.timer).getTime(),direction:"up",alignment:n.alignment},null,8,["time","alignment"])):c("",!0)],64)):c("",!0),n.table?(a(),m(ae,{key:3,tableData:n.table,alignment:n.tableAlignment},null,8,["tableData","alignment"])):c("",!0)]),_:2},[n.isExpandable?void 0:{name:"headericon",fn:B(()=>[]),key:"0"}]),1032,["disabled","pt"]))),256))]),_:1},8,["multiple","active-index"])]}),_:1},8,["class"]),E(Ae,{post:e.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","loading","route"]))}});export{rt as _,Fe as a,ee as b,z as c,te as d,le as s,it as u};
