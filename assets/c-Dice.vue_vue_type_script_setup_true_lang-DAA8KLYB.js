import{aW as Pe,a_ as Re,c as Ve,aX as $e,aQ as ke,s as D,a$ as Ye,b0 as K,aS as b,w as g,aR as _,a9 as Y,f as m,o as Ue,L as N,b3 as je,b4 as We,aY as C,b5 as ze,b9 as ee,aq as Ze,aZ as Me,d as Be,g as xe,j as le,l as Xe,aT as ye,h as U,z as qe}from"../bundle.js";import{_ as Qe,a as Je,b as we,c as Ke,d as el}from"./c-Dice5.vue_vue_type_script_setup_true_lang-DK-8hWiG.js";import{_ as ll}from"./c-Dice6.vue_vue_type_script_setup_true_lang-CbzU1YFL.js";var al=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.WAITING_FOR_OPPONENTS=2]="WAITING_FOR_OPPONENTS",l[l.HAS_STARTED=3]="HAS_STARTED",l[l.HAS_THROWN_DICES=4]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=5]="HAS_CHOSEN_DICES",l[l.HAS_FINISHED=6]="HAS_FINISHED",l))(al||{}),tl=(l=>(l[l.ONES=0]="ONES",l[l.TWOS=1]="TWOS",l[l.THREES=2]="THREES",l[l.FOURS=3]="FOURS",l[l.FIVES=4]="FIVES",l[l.SIXES=5]="SIXES",l[l.THREE_OF_A_KIND=6]="THREE_OF_A_KIND",l[l.FOUR_OF_A_KIND=7]="FOUR_OF_A_KIND",l[l.FULL_HOUSE=8]="FULL_HOUSE",l[l.SMALL_STRAIGHT=9]="SMALL_STRAIGHT",l[l.LARGE_STRAIGHT=10]="LARGE_STRAIGHT",l[l.YAHTZEE=11]="YAHTZEE",l[l.CHANCE=12]="CHANCE",l))(tl||{});const sl=Pe("yahtzeeStore",()=>{const l=Re(),S=Ve(),E=$e(),h=ke(),{personalBest:L,highscorePosition:F}=D(E),{firebaseUser:c}=D(S),{onlineGames:H,onlineGamesLoading:j,onlineGameId:W,onlineGameCreatorId:te,onlineGamePlayers:G,onlineGameOpponents:z,maxPlayers:P,onlineGameChat:se,isInitializingOnlineGame:Z,isOnlineGameOwner:ne}=D(h),{fetchOnlineGames:ie,createOnlineGame:ue,continueOnlineGame:oe,updateOnlineGame:re,leaveOnlineGame:ce,deleteOnlineGame:ve,getPlayerDisplayName:fe,getNextPlayerId:M}=h,{setPreviousHighscores:B,updateHighscores:me,sortHighscores:Oe}=E,Ee={onlineGames:Ye(l,K.GAME_DATA,b.YAHTZEE,K.ONLINE_GAMES)},d=g(_.SOLO),o=g(0),A=g(!1),s=g("soloPlayer"),v=g(s.value),u=g(ae()),f=g(-1),r=Y({}),O=Y({}),i=Y({}),p=m(()=>u.value.some(e=>e.isRolling)),de=m(()=>f.value===-1&&!u.value.every(e=>e.selected)),_e=m(()=>f.value>=0&&f.value<2&&!u.value.every(e=>e.selected)),he=m(()=>e=>u.value.filter(a=>a.value===e).length),ge=m(()=>J(3)),Ie=m(()=>J(4)),Te=m(()=>$(2)&&$(3)?T[8].trueValue??!1:!1),Ae=m(()=>w(4)?T[9].trueValue??!1:!1),pe=m(()=>w(5)?T[10].trueValue??!1:!1),x=m(()=>$(5)?T[11].trueValue??!1:!1),Ne=m(()=>{let e=0;return u.value.forEach(a=>{e+=a.value}),e}),R=m(()=>(e,a="soloPlayer")=>{var n;let t=0;return(n=r[a])==null||n.filter(I=>T[I.row].section===e).forEach(I=>{I.value!==!1&&(t+=I.value)}),t});Ue(()=>{E.$init(b.YAHTZEE)}),N(r,e=>{Object.keys(i).length&&Object.keys(i).every(a=>e[a].length===13)&&(o.value=6)},{deep:!0}),N(o,e=>{if(e===6){let a=R.value("top",s.value);a>=63&&(O[s.value]+=35),a+=R.value("bottom",s.value),a+=O[s.value],i[s.value]=a,d.value===_.SOLO&&k(),C(Me)}}),N(()=>i,()=>{console.log("FINAL SCORE CHANGED",i),d.value===_.ONLINE&&G.value.every(e=>!!i[e.userId])&&z.value.every(e=>i[s.value]>=i[e.userId])&&k()},{deep:!0}),N([o,v,p],()=>{d.value===_.ONLINE&&(console.log("CHANGE IN LOCAL DATA DETECTED",o.value,v.value,p.value),X())},{deep:!0}),N(G,()=>{o.value===2&&P.value&&G.value.length===P.value&&(o.value=3)});const V=()=>{h.$reset(),d.value=_.SOLO,o.value=0,A.value=!1,s.value="soloPlayer",v.value=s.value,f.value=-1,u.value=ae(),Object.keys(r).forEach(e=>{delete r[e],delete O[e],delete i[e]}),B()},Se=(e,a=null)=>{c.value&&(e=[{userId:c.value.uid,isOnline:!0},...e],d.value=_.ONLINE,o.value=2,s.value=c.value.uid,v.value=s.value,e.forEach(t=>{r[t.userId]=[],O[t.userId]=0,i[t.userId]=0}),h.$init(b.YAHTZEE,q,y,V),ue(e,a))},He=e=>{c.value&&(d.value=_.ONLINE,s.value=c.value.uid,h.$init(b.YAHTZEE,q,y,V),oe(e))},X=()=>{console.log("updateOnlineGameCustom.1"),!(!c.value||v.value!==s.value&&!A.value&&!Z.value)&&(console.log("updateOnlineGameCustom.2"),re())},y=()=>({gameStatus:o.value,activePlayerId:v.value,dices:u.value,reroll:f.value,score:r,bonus:O,finalScore:i}),q=e=>{var t;console.log("updateLocalGameState.1");const a=(t=c.value)==null?void 0:t.uid;!a||v.value===s.value&&!Z.value||(console.log("updateLocalGameState.2"),o.value=e.gameStatus,v.value=e.activePlayerId,u.value=e.dices,f.value=e.reroll,Object.assign(r,e.score),Object.assign(O,e.bonus),Object.assign(i,e.finalScore),Object.keys(r).includes(a)||(r[a]=[],O[a]=0,i[a]=0))},Q=async()=>{for(;p.value;)await new Promise(e=>setTimeout(e,E.diceRollSpeed*1e3));return!0},J=e=>{for(let a=1;a<=6;a++)if(u.value.filter(t=>t.value===a).length>=e){let t=0;return u.value.forEach(n=>{t+=n.value}),t}return!1},$=e=>{for(let a=1;a<=6;a++)if(u.value.filter(t=>t.value===a).length===e)return!0;return!1},w=e=>{let a=0,t=e;do{e:for(let n=t-e+1;n<=t;n++)if(u.value.some(I=>I.value===n))a++;else break e;if(a===e)return!0;a=0,t++}while(t<=6);return!1},Ge=()=>{o.value=3,r[s.value]=[],O[s.value]=0,i[s.value]=0},be=async()=>{const e=E.diceRollSpeed*1e3;f.value++,u.value.forEach(a=>{a.selected||(a.isRolling=!0,setTimeout(()=>{a.value=je(6),a.isRolling=!1,f.value===2&&(a.selected=!0),u.value.sort((t,n)=>t.value-n.value)},We(e,e/3)))}),await Q(),o.value=4,C(ze)},Ce=(e,a)=>{var t;return(t=r[a])==null?void 0:t.find(n=>n.row===e)},De=(e,a)=>{let t=a;if(t===!1)return!1;const n=T[e];return n.multiplier?t*=n.multiplier:n.trueValue&&(t=n.trueValue),t},Le=e=>{v.value===s.value&&f.value>=0&&f.value<2&&(e.selected=!e.selected,C(ee))},Fe=(e,a)=>{if(!p.value){if(a!==!1&&x.value){const t=r[s.value].find(n=>n.row===11);t&&t.value!==!1&&(O[s.value]+=100)}r[s.value].push({row:e,value:a}),f.value=-1,u.value.forEach(t=>{t.selected=!1}),C(ee),d.value===_.ONLINE&&(A.value=!0,o.value=5,setTimeout(async()=>{o.value=3,v.value=M(v.value),await Ze(),A.value=!1},E.diceRollSpeed*1e3))}},k=()=>{c.value&&i[s.value]&&me({gameId:W.value??null,score:i[s.value],bonus:O[s.value]})};return{collections:Ee,onlineGames:H,onlineGamesLoading:j,onlineGameId:W,onlineGameCreatorId:te,onlineGamePlayers:G,onlineGameOpponents:z,maxPlayers:P,onlineGameChat:se,isOnlineGameOwner:ne,gameType:d,gameStatus:o,gameStatusLoading:A,myPlayerId:s,activePlayerId:v,score:r,finalScore:i,bonus:O,reroll:f,dices:u,isRolling:p,canRoll:de,canReroll:_e,hasOfValue:he,hasThreeOfAKind:ge,hasFourOfAKind:Ie,hasFullHouse:Te,hasSmallStraight:Ae,hasLargeStraight:pe,hasYahtzee:x,diceTotal:Ne,scoreTotalOf:R,personalBest:L,highscorePosition:F,$reset:V,start:Ge,roll:be,hasFinishedRolling:Q,getScore:Ce,getActualValue:De,selectDice:Le,selectScore:Fe,setPreviousHighscores:B,updateYahtzeeHighscore:k,sortHighscores:Oe,fetchOnlineGames:ie,createOnlineGame:Se,continueOnlineGame:He,updateOnlineGame:X,leaveOnlineGame:ce,deleteOnlineGame:ve,getPlayerDisplayName:fe,getNextPlayerId:M}},{persist:{enabled:!0}}),ae=()=>[{id:1,value:1,selected:!1,isRolling:!1},{id:2,value:2,selected:!1,isRolling:!1},{id:3,value:3,selected:!1,isRolling:!1},{id:4,value:4,selected:!1,isRolling:!1},{id:5,value:5,selected:!1,isRolling:!1}],T={0:{title:"Ones",section:"top"},1:{title:"Twos",section:"top",multiplier:2},2:{title:"Threes",section:"top",multiplier:3},3:{title:"Fours",section:"top",multiplier:4},4:{title:"Fives",section:"top",multiplier:5},5:{title:"Sixes",section:"top",multiplier:6},6:{title:"Three of a Kind",section:"bottom"},7:{title:"Four of a Kind",section:"bottom"},8:{title:"Full House",section:"bottom",trueValue:25},9:{title:"Small Straight",section:"bottom",trueValue:30},10:{title:"Large Straight",section:"bottom",trueValue:40},11:{title:"Yahtzee",section:"bottom",trueValue:50},12:{title:"Chance",section:"bottom"}},ol=Be({__name:"Dice",props:{dice:{}},setup(l){const S=sl(),{activePlayerId:E,myPlayerId:h}=D(S),{selectDice:L}=S,F={1:el,2:Ke,3:we,4:Je,5:Qe,6:ll};return(c,H)=>(le(),xe("div",{class:qe(["cursor-pointer",{"animate-spin":c.dice.isRolling}])},[(le(),Xe(ye(F[c.dice.value]),{color:"black",backgroundColor:c.dice.selected?U(E)===U(h)?"#2563eb":"#e11d48":"white",width:"40",height:"40",onClick:H[0]||(H[0]=j=>U(L)(c.dice))},null,8,["backgroundColor"]))],2))}});export{al as G,tl as S,ol as _,T as s,sl as u};
