import{a as K,al as Y,s as x,l as de,av as pe,aw as be,ax as ne,ay as ie,az as M,aA as me,q as Q,z as i,d as A,u as ve,G as se,b as w,g as E,_ as H,f as e,R as j,a8 as ae,n as G,aB as Pe,w as V,e as q,i as z,J as F,C as h,c as I,x as we,h as u,D as fe,ar as Se,y as re,P as O,Q as J,aC as ke,aD as Ue,v as xe,aE as Ce,aF as Ve,ao as W,ap as he,aq as Te,j as Be,as as Re,at as le,aG as Ie,U as $e,af as L,ag as X,V as ue,aH as Z,aI as Ee,aJ as De,ab as Oe,aK as Ae,ac as _,ad as ee,k as te,ae as oe}from"../bundle.js";import{_ as ye}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DI3Y1UAH.js";import{u as Le}from"./c-useUsers-CxbPlCdU.js";const Me=t=>{const a=K(),p=Y(),{blogPosts:S,isBlogPostDatabaseActionActive:k}=x(a);let o=[];const r=i(),m=d=>{d.metadata.hasPendingWrites||k.value||(clearTimeout(r.value),r.value=setTimeout(async()=>{await a.fetchBlogPost(t.id,void 0,{loadingIndicator:!1}),a.checkBlogPostForUnreadReactions(S.value.previousData.single,!0)},200))};de(async()=>{p.unread=p.unread.filter(v=>v.postId!==t.id);const d=pe(t),b=a.collections.blogPosts(d.isPrivate),P=p.collections.blogReactions(d.isPrivate),c=be(b,t.id),y=ne(b,ie("id","==",t.id)),f=ne(P,ie("post","==",c));o.push(M(y,m)),o.push(M(f,m))}),me(()=>{clearTimeout(r.value),o.forEach(d=>{d()})})},et=()=>{const t=K(),a=Q(),p=Y(),{visibleBlogPosts:S,isBlogPostDatabaseActionActive:k}=x(t),{isLoggedIn:o}=x(a);let r=[];const m=i(),d=b=>{b.metadata.hasPendingWrites||k.value||(clearTimeout(m.value),m.value=setTimeout(async()=>{S.value.length&&(await t.fetchBlogPosts({amount:S.value.length,loadingIndicator:!1}),t.checkBlogPostsForUnreadReactions())},200))};de(()=>{p.unread=[],r.push(M(t.collections.blogPosts(!1),d)),r.push(M(p.collections.blogReactions(!1),d)),o.value&&(r.push(M(t.collections.blogPosts(!0),d)),r.push(M(p.collections.blogReactions(!0),d)))}),me(()=>{clearTimeout(m.value),r.forEach(b=>{b()})})},je={class:"flex flex-col gap-2"},ce=A({__name:"BlogReaction",props:{post:{},reaction:{}},setup(t){const a=t,p=ve(),S=Q(),k=se(),o=Y(),{routeLoading:r,routeLoadingId:m}=x(p),{firebaseUser:d,isLoggedIn:b,isOwner:P}=x(S),{publicUsers:c}=x(k),{isDatabaseDeletionActive:y}=x(o),f=h(()=>c.value.find(T=>T.id===a.reaction.userId)),v=h(()=>d.value&&a.reaction.userId===d.value.uid||P.value);return(T,B)=>(w(),E(H,{id:t.reaction.id,class:G(["p-5 w-full md:w-3/4 xl:w-2/3",t.post.colorTertiary,t.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":e(r)===e(j).USER_DETAILS&&e(m)===f.value?.id}},title:f.value?.displayName||"Unknown user",subTitle:e(ae)(t.reaction.date),avatar:f.value?.avatar,route:e(b)?{name:e(j).USER_DETAILS,params:{userId:t.reaction.userId}}:void 0,avatarRoute:e(b)?{name:e(j).USER_DETAILS,params:{userId:t.reaction.userId}}:void 0,description:t.reaction.message},Pe({_:2},[v.value?{name:"right",fn:V(()=>[q("div",je,[v.value&&!t.post.locked?(w(),E(z,{key:0,variant:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:e(y),onClick:B[0]||(B[0]=C=>e(o).deleteBlogReaction(t.post,t.reaction.id,{mutatePost:!0,fetch:!0}))},null,8,["disabled"])):F("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),Ne={class:"grid justify-items-center p-5 gap-5"},Ge=A({__name:"BlogReactions",props:{post:{}},setup(t){const a=t,p=ve(),S=Q(),k=Y(),{content:o}=x(p),{firebaseUser:r,isLoggedIn:m}=x(S),{isDatabaseCreationActive:d}=x(k),b=i(),P=i(!1),c=xe({reaction:{value:"",error:""}}),y=h(()=>[...a.post.reactions].reverse()),f=h(()=>y.value.filter((C,g)=>g<3)),v=h(()=>y.value.filter((C,g)=>g>=3)),T=h(()=>a.post.locked||!m.value||d.value),B=async()=>{if(!d.value){if(await b.value.test(),!c.reaction.error&&r.value){const C=c.reaction.value;c.reaction.value="Replying...";const g=await k.createBlogReaction(a.post,new Ce(r.value.uid,a.post.id,C));c.reaction.value=g?"":C}Ve()}};return(C,g)=>(w(),I("form",{action:"",onSubmit:we(B,["prevent"])},[q("div",Ne,[!e(m)||t.post.reactions.filter(n=>n.userId===e(r).uid).length<20?(w(),E(H,{key:0,class:G(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",t.post.colorTertiary||"bg-secondary-700",t.post.opacityTertiary||"bg-opacity-25"])},{default:V(()=>[u(fe,{class:"w-5/6",id:t.post.id,inputProps:{class:["!bg-neutral-900 rounded-primary border-none !placeholder-gray-300",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-600",t.post.opacitySecondary||"!bg-opacity-20",T.value?{"!bg-gray-900 !bg-opacity-50":!e(d)}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!e(m)&&!t.post.locked}],disabled:T.value,autocomplete:"off"},ref_key:"reaction",ref:b,name:"reaction",placeholder:t.post.locked?"Locked for comments":e(m)?"Reply":e(o).blogLoginGuest,modelValue:c.reaction.value,"onUpdate:modelValue":g[0]||(g[0]=n=>c.reaction.value=n),error:c.reaction.error,"onUpdate:error":g[1]||(g[1]=n=>c.reaction.error=n),rules:[e(re).Required],onClick:g[2]||(g[2]=()=>!e(m)&&!t.post.locked?e(Se).push({name:e(j).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):F("",!0),(w(!0),I(O,null,J(f.value,n=>(w(),E(ce,{post:t.post,reaction:n},null,8,["post","reaction"]))),256)),(w(!0),I(O,null,J(v.value,n=>ke((w(),E(ce,{post:t.post,reaction:n},null,8,["post","reaction"])),[[Ue,P.value]])),256)),t.post.reactions.length>3?(w(),E(z,{key:1,outlined:"",icon:P.value?"pi pi-angle-up":"pi pi-angle-down",label:P.value?"Hide older reactions":"View older reactions",onClick:g[3]||(g[3]=n=>P.value=!P.value)},null,8,["icon","label"])):F("",!0)])],32))}}),qe={class:"flex flex-wrap justify-end h-fit gap-3"},ze=A({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(t){return(a,p)=>(w(),I("div",qe,[u(z,{class:"min-w-80",label:"Edit",onClick:p[0]||(p[0]=S=>a.$emit("editClicked"))}),u(z,{class:"min-w-80",variant:"danger",outlined:"",label:"Delete",onClick:p[1]||(p[1]=S=>a.$emit("deleteClicked"))})]))}}),Fe={class:"flex justify-between h-fit mt-2 gap-2"},Qe={class:"flex flex-wrap gap-3"},tt=A({__name:"BlogPost",props:{post:{}},setup(t){const a=t,p=Be(),S=Q(),k=se(),o=K(),r=W(),{publicUsers:m}=x(k),{firebaseUser:d,isOwner:b}=x(S),{deleteBlogPost:P}=o,c=i(!1);p.currentRoute.value.name!==j.BLOG&&Me(a.post);const y=h(()=>a.post.allowedUserIds?.length?m.value.filter(n=>a.post.allowedUserIds?.includes(n.id)):[]),f=h(()=>{const n=ae(a.post.date);return a.post.dateUpdated?n+` - updated ${ae(a.post.dateUpdated)}`:n}),v=h(()=>{const n=[];return a.post.datePinned&&n.push({value:"Pinned",severity:"success",rounded:!1}),a.post.locked&&n.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),a.post.archived&&n.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),n}),T=()=>{r.openWith(a.post)},B=()=>{c.value=!0},C=async()=>{await P(a.post.id)&&(c.value=!1)},g=()=>{const n=document.createElement("textarea"),{protocol:$,hostname:U,port:l}=window.location,s=`${$}//${U}`+(U==="localhost"?`:${l}`:"");n.value=`${s}#${Re.BLOG.path}/${a.post.id}`,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),le.success("Copied link!")};return(n,$)=>(w(),I(O,null,[u(H,{id:t.post.id,class:G(["border-4 border-transparent","!rounded-primary",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-900",t.post.opacitySecondary||"bg-opacity-50"]),title:t.post.title,subTitle:f.value,tags:v.value,clickable:"",route:{name:e(j).BLOG_DETAILS,params:{postId:t.post.id}}},{right:V(()=>[u(z,{class:"h-fit",variant:"neutral",icon:"pi pi-copy",text:"",onClick:g})]),default:V(()=>[q("div",Fe,[q("div",Qe,[(w(!0),I(O,null,J(y.value,U=>(w(),E(e(he),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:U.id===e(d)?.uid?"You":U.displayName,rounded:""},null,8,["label"]))),256))]),e(b)?(w(),I("div",{key:0,class:G(["flex justify-end ms-5",t.post.allowedUserIds?.length?"flex-col md:flex-row":"flex-row"])},[u(ze,{onEditClicked:T,onDeleteClicked:B})],2)):F("",!0)]),u(H,{class:G(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5 flex flex-col gap-3",t.post.colorPrimary,t.post.opacityPrimary||"bg-opacity-50"])},{default:V(()=>[(w(!0),I(O,null,J(t.post.content,U=>(w(),E(Te,{key:U.id,post:t.post,block:U},null,8,["post","block"]))),128))]),_:1},8,["class"]),u(Ge,{post:t.post},null,8,["post"])]),_:1},8,["id","class","title","subTitle","tags","route"]),u(ye,{title:"Delete Post",isOpen:c.value,description:[` Are you sure you want to delete this post called '${t.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:C,onCancel:$[0]||($[0]=U=>c.value=!1)},null,8,["isOpen","description"])],64))}}),We=A({__name:"BlogPostContentDialog",emits:["update:selected","error"],setup(t,{expose:a,emit:p}){const S=p,k=W(),{blogPostMutation:o}=x(k),r=i(),m=i(),d=h(()=>[m.value].some(P=>!!P));return a({test:async()=>{await Promise.all([r.value.test()]),S("error",d.value)}}),(P,c)=>(w(),I(O,null,[u(fe,{ref_key:"title",ref:r,class:"w-full",name:"title",label:"Title",placeholder:"Amazing Post",modelValue:e(o).title,"onUpdate:modelValue":c[0]||(c[0]=y=>e(o).title=y),error:m.value,"onUpdate:error":c[1]||(c[1]=y=>m.value=y),rules:[e(re).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),u(Ie,{modelValue:e(o).content,"onUpdate:modelValue":c[2]||(c[2]=y=>e(o).content=y)},null,8,["modelValue"])],64))}}),He=A({__name:"BlogPostSettingsDialog",emits:["error"],setup(t,{expose:a,emit:p}){const S=p,k=se(),o=W(),{blogPostMutation:r}=x(o),{allowedPublicUsers:m}=k,{mappedUsers:d}=Le(),b=i(),P=i(),c=i(),y=i(),f=h({get(){return!!r.value.datePinned},set(l){r.value.datePinned=l?new Date:null}}),v=i(),T=i(),B=i(),C=i(),g=h(()=>[v.value,T.value,B.value,C.value].some(l=>!!l)),n=i([]),$=l=>{r.value.allowedUserIds=l},U=async()=>{r.value.allowedUserIds.length&&!n.value.length&&(v.value="Invalid user ID's"),await Promise.all([P.value.test(),c.value.test(),y.value.test()]),S("error",g.value)};return $e(()=>r.value.allowedUserIds,async l=>{n.value=await m(l)},{immediate:!0}),a({test:U}),(l,s)=>(w(),I(O,null,[u(L,{ref_key:"allowedUsers",ref:b,class:"w-full md:w-1/2",name:"allowedUserIds",label:"Allowed users",placeholder:"This post is public","model-value":e(r).allowedUserIds,error:v.value,"onUpdate:error":s[0]||(s[0]=D=>v.value=D),"onUpdate:arrayValue":$,options:e(d),multiple:""},null,8,["model-value","error","options"]),u(X,{ref_key:"pinned",ref:y,class:"w-full md:w-1/2",name:"pinned",label:"Pinned",modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=D=>f.value=D)},null,8,["modelValue"]),u(X,{ref_key:"locked",ref:P,class:"w-full md:w-1/2",name:"locked",label:"Locked for commenting",modelValue:e(r).locked,"onUpdate:modelValue":s[2]||(s[2]=D=>e(r).locked=D)},null,8,["modelValue"]),u(X,{ref_key:"archived",ref:c,class:"w-full md:w-1/2",name:"archived",label:"Archived",modelValue:e(r).archived,"onUpdate:modelValue":s[3]||(s[3]=D=>e(r).archived=D)},null,8,["modelValue"])],64))}}),Je=A({__name:"BlogPostStylingDialog",emits:["error"],setup(t,{expose:a,emit:p}){const S=p,k=W(),{blogPostMutation:o}=x(k),r=i(),m=i(),d=i(),b=i(),P=i(),c=i(),y=i(),f=i(),v=i(),T=i(),B=i(),C=i(),g=h(()=>[y.value,f.value,v.value,T.value,B.value,C.value].some(U=>!!U)),n=h(()=>De(ue.find(U=>U.value===o.value.colorPrimary)));return a({test:async()=>{await Promise.all([r.value.test(),m.value.test(),d.value.test(),b.value.test(),P.value.test(),c.value.test()]),S("error",g.value)}}),(U,l)=>(w(),I(O,null,[u(L,{ref_key:"colorPrimary",ref:r,class:"w-full md:w-1/2",name:"colorPrimary",label:"Primary Style",modelValue:e(o).colorPrimary,"onUpdate:modelValue":l[0]||(l[0]=s=>e(o).colorPrimary=s),error:y.value,"onUpdate:error":l[1]||(l[1]=s=>y.value=s),options:e(ue),rules:[e(re).Required]},null,8,["modelValue","error","options","rules"]),u(L,{ref_key:"opacityPrimary",ref:b,class:"w-full md:w-1/2",name:"opacityPrimary",label:"Primary Opacity",modelValue:e(o).opacityPrimary,"onUpdate:modelValue":l[2]||(l[2]=s=>e(o).opacityPrimary=s),error:T.value,"onUpdate:error":l[3]||(l[3]=s=>T.value=s),options:e(Z)},null,8,["modelValue","error","options"]),u(L,{ref_key:"colorSecondary",ref:m,class:"w-full md:w-1/2",name:"colorSecondary",label:"Secondary Style",modelValue:e(o).colorSecondary,"onUpdate:modelValue":l[4]||(l[4]=s=>e(o).colorSecondary=s),error:f.value,"onUpdate:error":l[5]||(l[5]=s=>f.value=s),options:n.value},null,8,["modelValue","error","options"]),u(L,{ref_key:"opacitySecondary",ref:P,class:"w-full md:w-1/2",name:"opacitySecondary",label:"Secondary Opacity",modelValue:e(o).opacitySecondary,"onUpdate:modelValue":l[6]||(l[6]=s=>e(o).opacitySecondary=s),error:B.value,"onUpdate:error":l[7]||(l[7]=s=>B.value=s),options:e(Z)},null,8,["modelValue","error","options"]),u(L,{ref_key:"colorTertiary",ref:d,class:"w-full md:w-1/2",name:"colorTertiary",label:"Tertiary Style",modelValue:e(o).colorTertiary,"onUpdate:modelValue":l[8]||(l[8]=s=>e(o).colorTertiary=s),error:v.value,"onUpdate:error":l[9]||(l[9]=s=>v.value=s),options:e(Ee)},null,8,["modelValue","error","options"]),u(L,{ref_key:"opacityTertiary",ref:c,class:"w-full md:w-1/2",name:"opacityTertiary",label:"Tertiary Opacity",modelValue:e(o).opacityTertiary,"onUpdate:modelValue":l[10]||(l[10]=s=>e(o).opacityTertiary=s),error:C.value,"onUpdate:error":l[11]||(l[11]=s=>C.value=s),options:e(Z)},null,8,["modelValue","error","options"])],64))}}),Ke={ref:"dialog",class:"pt-6 mb-4 xl:px-16"},ot=A({__name:"BlogPostDialog",emits:["scroll-to-updated"],setup(t,{emit:a}){const p=a,S=Q(),k=K(),o=W(),{firebaseUser:r}=x(S),{isBlogPostsMutationLoading:m}=x(k),{createBlogPost:d,updateBlogPost:b,deleteFilesOfBlogPost:P,toggleBlogPostVisibility:c}=k,{isOpen:y,blogPostOriginal:f,blogPostMutation:v,hasChanges:T}=x(o),B=i(),C=i(),g=i(),n=i(!1),$=i(!1),U=i(!1),l=h(()=>!!f.value?.allowedUserIds?.length&&!v.value.allowedUserIds?.length||!f.value?.allowedUserIds?.length&&!!v.value.allowedUserIds?.length),s=h(()=>pe(f.value)),D=async()=>{await Promise.all([B.value.test(),C.value.test(),g.value.test()]),!(n.value||$.value||U.value)&&(f.value?l.value?(o.isOpen=!1,await c(f.value,v.value.allowedUserIds.length?"private":"public")&&(o.close(),le.success("Successfully updated Post Visibility"),p("scroll-to-updated",v.value.id))):await b(v.value,s.value)&&(le.success("Successfully updated Post"),o.close(),p("scroll-to-updated",v.value.id)):await d(v.value)&&(o.close(),p("scroll-to-updated",v.value.id)))},ge=async()=>{P(v.value,f.value??void 0),o.close()};return(Ye,R)=>(w(),E(ye,{isOpen:e(y),title:e(f)?"Update Post":"Create Post",description:e(f)?"Update this post":"Create a new post","confirm-text":e(f)?"Update":"Create","confirm-loading":e(m),"confirm-props":{disabled:!e(T)},onConfirm:D,onCancel:ge},{default:V(()=>[q("form",Ke,[e(y)?(w(),E(e(Oe),{key:0,"active-index":0,onTabOpen:e(Ae)},{default:V(()=>[u(e(_),{value:"content"},{default:V(()=>[u(e(ee),null,{default:V(()=>[...R[3]||(R[3]=[te(" Content ",-1)])]),_:1}),u(e(oe),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:V(()=>[u(We,{ref_key:"content",ref:B,onError:R[0]||(R[0]=N=>n.value=N)},null,512)]),_:1})]),_:1}),u(e(_),{value:"styling"},{default:V(()=>[u(e(ee),null,{default:V(()=>[...R[4]||(R[4]=[te(" Styling ",-1)])]),_:1}),u(e(oe),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:V(()=>[u(Je,{ref_key:"styling",ref:C,onError:R[1]||(R[1]=N=>$.value=N)},null,512)]),_:1})]),_:1}),u(e(_),{value:"settings"},{default:V(()=>[u(e(ee),null,{default:V(()=>[...R[5]||(R[5]=[te(" Settings ",-1)])]),_:1}),u(e(oe),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:V(()=>[u(He,{ref_key:"settings",ref:g,onError:R[2]||(R[2]=N=>U.value=N)},null,512)]),_:1})]),_:1})]),_:1},8,["onTabOpen"])):F("",!0)],512)]),_:1},8,["isOpen","title","description","confirm-text","confirm-loading","confirm-props"]))}});export{tt as _,ot as a,ze as b,et as u};
