import{_ as Ee}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DTvaJL_v.js";import{_ as je}from"./c-Page.vue_vue_type_script_setup_true_lang-Du-xfDw7.js";import{d as Ge,r,a as xe,c as T,I as W,b as re,v as Fe,e as qe,f as F,u as ze,g as Te,h as ke,i as ee,j as ne,s as D,o as De,k as We,F as He,R as H,l as P,m as o,n as a,p as v,_ as x,q as I,t as U,w as C,x as Q,B as Je,y as Ye,z,A as K,C as q,D as he,E as Ce,G as fe,H as R,J as Pe,K as Qe,L as Se,M as ue,N as Ke,O as $e,P as Xe,Q as be,S as se,T as de,U as Ve,V as Ze,W as Oe,X as et,Y,Z as pe,$ as tt,a0 as we,a1 as ce,a2 as ot,a3 as Ue,a4 as lt,a5 as at,a6 as nt,a7 as me}from"../bundle.js";import{_ as Le,s as ge,a as Be,u as st}from"./c-BlogPost.vue_vue_type_script_setup_true_lang-CmGbnfb4.js";const ve=e=>(e==null?void 0:e.id)??Fe(),ye=e=>{var d;return{content:(e==null?void 0:e.content.slice().map(qe.mapOutgoing))??[],date:e!=null&&e.date?new Date(e.date):new Date,dateUpdated:e!=null&&e.dateUpdated?new Date(e.dateUpdated):new Date,title:(e==null?void 0:e.title)??"",description:(e==null?void 0:e.description)??"",descriptionFooter:(e==null?void 0:e.descriptionFooter)??"",coverImageUrl:(e==null?void 0:e.coverImageUrl)??"",timer:e!=null&&e.timer?new Date(e.timer):null,countdown:e!=null&&e.countdown?new Date(e.countdown):null,table:(e==null?void 0:e.table)??"",sections:((d=e==null?void 0:e.sections)==null?void 0:d.slice().map(n=>({...n,bullets:n.bullets.slice(),timer:n.timer?new Date(n.timer):null,countdown:n.countdown?new Date(n.countdown):null})))??[],alignment:(e==null?void 0:e.alignment)??"center",tableAlignment:(e==null?void 0:e.tableAlignment)??"left",colorPrimary:(e==null?void 0:e.colorPrimary)??"",colorSecondary:(e==null?void 0:e.colorSecondary)??"",colorTertiary:(e==null?void 0:e.colorTertiary)??"",opacityPrimary:(e==null?void 0:e.opacityPrimary)??"",opacitySecondary:(e==null?void 0:e.opacitySecondary)??"",opacityTertiary:(e==null?void 0:e.opacityTertiary)??"",locked:(e==null?void 0:e.locked)??!1,allowedUserIds:(e==null?void 0:e.allowedUserIds)??[],archived:(e==null?void 0:e.archived)??!1,datePinned:e!=null&&e.datePinned?new Date(e.datePinned):null}},te=Ge("blogPostDialogStore",()=>{const e=r(!1),d=r(null),n=r(ve(null)),u=r(ye(null)),m=xe({hasContentChanges:!1,hasStylingChanges:!1,hasSettingsChanges:!1}),s=T(()=>d.value?W.convert(d.value):null),S=T(()=>m.hasContentChanges),B=T(()=>m.hasStylingChanges),h=T(()=>m.hasSettingsChanges),$=()=>{d.value=null,n.value=ve(null),u.value=ye(null),m.hasContentChanges=!1,m.hasStylingChanges=!1,m.hasSettingsChanges=!1},p=l=>{d.value=l,n.value=ve(l),u.value=ye(l),e.value=!0},b=()=>{e.value=!1,$()},g=()=>W.Content.convert(u.value),c=()=>W.Styling.convert(u.value),k=()=>W.Settings.convert(u.value);return{isOpen:e,blogPostOriginal:d,blogPostMutationId:n,blogPostMutation:u,blogPostMutationChanges:m,blogPostOriginalMutation:s,hasBlogPostMutationContentChanges:S,hasBlogPostMutationStylingChanges:B,hasBlogPostMutationSettingsChanges:h,$reset:$,openWith:p,close:b,getBlogPostMutationContent:g,getBlogPostMutationStyling:c,getBlogPostMutationSettings:k,isMutationEqual:async()=>{s.value&&(m.hasContentChanges=!re(W.Content.convert(s.value),g()),m.hasStylingChanges=!re(W.Styling.convert(s.value),c()),m.hasSettingsChanges=!re(W.Settings.convert(s.value),k()))}}}),it={key:0,class:"flex justify-center mt-5"},rt={class:"grid grid-cols-6 mb-5 gap-5"},ut=F({__name:"BlogDetails",emits:["createClicked","editClicked","deleteClicked"],setup(e){const d=ze(),n=Te(),u=ke(),m=ee(),s=ne(),{routeLoading:S}=D(u),{isLoggedIn:B}=D(m),{blogPosts:h,blogReactions:$,isBlogPostsFetchLoading:p}=D(s),{fetchBlogPost:b}=s,g=T(()=>d.params.postId);return De(async()=>{var c;if($.value.unread=[],g.value)if(((c=h.value.data.single)==null?void 0:c.id)!==g.value){const k=await b(g.value);if(We(k)&&k===He.PERMISSION_DENIED&&!B.value){n.push({name:H.LOGIN,params:{redirect:JSON.stringify({name:H.BLOG_DETAILS,params:{postId:g.value}})}});return}}else h.value.data.single}),(c,k)=>o(p)?(a(),P("div",it,[v(x,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:"",label:"Loading..."})])):(a(),P(Q,{key:1},[I("div",rt,[v(x,{class:"col-span-full md:col-span-4 lg:col-span-2",type:"tertiary",route:o(H).BLOG,loading:o(S)===o(H).BLOG,label:"Back to other posts",icon:"pi pi-arrow-up-left"},null,8,["route","loading"])]),o(h).data.single?(a(),U(Le,{key:0,post:o(h).data.single,onEditClicked:k[0]||(k[0]=t=>c.$emit("editClicked",o(h).data.single)),onDeleteClicked:k[1]||(k[1]=t=>c.$emit("deleteClicked",o(h).data.single))},null,8,["post"])):C("",!0)],64))}});var dt={root:"p-card p-component",header:"p-card-header",body:"p-card-body",caption:"p-card-caption",title:"p-card-title",subtitle:"p-card-subtitle",content:"p-card-content",footer:"p-card-footer"},pt=Je.extend({name:"card",classes:dt}),ct={name:"BaseCard",extends:Ye,style:pt},Me={name:"Card",extends:ct,inheritAttrs:!1};function mt(e,d,n,u,m,s){return a(),P("div",z({class:e.cx("root")},e.ptmi("root")),[e.$slots.header?(a(),P("div",z({key:0,class:e.cx("header")},e.ptm("header")),[K(e.$slots,"header")],16)):C("",!0),I("div",z({class:e.cx("body")},e.ptm("body")),[e.$slots.title||e.$slots.subtitle?(a(),P("div",z({key:0,class:e.cx("caption")},e.ptm("caption")),[e.$slots.title?(a(),P("div",z({key:0,class:e.cx("title")},e.ptm("title")),[K(e.$slots,"title")],16)):C("",!0),e.$slots.subtitle?(a(),P("div",z({key:1,class:e.cx("subtitle")},e.ptm("subtitle")),[K(e.$slots,"subtitle")],16)):C("",!0)],16)):C("",!0),I("div",z({class:e.cx("content")},e.ptm("content")),[K(e.$slots,"content")],16),e.$slots.footer?(a(),P("div",z({key:1,class:e.cx("footer")},e.ptm("footer")),[K(e.$slots,"footer")],16)):C("",!0)],16)],16)}Me.render=mt;const Ie=F({__name:"BlogPostSectionTitle",props:{class:{},alignment:{},isExpandable:{type:Boolean},isExpanded:{type:Boolean},isSubTitle:{type:Boolean}},emits:["click"],setup(e){const d=e;return(n,u)=>(a(),P("div",{class:q(["font-bold",{"text-lg md:text-2xl":!n.isSubTitle},{"hover:underline cursor-pointer":n.isExpandable},d.class])},[I("div",{class:q({block:!n.alignment,flex:!!n.alignment,"justify-start":n.alignment==="left","justify-center":n.alignment==="center","justify-end":n.alignment==="right"})},[I("span",{class:"flex",onClick:u[0]||(u[0]=m=>n.$emit("click"))},[n.isExpandable&&n.alignment==="right"?(a(),P("i",{key:0,class:q(["pi pi-angle-down animation",{"rotate-180":n.isExpanded}])},null,2)):C("",!0),K(n.$slots,"default"),n.isExpandable&&(n.alignment==="left"||n.alignment==="center")?(a(),P("i",{key:1,class:q(["pi pi-angle-down animation",{"rotate-180":n.isExpanded}])},null,2)):C("",!0)])],2)],2))}}),gt={class:"flex gap-3"},vt={class:"min-h-[50vh] flex flex-col"},yt={class:"flex justify-between h-fit mt-2 gap-2"},ft={class:"flex flex-wrap gap-3"},bt={class:"relative mt-5 min-h-[20vh] max-h-screen flex flex-col justify-end"},kt={class:"relative min-h-[20vh] max-h-full flex-grow"},ht={class:"w-full"},Ct={key:3,class:"w-full"},Pt={class:"flex justify-center mt-5"},St={class:"flex justify-center mt-3"},$t=F({__name:"BlogPostOverview",props:{post:{}},emits:["editClicked","deleteClicked"],setup(e){const d=e,n=ke(),u=ee(),m=he(),{routeLoading:s,routeLoadingId:S}=D(n),{publicUsers:B}=D(m),{isOwner:h}=D(u),$=r(d.post.archived),p=T(()=>{var t;return(t=d.post.allowedUserIds)!=null&&t.length?B.value.filter(l=>{var i;return(i=d.post.allowedUserIds)==null?void 0:i.includes(l.id)}):[]}),b=T(()=>{const t=Ce(d.post.date);return d.post.dateUpdated?t+` - updated ${Ce(d.post.dateUpdated)}`:t}),g=T(()=>{const t=[];return d.post.datePinned&&t.push({value:"Pinned",severity:"success",rounded:!1}),d.post.locked&&t.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),d.post.archived&&t.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),t}),c=T(()=>d.post.sections.length?d.post.sections[0]:null),k=()=>{const t=document.createElement("textarea"),{protocol:l,hostname:i,port:E}=window.location,w=`${l}//${i}`+(i==="localhost"?`:${E}`:"");t.value=`${w}#${Xe.BLOG.path}/${d.post.id}`,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),be.success("Copied link!")};return(t,l)=>(a(),U(fe,{id:t.post.id,class:q([{"min-h-[50vh]":!$.value},"border-4 border-transparent","!rounded-primary",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-900",t.post.opacitySecondary||"bg-opacity-50"]),title:t.post.title,subTitle:b.value,tags:g.value,loading:t.post.loading,isCollapsed:$.value,clickable:"",route:{name:o(H).BLOG_DETAILS,params:{postId:t.post.id}}},{right:R(()=>[I("div",gt,[$.value?o(h)?(a(),U(Be,{key:1,onEditClicked:l[0]||(l[0]=i=>t.$emit("editClicked")),onDeleteClicked:l[1]||(l[1]=i=>t.$emit("deleteClicked"))})):C("",!0):(a(),U(x,{key:0,class:"border-none h-fit",type:"neutral",icon:"pi pi-copy",onClick:k}))])]),default:R(()=>{var i;return[I("div",vt,[I("div",yt,[I("div",ft,[p.value.length?(a(),P(Q,{key:0},[v(o(ge),{class:"h-fit !p-0 !px-4 !py-1 bg-red-800 bg-opacity-50",icon:"pi pi-user",label:p.value[0].displayName,rounded:""},null,8,["label"]),p.value.length>1?(a(),U(o(ge),{key:0,class:"h-fit !p-0 !px-4 !py-1 bg-red-800 bg-opacity-50",icon:"pi pi-user",label:"You",rounded:""})):C("",!0),p.value.length>2?(a(),U(o(ge),{key:1,class:"h-fit !p-0 !px-4 !py-1 bg-red-800 bg-opacity-50",label:`${p.value.length-2} others`,rounded:""},null,8,["label"])):C("",!0)],64)):C("",!0)]),o(h)?(a(),P("div",{key:0,class:q(["flex justify-end ms-5",(i=t.post.allowedUserIds)!=null&&i.length?"flex-col md:flex-row":"flex-row"])},[v(Be,{onEditClicked:l[2]||(l[2]=E=>t.$emit("editClicked")),onDeleteClicked:l[3]||(l[3]=E=>t.$emit("deleteClicked"))})],2)):C("",!0)]),I("div",bt,[l[6]||(l[6]=I("div",{class:"absolute inset-0 rounded-primary bg-gradient-to-t from-neutral-500 to-transparent"},null,-1)),I("div",kt,[v(o(Me),{class:q(["z-10 min-h-[20vh] p-5 text-neutral-300",t.post.colorPrimary,t.post.opacityPrimary||"bg-opacity-50"])},{header:R(()=>[t.post.coverImageUrl?(a(),U(Ke,{key:0,post:t.post,"cover-image-url":t.post.coverImageUrl,thumb:""},null,8,["post","cover-image-url"])):C("",!0)]),content:R(()=>[I("div",{class:q(["flex relative",t.post.countdown||t.post.alignment==="center"?"flex justify-between":""])},[I("div",ht,[t.post.countdown?(a(),U(Pe,{key:0,time:new Date(t.post.countdown).getTime(),direction:"down",alignment:t.post.alignment},null,8,["time","alignment"])):C("",!0),t.post.timer?(a(),U(Pe,{key:1,time:new Date(t.post.timer).getTime(),direction:"up",alignment:t.post.alignment},null,8,["time","alignment"])):C("",!0),t.post.description?(a(),U(Qe,{key:2,description:t.post.description.substring(0,150)+(t.post.description.length>=150?"...":"")},null,8,["description"])):c.value?(a(),P("div",Ct,[c.value.title?(a(),U(Ie,{key:0,alignment:c.value.alignment},{default:R(()=>[Se(ue(c.value.subTitle?c.value.title:`${c.value.title}...`),1)]),_:1},8,["alignment"])):C("",!0),c.value.subTitle?(a(),U(Ie,{key:1,alignment:c.value.alignment,"is-sub-title":""},{default:R(()=>[Se(ue(c.value.subTitle)+"... ",1)]),_:1},8,["alignment"])):C("",!0)])):C("",!0)])],2)]),_:1},8,["class"])])]),I("div",Pt,[v(x,{class:"w-full md:w-1/2",type:"neutral",label:"Read more",loading:o(s)===o(H).BLOG_DETAILS&&o(S)===t.post.id,onClick:l[4]||(l[4]=E=>o($e).push({name:o(H).BLOG_DETAILS,params:{postId:t.post.id}}))},null,8,["loading"])]),I("div",St,[I("p",{class:q(t.post.reactions.length?"text-yellow-400 hover:text-yellow-500 cursor-pointer":"text-neutral-200"),onClick:l[5]||(l[5]=E=>o($e).push({name:o(H).BLOG_DETAILS,params:{postId:t.post.id}}))},ue(t.post.reactions.length)+" replies ",3)])])]}),_:1},8,["id","class","title","subTitle","tags","loading","isCollapsed","route"]))}}),wt={key:0,class:"grid grid-cols-6 mb-5 gap-5"},Ut={key:1,class:"grid grid-cols-6 lg:hidden mb-5"},Bt={class:"grid gap-4 md:gap-10 xl:gap-20"},It={key:2,class:"flex justify-center mt-5"},Et=F({__name:"BlogPosts",props:{single:{type:Boolean}},emits:["createClicked","editClicked","deleteClicked"],setup(e){const d=ee(),n=ne(),{blogPosts:u,visibleBlogPosts:m,isBlogPostsFetchLoading:s}=D(n),{firebaseUser:S,isLoggedIn:B,isOwner:h}=D(d),{fetchBlogPosts:$}=n;st();const p=r(),b=r(),g=r(),c=async t=>{var l;u.value.visibility!==t&&(u.value.data[t].length||await $((l=S.value)==null?void 0:l.uid,{visibility:t}),u.value.visibility=t,u.value.isLastPage=!1,de(p.value))},k=async()=>{var l;const t=m.value.length;await $((l=S.value)==null?void 0:l.uid),m.value[t]&&de(b.value[t])};return De(()=>{u.value.loadedOnce||(B.value?c("private"):u.value.visibility!=="public"&&c("public"),u.value.loadedOnce=!0)}),se(()=>{var t;return(t=b.value)==null?void 0:t.length},()=>{var t;if((t=b.value)!=null&&t.length&&g.value){const l=m.value.find(i=>i.id===g.value);if(l){const i=m.value.indexOf(l);de(b.value[i]),g.value=void 0}}}),(t,l)=>(a(),P("div",{ref_key:"container",ref:p},[o(B)?(a(),P("div",wt,[v(x,{class:"hidden lg:block col-span-2",type:"secondary",outlined:o(u).visibility!=="public",loading:o(u).isLoading.public.fetch,label:"Public Posts",onClick:l[0]||(l[0]=i=>c("public"))},null,8,["outlined","loading"]),o(h)?(a(),U(x,{key:0,class:"col-span-full md:col-start-2 md:col-span-4 lg:col-start-3 lg:col-span-2",type:"tertiary",label:"New Post",onClick:l[1]||(l[1]=i=>t.$emit("createClicked"))})):C("",!0),v(x,{class:"hidden lg:block col-start-5 col-span-2",type:"secondary",outlined:o(u).visibility!=="private",loading:o(u).isLoading.private.fetch,label:"Private Posts",onClick:l[2]||(l[2]=i=>c("private"))},null,8,["outlined","loading"])])):C("",!0),o(B)?(a(),P("div",Ut,[v(x,{class:"col-span-3 md:col-start-2 md:col-span-2 rounded-r-none",type:"secondary",outlined:o(u).visibility!=="public",loading:o(u).isLoading.public.fetch,label:"Public Posts",onClick:l[3]||(l[3]=i=>c("public"))},null,8,["outlined","loading"]),v(x,{class:"col-span-3 md:col-start-4 md:col-span-2 rounded-l-none",type:"secondary",outlined:o(u).visibility!=="private",loading:o(u).isLoading.private.fetch,label:"Private Posts",onClick:l[4]||(l[4]=i=>c("private"))},null,8,["outlined","loading"])])):C("",!0),I("div",Bt,[o(m).length?(a(!0),P(Q,{key:0},Ve(o(m),(i,E)=>(a(),P("div",{key:i.id,ref_for:!0,ref_key:"posts",ref:b},[E===0||i.datePinned?(a(),U(Le,{key:0,post:i,onEditClicked:w=>t.$emit("editClicked",i),onDeleteClicked:w=>t.$emit("deleteClicked",i)},null,8,["post","onEditClicked","onDeleteClicked"])):(a(),U($t,{key:1,post:i,onEditClicked:w=>t.$emit("editClicked",i),onDeleteClicked:w=>t.$emit("deleteClicked",i)},null,8,["post","onEditClicked","onDeleteClicked"]))]))),128)):o(s)?(a(),U(fe,{key:1,class:"!bg-neutral-600 !bg-opacity-40 !rounded-primary",title:"Loading..."})):(a(),U(fe,{key:2,class:"!bg-red-900 !bg-opacity-40 !rounded-primary",title:"No posts"}))]),o(u).isLastPage?C("",!0):(a(),P("div",It,[v(x,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:o(m).length>0&&o(s),label:"Load more posts",onClick:k},null,8,["loading"])]))],512))}}),Tt=F({__name:"BlogPostContentDialog",emits:["update:selected","error"],setup(e,{expose:d,emit:n}){const u=n,m=te(),{blogPostMutation:s}=D(m),S=r(),B=r(),h=T(()=>[B.value].some(p=>!!p));return d({test:async()=>{await Promise.all([S.value.test()]),u("error",h.value)}}),(p,b)=>(a(),P(Q,null,[v(Ze,{ref_key:"title",ref:S,name:"title",label:"Title",placeholder:"Amazing Post",modelValue:o(s).title,"onUpdate:modelValue":b[0]||(b[0]=g=>o(s).title=g),error:B.value,"onUpdate:error":b[1]||(b[1]=g=>B.value=g),rules:[o(Oe).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),v(et,{modelValue:o(s).content,"onUpdate:modelValue":b[2]||(b[2]=g=>o(s).content=g)},null,8,["modelValue"])],64))}}),Dt=F({__name:"BlogPostSettingsDialog",emits:["error"],setup(e,{expose:d,emit:n}){const u=n,m=ee(),s=he(),S=te(),{publicUser:B,publicUsers:h}=D(s),{firebaseUser:$}=D(m),{blogPostMutation:p}=D(S),{allowedPublicUsers:b}=s,g=r(),c=r(),k=r(),t=r(),l=T({get(){return!!p.value.datePinned},set(L){p.value.datePinned=L?new Date:null}}),i=r(),E=r(),w=r(),V=r(),O=T(()=>[i.value,E.value,w.value,V.value].some(L=>!!L)),f=T(()=>h.value.map(({id:L,displayName:M})=>({value:L,label:M}))),y=r([]),oe=L=>{p.value.allowedUserIds=L},le=async()=>{p.value.allowedUserIds.length&&!y.value.length&&(i.value="Invalid user ID's"),await Promise.all([c.value.test(),k.value.test(),t.value.test()]),u("error",O.value)};return se(()=>p.value.allowedUserIds,async L=>{y.value=await b(L)},{immediate:!0}),d({test:le}),(L,M)=>(a(),P(Q,null,[v(Y,{ref_key:"allowedUsers",ref:g,name:"allowedUserIds",label:"Allowed users",placeholder:"This post is public","model-value":o(p).allowedUserIds,error:i.value,"onUpdate:error":M[0]||(M[0]=_=>i.value=_),"onUpdate:arrayValue":oe,options:[{value:o($).uid,label:o(B).displayName},...f.value.filter(({value:_})=>{var ae;return _!==((ae=o($))==null?void 0:ae.uid)})],multiple:""},null,8,["model-value","error","options"]),v(pe,{ref_key:"pinned",ref:t,name:"pinned",label:"Pinned",modelValue:l.value,"onUpdate:modelValue":M[1]||(M[1]=_=>l.value=_)},null,8,["modelValue"]),v(pe,{ref_key:"locked",ref:c,name:"locked",label:"Locked for commenting",modelValue:o(p).locked,"onUpdate:modelValue":M[2]||(M[2]=_=>o(p).locked=_)},null,8,["modelValue"]),v(pe,{ref_key:"archived",ref:k,name:"archived",label:"Archived",modelValue:o(p).archived,"onUpdate:modelValue":M[3]||(M[3]=_=>o(p).archived=_)},null,8,["modelValue"])],64))}}),Vt=F({__name:"BlogPostStylingDialog",emits:["error"],setup(e,{expose:d,emit:n}){const u=n,m=te(),{blogPostMutation:s}=D(m),S=r(),B=r(),h=r(),$=r(),p=r(),b=r(),g=r(),c=r(),k=r(),t=r(),l=r(),i=r(),E=T(()=>[g.value,c.value,k.value,t.value,l.value,i.value].some(O=>!!O)),w=T(()=>tt(we.find(O=>O.value===s.value.colorPrimary)));return d({test:async()=>{await Promise.all([S.value.test(),B.value.test(),h.value.test(),$.value.test(),p.value.test(),b.value.test()]),u("error",E.value)}}),(O,f)=>(a(),P(Q,null,[v(Y,{ref_key:"colorPrimary",ref:S,name:"colorPrimary",label:"Primary Style",modelValue:o(s).colorPrimary,"onUpdate:modelValue":f[0]||(f[0]=y=>o(s).colorPrimary=y),error:g.value,"onUpdate:error":f[1]||(f[1]=y=>g.value=y),options:o(we),rules:[o(Oe).Required]},null,8,["modelValue","error","options","rules"]),v(Y,{ref_key:"opacityPrimary",ref:$,name:"opacityPrimary",label:"Primary Opacity",modelValue:o(s).opacityPrimary,"onUpdate:modelValue":f[2]||(f[2]=y=>o(s).opacityPrimary=y),error:t.value,"onUpdate:error":f[3]||(f[3]=y=>t.value=y),options:o(ce)},null,8,["modelValue","error","options"]),v(Y,{ref_key:"colorSecondary",ref:B,name:"colorSecondary",label:"Secondary Style",modelValue:o(s).colorSecondary,"onUpdate:modelValue":f[4]||(f[4]=y=>o(s).colorSecondary=y),error:c.value,"onUpdate:error":f[5]||(f[5]=y=>c.value=y),options:w.value},null,8,["modelValue","error","options"]),v(Y,{ref_key:"opacitySecondary",ref:p,name:"opacitySecondary",label:"Secondary Opacity",modelValue:o(s).opacitySecondary,"onUpdate:modelValue":f[6]||(f[6]=y=>o(s).opacitySecondary=y),error:l.value,"onUpdate:error":f[7]||(f[7]=y=>l.value=y),options:o(ce)},null,8,["modelValue","error","options"]),v(Y,{ref_key:"colorTertiary",ref:h,name:"colorTertiary",label:"Tertiary Style",modelValue:o(s).colorTertiary,"onUpdate:modelValue":f[8]||(f[8]=y=>o(s).colorTertiary=y),error:k.value,"onUpdate:error":f[9]||(f[9]=y=>k.value=y),options:o(ot)},null,8,["modelValue","error","options"]),v(Y,{ref_key:"opacityTertiary",ref:b,name:"opacityTertiary",label:"Tertiary Opacity",modelValue:o(s).opacityTertiary,"onUpdate:modelValue":f[10]||(f[10]=y=>o(s).opacityTertiary=y),error:i.value,"onUpdate:error":f[11]||(f[11]=y=>i.value=y),options:o(ce)},null,8,["modelValue","error","options"])],64))}}),Ot=F({__name:"BlogPostDialog",emits:["scroll-to-updated"],setup(e,{emit:d}){const n=d,u=ee(),m=ne(),s=te(),{firebaseUser:S}=D(u),{isBlogPostsMutationLoading:B}=D(m),{createBlogPost:h,updateBlogPost:$,deleteFilesOfBlogPost:p,toggleBlogPostVisibility:b}=m,{getBlogPostMutationContent:g,getBlogPostMutationStyling:c,getBlogPostMutationSettings:k}=s,{isOpen:t,blogPostOriginal:l,blogPostMutationId:i,blogPostMutation:E,hasBlogPostMutationContentChanges:w,hasBlogPostMutationStylingChanges:V,hasBlogPostMutationSettingsChanges:O}=D(s),f=r(),y=r(),oe=r(),le=r(),L=r(!1),M=r(!1),_=r(!1),ae=T(()=>{var A,N,j,X,Z,G;return!!((N=(A=l.value)==null?void 0:A.allowedUserIds)!=null&&N.length)&&!((j=k().allowedUserIds)!=null&&j.length)||!((Z=(X=l.value)==null?void 0:X.allowedUserIds)!=null&&Z.length)&&!!((G=k().allowedUserIds)!=null&&G.length)}),_e=T(()=>{const A=[];return w.value&&A.push("Content"),V.value&&A.push("Styling"),O.value&&A.push("Settings"),A.length?"Update "+Ue(A):void 0}),ie=T(()=>lt(l.value)),Ae=async()=>{var A,N,j,X,Z;if(await Promise.all([y.value.test(),oe.value.test(),le.value.test()]),!(L.value||M.value||_.value))if(!l.value)await h(i.value,E.value,(A=S.value)==null?void 0:A.uid)&&(s.close(),n("scroll-to-updated",i.value));else if(ae.value){const G=i.value;s.isOpen=!1,await b(G,W.convert(E.value),l.value.reactions,E.value.allowedUserIds.length?"private":"public",(N=S.value)==null?void 0:N.uid)&&(s.close(),be.success("Successfully updated Post Visibility"),n("scroll-to-updated",G))}else{const G=i.value;let J=[];w.value&&J.push(await $(G,g(),ie.value,(j=S.value)==null?void 0:j.uid)),V.value&&J.push(await $(G,c(),ie.value,(X=S.value)==null?void 0:X.uid)),O.value&&(J.push(await $(G,k(),ie.value,(Z=S.value)==null?void 0:Z.uid)),n("scroll-to-updated",G)),J=J.filter(Re=>typeof Re=="string"),J.length&&(be.success(`Successfully updated Post ${Ue(J)}`),s.close())}},Ne=async()=>{p(E.value,l.value??void 0),s.close()};return se(E,()=>{s.isMutationEqual()},{deep:!0}),(A,N)=>(a(),U(Ee,{isOpen:o(t),title:o(l)?"Update Post":"Create Post",description:o(l)?"Update this post":"Create a new post","confirm-text":o(l)?_e.value:"Create","confirm-loading":o(B),onConfirm:Ae,onCancel:Ne},{default:R(()=>[I("form",{ref_key:"dialog",ref:f,class:"pt-6 mb-4 xl:px-16"},[o(t)?(a(),U(o(at),{key:0,"active-index":0,onTabOpen:o(nt)},{default:R(()=>[v(o(me),{header:"Content"},{default:R(()=>[v(Tt,{ref_key:"content",ref:y,onError:N[0]||(N[0]=j=>L.value=j)},null,512)]),_:1}),v(o(me),{header:"Styling"},{default:R(()=>[v(Vt,{ref_key:"styling",ref:oe,onError:N[1]||(N[1]=j=>M.value=j)},null,512)]),_:1}),v(o(me),{header:"Settings"},{default:R(()=>[v(Dt,{ref_key:"settings",ref:le,onError:N[2]||(N[2]=j=>_.value=j)},null,512)]),_:1})]),_:1},8,["onTabOpen"])):C("",!0)],512)]),_:1},8,["isOpen","title","description","confirm-text","confirm-loading"]))}}),Lt={class:"grid mt-10 md:mt-15"},Mt={class:"grid justify-center"},_t={class:"text-lg md:text-xl text-white"},At=["innerHTML"],Nt={class:"grid my-5 xl:px-20"},Rt=F({__name:"Blog",setup(e){const d=Te(),n=ke(),u=he(),m=ne(),s=te(),{menuItems:S,content:B}=D(n),{publicUser:h}=D(u),{deleteBlogPost:$}=m,p=r(null),b=r(),g=r(!1),c=r(d.currentRoute.value.params.postId),k=T(()=>{var w;return h.value?[...B.value.blogDescriptionUser.map(V=>V.replace("%USER%",h.value.displayName||"Unknown user")),...((w=S.value.find(V=>V.id==="nfNQM4SMESU2VOkJtcgY"))==null?void 0:w.description)||[]]:B.value.blogDescriptionGuest}),t=()=>{s.openWith(null)},l=w=>{s.openWith(w)},i=w=>{p.value=w,g.value=!0},E=async w=>{await $(w)&&(g.value=!1,p.value=null)};return se(d.currentRoute,w=>{c.value=w.params.postId}),(w,V)=>(a(),U(je,null,{content:R(()=>[I("div",Lt,[I("div",Mt,[(a(!0),P(Q,null,Ve(k.value,O=>(a(),P("h1",_t,[I("span",{innerHTML:O},null,8,At)]))),256))]),I("div",Nt,[c.value?(a(),U(ut,{key:0,onEditClicked:l,onDeleteClicked:i})):(a(),U(Et,{key:1,onCreateClicked:t,onEditClicked:l,onDeleteClicked:i})),v(Ot,{onScrollToUpdated:V[0]||(V[0]=O=>b.value=O)}),p.value?(a(),U(Ee,{key:2,title:"Delete Post",isOpen:g.value,description:[` Are you sure you want to delete this post called ' ${p.value.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{type:"danger",outlined:!0},onConfirm:V[1]||(V[1]=O=>E(p.value.id)),onCancel:V[2]||(V[2]=O=>g.value=!1)},null,8,["isOpen","description"])):C("",!0)])])]),_:1}))}}),qt=F({__name:"Blog",setup(e){return(d,n)=>(a(),U(Rt))}});export{qt as default};
