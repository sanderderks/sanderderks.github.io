import{d as le,b as D,c as me,h as l,a9 as c,D as b,f as o,y as P,e as g,i as oe,z as n,C as p,q as ve,T as ge,s as ae,v as fe,U as ce,g as F,w as i,aa as re,ab as O,ac as k,k as $,t as I,ad as C,ae as S,a4 as we,a5 as Ve,J as z,a6 as De,$ as be,af as te,ag as pe,a2 as ye,K as xe,ah as Ue,ai as Fe,M as Oe}from"../bundle.js";import{_ as ke}from"./c-Dialog.vue_vue_type_script_setup_true_lang-ChRuyxYJ.js";import{u as Ce}from"./c-useUsers-Rsmxr7ei.js";const Se={class:"flex flex-col gap-3 md:px-5"},Pe={class:"mt-3 flex justify-evenly font-bold"},he=le({__name:"PetLogDialogSection",props:{id:{},log:{}},emits:["error","delete"],setup(u,{expose:h,emit:m}){const y=m,x=n(),f=n(),w=n(),V=n(),L=p(()=>[w.value,V.value].some(e=>!!e));return h({test:async()=>{var e,d;await Promise.all([(e=x.value)==null?void 0:e.test(),(d=f.value)==null?void 0:d.test()]),y("error",L.value)}}),(e,d)=>(D(),me("div",Se,[l(c,{ref_key:"dateField",ref:x,id:u.id,name:"logDate",label:"Date",modelValue:u.log.date,"onUpdate:modelValue":d[0]||(d[0]=s=>u.log.date=s),error:w.value,"onUpdate:error":d[1]||(d[1]=s=>w.value=s),"without-time":""},null,8,["id","modelValue","error"]),l(b,{ref_key:"weightField",ref:f,id:u.id,name:"logWeight",label:"Weight (kg)","model-value":`${u.log.weight}`,"onUpdate:modelValue":d[2]||(d[2]=s=>u.log.weight=Number(s)),error:V.value,"onUpdate:error":d[3]||(d[3]=s=>V.value=s),rules:[o(P).Required,o(P).Numeric],"min-value":0,"input-props":{type:"number"}},null,8,["id","model-value","error","rules"]),g("div",Pe,[l(oe,{class:"w-full sm:w-2/3 md:w-1/2 xl:w-2/3",variant:"danger",outlined:"",label:"Delete",onClick:d[4]||(d[4]=s=>e.$emit("delete"))})])]))}}),Le={class:"pt-6 mb-4 xl:px-16 flex flex-col gap-3"},Be={class:"flex gap-5"},$e={class:"flex justify-center"},Ie={class:"basis-full lg:basis-1/2"},We=le({__name:"PetDialog",props:{isOpen:{type:Boolean},originalPet:{}},emits:["close"],setup(u,{emit:h}){const m=u,y=h,x=ve(),f=ge(),{isMutationLoading:w}=ae(f),{firebaseUser:V}=ae(x),{mappedUsers:L}=Ce(),B=r=>({name:{value:(r==null?void 0:r.name)??"",error:""},description:{value:(r==null?void 0:r.description)??"",error:""},coOwnerId:{value:(r==null?void 0:r.coOwnerId)??"",error:""},avatar:{value:(r==null?void 0:r.avatar)??"",error:""},dateOfBirth:{value:r!=null&&r.dateOfBirth?new Date(r.dateOfBirth):null,error:""},type:{value:(r==null?void 0:r.type)??"cat",error:""},breed:{value:(r==null?void 0:r.breed)??"",error:""},breedSize:{value:(r==null?void 0:r.breedSize)??"medium",error:""},gender:{value:(r==null?void 0:r.gender)??"male",error:""},weight:{value:r!=null&&r.weight?r.weight.toString():"",error:""},insideCat:{value:(r==null?void 0:r.insideCat)??!1,error:""},castrated:{value:(r==null?void 0:r.castrated)??!1,error:""},dewormingDate:{value:r!=null&&r.dewormingDate?new Date(r.dewormingDate):null,error:""},vetDate:{value:r!=null&&r.vetDate?new Date(r.vetDate):null,error:""},lastVaccinationDate:{value:r!=null&&r.lastVaccinationDate?new Date(r.lastVaccinationDate):null,error:""},nextVaccinationDate:{value:r!=null&&r.nextVaccinationDate?new Date(r.nextVaccinationDate):null,error:""},weightLog:{value:r!=null&&r.weightLog?r.weightLog.map(a=>({...a,date:new Date(a.date)})):[],error:{}}}),e=fe(B(m.originalPet)),d=p(()=>{var r,a;return((r=m.originalPet)==null?void 0:r.userId)??((a=V.value)==null?void 0:a.uid)??""}),s=p(()=>{var r;return new Ue({id:(r=m.originalPet)==null?void 0:r.id,userId:d.value,coOwnerId:e.coOwnerId.value,name:e.name.value,description:e.description.value,avatar:e.avatar.value,dateOfBirth:e.dateOfBirth.value,type:e.type.value,breed:e.breed.value,breedSize:e.breedSize.value,gender:e.gender.value,weight:isNaN(+e.weight.value)?null:+e.weight.value,insideCat:e.type.value==="cat"?e.insideCat.value:null,castrated:e.castrated.value,dewormingDate:e.dewormingDate.value,vetDate:e.vetDate.value,lastVaccinationDate:e.lastVaccinationDate.value,nextVaccinationDate:e.nextVaccinationDate.value,weightLog:e.weightLog.value.map(a=>new Fe(a.date,a.weight))})}),N=n(),E=n(),W=n(),j=n(),M=n(),R=n(),T=n(),q=n(),K=n(),A=n(),G=n(),H=n(),J=n(),Q=n(),X=n(),Y=n([]),Z=p(()=>!Oe(m.originalPet,s.value)),_=p(()=>{if(e.name.value)return e.name.value;switch(e.type.value){case"cat":return"Cat";case"dog":return"Dog";default:return"Pet"}}),ne=async()=>{var r,a,t;await Promise.all([N.value.test(),E.value.test(),W.value.test(),j.value.test(),M.value.test(),R.value.test(),(r=T.value)==null?void 0:r.test(),q.value.test(),(a=K.value)==null?void 0:a.test(),(t=A.value)==null?void 0:t.test(),G.value.test(),H.value.test(),Q.value.test(),X.value.test(),J.value.test()]);for(const v of Y.value)await(v==null?void 0:v.test());e.name.error||e.description.error||e.coOwnerId.error||e.avatar.error||e.dateOfBirth.error||e.type.error||e.breed.error||e.breedSize.error||e.gender.error||e.weight.error||e.insideCat.error||e.castrated.error||e.dewormingDate.error||e.vetDate.error||e.lastVaccinationDate.error||e.nextVaccinationDate.error||Object.values(e.weightLog.error).some(v=>!!v)||(m.originalPet?await f.updatePet(s.value):await f.createPet(s.value),y("close"))},ie=()=>{e.weightLog.value.push({date:new Date,weight:0})},ee=r=>e.weightLog.value.findIndex(a=>a.date.toString()===r),de=r=>{e.weightLog.value.splice(ee(r),1)},se=(r,a)=>{e.weightLog.error[ee(a)]=r},ue=()=>{y("close")};return ce(()=>[m.isOpen,m.originalPet],()=>{Object.assign(e,B(m.originalPet))}),(r,a)=>(D(),F(ke,{isOpen:u.isOpen,title:u.originalPet?"Update Pet":"Create Pet",description:"Keep in mind that pet data is visible to all authenticated users.","confirm-text":u.originalPet?Z.value?"Update":"Nothing changed":"Create","confirm-loading":o(w),"confirm-props":{disabled:!Z.value},onConfirm:ne,onCancel:ue},{default:i(()=>[g("form",Le,[l(b,{ref_key:"nameField",ref:N,id:"name",name:"name",label:"Name",placeholder:"Mogu",modelValue:e.name.value,"onUpdate:modelValue":a[0]||(a[0]=t=>e.name.value=t),error:e.name.error,"onUpdate:error":a[1]||(a[1]=t=>e.name.error=t),rules:[o(P).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),l(b,{ref_key:"descriptionField",ref:E,id:"description",name:"description",label:"Description",placeholder:"My cute pet.",modelValue:e.description.value,"onUpdate:modelValue":a[2]||(a[2]=t=>e.description.value=t),error:e.description.error,"onUpdate:error":a[3]||(a[3]=t=>e.description.error=t),"max-length":100},null,8,["modelValue","error"]),l(o(re),null,{default:i(()=>[l(o(O),{value:"details"},{default:i(()=>[l(o(k),null,{default:i(()=>[$(I(_.value)+"'s Details ",1)]),_:1}),l(o(C),{"pt:content":"flex flex-col gap-3"},{default:i(()=>[l(S,{name:"coOwnerId",label:"Co-owner",modelValue:e.coOwnerId.value,"onUpdate:modelValue":a[4]||(a[4]=t=>e.coOwnerId.value=t),error:e.coOwnerId.error,"onUpdate:error":a[5]||(a[5]=t=>e.coOwnerId.error=t),options:[{value:"",label:"No co-owner"},...o(L).filter(t=>t.value!==s.value.userId)]},null,8,["modelValue","error","options"]),l(c,{ref_key:"dateOfBirthField",ref:j,name:"dateOfBirth",label:"Date of birth",modelValue:e.dateOfBirth.value,"onUpdate:modelValue":a[6]||(a[6]=t=>e.dateOfBirth.value=t),error:e.dateOfBirth.error,"onUpdate:error":a[7]||(a[7]=t=>e.dateOfBirth.error=t),"without-time":""},null,8,["modelValue","error"]),l(S,{ref_key:"typeField",ref:M,name:"type",label:"Type",modelValue:e.type.value,"onUpdate:modelValue":a[8]||(a[8]=t=>e.type.value=t),error:e.type.error,"onUpdate:error":a[9]||(a[9]=t=>e.type.error=t),options:o(we)},null,8,["modelValue","error","options"]),l(b,{ref_key:"breedField",ref:R,id:"breed",name:"breed",label:"Breed",placeholder:e.type.value==="dog"?"Golden Retriever":"Maine Coone",modelValue:e.breed.value,"onUpdate:modelValue":a[10]||(a[10]=t=>e.breed.value=t),error:e.breed.error,"onUpdate:error":a[11]||(a[11]=t=>e.breed.error=t),"min-length":3,"max-length":50},null,8,["placeholder","modelValue","error"]),e.type.value==="dog"?(D(),F(S,{key:0,ref_key:"breedSizeField",ref:T,name:"breedSize",label:"Breed Size",modelValue:e.breedSize.value,"onUpdate:modelValue":a[12]||(a[12]=t=>e.breedSize.value=t),error:e.breedSize.error,"onUpdate:error":a[13]||(a[13]=t=>e.breedSize.error=t),options:o(Ve)},null,8,["modelValue","error","options"])):z("",!0),l(S,{ref_key:"genderField",ref:q,name:"gender",label:"Gender",modelValue:e.gender.value,"onUpdate:modelValue":a[14]||(a[14]=t=>e.gender.value=t),error:e.gender.error,"onUpdate:error":a[15]||(a[15]=t=>e.gender.error=t),options:o(De)},null,8,["modelValue","error","options"])]),_:1})]),_:1}),l(o(O),{value:"health"},{default:i(()=>[l(o(k),null,{default:i(()=>[$(I(_.value)+"'s Health ",1)]),_:1}),l(o(C),{"pt:content":"flex flex-col gap-3"},{default:i(()=>[e.weightLog.value.length?z("",!0):(D(),F(b,be({key:0,ref_key:"weightField",ref:K,name:"weight",label:"Weight (kg)",modelValue:e.weight.value,"onUpdate:modelValue":a[16]||(a[16]=t=>e.weight.value=t),error:e.weight.error,"onUpdate:error":a[17]||(a[17]=t=>e.weight.error=t)},e.weight.value?{rules:[o(P).Numeric],minValue:0}:void 0,{"input-props":{type:"number"}}),null,16,["modelValue","error"])),e.type.value==="cat"?(D(),F(te,{key:1,ref_key:"insideCatField",ref:A,name:"insideCat",label:"Inside Cat",modelValue:e.insideCat.value,"onUpdate:modelValue":a[18]||(a[18]=t=>e.insideCat.value=t)},null,8,["modelValue"])):z("",!0),l(te,{ref_key:"castratedField",ref:G,name:"castrated",label:"Castrated or Sterilized",modelValue:e.castrated.value,"onUpdate:modelValue":a[19]||(a[19]=t=>e.castrated.value=t)},null,8,["modelValue"]),l(c,{ref_key:"vetDateField",ref:J,name:"vetDate",label:"Last vet visit",modelValue:e.vetDate.value,"onUpdate:modelValue":a[20]||(a[20]=t=>e.vetDate.value=t),error:e.vetDate.error,"onUpdate:error":a[21]||(a[21]=t=>e.vetDate.error=t),"without-time":""},null,8,["modelValue","error"]),l(c,{ref_key:"lastVaccinationDateField",ref:Q,name:"lastVaccinationDate",label:"Last vaccination",modelValue:e.lastVaccinationDate.value,"onUpdate:modelValue":a[22]||(a[22]=t=>e.lastVaccinationDate.value=t),error:e.lastVaccinationDate.error,"onUpdate:error":a[23]||(a[23]=t=>e.lastVaccinationDate.error=t),"without-time":""},null,8,["modelValue","error"]),l(c,{ref_key:"nextVaccinationDateField",ref:X,name:"nextVaccinationDate",label:"Next vaccination",modelValue:e.nextVaccinationDate.value,"onUpdate:modelValue":a[24]||(a[24]=t=>e.nextVaccinationDate.value=t),error:e.nextVaccinationDate.error,"onUpdate:error":a[25]||(a[25]=t=>e.nextVaccinationDate.error=t),"without-time":""},null,8,["modelValue","error"]),l(c,{ref_key:"dewormingDateField",ref:H,name:"dewormingDate",label:"Last deworming date",modelValue:e.dewormingDate.value,"onUpdate:modelValue":a[26]||(a[26]=t=>e.dewormingDate.value=t),error:e.dewormingDate.error,"onUpdate:error":a[27]||(a[27]=t=>e.dewormingDate.error=t),"without-time":""},null,8,["modelValue","error"])]),_:1})]),_:1}),l(o(O),{value:"Weight Log"},{default:i(()=>[l(o(k),null,{default:i(()=>[...a[31]||(a[31]=[$(" Weight Log ",-1)])]),_:1}),l(o(C),{"pt:content":"flex flex-col gap-3"},{default:i(()=>[l(o(pe),{ref:"draggable",class:"flex flex-col gap-3",modelValue:e.weightLog.value,"onUpdate:modelValue":a[28]||(a[28]=t=>e.weightLog.value=t),itemKey:t=>t.date.toString(),handle:".drag-handle"},{item:i(({element:t,index:v})=>[l(o(re),null,{default:i(()=>[l(o(O),{value:"0"},{default:i(()=>[l(o(k),{class:"drag-handle"},{default:i(()=>[g("div",Be,[a[32]||(a[32]=g("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),g("p",null,I(o(ye)(t.date)),1)])]),_:2},1024),l(o(C),null,{default:i(()=>[l(he,{ref:U=>{Y.value[v]=U},id:t.date.toString(),log:t,onDelete:U=>de(t.date.toString()),onError:U=>se(U,t.date.toString())},null,8,["id","log","onDelete","onError"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),g("div",$e,[l(oe,{class:"w-1/2",variant:"green",label:"Add Log",onClick:ie})])]),_:1})]),_:1})]),_:1}),g("div",Ie,[l(xe,{ref_key:"avatarField",ref:W,id:"avatar",name:"avatar",label:"Avatar",modelValue:e.avatar.value,"onUpdate:modelValue":a[29]||(a[29]=t=>e.avatar.value=t),error:e.avatar.error,"onUpdate:error":a[30]||(a[30]=t=>e.avatar.error=t),"is-public":"","blog-post":null,"image-props":{class:"rounded-full"},"image-container-props":{class:"!h-64 !w-64"}},null,8,["modelValue","error"])])])]),_:1},8,["isOpen","title","confirm-text","confirm-loading","confirm-props"]))}});export{We as _};
