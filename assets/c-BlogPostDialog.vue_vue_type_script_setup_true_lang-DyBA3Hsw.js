import{a as H,am as J,s as x,l as ie,aw as ue,ax as ve,ay as ae,az as se,aA as A,aB as ce,q as F,z as i,d as O,u as de,G as le,b as P,g as I,_ as Q,f as e,R as M,$ as te,n as q,aC as fe,w as R,e as j,i as N,J as G,C as B,c as h,x as ye,h as d,D as pe,as as ge,y as E,O as D,Q as W,aD as be,aE as we,v as Pe,aF as Se,aG as ke,ap as z,aq as Ue,ar as xe,j as Ce,at as Ve,au as oe,aH as Re,U as Be,ab as L,ac as K,V as re,aI as Y,aJ as Te,aK as he,aL as Ie,a7 as $e,aM as Ee,a8 as X,a9 as Z,k as _,aa as ee}from"../bundle.js";import{_ as me}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{u as De}from"./c-useUsers-DiKbhbPK.js";const Oe=t=>{const s=H(),m=J(),{previousCurrentBlogPost:y,isBlogPostDatabaseActionActive:U}=x(s);let a=[];const n=i(),v=r=>{r.metadata.hasPendingWrites||U.value||(clearTimeout(n.value),n.value=setTimeout(async()=>{await s.fetchBlogPost(t.id,void 0,{loadingIndicator:!1}),s.checkBlogPostForUnreadReactions(y.value,!0)},200))};ie(async()=>{m.unread=m.unread.filter(S=>S.postId!==t.id);const r=ue(t),p=s.collections.blogPosts(r.isPrivate),g=m.collections.blogReactions(r.isPrivate),u=ve(p,t.id),f=ae(p,se("id","==",t.id)),k=ae(g,se("post","==",u));a.push(A(f,v)),a.push(A(k,v))}),ce(()=>{clearTimeout(n.value),a.forEach(r=>{r()})})},Ye=()=>{const t=H(),s=F(),m=J(),{visibleBlogPosts:y,isBlogPostDatabaseActionActive:U}=x(t),{isLoggedIn:a}=x(s);let n=[];const v=i(),r=p=>{p.metadata.hasPendingWrites||U.value||(clearTimeout(v.value),v.value=setTimeout(async()=>{y.value.length&&(await t.fetchBlogPosts({amount:y.value.length,loadingIndicator:!1}),t.checkBlogPostsForUnreadReactions())},200))};ie(()=>{m.unread=[],n.push(A(t.collections.blogPosts(!1),r)),n.push(A(m.collections.blogReactions(!1),r)),a.value&&(n.push(A(t.collections.blogPosts(!0),r)),n.push(A(m.collections.blogReactions(!0),r)))}),ce(()=>{clearTimeout(v.value),n.forEach(p=>{p()})})},Le={class:"flex flex-col gap-2"},ne=O({__name:"BlogReaction",props:{post:{},reaction:{}},setup(t){const s=t,m=de(),y=F(),U=le(),a=J(),{routeLoading:n,routeLoadingId:v}=x(m),{firebaseUser:r,isLoggedIn:p,isOwner:g}=x(y),{publicUsers:u}=x(U),{isDatabaseDeletionActive:f}=x(a),k=B(()=>u.value.find(C=>C.id===s.reaction.userId)),S=B(()=>r.value&&s.reaction.userId===r.value.uid||g.value);return(C,T)=>(P(),I(Q,{id:t.reaction.id,class:q(["p-5 w-full md:w-3/4 xl:w-2/3",t.post.colorTertiary,t.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":e(n)===e(M).USER_DETAILS&&e(v)===k.value?.id}},title:k.value?.displayName||"Unknown user",subTitle:e(te)(t.reaction.date),avatar:k.value?.avatar,route:e(p)?{name:e(M).USER_DETAILS,params:{userId:t.reaction.userId}}:void 0,avatarRoute:e(p)?{name:e(M).USER_DETAILS,params:{userId:t.reaction.userId}}:void 0,description:t.reaction.message},fe({_:2},[S.value?{name:"right",fn:R(()=>[j("div",Le,[S.value&&!t.post.locked?(P(),I(N,{key:0,variant:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:e(f),onClick:T[0]||(T[0]=V=>e(a).deleteBlogReaction(t.post,t.reaction.id))},null,8,["disabled"])):G("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"]))}}),Ae={class:"grid justify-items-center p-5 gap-5"},Me=O({__name:"BlogReactions",props:{post:{}},setup(t){const s=t,m=de(),y=F(),U=J(),{content:a}=x(m),{firebaseUser:n,isLoggedIn:v}=x(y),{isDatabaseCreationActive:r}=x(U),p=i(),g=i(!1),u=Pe({reaction:{value:"",error:""}}),f=B(()=>[...s.post.reactions].reverse()),k=B(()=>f.value.filter((V,b)=>b<3)),S=B(()=>f.value.filter((V,b)=>b>=3)),C=B(()=>s.post.locked||!v.value||r.value),T=async()=>{if(!r.value){if(await p.value.test(),!u.reaction.error&&n.value){const V=u.reaction.value;u.reaction.value="Replying...";const b=await U.createBlogReaction(s.post,new Se({userId:n.value.uid,postId:s.post.id,message:V}));u.reaction.value=b?"":V}ke()}};return(V,b)=>(P(),h("form",{action:"",onSubmit:ye(T,["prevent"])},[j("div",Ae,[!e(v)||t.post.reactions.filter(c=>c.userId===e(n).uid).length<20?(P(),I(Q,{key:0,class:q(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",t.post.colorTertiary||"bg-secondary-700",t.post.opacityTertiary||"bg-opacity-25"])},{default:R(()=>[d(pe,{class:"w-5/6",id:t.post.id,inputProps:{class:["!bg-neutral-900 rounded-primary border-none !placeholder-gray-300",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-600",t.post.opacitySecondary||"!bg-opacity-20",C.value?{"!bg-gray-900 !bg-opacity-50":!e(r)}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!e(v)&&!t.post.locked}],disabled:C.value,autocomplete:"off"},ref_key:"reaction",ref:p,name:"reaction",placeholder:t.post.locked?"Locked for comments":e(v)?"Reply":e(a).blogLoginGuest,modelValue:u.reaction.value,"onUpdate:modelValue":b[0]||(b[0]=c=>u.reaction.value=c),error:u.reaction.error,"onUpdate:error":b[1]||(b[1]=c=>u.reaction.error=c),rules:[e(E).Required],onClick:b[2]||(b[2]=()=>!e(v)&&!t.post.locked?e(ge).push({name:e(M).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):G("",!0),(P(!0),h(D,null,W(k.value,c=>(P(),I(ne,{post:t.post,reaction:c},null,8,["post","reaction"]))),256)),(P(!0),h(D,null,W(S.value,c=>be((P(),I(ne,{post:t.post,reaction:c},null,8,["post","reaction"])),[[we,g.value]])),256)),t.post.reactions.length>3?(P(),I(N,{key:1,outlined:"",icon:g.value?"pi pi-angle-up":"pi pi-angle-down",label:g.value?"Hide older reactions":"View older reactions",onClick:b[3]||(b[3]=c=>g.value=!g.value)},null,8,["icon","label"])):G("",!0)])],32))}}),qe={class:"flex flex-wrap justify-end h-fit gap-3"},je=O({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(t){return(s,m)=>(P(),h("div",qe,[d(N,{class:"min-w-80",label:"Edit",onClick:m[0]||(m[0]=y=>s.$emit("editClicked"))}),d(N,{class:"min-w-80",variant:"danger",outlined:"",label:"Delete",onClick:m[1]||(m[1]=y=>s.$emit("deleteClicked"))})]))}}),Ne={class:"flex justify-between h-fit mt-2 gap-2"},Ge={class:"flex flex-wrap gap-3"},Xe=O({__name:"BlogPost",props:{post:{}},setup(t){const s=t,m=Ce(),y=F(),U=le(),a=H(),n=z(),{publicUsers:v}=x(U),{firebaseUser:r,isOwner:p}=x(y),{deleteBlogPost:g}=a,u=i(!1);m.currentRoute.value.name!==M.BLOG&&Oe(s.post);const f=B(()=>s.post.allowedUserIds?.length?v.value.filter(c=>s.post.allowedUserIds?.includes(c.id)):[]),k=B(()=>{const c=te(s.post.date);return s.post.dateUpdated?c+` - updated ${te(s.post.dateUpdated)}`:c}),S=B(()=>{const c=[];return s.post.datePinned&&c.push({value:"Pinned",severity:"success",rounded:!1}),s.post.locked&&c.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),s.post.archived&&c.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),c}),C=()=>{n.openWith(s.post)},T=()=>{u.value=!0},V=async()=>{await g(s.post.id)&&(u.value=!1)},b=()=>{const c=document.createElement("textarea"),{protocol:$,hostname:w,port:o}=window.location,l=`${$}//${w}`+(w==="localhost"?`:${o}`:"");c.value=`${l}#${Ve.BLOG.path}/${s.post.id}`,document.body.appendChild(c),c.select(),document.execCommand("copy"),document.body.removeChild(c),oe.success("Copied link!")};return(c,$)=>(P(),h(D,null,[d(Q,{id:t.post.id,class:q(["border-4 border-transparent","!rounded-primary",t.post.colorSecondary||t.post.colorPrimary||"bg-secondary-900",t.post.opacitySecondary||"bg-opacity-50"]),title:t.post.title,subTitle:k.value,tags:S.value,clickable:"",route:{name:e(M).BLOG_DETAILS,params:{postId:t.post.id}}},{right:R(()=>[d(N,{class:"h-fit",variant:"neutral",icon:"pi pi-copy",text:"",onClick:b})]),default:R(()=>[j("div",Ne,[j("div",Ge,[(P(!0),h(D,null,W(f.value,w=>(P(),I(e(Ue),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:w.id===e(r)?.uid?"You":w.displayName,rounded:""},null,8,["label"]))),256))]),e(p)?(P(),h("div",{key:0,class:q(["flex justify-end ms-5",t.post.allowedUserIds?.length?"flex-col md:flex-row":"flex-row"])},[d(je,{onEditClicked:C,onDeleteClicked:T})],2)):G("",!0)]),d(Q,{class:q(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5 flex flex-col gap-3",t.post.colorPrimary,t.post.opacityPrimary||"bg-opacity-50"])},{default:R(()=>[(P(!0),h(D,null,W(t.post.content,w=>(P(),I(xe,{key:w.id,post:t.post,block:w},null,8,["post","block"]))),128))]),_:1},8,["class"]),d(Me,{post:t.post},null,8,["post"])]),_:1},8,["id","class","title","subTitle","tags","route"]),d(me,{title:"Delete Post",isOpen:u.value,description:[` Are you sure you want to delete this post called '${t.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:V,onCancel:$[0]||($[0]=w=>u.value=!1)},null,8,["isOpen","description"])],64))}}),Fe=O({__name:"BlogPostContentDialog",emits:["update:selected","error"],setup(t,{expose:s,emit:m}){const y=m,U=z(),{blogPostMutation:a}=x(U),n=i(),v=i(),r=B(()=>[v.value].some(g=>!!g));return s({test:async()=>{await Promise.all([n.value.test()]),y("error",r.value)}}),(g,u)=>(P(),h(D,null,[d(pe,{ref_key:"title",ref:n,class:"w-full",name:"title",label:"Title",placeholder:"Amazing Post",modelValue:e(a).title,"onUpdate:modelValue":u[0]||(u[0]=f=>e(a).title=f),error:v.value,"onUpdate:error":u[1]||(u[1]=f=>v.value=f),rules:[e(E).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),d(Re,{modelValue:e(a).content,"onUpdate:modelValue":u[2]||(u[2]=f=>e(a).content=f)},null,8,["modelValue"])],64))}}),ze=O({__name:"BlogPostSettingsDialog",emits:["error"],setup(t,{expose:s,emit:m}){const y=m,U=le(),a=z(),{blogPostMutation:n}=x(a),{allowedPublicUsers:v}=U,{mappedUsers:r}=De(),p=i(),g=i(),u=i(),f=i(),k=B({get(){return!!n.value.datePinned},set(w){n.value.datePinned=w?new Date:null}}),S=i(),C=i(),T=i(),V=i(),b=B(()=>[S.value,C.value,T.value,V.value].some(w=>!!w)),c=i([]),$=async()=>{n.value.allowedUserIds.length&&!c.value.length&&(S.value="Invalid user ID's"),await Promise.all([g.value.test(),u.value.test(),f.value.test()]),y("error",b.value)};return Be(()=>n.value.allowedUserIds,async w=>{c.value=await v(w)},{immediate:!0}),s({test:$}),(w,o)=>(P(),h(D,null,[d(L,{ref_key:"allowedUsers",ref:p,class:"w-full md:w-1/2",name:"allowedUserIds",label:"Allowed users",placeholder:"This post is public",modelValue:e(n).allowedUserIds,"onUpdate:modelValue":o[0]||(o[0]=l=>e(n).allowedUserIds=l),error:S.value,"onUpdate:error":o[1]||(o[1]=l=>S.value=l),options:e(r),multiple:""},null,8,["modelValue","error","options"]),d(K,{ref_key:"pinned",ref:f,class:"w-full md:w-1/2",name:"pinned",label:"Pinned",modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=l=>k.value=l)},null,8,["modelValue"]),d(K,{ref_key:"locked",ref:g,class:"w-full md:w-1/2",name:"locked",label:"Locked for commenting",modelValue:e(n).locked,"onUpdate:modelValue":o[3]||(o[3]=l=>e(n).locked=l)},null,8,["modelValue"]),d(K,{ref_key:"archived",ref:u,class:"w-full md:w-1/2",name:"archived",label:"Archived",modelValue:e(n).archived,"onUpdate:modelValue":o[4]||(o[4]=l=>e(n).archived=l)},null,8,["modelValue"])],64))}}),Qe=O({__name:"BlogPostStylingDialog",emits:["error"],setup(t,{expose:s,emit:m}){const y=m,U=z(),{blogPostMutation:a}=x(U),n=i(),v=i(),r=i(),p=i(),g=i(),u=i(),f=i(),k=i(),S=i(),C=i(),T=i(),V=i(),b=B(()=>[f.value,k.value,S.value,C.value,T.value,V.value].some(w=>!!w)),c=B(()=>he(re.find(w=>w.value===a.value.colorPrimary)));return s({test:async()=>{await Promise.all([n.value.test(),v.value.test(),r.value.test(),p.value.test(),g.value.test(),u.value.test()]),y("error",b.value)}}),(w,o)=>(P(),h(D,null,[d(L,{ref_key:"colorPrimary",ref:n,class:"w-full md:w-1/2",name:"colorPrimary",label:"Primary Style",modelValue:e(a).colorPrimary,"onUpdate:modelValue":o[0]||(o[0]=l=>e(a).colorPrimary=l),error:f.value,"onUpdate:error":o[1]||(o[1]=l=>f.value=l),options:e(re),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"opacityPrimary",ref:p,class:"w-full md:w-1/2",name:"opacityPrimary",label:"Primary Opacity",modelValue:e(a).opacityPrimary,"onUpdate:modelValue":o[2]||(o[2]=l=>e(a).opacityPrimary=l),error:C.value,"onUpdate:error":o[3]||(o[3]=l=>C.value=l),options:e(Y),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"colorSecondary",ref:v,class:"w-full md:w-1/2",name:"colorSecondary",label:"Secondary Style",modelValue:e(a).colorSecondary,"onUpdate:modelValue":o[4]||(o[4]=l=>e(a).colorSecondary=l),error:k.value,"onUpdate:error":o[5]||(o[5]=l=>k.value=l),options:c.value,rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"opacitySecondary",ref:g,class:"w-full md:w-1/2",name:"opacitySecondary",label:"Secondary Opacity",modelValue:e(a).opacitySecondary,"onUpdate:modelValue":o[6]||(o[6]=l=>e(a).opacitySecondary=l),error:T.value,"onUpdate:error":o[7]||(o[7]=l=>T.value=l),options:e(Y),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"colorTertiary",ref:r,class:"w-full md:w-1/2",name:"colorTertiary",label:"Tertiary Style",modelValue:e(a).colorTertiary,"onUpdate:modelValue":o[8]||(o[8]=l=>e(a).colorTertiary=l),error:S.value,"onUpdate:error":o[9]||(o[9]=l=>S.value=l),options:e(Te),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"opacityTertiary",ref:u,class:"w-full md:w-1/2",name:"opacityTertiary",label:"Tertiary Opacity",modelValue:e(a).opacityTertiary,"onUpdate:modelValue":o[10]||(o[10]=l=>e(a).opacityTertiary=l),error:V.value,"onUpdate:error":o[11]||(o[11]=l=>V.value=l),options:e(Y),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"])],64))}}),We={ref:"dialog",class:"pt-6 mb-4 xl:px-16"},Ze=O({__name:"BlogPostDialog",emits:["scroll-to-updated"],setup(t,{emit:s}){const m=s;F();const y=H(),U=Ie(),a=z(),{isBlogPostsMutationLoading:n}=x(y),{isOpen:v,blogPostOriginal:r,blogPostMutation:p,hasChanges:g}=x(a),u=i(),f=i(),k=i(),S=i(!1),C=i(!1),T=i(!1),V=B(()=>!!r.value?.allowedUserIds?.length&&!p.value.allowedUserIds?.length||!r.value?.allowedUserIds?.length&&!!p.value.allowedUserIds?.length),b=B(()=>ue(r.value)),c=async()=>{await Promise.all([u.value.test(),f.value.test(),k.value.test()]),!(S.value||C.value||T.value)&&(r.value?V.value?(a.isOpen=!1,await y.toggleBlogPostVisibility(r.value,p.value.allowedUserIds.length?"private":"public")&&(a.close(),oe.success("Successfully updated Post Visibility"),m("scroll-to-updated",p.value.id))):await y.updateBlogPost(p.value,b.value)&&(oe.success("Successfully updated Post"),a.close(),m("scroll-to-updated",p.value.id)):await y.createBlogPost(p.value)&&(a.close(),m("scroll-to-updated",p.value.id)))},$=async()=>{await U.deleteFilesOfBlogPost(p.value,r.value??void 0),a.close()};return(w,o)=>(P(),I(me,{isOpen:e(v),title:e(r)?"Update Post":"Create Post",description:e(r)?"Update this post":"Create a new post","confirm-text":e(r)?"Update":"Create","confirm-loading":e(n),"confirm-props":{disabled:!e(g)},onConfirm:c,onCancel:$},{default:R(()=>[j("form",We,[e(v)?(P(),I(e($e),{key:0,"active-index":0,onTabOpen:e(Ee)},{default:R(()=>[d(e(X),{value:"content"},{default:R(()=>[d(e(Z),null,{default:R(()=>[...o[3]||(o[3]=[_(" Content ",-1)])]),_:1}),d(e(ee),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:R(()=>[d(Fe,{ref_key:"content",ref:u,onError:o[0]||(o[0]=l=>S.value=l)},null,512)]),_:1})]),_:1}),d(e(X),{value:"styling"},{default:R(()=>[d(e(Z),null,{default:R(()=>[...o[4]||(o[4]=[_(" Styling ",-1)])]),_:1}),d(e(ee),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:R(()=>[d(Qe,{ref_key:"styling",ref:f,onError:o[1]||(o[1]=l=>C.value=l)},null,512)]),_:1})]),_:1}),d(e(X),{value:"settings"},{default:R(()=>[d(e(Z),null,{default:R(()=>[...o[5]||(o[5]=[_(" Settings ",-1)])]),_:1}),d(e(ee),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:R(()=>[d(ze,{ref_key:"settings",ref:k,onError:o[2]||(o[2]=l=>T.value=l)},null,512)]),_:1})]),_:1})]),_:1},8,["onTabOpen"])):G("",!0)],512)]),_:1},8,["isOpen","title","description","confirm-text","confirm-loading","confirm-props"]))}});export{Xe as _,Ze as a,je as b,Ye as u};
