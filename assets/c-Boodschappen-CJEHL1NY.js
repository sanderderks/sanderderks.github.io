import{b9 as Z,bs as ne,bt as oe,bg as le,bh as E,bu as se,ax as Y,bv as ie,bw as re,b5 as ue,be as ce,q as de,bx as pe,s as T,z as _,C as M,au as B,by as me,bz as ge,bA as X,d as R,bq as fe,U as ee,b as k,g as L,D as F,Y as ye,br as ve,v as he,w as h,f as a,e as C,h as o,ab as be,J as te,i as q,a7 as we,a8 as Ve,a9 as De,t as N,$ as K,aa as Be,a6 as ke,ad as Ce,E as _e,l as ze,c as J,O as W,I as Pe,_ as xe,ai as Ue,aj as $,k as S,n as $e}from"../bundle.js";import{_ as ae}from"./c-Dialog.vue_vue_type_script_setup_true_lang-BvpiYg2Q.js";import{_ as Le}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{u as Ne,D as qe,_ as Se}from"./c-useDateChart-DM47Wxlr.js";class O{id;name;size;category;buyLog;constructor({id:e,name:l,size:s,category:b,buyLog:u}={}){this.id=e??Z(),this.name=l??"",this.size=s??{value:0,unit:""},this.category=b??null,this.buyLog=u??[]}static deserialize(e){return new O({id:e.id,name:e.name,size:e.size,category:e.category??null,buyLog:e.buyLog.map(A.deserialize)})}serialize(){return{id:this.id,name:this.name,size:this.size,category:this.category,buyLog:this.buyLog.map(e=>e.serialize())}}clone(){return new O({id:this.id,name:this.name,size:{...this.size},category:this.category?{...this.category}:null,buyLog:this.buyLog.map(e=>e.clone())})}}class A{date;price;quantity;constructor(e,l,s){this.date=e??new Date,this.price=l??0,this.quantity=s??1}static deserialize(e){return new A(e.date.toDate(),e.price,e.quantity)}serialize(){return{date:ne.fromDate(this.date),price:this.price,quantity:this.quantity}}clone(){return new A(new Date(this.date.getTime()),this.price,this.quantity)}}function Fe(f){return f.map(Oe)}function Oe(f){return O.deserialize(f)}class je{async fetchMultiple(e){return oe(le(e,E.BOODSCHAPPEN))}async create(e,l){await se(Y(e,E.BOODSCHAPPEN,l.id),l)}async update(e,l){await ie(Y(e,E.BOODSCHAPPEN,l.id),{...l})}async delete(e,l){await re(Y(e,E.BOODSCHAPPEN,l))}}const I=new je,Q=ue("boodschappenStore",()=>{const f=ce(),e=de(),l=pe(),{firebaseUser:s}=T(e),{debug:b}=T(l),u=_([]),V=_(!1),y=_(!1),t=M(()=>u.value.reduce((i,v)=>{const r=v.category;return r&&!i.some(m=>m.id===r.id)&&i.push(r),i},[]));return{boodschappen:u,isFetchLoading:V,isMutationLoading:y,categories:t,$reset:()=>{u.value=[]},fetchBoodschappen:async()=>{if(!s.value){B.error("You must be logged in to fetch products.");return}try{V.value=!0;const i=await I.fetchMultiple(f);u.value=Fe(i)}catch(i){B.firebaseError(b.value,i)}finally{V.value=!1}},createBoodschap:async i=>{if(!s.value){B.error("You must be logged in to create products.");return}try{y.value=!0,await I.create(f,i.serialize()),me(u,i),B.success("Successfully created product")}catch(v){B.firebaseError(b.value,v)}finally{y.value=!1}},updateBoodschap:async i=>{if(!s.value){B.error("You must be logged in to update products.");return}try{y.value=!0,await I.update(f,i.serialize()),ge(u,i,"id"),B.success("Successfully updated product")}catch(v){B.firebaseError(b.value,v)}finally{y.value=!1}},deleteBoodschap:async i=>{if(!s.value){B.error("You must be logged in to delete products.");return}try{y.value=!0,u.value.find(r=>r.id===i)&&(await I.delete(f,i),u.value=u.value.filter(r=>r.id!==i),B.success("Successfully deleted product"))}catch(v){B.firebaseError(b.value,v)}finally{y.value=!1}}}}),Te=()=>{const f=Q(),{boodschappen:e}=T(f),l=M(()=>[...e.value].sort((t,c)=>{const p=u(t),g=u(c);return p===null&&g===null?0:p===null?1:g===null?-1:p.getTime()-g.getTime()})),s=t=>[...t.buyLog].filter(c=>Number(c.quantity)>0&&!Number.isNaN(c.date.getTime())).sort((c,p)=>c.date.getTime()-p.date.getTime()),b=t=>s(t).at(-1)?.date??null,u=(t,c=new Date)=>{const p=s(t),g=t.size.value;if(!Number.isFinite(g)||g<=0)return null;if(p.length<2)return null;let w=0,z=0;for(let D=0;D<p.length-1;D++){const x=p[D],n=(p[D+1].date.getTime()-x.date.getTime())/X;!Number.isFinite(x.quantity)||x.quantity<=0||n<=0||(w+=x.quantity*g,z+=n)}if(z<=0||w<=0)return null;const i=w/z;if(!Number.isFinite(i)||i<=0)return null;const v=p.at(-1);if(!v)return null;const r=v.quantity;if(!Number.isFinite(r)||r<=0)return null;const d=r*g/i;if(!Number.isFinite(d)||d<=0)return null;const P=new Date(v.date.getTime()+d*X);return P.getTime()<c.getTime()?c:P};return{sortedBoodschappen:l,getLatestPurchaseDate:b,getProjectedOutOfStockDate:u,getPricePerUnit:t=>{const c=s(t).at(-1);return!c||!Number.isFinite(c.price)||!Number.isFinite(c.quantity)||c.quantity<=0?null:c.price/c.quantity},getPriceIncreasePercentage:t=>{const c=s(t);if(c.length<2)return 0;const p=c.at(-1),g=c.at(-2);return!Number.isFinite(p.price)||!Number.isFinite(p.quantity)||!Number.isFinite(g.price)||!Number.isFinite(g.quantity)||g.quantity===0?0:(p.price/p.quantity-g.price/g.quantity)/(g.price/g.quantity)*100}}},G=R({__name:"NumberField",props:ve({id:{},name:{},label:{},placeholder:{},error:{},rules:{},inputProps:{},labelProps:{},minLength:{},maxLength:{},minValue:{},maxValue:{},compare:{},deleteButton:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const e=f,l=fe(f,"modelValue"),s=_("");function b(){l.value=parseFloat(s.value)||0}return ee(l,u=>{s.value=u.toString()},{immediate:!0}),(u,V)=>(k(),L(F,ye(e,{modelValue:s.value,"onUpdate:modelValue":V[0]||(V[0]=y=>s.value=y),"input-props":{...e.inputProps,type:"number"},onBlur:b}),null,16,["modelValue","input-props"]))}}),Ae={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ee={class:"flex gap-3"},Ie={class:"w-full flex gap-3"},Me={class:"flex gap-5"},Re={class:"flex flex-col gap-3"},He=R({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(f,{emit:e}){const l=f,s=e,b=Q(),{isMutationLoading:u,categories:V}=T(b),y=_(!1),t=he(p()),c=M(()=>[{value:null,label:"Geen categorie"},...V.value.map(r=>({value:r,label:r.label}))]);function p(){const r=l.selectedBoodschap?.clone()??new O;return{name:r.name,category:V.value.find(m=>m.id===r.category?.id)??null,size:r.size,buyLog:r.buyLog}}function g(){const r=l.selectedBoodschap?l.selectedBoodschap:new O;Object.assign(r,t),l.selectedBoodschap?b.updateBoodschap(r):b.createBoodschap(r),s("close")}function w(){s("close")}function z(){y.value=!0,t.category={id:Z(),label:""}}function i(){y.value=!1,t.category=null}function v(){t.buyLog.push(new A)}return ee(()=>l.isOpen,r=>{r?Object.assign(t,p()):y.value=!1},{immediate:!0}),(r,m)=>(k(),L(ae,{"is-open":f.isOpen,title:l.selectedBoodschap?`Bewerk ${l.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":l.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":a(u),onConfirm:g,onCancel:w},{default:h(()=>[C("div",Ae,[o(F,{name:"name",label:"Naam",modelValue:t.name,"onUpdate:modelValue":m[0]||(m[0]=d=>t.name=d)},null,8,["modelValue"]),C("div",Ee,[y.value?t.category?(k(),L(F,{key:1,class:"w-full",name:"category",label:"Categorie",modelValue:t.category.label,"onUpdate:modelValue":m[2]||(m[2]=d=>t.category.label=d)},null,8,["modelValue"])):te("",!0):(k(),L(be,{key:0,class:"w-full",name:"category",label:"Categorie",modelValue:t.category,"onUpdate:modelValue":m[1]||(m[1]=d=>t.category=d),options:c.value},null,8,["modelValue","options"])),y.value?(k(),L(q,{key:3,class:"h-fit place-self-end",icon:"pi pi-times","icon-only":"",variant:"neutral",onClick:i})):(k(),L(q,{key:2,class:"h-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",onClick:z}))]),C("div",Ie,[o(G,{name:"sizeValue",label:"Formaat",modelValue:t.size.value,"onUpdate:modelValue":m[3]||(m[3]=d=>t.size.value=d)},null,8,["modelValue"]),o(F,{name:"sizeUnit",label:"Eenheid",modelValue:t.size.unit,"onUpdate:modelValue":m[4]||(m[4]=d=>t.size.unit=d)},null,8,["modelValue"])]),m[7]||(m[7]=C("b",null,"Logboek",-1)),o(a(Ce),{ref:"draggable",class:"flex flex-col gap-3",modelValue:t.buyLog,"onUpdate:modelValue":m[5]||(m[5]=d=>t.buyLog=d),itemKey:d=>d.date.toString(),handle:".drag-handle"},{item:h(({element:d,index:P})=>[o(a(we),null,{default:h(()=>[o(a(Ve),{value:"0"},{default:h(()=>[o(a(De),{class:"drag-handle"},{default:h(()=>[C("div",Me,[m[6]||(m[6]=C("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),C("p",null,N(a(K)(d.date)),1)])]),_:2},1024),o(a(Be),null,{default:h(()=>[C("div",Re,[o(ke,{name:`buylog-date-${P}`,label:"Datum",modelValue:d.date,"onUpdate:modelValue":D=>d.date=D,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),o(G,{name:`buylog-quantity-${P}`,label:"Aantal",modelValue:d.quantity,"onUpdate:modelValue":D=>d.quantity=D},null,8,["name","modelValue","onUpdate:modelValue"]),o(G,{name:`buylog-price-${P}`,label:"Prijs",modelValue:d.price,"onUpdate:modelValue":D=>d.price=D},null,8,["name","modelValue","onUpdate:modelValue"]),o(q,{variant:"danger",outlined:"",label:"Delete",onClick:D=>t.buyLog.splice(P,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),o(q,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:v})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),Ye=R({__name:"ProductPriceChart",props:{product:{}},setup(f){const e=f,l=M(()=>e.product.buyLog.map(u=>({date:u.date,value:u.price/u.quantity}))),{headers:s,filteredData:b}=Ne(l,qe.MONTHS);return(u,V)=>(k(),L(Se,{headers:a(s),datasets:[{label:"Prijsverloop",fill:!1,borderColor:"orange",yAxisID:"y",tension:.4,data:a(b),spanGaps:!0}]},null,8,["headers","datasets"]))}}),Je={class:"flex gap-3"},Xe=R({__name:"Boodschappen",setup(f){const e=Q(),{isFetchLoading:l,isMutationLoading:s}=T(e),b=_e(Pe),{sortedBoodschappen:u,getLatestPurchaseDate:V,getPricePerUnit:y,getPriceIncreasePercentage:t,getProjectedOutOfStockDate:c}=Te(),p=b.greaterOrEqual("md"),g=_([]),w=_(null),z=_({name:{value:null,matchMode:"startsWith"},"category.label":{value:null,matchMode:"startsWith"}}),i=_(!1),v=_(!1);function r(){w.value=null,v.value=!0}function m(x){w.value=x,v.value=!0}function d(x){w.value=x,i.value=!0}function P(){w.value=null,v.value=!1}async function D(){w.value&&await e.deleteBoodschap(w.value.id),i.value=!1,w.value=null}return ze(()=>{e.fetchBoodschappen()}),(x,U)=>(k(),J(W,null,[o(Le,null,{content:h(()=>[o(xe,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"De Booschappen Tool",description:"Hiermee hoef je nooit meer een boodschappenlijst te maken. Je voegt alleen toe wanneer je iets koopt, en de tool berekent wanneer je weer iets moet kopen op basis van je aankoopgeschiedenis. Je kunt ook zien hoe de prijzen zich ontwikkelen.","description-props":{class:"text-white mb-5"}},{default:h(()=>[o(a(Ue),{value:a(u),expandedRows:g.value,"onUpdate:expandedRows":U[0]||(U[0]=n=>g.value=n),filters:z.value,"onUpdate:filters":U[1]||(U[1]=n=>z.value=n),tableStyle:"min-width: 40rem",loading:a(l),size:a(p)?void 0:"small",filterDisplay:"row"},{empty:h(()=>[...U[3]||(U[3]=[S(" Er zijn nog geen producten gevonden. ",-1)])]),expansion:h(({data:n})=>[o(Ye,{product:n},null,8,["product"])]),default:h(()=>[o(a($),{expander:"",style:{width:"5rem"}}),o(a($),{field:"name",header:"Naam"},{filter:h(({filterModel:n,filterCallback:j})=>[o(F,{name:"nameFilter",modelValue:n.value,"onUpdate:modelValue":H=>n.value=H,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:j},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),o(a($),{field:"category.label",header:"Categorie"},{filter:h(({filterModel:n,filterCallback:j})=>[o(F,{name:"categoryFilter",modelValue:n.value,"onUpdate:modelValue":H=>n.value=H,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:j},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),a(p)?(k(),L(a($),{key:0,field:"size.value",header:"Formaat"},{body:h(({data:n})=>[S(N(n.size.value)+" "+N(n.size.unit),1)]),_:1})):te("",!0),o(a($),{header:"Laatste aankoop"},{body:h(({data:n})=>[a(V)(n)?(k(),J(W,{key:1},[S(N(a(K)(a(V)(n))),1)],64)):(k(),J(W,{key:0},[S(" Nog niet gekocht ")],64))]),_:1}),o(a($),{header:"Voorraad aanvullen op"},{body:h(({data:n})=>[S(N(a(c)(n)?a(K)(a(c)(n)):"Onbekend"),1)]),_:1}),o(a($),{header:"Prijs"},{body:h(({data:n})=>[S(N(a(y)(n)?`â‚¬${a(y)(n).toFixed(2)}`:""),1)]),_:1}),o(a($),{header:"Prijsstijging"},{body:h(({data:n})=>[C("span",{class:$e(a(t)(n)>0?"text-red-500":a(t)(n)<0?"text-green-500":"")},N(a(t)(n)?`${a(t)(n).toFixed(2)}%`:""),3)]),_:1}),o(a($),{header:"Acties"},{body:h(({data:n})=>[C("div",Je,[o(q,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:a(s),onClick:j=>m(n)},null,8,["loading","onClick"]),o(q,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:a(s),onClick:j=>d(n)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","loading","size"]),o(q,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:a(s),onClick:r},null,8,["loading"])]),_:1})]),_:1}),o(He,{"is-open":v.value,selectedBoodschap:w.value,onClose:P},null,8,["is-open","selectedBoodschap"]),o(ae,{title:"Product verwijderen","is-open":i.value,description:[w.value?`Weet je zeker dat je het product '${w.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":a(s),onConfirm:D,onCancel:U[2]||(U[2]=n=>i.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{Xe as default};
