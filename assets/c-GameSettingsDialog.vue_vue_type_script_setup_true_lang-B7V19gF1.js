import{_ as xe}from"./c-Dialog.vue_vue_type_script_setup_true_lang-CWtsg3qw.js";import{aW as Ge,aX as de,s as X,w as E,a9 as we,f as R,o as Ne,aS as b,L as Te,aY as se,b8 as Ue,aZ as Me,b9 as _e,aV as Be,c as Fe,aU as q,b3 as Ye,b4 as je,b5 as Ze,d as ze,b6 as Ke,b7 as qe,l as ce,j as re,A as Xe,k as Je,m as Ae,h as Y,an as ve,U as Ve,T as Ce}from"../bundle.js";var Qe=(l=>(l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(Qe||{});const Ie={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var el=(l=>(l.STOCK_CLOSED="stock_closed",l.STOCK_OPEN="stock_open",l.PILE1="pile1",l.PILE2="pile2",l.PILE3="pile3",l.PILE4="pile4",l.PILE5="pile5",l.PILE6="pile6",l.PILE7="pile7",l.HEARTS="hearts",l.SPADES="spades",l.DIAMONDS="diamonds",l.CLUBS="clubs",l))(el||{}),ll=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.HAS_STARTED=1]="HAS_STARTED",l[l.HAS_FINISHED=2]="HAS_FINISHED",l))(ll||{});const sl={easy:.5,hard:1},Le=()=>{const l=ol();return Ue(l),{pile1:l.splice(0,1).map(n=>({...n,deck:"pile1"})),pile2:l.splice(0,2).map((n,f)=>f<1?{...n,hidden:!0,deck:"pile2"}:{...n,deck:"pile2"}),pile3:l.splice(0,3).map((n,f)=>f<2?{...n,hidden:!0,deck:"pile3"}:{...n,deck:"pile3"}),pile4:l.splice(0,4).map((n,f)=>f<3?{...n,hidden:!0,deck:"pile4"}:{...n,deck:"pile4"}),pile5:l.splice(0,5).map((n,f)=>f<4?{...n,hidden:!0,deck:"pile5"}:{...n,deck:"pile5"}),pile6:l.splice(0,6).map((n,f)=>f<5?{...n,hidden:!0,deck:"pile6"}:{...n,deck:"pile6"}),pile7:l.splice(0,7).map((n,f)=>f<6?{...n,hidden:!0,deck:"pile7"}:{...n,deck:"pile7"}),stock_closed:l.map(n=>({...n,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},al=Ge("patienceStore",()=>{const l=de(),{personalBest:n,highscorePosition:f}=X(l),{setPreviousHighscores:x,updateHighscores:U,sortHighscores:B}=l,y=E("hard"),k=E(0),D=E(0),O=E(0),p=E(0),I=E(0),ae=E(),J=E(!0),r=we(Le()),Q=R(()=>sl[y.value]),j=R(()=>Object.keys(r).flatMap(s=>r[s])),fe=1e3,te=10,pe=10,ne=R(()=>{const s=O.value%10===0?O.value:Math.floor(O.value/10)*10,a=D.value*te,o=I.value*te,u=s+a+o,S=p.value*pe;return Math.max(0,fe-(u-S))}),me=R(()=>{const s=Math.floor(O.value/60),a=O.value%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),ue=R(()=>r.hearts.length===13&&r.spades.length===13&&r.diamonds.length===13&&r.clubs.length===13);Ne(()=>{l.$init(b.PATIENCE),O.value&&k.value===1&&G()}),Te(ue,s=>{s&&k.value!==2&&(V(),k.value=2,N(),se(Me))});const he=()=>{V(),D.value=0,O.value=0,p.value=0,I.value=0,k.value=0,Object.assign(r,Le()),l.setPreviousHighscores()},ge=()=>{O.value=0,G(),k.value=1,setTimeout(()=>{g()},500)},G=()=>{ae.value&&V(),ae.value=setInterval(()=>{O.value++},1e3)},V=()=>{clearInterval(ae.value)},v=()=>{const s=r.stock_open;s.length&&(s.reverse(),w(s[0],!1,a=>{a.deck="stock_closed",a.hidden=!0,r.stock_closed.push(a)}),s.splice(0,s.length),H(1))},ee=s=>{const a=s.deck,o=j.value.filter(u=>u.selected);if(a==="stock_closed"){const u=r.stock_closed,S=u.indexOf(s);if(S===u.length-1){const $=y.value==="hard"?S-2:S,T=$<0?0:$,le=u.filter((L,ie)=>ie>=T);m(),d(le,"stock_open",L=>{L.hidden=!1}),H(0)}}else if(a==="stock_open"){const u=r.stock_open;u.indexOf(s)===u.length-1&&(s.selected=!s.selected,o.length&&w(o[0],!1))}else if(o.length){const u=o[0];u===s?w(s,!1):W(a)&&z(u,s)?s.value===u.value+1&&s.deck!==u.deck&&(d(o,a),u.deck==="stock_open"?H(2):H(4)):o.length===1&&K(a)&&Se(u,s)&&s.value===u.value-1&&(Z(u,a),H(3),u.hasBeenHome=!0)}else w(s,!0)},C=s=>{const a=j.value.filter(o=>o.selected);if(a.length){const o=a[0],u=o.deck;o.value===13&&(d(a,s),u==="stock_open"?H(2):W(o.deck)&&r[o.deck].every(S=>!S.hidden)?H(5):H(4))}},F=s=>{const a=j.value.filter(o=>o.selected);if(a.length===1){const o=a[0],u=o.type;!r[s].length&&u===s&&o.value===1&&(Z(o,s),H(3))}},w=(s,a,o)=>{const u=r[s.deck],S=u.indexOf(s);u.filter((T,le)=>le>=S).forEach(T=>{T.selected=a,o==null||o(T)})},m=()=>{j.value.forEach(s=>{s.selected=!1})},Z=(s,a)=>{const o=s.deck,u=r[o].indexOf(s);s.deck=a,s.selected=!1,r[a].push(s),r[o].splice(u,1),(W(o)||o==="stock_open")&&M(o)},d=(s,a,o)=>{const u=s[0],S=u.deck,$=r[S].indexOf(u);w(u,!1,T=>{T.deck=a,o==null||o(T),r[a].push(T)}),r[S].splice($,s.length),K(S)||M(S!=="stock_closed"?S:a)},h=s=>{if(!J.value)return!0;const a=r[s.type],o=a.length?a[a.length-1].value:0;if(s.value===o+1){const u=["hearts","spades","diamonds","clubs"],S=o<=1||u.every($=>{const T=r[$];return(T.length?T[T.length-1].value:0)>=o});if(o===0||S)return Z(s,s.type),s.hasBeenHome=!0,H(3),!0}return!1},g=()=>{if(J.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const a=r[s];if(a.length&&h(a[a.length-1]))return}},M=s=>{const a=r[s];if(a.length){const o=a[a.length-1],u=o.deck;o.hidden=!1,setTimeout(()=>{o.deck===u&&(h(o)||g())},500)}else setTimeout(()=>{g()},500)},H=s=>{switch(s!==5&&D.value++,s){case 0:{I.value+=2*Q.value;break}case 1:{I.value+=5*Q.value;break}case 2:{p.value+=10*Q.value;break}case 3:{p.value+=20*Q.value;break}}se(_e)},z=(s,a)=>s.color!==a.color,Se=(s,a)=>s.type===a.type,W=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),K=s=>["hearts","spades","diamonds","clubs"].includes(s),N=()=>{U({difficulty:y.value,score:ne.value,bonus:p.value,time:O.value,turns:D.value,penalty:I.value})};return{difficulty:y,gameStatus:k,score:ne,turns:D,time:O,bonus:p,penalty:I,cards:r,doAutocomplete:J,allCards:j,formattedTime:me,personalBest:n,highscorePosition:f,$reset:he,start:ge,shuffle:v,selectCard:ee,selectEmptyDeck:C,selectFinalDeck:F,deselectAllCards:m,isPlayDeck:W,isFinalDeck:K,setPreviousHighscores:x,updatePatienceHighscore:N,sortHighscores:B}},{persist:{enabled:!0}}),ol=()=>Object.keys(Ie).flatMap(l=>{const n=l,f=[];for(let x=0;x<13;x++){const U={type:n,label:Ie[n].label,color:Ie[n].color,value:x+1,hidden:!1,selected:!1,hasBeenHome:!1};f.push(U)}return f});var tl=(l=>(l[l.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",l[l.FINDING_OPPONENT=1]="FINDING_OPPONENT",l[l.HAS_STARTED=2]="HAS_STARTED",l[l.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",l[l.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",l[l.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",l[l.HAS_LOST=6]="HAS_LOST",l[l.HAS_FINISHED=7]="HAS_FINISHED",l))(tl||{}),nl=(l=>(l[l.NONE=0]="NONE",l[l.HAS_LOST_TILE=1]="HAS_LOST_TILE",l[l.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",l))(nl||{}),ul=(l=>(l[l.NONE=0]="NONE",l[l.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",l[l.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",l[l.LOSER=3]="LOSER",l))(ul||{}),il=(l=>(l[l.PLAYER=0]="PLAYER",l[l.OPPONENT=1]="OPPONENT",l))(il||{});const cl=l=>{for(let n=1;n<=6;n++)if(l.every(f=>f.value===n))return!0;return!1},Pe=()=>({0:[],1:[]}),rl=Ge("rainwormsStore",()=>{const l=de(),n=Be(),f=Fe(),{personalBest:x,highscorePosition:U}=X(l),{firebaseUser:B}=X(f),{onlineGames:y,onlineGamesLoading:k,onlineGameId:D,onlineGameCreatorId:O,onlineGameOpponentId:p,onlineGameOpponentActive:I,onlineGameChat:ae,isInitializingOnlineGame:J,isOnlineGameOwner:r,onlineGameOpponentName:Q}=X(n),{fetchOnlineGames:j,createOnlineGame:fe,continueOnlineGame:te,updateOnlineGame:pe,leaveOnlineGame:ne,deleteOnlineGame:me}=n,{setPreviousHighscores:ue,updateHighscores:he,sortHighscores:ge}=l,G=E(1),V=E(q.SOLO),v=E(0),ee=E(!1),C=E(0),F=E(0),w=E(0),m=E(0),Z=E(!1),d=E(ye()),h=E(De()),g=we(Pe()),M=R(()=>d.value.some(e=>e.isRolling)),H=R(()=>d.value.filter(e=>e.selected).some(e=>e.value===6)),z=R(()=>e=>d.value.some(t=>t.value===e&&t.selected)),Se=R(()=>h.value.some(e=>e.displayValue<=N.value)),W=R(()=>e=>m.value===(e??0)),K=R(()=>e=>{const t=g[e??0];return t.length?t[t.length-1]:null}),N=R(()=>{let e=0;return d.value.filter(t=>t.selected).forEach(t=>{e+=t.value===6?5:t.value}),e}),s=R(()=>e=>{let t=0;return g[e].forEach(c=>{t+=c.value}),t});Ne(()=>{l.$init(b.RAINWORMS),M.value&&d.value.forEach(e=>{e.isRolling=!1})}),Te(v,e=>{e===7?$e():V.value===q.SOLO&&(Z.value||m.value===1)&&We(m.value)}),Te([v,m,M],()=>{V.value===q.ONLINE&&$()},{deep:!0});const a=()=>{n.$reset(),V.value=q.SOLO,v.value=0,C.value=0,F.value=0,w.value=0,m.value=0,d.value=ye(),h.value=De(),Object.assign(g,Pe()),ue()},o=()=>{V.value=q.SOLO,v.value=2},u=e=>{B.value&&(V.value=q.ONLINE,v.value=2,n.$init(b.RAINWORMS,le,T,a),fe(e))},S=e=>{V.value=q.ONLINE,n.$init(b.RAINWORMS,le,T,a),te(e)},$=()=>{console.log("updateOnlineGameCustom.1"),!(!B.value||!p.value||m.value===1&&!ee.value&&!J.value)&&(console.log("updateOnlineGameCustom.2"),pe())},T=(e,t)=>({gameStatus:v.value,gameStatusActivator:C.value===0?e:t,activePlayer:m.value===0?e:t,dices:d.value,tiles:h.value,score:{[e]:g[0],[t]:g[1]}}),le=e=>{var c;console.log("updateLocalGameState.1");const t=(c=B.value)==null?void 0:c.uid;!t||m.value===0&&!J.value||(console.log("updateLocalGameState.2"),v.value=e.gameStatus,C.value=e.gameStatusActivator===t?0:1,m.value=e.activePlayer===t?0:1,d.value=e.dices,h.value=e.tiles,r.value?(g[0]=e.score[e.creatorId],g[1]=e.score[e.opponentId]):(g[0]=e.score[e.opponentId],g[1]=e.score[e.creatorId]))},L=e=>{if(!W.value(e))return;(v.value===2||v.value===5||v.value===6)&&d.value.forEach(c=>{c.selected=!1}),v.value=3;const t=l.diceRollSpeed*1e3;d.value.forEach(c=>{c.selected||(c.isRolling=!0,setTimeout(()=>{c.value=Ye(6),c.isRolling=!1,d.value.sort((_,i)=>_.value-i.value),!M.value&&v.value!==6&&He()&&Re(e)},je(t,t/3)))}),se(Ze)},ie=async()=>{for(;M.value;)await new Promise(e=>setTimeout(e,l.diceRollSpeed*1e3));return!0},He=()=>{const e=d.value.filter(t=>!t.selected&&!z.value(t.value));return!e.length||cl(e)&&e.every(t=>t.value!==6)&&d.value.filter(t=>t.selected).every(t=>t.value!==6)},Re=e=>{v.value=6,C.value=e??0,g[C.value].length?w.value=1:w.value=2,be(),h.value.length===0?v.value=7:Ee()},be=()=>{const e=g[m.value];if(e.length){const t=e.splice(e.length-1,1)[0];h.value.push(t),h.value.sort((c,_)=>c.displayValue-_.displayValue)}h.value.splice(h.value.length-1,1)},Oe=(e,t)=>{W.value(t)&&!M.value&&v.value===3&&!e.selected&&!z.value(e.value)&&(v.value=4,d.value.filter(c=>c.value===e.value).forEach(c=>{c.selected=!0}),se(_e))},oe=(e,t,c)=>{if(W.value(c)&&(v.value===3||v.value===4)){if(t){const _=g[m.value===0?1:0];_.splice(_.length-1,1)}else h.value=h.value.filter(_=>_.displayValue!==e.displayValue);g[m.value].push(e),h.value.length===0?v.value=7:(v.value=5,C.value=c??0,Ee()),se(_e)}},Ee=e=>{(Z.value||m.value===1||v.value!==6||e)&&(m.value===0?setTimeout(()=>{ee.value=!0,m.value=1,setTimeout(()=>{v.value=2,C.value=0,ee.value=!1},G.value*1e3)},e?0:G.value*1e3*2):setTimeout(()=>{m.value=0,setTimeout(()=>{v.value=2,C.value=1},G.value*1e3)},e?0:G.value*1e3*2))},We=async e=>{if(await new Promise(c=>setTimeout(c,5)),!W.value(e))return;const t=e===0?0:1;switch(v.value){case 2:{L(e);break}case 3:{await ie(),setTimeout(()=>{const c=d.value.filter(i=>!i.selected),_=K.value(t);if(_&&N.value<_.displayValue)for(let i=6;i>=1;i--){const A=c.filter(P=>P.value===i&&!z.value(i));if(A.length){const P=A.length*(i===6?5:i);if(N.value+P===_.displayValue){Oe(A[0],e);return}}}for(let i=6;i>=1;i--){const A=d.value.find(P=>P.value===i);if(A&&!z.value(i)){Oe(A,e);return}}},G.value*1e3);break}case 4:{setTimeout(()=>{const c=K.value(t),_=d.value.filter(i=>!i.selected).length;if(!_||N.value>=30){_?console.log(e,"i am rich"):console.log(e,"i can only pick a tile now");for(let i=N.value;i>=21;i--){const A=h.value.find(P=>P.displayValue===i);if(A){oe(A,!1,e);return}}_&&L(e)}if(h.value.every(i=>i.displayValue>N.value)&&c&&c.displayValue>N.value)console.log(e,"my score is too low"),L(e);else if(c&&c.displayValue===N.value)console.log(e,"i can steal"),oe(c,!0,e);else if(new Set(d.value.filter(i=>i.selected).map(i=>i.value)).size<=3)if(d.value.filter(i=>!i.selected).length<=2){console.log(e,"there aren't that much dices left");const i=h.value.filter(A=>A.displayValue>=N.value-5&&A.displayValue<=N.value).sort((A,P)=>P.displayValue-A.displayValue);i.length?(console.log(e,"i choose the highest score within 5 tiles"),oe(i[0],!1,e)):(console.log(e,"i choose to roll again"),L(e))}else console.log(e,"i have nothing to worry about"),L(e);else if(!H.value)console.log(e,"i am worrying and have no worm yet"),L(e);else{console.log(e,"if i can choose, i choose");const i=h.value.filter(A=>A.displayValue<=N.value).sort((A,P)=>P.displayValue-A.displayValue);i.length?(console.log(e,"i choose the highest score"),oe(i[0],!1,e)):(console.log(e,"i choose to roll again"),L(e))}},G.value*1e3);break}default:console.log(e,"DEFAULT",v.value)}},$e=()=>{const e=s.value(0),t=s.value(1);e>t?F.value=1:e===t&&Math.max(...g[0].map(c=>c.displayValue))>Math.max(...g[1].map(c=>c.displayValue))?F.value=2:F.value=3,(F.value===1||F.value===2)&&(ke(),se(Me))},ke=()=>{he({gameId:D.value??null,score:s.value(0)})};return{gameType:V,gameStatus:v,gameStatusLoading:ee,gameStatusActivator:C,finishStatus:F,loseStatus:w,activePlayer:m,isFullyAutomatic:Z,dices:d,tiles:h,score:g,robotSpeed:G,isRolling:M,hasWorm:H,hasAlreadyChosen:z,canSelectAnyTile:Se,canPlay:W,visibleTile:K,selectedDiceTotal:N,totalScore:s,personalBest:x,highscorePosition:U,onlineGames:y,onlineGamesLoading:k,onlineGameId:D,onlineGameCreatorId:O,onlineGameOpponentId:p,onlineGameOpponentActive:I,onlineGameChat:ae,isOnlineGameOwner:r,onlineGameOpponentName:Q,$reset:a,start:o,roll:L,hasFinishedRolling:ie,hasLostRound:He,loseTurn:Re,popLastTile:be,selectDice:Oe,selectTile:oe,passTurn:Ee,setPreviousHighscores:ue,updateRainwormsHighscore:ke,sortHighscores:ge,fetchOnlineGames:j,createOnlineGame:u,continueOnlineGame:S,updateOnlineGame:$,leaveOnlineGame:ne,deleteOnlineGame:me}},{persist:{enabled:!0}}),ye=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],De=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],fl=ze({__name:"GameSettingsDialog",props:Ke({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(l){const n=l,f=qe(l,"isOpen"),x=de(),{useAudio:U,diceRollSpeed:B}=X(de()),{robotSpeed:y}=X(rl()),{doAutocomplete:k}=X(al()),D=R(()=>{switch(n.gameId){case b.YAHTZEE:return"v5 (12-12-2024)";case b.RAINWORMS:return"v5 (12-12-2024)";case b.PATIENCE:return"v2 (16-12-2024)";case b.GUESS_THE_WORD:return"v2 (10-01-2025)";case b.CATAN:return"v1 (11-06-2025)";default:return"v0"}});return Ne(()=>{x.$init(n.gameId)}),(O,p)=>(re(),ce(xe,{isOpen:f.value,title:"Game Settings",description:O.gameId?`Current version: ${D.value}`:"General settings",cancelText:"Close",onCancel:p[4]||(p[4]=I=>f.value=!1)},{default:Xe(()=>[Je(Ve,{name:"useAudio",label:"Audio",modelValue:Y(U),"onUpdate:modelValue":p[0]||(p[0]=I=>ve(U)?U.value=I:null)},null,8,["modelValue"]),O.gameId===Y(b).PATIENCE?(re(),ce(Ve,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:Y(k),"onUpdate:modelValue":p[1]||(p[1]=I=>ve(k)?k.value=I:null)},null,8,["modelValue"])):Ae("",!0),O.gameId===Y(b).YAHTZEE||O.gameId===Y(b).RAINWORMS?(re(),ce(Ce,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:Y(B),"onUpdate:modelValue":p[2]||(p[2]=I=>ve(B)?B.value=I:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Ae("",!0),O.gameId===Y(b).RAINWORMS?(re(),ce(Ce,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:Y(y),"onUpdate:modelValue":p[3]||(p[3]=I=>ve(y)?y.value=I:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Ae("",!0)]),_:1},8,["isOpen","description"]))}});export{Qe as C,el as D,ul as F,tl as G,nl as L,il as P,fl as _,al as a,ll as b,rl as u};
