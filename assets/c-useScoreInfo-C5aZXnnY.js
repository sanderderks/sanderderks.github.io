import{d as R,j as J,b as s,c as r,g as $,_ as q,w as N,k,e as l,f as t,R as M,i as x,J as u,C as f,z as L,a0 as Q,G as W,bc as A,s as B,l as T,aF as K,U as X,h as D,W as Y,P as H,Q as Z,t as g,a2 as ee,n as te,q as se}from"../bundle.js";import{_ as oe}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"flex flex-wrap gap-3 mt-3 justify-center"},Ie=R({__name:"AddToLeaderboard",props:{isLoggedIn:{type:Boolean},isSolo:{type:Boolean},isGameOver:{type:Boolean},finalScore:{},personalBest:{},redirectRoute:{},showIf:{type:Boolean}},emits:["updateHighscore"],setup(n){const c=J();return(d,o)=>n.isGameOver?(s(),r("div",ne,[n.isLoggedIn?n.showIf!==!1&&n.isSolo&&n.finalScore>n.personalBest?(s(),$(x,{key:1,class:"w-full md:w-1/2",variant:"primary",onClick:o[1]||(o[1]=v=>d.$emit("updateHighscore"))},{default:N(()=>[...o[4]||(o[4]=[k(" Add To Leaderboard ",-1)])]),_:1})):u("",!0):(s(),$(q,{key:0,class:"w-full md:w-1/2 bg-primary-500 bg-opacity-50 !rounded-primary"},{default:N(()=>[o[2]||(o[2]=k(" Please ",-1)),l("a",{class:"cursor-pointer",onClick:o[0]||(o[0]=v=>t(c).push({name:t(M).LOGIN,params:{redirect:JSON.stringify({name:n.redirectRoute})}}))}," Login "),o[3]||(o[3]=k(" to add your score to the leaderboard. ",-1))]),_:1}))])):u("",!0)}}),ae=(n,c)=>{const d=L(0),o=f(()=>Q(n)),v=f(()=>(d.value+1)*c),y=f(()=>v.value-c),p=f(()=>d.value>0),m=f(()=>o.value.length>v.value),b=f(()=>o.value.filter((i,w)=>w>=y.value&&w<v.value));return{page:d,perPage:c,visibleData:b,hasPrevious:p,hasNext:m,$reset:()=>{d.value=0}}},le={class:"mt-5 flex flex-col items-center"},re={class:"w-full overflow-x-auto"},ie={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},ue={key:0},ce={key:0},de={key:1},fe={key:1},ve={key:0},he={key:1},me={key:2},ge={key:3},ye={key:2},pe={key:3},ke={key:4},be={colspan:"100%"},we=R({__name:"Highscores",props:{gameId:{},unit:{}},setup(n){const c=n,d=W(),o=A(),{publicUsers:v}=B(d),{allGameData:y,fetchLoading:p}=B(o),{fetchGameData:m,fetchHighscores:b,fetchScores:S}=o,i=L("highscores"),w=L(),V=f(()=>y.value[c.gameId].gameData[i.value]),{page:_,perPage:j,visibleData:h,hasPrevious:P,hasNext:G,$reset:O}=ae(()=>V.value,10),z=I=>{var e;return((e=v.value.find(a=>a.id===I))==null?void 0:e.displayName)??"Unknown"},U=I=>{O(),i.value=I},E=()=>{i.value==="highscores"?b():S()};return T(()=>{o.$init(c.gameId),m(),w.value=setInterval(()=>{m()},1e3*60*5)}),K(()=>{clearInterval(w.value)}),X(i,()=>{y.value[c.gameId].gameData[i.value].length||E()}),(I,e)=>(s(),r("div",le,[D(t(Y),{class:"w-full md:w-1/2"},{default:N(()=>[D(x,{class:"w-full",variant:"secondary",outlined:i.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=a=>U("highscores"))},null,8,["outlined"]),D(x,{class:"w-full",variant:"secondary",outlined:i.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=a=>U("scores"))},null,8,["outlined"])]),_:1}),l("div",re,[l("table",ie,[t(h).length?(s(),r("thead",ue,[l("tr",null,[e[4]||(e[4]=l("th",null,"Rank",-1)),e[5]||(e[5]=l("th",null,"User",-1)),e[6]||(e[6]=l("th",null,"Score",-1)),t(h).length&&t(h).some(a=>a.difficulty)?(s(),r("th",ce,"Difficulty")):u("",!0),e[7]||(e[7]=l("th",null,"Date",-1)),t(h).length&&t(h).some(a=>a.bonus)?(s(),r("th",de,"Bonus")):u("",!0)])])):u("",!0),t(h).length?(s(),r("tbody",fe,[(s(!0),r(H,null,Z(t(h),(a,F)=>(s(),r("tr",null,[l("th",null,g(F+1+t(_)*t(j)),1),l("th",null,g(z(a.userId??a.id)),1),l("td",null,[k(g(a.score)+" ",1),n.unit?(s(),r(H,{key:0},[k(g(n.unit),1),a.score!==1?(s(),r(H,{key:0},[k("s")],64)):u("",!0)],64)):u("",!0)]),a.difficulty?(s(),r("td",ve,g(a.difficulty),1)):t(h).some(C=>C.difficulty)?(s(),r("td",he)):u("",!0),l("td",null,g(t(ee)(a.date)),1),a.bonus?(s(),r("td",me,g(a.bonus),1)):t(h).some(C=>C.bonus)?(s(),r("td",ge)):u("",!0)]))),256))])):t(p)?(s(),r("tbody",ye,[...e[8]||(e[8]=[l("tr",null,[l("th",null,"Loading highscores...")],-1)])])):(s(),r("tbody",pe,[l("tr",null,[l("th",null,"There are no "+g(i.value==="highscores"?"highscores":"scores")+" yet.",1)])])),t(P)||t(G)?(s(),r("tfoot",ke,[l("tr",null,[l("td",be,[l("div",{class:te(["w-full p-2 flex",[t(P)?"justify-between":"justify-end"]])},[t(P)?(s(),$(x,{key:0,class:"w-fit",label:"Previous",variant:"neutral",onClick:e[2]||(e[2]=a=>_.value-=1)})):u("",!0),t(G)?(s(),$(x,{key:1,class:"w-fit",label:"Next",variant:"neutral",onClick:e[3]||(e[3]=a=>_.value+=1)})):u("",!0)],2)])])])):u("",!0)])])]))}}),$e=oe(we,[["__scopeId","data-v-b42fb3e6"]]),Be=n=>{const c=se(),d=A(),{allGameData:o,highscorePosition:v,personalBest:y}=B(d),{firebaseUser:p}=B(c),m=f(()=>p.value?v.value:null),b=f(()=>{if(!n)return!1;const i=o.value[n].previousHighscorePosition;return m.value&&i?i>m.value:!1}),S=f(()=>{if(!n)return!1;const i=o.value[n].previousPersonalBest;return p.value&&i?i<y.value:!1});return T(()=>{d.$init(n)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:S}};export{$e as H,Ie as _,Be as u};
