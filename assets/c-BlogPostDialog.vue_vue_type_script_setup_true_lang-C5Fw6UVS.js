import{a as H,am as J,s as C,l as de,aw as pe,ax as ge,ay as ne,az as ie,aA as A,aB as me,q as F,z as u,d as O,u as ve,G as le,b as P,g as $,_ as Q,f as e,R as M,$ as te,n as q,aC as be,w as R,e as j,i as N,J as G,C as B,c as I,x as we,h as d,D as fe,as as Pe,y as E,O as D,Q as W,aD as Se,aE as ke,v as Ue,aF as xe,aG as Ce,ap as z,aq as Ve,ar as Re,j as Be,at as Te,au as oe,aH as he,U as Ie,ab as L,ac as K,V as ue,aI as Y,aJ as $e,aK as Ee,aL as De,a7 as Oe,aM as Le,a8 as X,a9 as Z,k as _,aa as ee}from"../bundle.js";import{_ as ye}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DhUst3eP.js";import{u as Ae}from"./c-useUsers-Rsmxr7ei.js";const Me=o=>{const s=H(),m=J(),{previousCurrentBlogPost:b,isBlogPostDatabaseActionActive:U}=C(s);let a=[];const i=u(),v=r=>{r.metadata.hasPendingWrites||U.value||(clearTimeout(i.value),i.value=setTimeout(async()=>{await s.fetchBlogPost(o.id,void 0,{loadingIndicator:!1}),s.checkBlogPostForUnreadReactions(b.value,!0)},200))};de(async()=>{m.unread=m.unread.filter(S=>S.postId!==o.id);const r=pe(o),p=s.collections.blogPosts(r.isPrivate),w=m.collections.blogReactions(r.isPrivate),c=ge(p,o.id),g=ne(p,ie("id","==",o.id)),k=ne(w,ie("post","==",c));a.push(A(g,v)),a.push(A(k,v))}),me(()=>{clearTimeout(i.value),a.forEach(r=>{r()})})},_e=()=>{const o=H(),s=F(),m=J(),{visibleBlogPosts:b,isBlogPostDatabaseActionActive:U}=C(o),{isLoggedIn:a}=C(s);let i=[];const v=u(),r=p=>{p.metadata.hasPendingWrites||U.value||(clearTimeout(v.value),v.value=setTimeout(async()=>{b.value.length&&(await o.fetchBlogPosts({amount:b.value.length,loadingIndicator:!1}),o.checkBlogPostsForUnreadReactions())},200))};de(()=>{m.unread=[],i.push(A(o.collections.blogPosts(!1),r)),i.push(A(m.collections.blogReactions(!1),r)),a.value&&(i.push(A(o.collections.blogPosts(!0),r)),i.push(A(m.collections.blogReactions(!0),r)))}),me(()=>{clearTimeout(v.value),i.forEach(p=>{p()})})},qe={class:"flex flex-col gap-2"},ce=O({__name:"BlogReaction",props:{post:{},reaction:{}},setup(o){const s=o,m=ve(),b=F(),U=le(),a=J(),{routeLoading:i,routeLoadingId:v}=C(m),{firebaseUser:r,isLoggedIn:p,isOwner:w}=C(b),{publicUsers:c}=C(U),{isDatabaseDeletionActive:g}=C(a),k=B(()=>c.value.find(V=>V.id===s.reaction.userId)),S=B(()=>r.value&&s.reaction.userId===r.value.uid||w.value);return(V,T)=>{var x,f,n;return P(),$(Q,{id:o.reaction.id,class:q(["p-5 w-full md:w-3/4 xl:w-2/3",o.post.colorTertiary,o.post.opacityTertiary||"bg-opacity-50","!rounded-primary"]),titleProps:{class:"!text-base mt-1"},descriptionProps:{class:"text-white"},avatarProps:{class:{"animate-spin":e(i)===e(M).USER_DETAILS&&e(v)===((x=k.value)==null?void 0:x.id)}},title:((f=k.value)==null?void 0:f.displayName)||"Unknown user",subTitle:e(te)(o.reaction.date),avatar:(n=k.value)==null?void 0:n.avatar,route:e(p)?{name:e(M).USER_DETAILS,params:{userId:o.reaction.userId}}:void 0,avatarRoute:e(p)?{name:e(M).USER_DETAILS,params:{userId:o.reaction.userId}}:void 0,description:o.reaction.message},be({_:2},[S.value?{name:"right",fn:R(()=>[j("div",qe,[S.value&&!o.post.locked?(P(),$(N,{key:0,variant:"danger",outlined:"",class:"h-fit",label:"Delete",disabled:e(g),onClick:T[0]||(T[0]=h=>e(a).deleteBlogReaction(o.post,o.reaction.id))},null,8,["disabled"])):G("",!0)])]),key:"0"}:void 0]),1032,["id","class","avatarProps","title","subTitle","avatar","route","avatarRoute","description"])}}}),je={class:"grid justify-items-center p-5 gap-5"},Ne=O({__name:"BlogReactions",props:{post:{}},setup(o){const s=o,m=ve(),b=F(),U=J(),{content:a}=C(m),{firebaseUser:i,isLoggedIn:v}=C(b),{isDatabaseCreationActive:r}=C(U),p=u(),w=u(!1),c=Ue({reaction:{value:"",error:""}}),g=B(()=>[...s.post.reactions].reverse()),k=B(()=>g.value.filter((x,f)=>f<3)),S=B(()=>g.value.filter((x,f)=>f>=3)),V=B(()=>s.post.locked||!v.value||r.value),T=async()=>{if(!r.value){if(await p.value.test(),!c.reaction.error&&i.value){const x=c.reaction.value;c.reaction.value="Replying...";const f=await U.createBlogReaction(s.post,new xe({userId:i.value.uid,postId:s.post.id,message:x}));c.reaction.value=f?"":x}Ce()}};return(x,f)=>(P(),I("form",{action:"",onSubmit:we(T,["prevent"])},[j("div",je,[!e(v)||o.post.reactions.filter(n=>n.userId===e(i).uid).length<20?(P(),$(Q,{key:0,class:q(["p-5 flex justify-center w-full md:w-3/4 xl:w-2/3","!rounded-primary",o.post.colorTertiary||"bg-secondary-700",o.post.opacityTertiary||"bg-opacity-25"])},{default:R(()=>[d(fe,{class:"w-5/6",id:o.post.id,inputProps:{class:["!bg-neutral-900 rounded-primary border-none !placeholder-gray-300",o.post.colorSecondary||o.post.colorPrimary||"bg-secondary-600",o.post.opacitySecondary||"!bg-opacity-20",V.value?{"!bg-gray-900 !bg-opacity-50":!e(r)}:"focus:!text-white focus:!placeholder-gray-200",{"cursor-pointer":!e(v)&&!o.post.locked}],disabled:V.value,autocomplete:"off"},ref_key:"reaction",ref:p,name:"reaction",placeholder:o.post.locked?"Locked for comments":e(v)?"Reply":e(a).blogLoginGuest,modelValue:c.reaction.value,"onUpdate:modelValue":f[0]||(f[0]=n=>c.reaction.value=n),error:c.reaction.error,"onUpdate:error":f[1]||(f[1]=n=>c.reaction.error=n),rules:[e(E).Required],onClick:f[2]||(f[2]=()=>!e(v)&&!o.post.locked?e(Pe).push({name:e(M).LOGIN}):{})},null,8,["id","inputProps","placeholder","modelValue","error","rules"])]),_:1},8,["class"])):G("",!0),(P(!0),I(D,null,W(k.value,n=>(P(),$(ce,{post:o.post,reaction:n},null,8,["post","reaction"]))),256)),(P(!0),I(D,null,W(S.value,n=>Se((P(),$(ce,{post:o.post,reaction:n},null,8,["post","reaction"])),[[ke,w.value]])),256)),o.post.reactions.length>3?(P(),$(N,{key:1,outlined:"",icon:w.value?"pi pi-angle-up":"pi pi-angle-down",label:w.value?"Hide older reactions":"View older reactions",onClick:f[3]||(f[3]=n=>w.value=!w.value)},null,8,["icon","label"])):G("",!0)])],32))}}),Ge={class:"flex flex-wrap justify-end h-fit gap-3"},Fe=O({__name:"BlogPostMutationButtons",emits:["editClicked","deleteClicked"],setup(o){return(s,m)=>(P(),I("div",Ge,[d(N,{class:"min-w-80",label:"Edit",onClick:m[0]||(m[0]=b=>s.$emit("editClicked"))}),d(N,{class:"min-w-80",variant:"danger",outlined:"",label:"Delete",onClick:m[1]||(m[1]=b=>s.$emit("deleteClicked"))})]))}}),ze={class:"flex justify-between h-fit mt-2 gap-2"},Qe={class:"flex flex-wrap gap-3"},et=O({__name:"BlogPost",props:{post:{}},setup(o){const s=o,m=Be(),b=F(),U=le(),a=H(),i=z(),{publicUsers:v}=C(U),{firebaseUser:r,isOwner:p}=C(b),{deleteBlogPost:w}=a,c=u(!1);m.currentRoute.value.name!==M.BLOG&&Me(s.post);const g=B(()=>{var n;return(n=s.post.allowedUserIds)!=null&&n.length?v.value.filter(h=>{var y;return(y=s.post.allowedUserIds)==null?void 0:y.includes(h.id)}):[]}),k=B(()=>{const n=te(s.post.date);return s.post.dateUpdated?n+` - updated ${te(s.post.dateUpdated)}`:n}),S=B(()=>{const n=[];return s.post.datePinned&&n.push({value:"Pinned",severity:"success",rounded:!1}),s.post.locked&&n.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),s.post.archived&&n.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),n}),V=()=>{i.openWith(s.post)},T=()=>{c.value=!0},x=async()=>{await w(s.post.id)&&(c.value=!1)},f=()=>{const n=document.createElement("textarea"),{protocol:h,hostname:y,port:t}=window.location,l=`${h}//${y}`+(y==="localhost"?`:${t}`:"");n.value=`${l}#${Te.BLOG.path}/${s.post.id}`,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),oe.success("Copied link!")};return(n,h)=>(P(),I(D,null,[d(Q,{id:o.post.id,class:q(["border-4 border-transparent","!rounded-primary",o.post.colorSecondary||o.post.colorPrimary||"bg-secondary-900",o.post.opacitySecondary||"bg-opacity-50"]),title:o.post.title,subTitle:k.value,tags:S.value,clickable:"",route:{name:e(M).BLOG_DETAILS,params:{postId:o.post.id}}},{right:R(()=>[d(N,{class:"h-fit",variant:"neutral",icon:"pi pi-copy",text:"",onClick:f})]),default:R(()=>{var y;return[j("div",ze,[j("div",Qe,[(P(!0),I(D,null,W(g.value,t=>{var l;return P(),$(e(Ve),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:t.id===((l=e(r))==null?void 0:l.uid)?"You":t.displayName,rounded:""},null,8,["label"])}),256))]),e(p)?(P(),I("div",{key:0,class:q(["flex justify-end ms-5",(y=o.post.allowedUserIds)!=null&&y.length?"flex-col md:flex-row":"flex-row"])},[d(Fe,{onEditClicked:V,onDeleteClicked:T})],2)):G("",!0)]),d(Q,{class:q(["z-10 min-h-[125px] md:min-h-[160px] p-5 mt-5 flex flex-col gap-3",o.post.colorPrimary,o.post.opacityPrimary||"bg-opacity-50"])},{default:R(()=>[(P(!0),I(D,null,W(o.post.content,t=>(P(),$(Re,{key:t.id,post:o.post,block:t},null,8,["post","block"]))),128))]),_:1},8,["class"]),d(Ne,{post:o.post},null,8,["post"])]}),_:1},8,["id","class","title","subTitle","tags","route"]),d(ye,{title:"Delete Post",isOpen:c.value,description:[` Are you sure you want to delete this post called '${o.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:x,onCancel:h[0]||(h[0]=y=>c.value=!1)},null,8,["isOpen","description"])],64))}}),We=O({__name:"BlogPostContentDialog",emits:["update:selected","error"],setup(o,{expose:s,emit:m}){const b=m,U=z(),{blogPostMutation:a}=C(U),i=u(),v=u(),r=B(()=>[v.value].some(w=>!!w));return s({test:async()=>{await Promise.all([i.value.test()]),b("error",r.value)}}),(w,c)=>(P(),I(D,null,[d(fe,{ref_key:"title",ref:i,class:"w-full",name:"title",label:"Title",placeholder:"Amazing Post",modelValue:e(a).title,"onUpdate:modelValue":c[0]||(c[0]=g=>e(a).title=g),error:v.value,"onUpdate:error":c[1]||(c[1]=g=>v.value=g),rules:[e(E).Required],"min-length":3,"max-length":50},null,8,["modelValue","error","rules"]),d(he,{modelValue:e(a).content,"onUpdate:modelValue":c[2]||(c[2]=g=>e(a).content=g)},null,8,["modelValue"])],64))}}),He=O({__name:"BlogPostSettingsDialog",emits:["error"],setup(o,{expose:s,emit:m}){const b=m,U=le(),a=z(),{blogPostMutation:i}=C(a),{allowedPublicUsers:v}=U,{mappedUsers:r}=Ae(),p=u(),w=u(),c=u(),g=u(),k=B({get(){return!!i.value.datePinned},set(y){i.value.datePinned=y?new Date:null}}),S=u(),V=u(),T=u(),x=u(),f=B(()=>[S.value,V.value,T.value,x.value].some(y=>!!y)),n=u([]),h=async()=>{i.value.allowedUserIds.length&&!n.value.length&&(S.value="Invalid user ID's"),await Promise.all([w.value.test(),c.value.test(),g.value.test()]),b("error",f.value)};return Ie(()=>i.value.allowedUserIds,async y=>{n.value=await v(y)},{immediate:!0}),s({test:h}),(y,t)=>(P(),I(D,null,[d(L,{ref_key:"allowedUsers",ref:p,class:"w-full md:w-1/2",name:"allowedUserIds",label:"Allowed users",placeholder:"This post is public",modelValue:e(i).allowedUserIds,"onUpdate:modelValue":t[0]||(t[0]=l=>e(i).allowedUserIds=l),error:S.value,"onUpdate:error":t[1]||(t[1]=l=>S.value=l),options:e(r),multiple:""},null,8,["modelValue","error","options"]),d(K,{ref_key:"pinned",ref:g,class:"w-full md:w-1/2",name:"pinned",label:"Pinned",modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=l=>k.value=l)},null,8,["modelValue"]),d(K,{ref_key:"locked",ref:w,class:"w-full md:w-1/2",name:"locked",label:"Locked for commenting",modelValue:e(i).locked,"onUpdate:modelValue":t[3]||(t[3]=l=>e(i).locked=l)},null,8,["modelValue"]),d(K,{ref_key:"archived",ref:c,class:"w-full md:w-1/2",name:"archived",label:"Archived",modelValue:e(i).archived,"onUpdate:modelValue":t[4]||(t[4]=l=>e(i).archived=l)},null,8,["modelValue"])],64))}}),Je=O({__name:"BlogPostStylingDialog",emits:["error"],setup(o,{expose:s,emit:m}){const b=m,U=z(),{blogPostMutation:a}=C(U),i=u(),v=u(),r=u(),p=u(),w=u(),c=u(),g=u(),k=u(),S=u(),V=u(),T=u(),x=u(),f=B(()=>[g.value,k.value,S.value,V.value,T.value,x.value].some(y=>!!y)),n=B(()=>Ee(ue.find(y=>y.value===a.value.colorPrimary)));return s({test:async()=>{await Promise.all([i.value.test(),v.value.test(),r.value.test(),p.value.test(),w.value.test(),c.value.test()]),b("error",f.value)}}),(y,t)=>(P(),I(D,null,[d(L,{ref_key:"colorPrimary",ref:i,class:"w-full md:w-1/2",name:"colorPrimary",label:"Primary Style",modelValue:e(a).colorPrimary,"onUpdate:modelValue":t[0]||(t[0]=l=>e(a).colorPrimary=l),error:g.value,"onUpdate:error":t[1]||(t[1]=l=>g.value=l),options:e(ue),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"opacityPrimary",ref:p,class:"w-full md:w-1/2",name:"opacityPrimary",label:"Primary Opacity",modelValue:e(a).opacityPrimary,"onUpdate:modelValue":t[2]||(t[2]=l=>e(a).opacityPrimary=l),error:V.value,"onUpdate:error":t[3]||(t[3]=l=>V.value=l),options:e(Y),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"colorSecondary",ref:v,class:"w-full md:w-1/2",name:"colorSecondary",label:"Secondary Style",modelValue:e(a).colorSecondary,"onUpdate:modelValue":t[4]||(t[4]=l=>e(a).colorSecondary=l),error:k.value,"onUpdate:error":t[5]||(t[5]=l=>k.value=l),options:n.value,rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"opacitySecondary",ref:w,class:"w-full md:w-1/2",name:"opacitySecondary",label:"Secondary Opacity",modelValue:e(a).opacitySecondary,"onUpdate:modelValue":t[6]||(t[6]=l=>e(a).opacitySecondary=l),error:T.value,"onUpdate:error":t[7]||(t[7]=l=>T.value=l),options:e(Y),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"colorTertiary",ref:r,class:"w-full md:w-1/2",name:"colorTertiary",label:"Tertiary Style",modelValue:e(a).colorTertiary,"onUpdate:modelValue":t[8]||(t[8]=l=>e(a).colorTertiary=l),error:S.value,"onUpdate:error":t[9]||(t[9]=l=>S.value=l),options:e($e),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"]),d(L,{ref_key:"opacityTertiary",ref:c,class:"w-full md:w-1/2",name:"opacityTertiary",label:"Tertiary Opacity",modelValue:e(a).opacityTertiary,"onUpdate:modelValue":t[10]||(t[10]=l=>e(a).opacityTertiary=l),error:x.value,"onUpdate:error":t[11]||(t[11]=l=>x.value=l),options:e(Y),rules:[e(E).Required]},null,8,["modelValue","error","options","rules"])],64))}}),Ke={ref:"dialog",class:"pt-6 mb-4 xl:px-16"},tt=O({__name:"BlogPostDialog",emits:["scroll-to-updated"],setup(o,{emit:s}){const m=s;F();const b=H(),U=De(),a=z(),{isBlogPostsMutationLoading:i}=C(b),{isOpen:v,blogPostOriginal:r,blogPostMutation:p,hasChanges:w}=C(a),c=u(),g=u(),k=u(),S=u(!1),V=u(!1),T=u(!1),x=B(()=>{var y,t,l,ae,se,re;return!!((t=(y=r.value)==null?void 0:y.allowedUserIds)!=null&&t.length)&&!((l=p.value.allowedUserIds)!=null&&l.length)||!((se=(ae=r.value)==null?void 0:ae.allowedUserIds)!=null&&se.length)&&!!((re=p.value.allowedUserIds)!=null&&re.length)}),f=B(()=>pe(r.value)),n=async()=>{await Promise.all([c.value.test(),g.value.test(),k.value.test()]),!(S.value||V.value||T.value)&&(r.value?x.value?(a.isOpen=!1,await b.toggleBlogPostVisibility(r.value,p.value.allowedUserIds.length?"private":"public")&&(a.close(),oe.success("Successfully updated Post Visibility"),m("scroll-to-updated",p.value.id))):await b.updateBlogPost(p.value,f.value)&&(oe.success("Successfully updated Post"),a.close(),m("scroll-to-updated",p.value.id)):await b.createBlogPost(p.value)&&(a.close(),m("scroll-to-updated",p.value.id)))},h=async()=>{await U.deleteFilesOfBlogPost(p.value,r.value??void 0),a.close()};return(y,t)=>(P(),$(ye,{isOpen:e(v),title:e(r)?"Update Post":"Create Post",description:e(r)?"Update this post":"Create a new post","confirm-text":e(r)?"Update":"Create","confirm-loading":e(i),"confirm-props":{disabled:!e(w)},onConfirm:n,onCancel:h},{default:R(()=>[j("form",Ke,[e(v)?(P(),$(e(Oe),{key:0,"active-index":0,onTabOpen:e(Le)},{default:R(()=>[d(e(X),{value:"content"},{default:R(()=>[d(e(Z),null,{default:R(()=>[...t[3]||(t[3]=[_(" Content ",-1)])]),_:1}),d(e(ee),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:R(()=>[d(We,{ref_key:"content",ref:c,onError:t[0]||(t[0]=l=>S.value=l)},null,512)]),_:1})]),_:1}),d(e(X),{value:"styling"},{default:R(()=>[d(e(Z),null,{default:R(()=>[...t[4]||(t[4]=[_(" Styling ",-1)])]),_:1}),d(e(ee),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:R(()=>[d(Je,{ref_key:"styling",ref:g,onError:t[1]||(t[1]=l=>V.value=l)},null,512)]),_:1})]),_:1}),d(e(X),{value:"settings"},{default:R(()=>[d(e(Z),null,{default:R(()=>[...t[5]||(t[5]=[_(" Settings ",-1)])]),_:1}),d(e(ee),{"pt:content":"flex flex-col justify-center items-center gap-3"},{default:R(()=>[d(He,{ref_key:"settings",ref:k,onError:t[2]||(t[2]=l=>T.value=l)},null,512)]),_:1})]),_:1})]),_:1},8,["onTabOpen"])):G("",!0)],512)]),_:1},8,["isOpen","title","description","confirm-text","confirm-loading","confirm-props"]))}});export{et as _,tt as a,Fe as b,_e as u};
