import{x as H,k as u,aF as q,e as z,w as M,aV as G,j as S,l as T,ay as Q,N as J,a as n,o as s,q as B,d as l,b as r,A as K,_ as w,p as o,P as O,C,Q as W,I as g,H as D,y as X,v as Y,t as V,h as Z}from"../bundle.js";import{_ as ee}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const te=(i,c)=>{const d=H(0),v=u(()=>q(i)),y=u(()=>(d.value+1)*c),k=u(()=>y.value-c),p=u(()=>d.value>0),m=u(()=>v.value.length>y.value),b=u(()=>v.value.filter((a,_)=>_>=k.value&&_<y.value));return{page:d,perPage:c,visibleData:b,hasPrevious:p,hasNext:m,$reset:()=>{d.value=0}}},se={class:"mt-5 flex flex-col items-center"},oe={class:"w-full overflow-x-auto"},le={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},ne={key:0},ae={key:0},re={key:1},ue={key:1},ie={key:0},ce={key:1},de={key:2},ve={key:3},fe={key:2},he={key:3},me={key:4},ge={colspan:"100%"},ye={key:0,class:"mt-5 flex justify-center"},ke=z({__name:"Highscores",props:{gameId:{},unit:{},withBackButton:{type:Boolean},backButtonText:{}},emits:["close"],setup(i){const c=i,d=M(),v=G(),{publicUsers:y}=S(d),{allGameData:k,fetchLoading:p}=S(v),{fetchGameData:m,fetchHighscores:b,fetchScores:x}=v,a=H("highscores"),_=H(),j=u(()=>k.value[c.gameId].gameData[a.value]),{page:I,perPage:A,visibleData:f,hasPrevious:P,hasNext:N,$reset:L}=te(()=>j.value,10),E=h=>{var e;return((e=y.value.find(t=>t.id===h))==null?void 0:e.displayName)??"Unknown"},U=h=>{L(),a.value=h},F=()=>{a.value==="highscores"?b():x()};return T(()=>{v.$init(c.gameId),m(),_.value=setInterval(()=>{m()},1e3*60*5)}),Q(()=>{clearInterval(_.value)}),J(a,()=>{k.value[c.gameId].gameData[a.value].length||F()}),(h,e)=>(s(),n("div",se,[B(o(O),{class:"w-full md:w-1/2"},{default:K(()=>[B(w,{class:"w-full",variant:"secondary",outlined:a.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=t=>U("highscores"))},null,8,["outlined"]),B(w,{class:"w-full",variant:"secondary",outlined:a.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=t=>U("scores"))},null,8,["outlined"])]),_:1}),l("div",oe,[l("table",le,[o(f).length?(s(),n("thead",ne,[l("tr",null,[e[5]||(e[5]=l("th",null,"Rank",-1)),e[6]||(e[6]=l("th",null,"User",-1)),e[7]||(e[7]=l("th",null,"Score",-1)),o(f).length&&o(f).some(t=>t.difficulty)?(s(),n("th",ae,"Difficulty")):r("",!0),e[8]||(e[8]=l("th",null,"Date",-1)),o(f).length&&o(f).some(t=>t.bonus)?(s(),n("th",re,"Bonus")):r("",!0)])])):r("",!0),o(f).length?(s(),n("tbody",ue,[(s(!0),n(C,null,W(o(f),(t,R)=>(s(),n("tr",null,[l("th",null,g(R+1+o(I)*o(A)),1),l("th",null,g(E(t.userId??t.id)),1),l("td",null,[D(g(t.score)+" ",1),h.unit?(s(),n(C,{key:0},[D(g(h.unit),1),t.score!==1?(s(),n(C,{key:0},[D("s")],64)):r("",!0)],64)):r("",!0)]),t.difficulty?(s(),n("td",ie,g(t.difficulty),1)):o(f).some($=>$.difficulty)?(s(),n("td",ce)):r("",!0),l("td",null,g(o(X)(t.date)),1),t.bonus?(s(),n("td",de,g(t.bonus),1)):o(f).some($=>$.bonus)?(s(),n("td",ve)):r("",!0)]))),256))])):o(p)?(s(),n("tbody",fe,e[9]||(e[9]=[l("tr",null,[l("th",null,"Loading highscores...")],-1)]))):(s(),n("tbody",he,[l("tr",null,[l("th",null,"There are no "+g(a.value==="highscores"?"highscores":"scores")+" yet.",1)])])),o(P)||o(N)?(s(),n("tfoot",me,[l("tr",null,[l("td",ge,[l("div",{class:Y(["w-full p-2 flex",[o(P)?"justify-between":"justify-end"]])},[o(P)?(s(),V(w,{key:0,class:"w-fit",label:"Previous",variant:"neutral",onClick:e[2]||(e[2]=t=>I.value-=1)})):r("",!0),o(N)?(s(),V(w,{key:1,class:"w-fit",label:"Next",variant:"neutral",onClick:e[3]||(e[3]=t=>I.value+=1)})):r("",!0)],2)])])])):r("",!0)])]),h.withBackButton?(s(),n("div",ye,[B(w,{class:"w-full md:w-1/2",variant:"neutral",label:h.backButtonText??"Go Back",onClick:e[4]||(e[4]=t=>h.$emit("close"))},null,8,["label"])])):r("",!0)]))}}),_e=ee(ke,[["__scopeId","data-v-ddf85469"]]),we=i=>{const c=Z(),d=G(),{allGameData:v,highscorePosition:y,personalBest:k}=S(d),{firebaseUser:p}=S(c),m=u(()=>p.value?y.value:null),b=u(()=>{if(!i)return!1;const a=v.value[i].previousHighscorePosition;return m.value&&a?a>m.value:!1}),x=u(()=>{if(!i)return!1;const a=v.value[i].previousPersonalBest;return p.value&&a?a<k.value:!1});return T(()=>{d.$init(i)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:x}};export{_e as H,we as u};
