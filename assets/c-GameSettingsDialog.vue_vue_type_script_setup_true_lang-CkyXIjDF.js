import{_ as _e,a as Le}from"./c-SwitchField.vue_vue_type_script_setup_true_lang-R6e5xvIM.js";import{_ as Te}from"./c-SelectField.vue_vue_type_script_setup_true_lang-DIKuGEia.js";import{d as Ce,aO as he,s as ee,r as h,a as Pe,c as V,o as Oe,aP as M,M as Ie,aQ as J,cV as we,aR as De,aU as Ae,cW as Me,h as xe,cX as We,cY as Ne,al as $e,ai as re,cZ as Be,L as ve,c_ as Ue,c$ as Fe,d0 as Ge,aS as He,aT as Ye,e as je,bX as Ze,cD as qe,l as de,q as fe,D as Ke,n as Xe,k as j,ad as pe,t as Se}from"../bundle.js";var ze=(e=>(e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(ze||{});const Ee={hearts:{label:"Hearts",color:"red"},spades:{label:"Spades",color:"black"},diamonds:{label:"Diamonds",color:"red"},clubs:{label:"Clubs",color:"black"}};var Qe=(e=>(e.STOCK_CLOSED="stock_closed",e.STOCK_OPEN="stock_open",e.PILE1="pile1",e.PILE2="pile2",e.PILE3="pile3",e.PILE4="pile4",e.PILE5="pile5",e.PILE6="pile6",e.PILE7="pile7",e.HEARTS="hearts",e.SPADES="spades",e.DIAMONDS="diamonds",e.CLUBS="clubs",e))(Qe||{}),Je=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.HAS_STARTED=1]="HAS_STARTED",e[e.HAS_FINISHED=2]="HAS_FINISHED",e))(Je||{});const el={easy:.5,hard:1},Re=()=>{const e=sl();return we(e),{pile1:e.splice(0,1).map(i=>({...i,deck:"pile1"})),pile2:e.splice(0,2).map((i,f)=>f<1?{...i,hidden:!0,deck:"pile2"}:{...i,deck:"pile2"}),pile3:e.splice(0,3).map((i,f)=>f<2?{...i,hidden:!0,deck:"pile3"}:{...i,deck:"pile3"}),pile4:e.splice(0,4).map((i,f)=>f<3?{...i,hidden:!0,deck:"pile4"}:{...i,deck:"pile4"}),pile5:e.splice(0,5).map((i,f)=>f<4?{...i,hidden:!0,deck:"pile5"}:{...i,deck:"pile5"}),pile6:e.splice(0,6).map((i,f)=>f<5?{...i,hidden:!0,deck:"pile6"}:{...i,deck:"pile6"}),pile7:e.splice(0,7).map((i,f)=>f<6?{...i,hidden:!0,deck:"pile7"}:{...i,deck:"pile7"}),stock_closed:e.map(i=>({...i,hidden:!0,deck:"stock_closed"})),stock_open:[],hearts:[],spades:[],diamonds:[],clubs:[]}},ll=Ce("patienceStore",()=>{const e=he(),{personalBest:i,highscorePosition:f}=ee(e),{setPreviousHighscores:$,updateHighscores:B,sortHighscores:N}=e,D=h("hard"),P=h(0),U=h(0),d=h(0),p=h(0),I=h(0),Z=h(),T=h(!0),c=Pe(Re()),H=V(()=>el[D.value]),R=V(()=>Object.keys(c).flatMap(s=>c[s])),x=1e3,v=10,L=10,W=V(()=>{const s=d.value%10===0?d.value:Math.floor(d.value/10)*10,o=U.value*v,u=I.value*v,n=s+o+u,g=p.value*L;return Math.max(0,x-(n-g))}),K=V(()=>{const s=Math.floor(d.value/60),o=d.value%60;return`${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`}),A=V(()=>c.hearts.length===13&&c.spades.length===13&&c.diamonds.length===13&&c.clubs.length===13);Oe(()=>{e.$init(M.PATIENCE),d.value&&P.value===1&&S()}),Ie(A,s=>{s&&P.value!==2&&(F(),P.value=2,w(),J(De))});const m=()=>{F(),U.value=0,d.value=0,p.value=0,I.value=0,P.value=0,Object.assign(c,Re()),e.setPreviousHighscores()},E=()=>{d.value=0,S(),P.value=1,setTimeout(()=>{se()},500)},S=()=>{Z.value&&F(),Z.value=setInterval(()=>{d.value++},1e3)},F=()=>{clearInterval(Z.value)},ue=()=>{const s=c.stock_open;s.length&&(s.reverse(),G(s[0],!1,o=>{o.deck="stock_closed",o.hidden=!0,c.stock_closed.push(o)}),s.splice(0,s.length),b(1))},q=s=>{const o=s.deck,u=R.value.filter(n=>n.selected);if(o==="stock_closed"){const n=c.stock_closed,g=n.indexOf(s);if(g===n.length-1){const C=D.value==="hard"?g-2:g,O=C<0?0:C,oe=n.filter((ie,ce)=>ce>=O);k(),le(oe,"stock_open",ie=>{ie.hidden=!1}),b(0)}}else if(o==="stock_open"){const n=c.stock_open;n.indexOf(s)===n.length-1&&(s.selected=!s.selected,u.length&&G(u[0],!1))}else if(u.length){const n=u[0];n===s?G(s,!1):z(o)&&ge(n,s)?s.value===n.value+1&&s.deck!==n.deck&&(le(u,o),n.deck==="stock_open"?b(2):b(4)):u.length===1&&Q(o)&&te(n,s)&&s.value===n.value-1&&(Y(n,o),b(3),n.hasBeenHome=!0)}else G(s,!0)},me=s=>{const o=R.value.filter(u=>u.selected);if(o.length){const u=o[0],n=u.deck;u.value===13&&(le(o,s),n==="stock_open"?b(2):z(u.deck)&&c[u.deck].every(g=>!g.hidden)?b(5):b(4))}},X=s=>{const o=R.value.filter(u=>u.selected);if(o.length===1){const u=o[0],n=u.type;!c[s].length&&n===s&&u.value===1&&(Y(u,s),b(3))}},G=(s,o,u)=>{const n=c[s.deck],g=n.indexOf(s);n.filter((O,oe)=>oe>=g).forEach(O=>{O.selected=o,u==null||u(O)})},k=()=>{R.value.forEach(s=>{s.selected=!1})},Y=(s,o)=>{const u=s.deck,n=c[u].indexOf(s);s.deck=o,s.selected=!1,c[o].push(s),c[u].splice(n,1),(z(u)||u==="stock_open")&&ae(u)},le=(s,o,u)=>{const n=s[0],g=n.deck,C=c[g].indexOf(n);G(n,!1,O=>{O.deck=o,u==null||u(O),c[o].push(O)}),c[g].splice(C,s.length),Q(g)||ae(g!=="stock_closed"?g:o)},ne=s=>{if(!T.value)return!0;const o=c[s.type],u=o.length?o[o.length-1].value:0;if(s.value===u+1){const n=["hearts","spades","diamonds","clubs"],g=u<=1||n.every(C=>{const O=c[C];return(O.length?O[O.length-1].value:0)>=u});if(u===0||g)return Y(s,s.type),s.hasBeenHome=!0,b(3),!0}return!1},se=()=>{if(T.value)for(const s of["stock_open","pile1","pile2","pile3","pile4","pile5","pile6","pile7"]){const o=c[s];if(o.length&&ne(o[o.length-1]))return}},ae=s=>{const o=c[s];if(o.length){const u=o[o.length-1],n=u.deck;u.hidden=!1,setTimeout(()=>{u.deck===n&&(ne(u)||se())},500)}else setTimeout(()=>{se()},500)},b=s=>{switch(s!==5&&U.value++,s){case 0:{I.value+=2*H.value;break}case 1:{I.value+=5*H.value;break}case 2:{p.value+=10*H.value;break}case 3:{p.value+=20*H.value;break}}J(Ae)},ge=(s,o)=>s.color!==o.color,te=(s,o)=>s.type===o.type,z=s=>["pile1","pile2","pile3","pile4","pile5","pile6","pile7"].includes(s),Q=s=>["hearts","spades","diamonds","clubs"].includes(s),w=()=>{B({difficulty:D.value,score:W.value,bonus:p.value,time:d.value,turns:U.value,penalty:I.value})};return{difficulty:D,gameStatus:P,score:W,turns:U,time:d,bonus:p,penalty:I,cards:c,doAutocomplete:T,allCards:R,formattedTime:K,personalBest:i,highscorePosition:f,$reset:m,start:E,shuffle:ue,selectCard:q,selectEmptyDeck:me,selectFinalDeck:X,deselectAllCards:k,isPlayDeck:z,isFinalDeck:Q,setPreviousHighscores:$,updatePatienceHighscore:w,sortHighscores:N}},{persist:{enabled:!0}}),sl=()=>Object.keys(Ee).flatMap(e=>{const i=e,f=[];for(let $=0;$<13;$++){const B={type:i,label:Ee[i].label,color:Ee[i].color,value:$+1,hidden:!1,selected:!1,hasBeenHome:!1};f.push(B)}return f});var al=(e=>(e[e.SOLO=0]="SOLO",e[e.ONLINE=1]="ONLINE",e))(al||{}),tl=(e=>(e[e.HAS_NOT_STARTED=0]="HAS_NOT_STARTED",e[e.FINDING_OPPONENT=1]="FINDING_OPPONENT",e[e.HAS_STARTED=2]="HAS_STARTED",e[e.HAS_THROWN_DICES=3]="HAS_THROWN_DICES",e[e.HAS_CHOSEN_DICES=4]="HAS_CHOSEN_DICES",e[e.HAS_CHOSEN_TILE=5]="HAS_CHOSEN_TILE",e[e.HAS_LOST=6]="HAS_LOST",e[e.HAS_FINISHED=7]="HAS_FINISHED",e))(tl||{}),ol=(e=>(e[e.NONE=0]="NONE",e[e.HAS_LOST_TILE=1]="HAS_LOST_TILE",e[e.HAS_LOST_NOTHING=2]="HAS_LOST_NOTHING",e))(ol||{}),ul=(e=>(e[e.NONE=0]="NONE",e[e.WINNER_HIGHEST_SCORE=1]="WINNER_HIGHEST_SCORE",e[e.WINNER_HIGHEST_TILE=2]="WINNER_HIGHEST_TILE",e[e.LOSER=3]="LOSER",e))(ul||{}),nl=(e=>(e[e.PLAYER=0]="PLAYER",e[e.OPPONENT=1]="OPPONENT",e))(nl||{});const il=e=>{for(let i=1;i<=6;i++)if(e.every(f=>f.value===i))return!0;return!1},ke=()=>({0:[],1:[]}),cl=Ce("rainwormsStore",()=>{const e=Me(),i=he(),f=xe(),{personalBest:$,highscorePosition:B}=ee(i),{firebaseUser:N}=ee(f),{setPreviousHighscores:D,updateHighscores:P,sortHighscores:U}=i,d={onlineGames:We(e,Ne.GAME_DATA,M.RAINWORMS,Ne.ONLINE_GAMES)},p=h(1),I=h([]),Z=h(!1),T=h(null),c=h(null),H=h(null),R=h(null),x=h(0),v=h(0),L=h(0),W=h(0),K=h(0),A=h(0),m=h(Ve()),E=h(be()),S=Pe(ke()),F=V(()=>m.value.some(l=>l.isRolling)),ue=V(()=>m.value.filter(l=>l.selected).some(l=>l.value===6)),q=V(()=>l=>m.value.some(t=>t.value===l&&t.selected)),me=V(()=>l=>E.value.some(t=>t.displayValue<=l)),X=V(()=>l=>A.value===(l??0)),G=V(()=>l=>{const t=S[l??0];return t.length?t[t.length-1]:null}),k=V(()=>{let l=0;return m.value.filter(t=>t.selected).forEach(t=>{l+=t.value===6?5:t.value}),l}),Y=V(()=>l=>{let t=0;return S[l].forEach(a=>{t+=a.value}),t});Oe(()=>{i.$init(M.RAINWORMS),T.value&&te()});const le=()=>{var l,t;x.value===1&&((l=N.value)==null?void 0:l.uid)===c.value&&Q(),(t=H.value)==null||t.call(H),H.value=null,T.value=null,R.value=null,c.value=null,v.value=0,L.value=0,W.value=0,K.value=0,A.value=0,m.value=Ve(),E.value=be(),Object.assign(S,ke()),D()},ne=()=>{x.value=0,v.value=2},se=async l=>{if(!N.value)return;c.value=N.value.uid,R.value=l,x.value=1,v.value=2;const t=N.value.uid;await b(t,l)},ae=async()=>{try{Z.value=!0,I.value=await Be(d.onlineGames)}catch(l){ve.firebaseError(!0,l)}finally{Z.value=!1}},b=async(l,t)=>{try{const a=re(d.onlineGames);await Ue(a,{userId:l,opponentId:t,gameStatus:v.value,gameStatusActivator:L.value===0?l:t,activePlayer:A.value===0?l:t,dices:m.value,tiles:E.value,score:{[l]:S[0],[t]:S[1]}}),T.value=a.id,te(!0)}catch(a){ve.firebaseError(!0,a)}},ge=l=>{T.value=l,x.value=1,te()},te=(l=!1)=>{var r;if(!T.value||!N.value)return;const t=N.value.uid;let a=!0;(r=H.value)==null||r.call(H),H.value=$e(re(d.onlineGames,T.value),_=>{if(!(l||A.value===0&&!a)&&(a=!1,_.exists())){const y=_.data(),ye=y.userId===t;c.value=y.userId,R.value=ye?y.opponentId:y.userId,v.value=y.gameStatus,L.value=y.gameStatusActivator===t?0:1,A.value=y.activePlayer===t?0:1,m.value=y.dices,E.value=y.tiles,ye?(S[0]=y.score[y.userId],S[1]=y.score[y.opponentId]):(S[0]=y.score[y.opponentId],S[1]=y.score[y.userId])}})},z=async()=>{try{if(!T.value||!N.value||!R.value)return;const l=N.value.uid;await Fe(re(d.onlineGames,T.value),{gameStatus:v.value,gameStatusActivator:L.value===0?l:R.value,activePlayer:A.value===0?l:R.value,dices:m.value,tiles:E.value,score:{[l]:S[0],[R.value]:S[1]}})}catch(l){ve.firebaseError(!0,l)}},Q=async()=>{try{if(!T.value)return;await Ge(re(d.onlineGames,T.value))}catch(l){ve.firebaseError(!0,l)}};Ie([v,F],()=>{x.value===1&&z()},{deep:!0}),Ie(v,l=>{l===7?ie():x.value!==1&&A.value===1&&oe()});const w=l=>{if(!X.value(l))return;(v.value===2||v.value===5||v.value===6)&&m.value.forEach(a=>{a.selected=!1}),v.value=3;const t=i.diceRollSpeed*1e3;m.value.forEach(a=>{a.selected||(a.isRolling=!0,setTimeout(()=>{a.value=He(6),a.isRolling=!1,m.value.sort((r,_)=>r.value-_.value),!F.value&&v.value!==6&&o()&&u(l)},He(t,t/3)))}),J(Ye)},s=async()=>{for(;F.value;)await new Promise(l=>setTimeout(l,500));return!0},o=()=>{const l=m.value.filter(t=>!t.selected&&!q.value(t.value));return!l.length||il(l)&&l.every(t=>t.value!==6)&&m.value.filter(t=>t.selected).every(t=>t.value!==6)},u=l=>{v.value=6,L.value=l??0,S[L.value].length?K.value=1:K.value=2,n(),E.value.length===0?v.value=7:O()},n=()=>{const l=S[A.value];if(l.length){const t=l.splice(l.length-1,1)[0];E.value.push(t),E.value.sort((a,r)=>a.displayValue-r.displayValue)}E.value.splice(E.value.length-1,1)},g=(l,t)=>{X.value(t)&&!F.value&&v.value===3&&!l.selected&&!q.value(l.value)&&(v.value=4,m.value.filter(a=>a.value===l.value).forEach(a=>{a.selected=!0}),J(Ae))},C=(l,t,a)=>{if(X.value(a)&&(v.value===3||v.value===4)){if(t){const r=S[A.value===0?1:0];r.splice(r.length-1,1)}else E.value=E.value.filter(r=>r.displayValue!==l.displayValue);S[A.value].push(l),J(Ae),E.value.length===0?v.value=7:(v.value=5,L.value=a??0,O())}},O=l=>{(A.value===1||v.value!==6||l)&&(A.value===0?setTimeout(()=>{A.value=1,setTimeout(()=>{v.value=2,L.value=0},1e3)},l?0:p.value*1e3*2):setTimeout(()=>{A.value=0},l?0:p.value*1e3*2))},oe=async()=>{switch(v.value){case 2:{w(1);break}case 3:{await s(),setTimeout(()=>{const l=m.value.filter(a=>!a.selected),t=G.value(0);if(t&&k.value<t.displayValue)for(let a=6;a>=1;a--){const r=l.filter(_=>_.value===a&&!q.value(a));if(r.length){const _=r.length*(a===6?5:a);if(k.value+_===t.displayValue){g(r[0],1);return}}}for(let a=6;a>=1;a--){const r=m.value.find(_=>_.value===a);if(r&&!q.value(a)){g(r,1);return}}},p.value*1e3);break}case 4:{setTimeout(()=>{const l=G.value(0),t=m.value.filter(a=>!a.selected).length;if(!t||k.value>=30){console.log(t?"i am rich":"i can only pick a tile now");for(let a=k.value;a>=21;a--){const r=E.value.find(_=>_.displayValue===a);if(r){C(r,!1,1);return}}t&&w(1)}if(E.value.every(a=>a.displayValue>k.value)&&l&&l.displayValue>k.value)console.log("my score is too low"),w(1);else if(l&&l.displayValue===k.value)console.log("i can steal"),C(l,!0,1);else if(new Set(m.value.filter(a=>a.selected).map(a=>a.value)).size<=3)if(m.value.filter(a=>!a.selected).length<=2){console.log("there aren't that much dices left");const a=E.value.filter(r=>r.displayValue>=k.value-5&&r.displayValue<=k.value).sort((r,_)=>_.displayValue-r.displayValue);a.length?(console.log("i choose the highest score within 5 tiles"),C(a[0],!1,1)):(console.log("i choose to roll again"),w(1))}else console.log("i have nothing to worry about"),w(1);else if(!ue.value)console.log("i am worrying and have no worm yet"),w(1);else{console.log("if i can choose, i choose");const a=E.value.filter(r=>r.displayValue<=k.value).sort((r,_)=>_.displayValue-r.displayValue);a.length?(console.log("i choose the highest score"),C(a[0],!1,1)):(console.log("i choose to roll again"),w(1))}},p.value*1e3);break}default:console.log("DEFAULT",v.value)}},ie=()=>{const l=Y.value(0),t=Y.value(1);l>t?W.value=1:l===t&&Math.max(...S[0].map(a=>a.displayValue))>Math.max(...S[1].map(a=>a.displayValue))?W.value=2:W.value=3,(W.value===1||W.value===2)&&(ce(),J(De)),x.value===1&&Q()},ce=()=>{P({score:Y.value(0)})};return{collections:d,onlineGames:I,onlineGamesLoading:Z,onlineGameId:T,onlineGameCreatorId:c,unsubscribeOnlineGame:H,opponentId:R,gameType:x,gameStatus:v,gameStatusActivator:L,finishStatus:W,loseStatus:K,activePlayer:A,dices:m,tiles:E,score:S,robotSpeed:p,isRolling:F,hasWorm:ue,hasAlreadyChosen:q,canSelectAnyTile:me,canPlay:X,visibleTile:G,selectedDiceTotal:k,totalScore:Y,personalBest:$,highscorePosition:B,$reset:le,start:ne,startOnline:se,continueOnlineGame:ge,fetchOnlineGames:ae,roll:w,hasFinishedRolling:s,hasLostRound:o,loseTurn:u,popLastTile:n,selectDice:g,selectTile:C,passTurn:O,setPreviousHighscores:D,updateRainwormsHighscore:ce,sortHighscores:U}},{persist:{enabled:!0}}),Ve=()=>[{id:1,value:6,selected:!1,isRolling:!1},{id:2,value:6,selected:!1,isRolling:!1},{id:3,value:6,selected:!1,isRolling:!1},{id:4,value:6,selected:!1,isRolling:!1},{id:5,value:6,selected:!1,isRolling:!1},{id:6,value:6,selected:!1,isRolling:!1},{id:7,value:6,selected:!1,isRolling:!1},{id:8,value:6,selected:!1,isRolling:!1}],be=()=>[{displayValue:21,value:1},{displayValue:22,value:1},{displayValue:23,value:1},{displayValue:24,value:1},{displayValue:25,value:2},{displayValue:26,value:2},{displayValue:27,value:2},{displayValue:28,value:2},{displayValue:29,value:3},{displayValue:30,value:3},{displayValue:31,value:3},{displayValue:32,value:3},{displayValue:33,value:4},{displayValue:34,value:4},{displayValue:35,value:4},{displayValue:36,value:4}],fl=je({__name:"GameSettingsDialog",props:Ze({gameId:{}},{isOpen:{type:Boolean,required:!0},isOpenModifiers:{}}),emits:["update:isOpen"],setup(e){const i=e,f=qe(e,"isOpen"),$=he(),{useAudio:B,diceRollSpeed:N}=ee(he()),{robotSpeed:D}=ee(cl()),{doAutocomplete:P}=ee(ll()),U=V(()=>{switch(i.gameId){case M.YAHTZEE:return"v5 (12-12-2024)";case M.RAINWORMS:return"v5 (12-12-2024)";case M.PATIENCE:return"v2 (16-12-2024)";case M.GUESS_THE_WORD:return"v2 (10-01-2025)"}});return Oe(()=>{$.$init(i.gameId)}),(d,p)=>(de(),fe(Le,{isOpen:f.value,title:"Game Settings",description:d.gameId?`Current version: ${U.value}`:"General settings",cancelText:"Close",onCancel:p[4]||(p[4]=I=>f.value=!1)},{default:Ke(()=>[Xe(_e,{name:"useAudio",label:"Audio",modelValue:j(B),"onUpdate:modelValue":p[0]||(p[0]=I=>pe(B)?B.value=I:null)},null,8,["modelValue"]),d.gameId===j(M).PATIENCE?(de(),fe(_e,{key:0,name:"useAutocomplete",label:"Patience autocomplete",modelValue:j(P),"onUpdate:modelValue":p[1]||(p[1]=I=>pe(P)?P.value=I:null)},null,8,["modelValue"])):Se("",!0),d.gameId===j(M).YAHTZEE||d.gameId===j(M).RAINWORMS?(de(),fe(Te,{key:1,name:"diceSpeed",label:"Dice rolling speed",modelValue:j(N),"onUpdate:modelValue":p[2]||(p[2]=I=>pe(N)?N.value=I:null),options:[{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:1.5,label:"1.5 seconds"},{value:2,label:"2 seconds"},{value:3,label:"3 seconds"},{value:4,label:"4 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0),d.gameId===j(M).RAINWORMS?(de(),fe(Te,{key:2,name:"robotSpeed",label:"Rainworms robot speed",modelValue:j(D),"onUpdate:modelValue":p[3]||(p[3]=I=>pe(D)?D.value=I:null),options:[{value:.25,label:"0.25 seconds"},{value:.5,label:"0.5 seconds"},{value:.75,label:"0.75 seconds"},{value:1,label:"1 second"},{value:3,label:"3 seconds"},{value:5,label:"5 seconds"}]},null,8,["modelValue"])):Se("",!0)]),_:1},8,["isOpen","description"]))}});export{ze as C,Qe as D,ul as F,tl as G,ol as L,nl as P,fl as _,al as a,ll as b,Je as c,cl as u};
