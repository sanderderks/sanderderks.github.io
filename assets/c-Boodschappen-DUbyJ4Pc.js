import{b9 as ne,bs as ie,bt as re,bg as ue,bh as I,bu as ce,ax as J,bv as de,bw as pe,b5 as me,be as ge,q as fe,bx as ye,s as A,z as _,C as H,au as B,by as he,bz as ve,bA as te,d as Y,bq as be,U as oe,b as x,g as q,D as T,Y as we,br as Ve,v as De,w as y,f as t,e as C,h as n,ab as le,J as Be,i as O,a7 as ke,a8 as Ce,a9 as _e,t as N,$ as X,aa as xe,a6 as ze,ad as Pe,E as Ue,l as $e,c as W,O as G,I as Le,_ as Ne,ai as ae,aj as $,n as K,k as j}from"../bundle.js";import{_ as se}from"./c-Dialog.vue_vue_type_script_setup_true_lang-BvpiYg2Q.js";import{_ as qe}from"./c-Page.vue_vue_type_script_setup_true_lang-C2l5ciLA.js";import{u as Oe,D as Se,_ as Fe}from"./c-useDateChart-DM47Wxlr.js";class E{id;name;size;category;buyLog;constructor({id:a,name:o,size:c,category:g,buyLog:u}={}){this.id=a??ne(),this.name=o??"",this.size=c??{value:0,unit:""},this.category=g??null,this.buyLog=u??[]}static deserialize(a){return new E({id:a.id,name:a.name,size:a.size,category:a.category??null,buyLog:a.buyLog.map(R.deserialize)})}serialize(){return{id:this.id,name:this.name,size:this.size,category:this.category,buyLog:this.buyLog.map(a=>a.serialize())}}clone(){return new E({id:this.id,name:this.name,size:{...this.size},category:this.category?{...this.category}:null,buyLog:this.buyLog.map(a=>a.clone())})}}class R{date;price;quantity;constructor(a,o,c){this.date=a??new Date,this.price=o??0,this.quantity=c??1}static deserialize(a){return new R(a.date.toDate(),a.price,a.quantity)}serialize(){return{date:ie.fromDate(this.date),price:this.price,quantity:this.quantity}}clone(){return new R(new Date(this.date.getTime()),this.price,this.quantity)}}function je(f){return f.map(Ee)}function Ee(f){return E.deserialize(f)}class Te{async fetchMultiple(a){return re(ue(a,I.BOODSCHAPPEN))}async create(a,o){await ce(J(a,I.BOODSCHAPPEN,o.id),o)}async update(a,o){await de(J(a,I.BOODSCHAPPEN,o.id),{...o})}async delete(a,o){await pe(J(a,I.BOODSCHAPPEN,o))}}const M=new Te,Z=me("boodschappenStore",()=>{const f=ge(),a=fe(),o=ye(),{firebaseUser:c}=A(a),{debug:g}=A(o),u=_([]),D=_(!1),w=_(!1),d=H(()=>u.value.reduce((l,s)=>{const i=s.category;return i&&!l.some(r=>r.id===i.id)&&l.push(i),l},[])),e=H(()=>[{value:null,label:"Geen categorie"},...d.value.map(l=>({value:l,label:l.label}))]);return{boodschappen:u,isFetchLoading:D,isMutationLoading:w,categories:d,categoryOptions:e,$reset:()=>{u.value=[]},fetchBoodschappen:async()=>{if(!c.value){B.error("You must be logged in to fetch products.");return}try{D.value=!0;const l=await M.fetchMultiple(f);u.value=je(l)}catch(l){B.firebaseError(g.value,l)}finally{D.value=!1}},createBoodschap:async l=>{if(!c.value){B.error("You must be logged in to create products.");return}try{w.value=!0,await M.create(f,l.serialize()),he(u,l),B.success("Successfully created product")}catch(s){B.firebaseError(g.value,s)}finally{w.value=!1}},updateBoodschap:async l=>{if(!c.value){B.error("You must be logged in to update products.");return}try{w.value=!0,await M.update(f,l.serialize()),ve(u,l,"id"),B.success("Successfully updated product")}catch(s){B.firebaseError(g.value,s)}finally{w.value=!1}},deleteBoodschap:async l=>{if(!c.value){B.error("You must be logged in to delete products.");return}try{w.value=!0,u.value.find(i=>i.id===l)&&(await M.delete(f,l),u.value=u.value.filter(i=>i.id!==l),B.success("Successfully deleted product"))}catch(s){B.firebaseError(g.value,s)}finally{w.value=!1}}}}),Ae=()=>{const f=Z(),{boodschappen:a}=A(f),o=H(()=>[...a.value].sort((d,e)=>{const m=u(d),p=u(e);return m===null&&p===null?0:m===null?1:p===null?-1:m.getTime()-p.getTime()})),c=d=>[...d.buyLog].filter(e=>Number(e.quantity)>0&&!Number.isNaN(e.date.getTime())).sort((e,m)=>e.date.getTime()-m.date.getTime()),g=d=>c(d).at(-1)?.date??null,u=(d,e=new Date)=>{const m=c(d),p=d.size.value;if(!Number.isFinite(p)||p<=0)return null;if(m.length<2)return null;let k=0,b=0;for(let V=0;V<m.length-1;V++){const S=m[V],U=(m[V+1].date.getTime()-S.date.getTime())/te;!Number.isFinite(S.quantity)||S.quantity<=0||U<=0||(k+=S.quantity*p,b+=U)}if(b<=0||k<=0)return null;const z=k/b;if(!Number.isFinite(z)||z<=0)return null;const l=m.at(-1);if(!l)return null;const s=l.quantity;if(!Number.isFinite(s)||s<=0)return null;const r=s*p/z;if(!Number.isFinite(r)||r<=0)return null;const P=new Date(l.date.getTime()+r*te);return P.getTime()<e.getTime()?e:P};return{sortedBoodschappen:o,getLatestPurchaseDate:g,getProjectedOutOfStockDate:u,getPricePerUnit:d=>{const e=c(d).at(-1);return!e||!Number.isFinite(e.price)||!Number.isFinite(e.quantity)||e.quantity<=0?null:e.price/e.quantity},getPriceIncreasePercentage:d=>{const e=c(d);if(e.length<2)return 0;const m=e.at(-1),p=e.at(-2);return!Number.isFinite(m.price)||!Number.isFinite(m.quantity)||!Number.isFinite(p.price)||!Number.isFinite(p.quantity)||p.quantity===0?0:(m.price/m.quantity-p.price/p.quantity)/(p.price/p.quantity)*100}}},Q=Y({__name:"NumberField",props:Ve({id:{},name:{},label:{},placeholder:{},error:{},rules:{},inputProps:{},labelProps:{},minLength:{},maxLength:{},minValue:{},maxValue:{},compare:{},deleteButton:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const a=f,o=be(f,"modelValue"),c=_("");function g(){o.value=parseFloat(c.value)||0}return oe(o,u=>{c.value=u.toString()},{immediate:!0}),(u,D)=>(x(),q(T,we(a,{modelValue:c.value,"onUpdate:modelValue":D[0]||(D[0]=w=>c.value=w),"input-props":{...a.inputProps,type:"number"},onBlur:g}),null,16,["modelValue","input-props"]))}}),Re={class:"flex flex-col gap-3 w-full md:w-1/2 place-self-center"},Ie={class:"flex gap-3"},Me={class:"w-full flex gap-3"},He={class:"flex gap-5"},Ye={class:"flex flex-col gap-3"},Je=Y({__name:"BoodschapEditDialog",props:{isOpen:{type:Boolean},selectedBoodschap:{}},emits:["close"],setup(f,{emit:a}){const o=f,c=a,g=Z(),{isMutationLoading:u,categories:D,categoryOptions:w}=A(g),d=_(!1),e=De(m());function m(){const s=o.selectedBoodschap?.clone()??new E;return{name:s.name,category:D.value.find(i=>i.id===s.category?.id)??null,size:s.size,buyLog:s.buyLog}}function p(){const s=o.selectedBoodschap?o.selectedBoodschap:new E;Object.assign(s,e),o.selectedBoodschap?g.updateBoodschap(s):g.createBoodschap(s),c("close")}function k(){c("close")}function b(){d.value=!0,e.category={id:ne(),label:""}}function z(){d.value=!1,e.category=null}function l(){e.buyLog.push(new R)}return oe(()=>o.isOpen,s=>{s?Object.assign(e,m()):d.value=!1},{immediate:!0}),(s,i)=>(x(),q(se,{"is-open":f.isOpen,title:o.selectedBoodschap?`Bewerk ${o.selectedBoodschap.name}`:"Product toevoegen",description:"","cancel-text":"Annuleren","confirm-text":o.selectedBoodschap?"Bijwerken":"Toevoegen","confirm-loading":t(u),onConfirm:p,onCancel:k},{default:y(()=>[C("div",Re,[n(T,{name:"name",label:"Naam",modelValue:e.name,"onUpdate:modelValue":i[0]||(i[0]=r=>e.name=r)},null,8,["modelValue"]),C("div",Ie,[d.value?e.category?(x(),q(T,{key:1,class:"w-full",name:"category",label:"Categorie",modelValue:e.category.label,"onUpdate:modelValue":i[2]||(i[2]=r=>e.category.label=r)},null,8,["modelValue"])):Be("",!0):(x(),q(le,{key:0,class:"w-full",name:"category",label:"Categorie",modelValue:e.category,"onUpdate:modelValue":i[1]||(i[1]=r=>e.category=r),options:t(w)},null,8,["modelValue","options"])),d.value?(x(),q(O,{key:3,class:"h-fit place-self-end",icon:"pi pi-times","icon-only":"",variant:"neutral",onClick:z})):(x(),q(O,{key:2,class:"h-fit place-self-end",icon:"pi pi-plus","icon-only":"",variant:"green",onClick:b}))]),C("div",Me,[n(Q,{name:"sizeValue",label:"Formaat",modelValue:e.size.value,"onUpdate:modelValue":i[3]||(i[3]=r=>e.size.value=r)},null,8,["modelValue"]),n(T,{name:"sizeUnit",label:"Eenheid",modelValue:e.size.unit,"onUpdate:modelValue":i[4]||(i[4]=r=>e.size.unit=r)},null,8,["modelValue"])]),i[7]||(i[7]=C("b",null,"Logboek",-1)),n(t(Pe),{ref:"draggable",class:"flex flex-col gap-3",modelValue:e.buyLog,"onUpdate:modelValue":i[5]||(i[5]=r=>e.buyLog=r),itemKey:r=>r.date.toString(),handle:".drag-handle"},{item:y(({element:r,index:P})=>[n(t(ke),null,{default:y(()=>[n(t(Ce),{value:"0"},{default:y(()=>[n(t(_e),{class:"drag-handle"},{default:y(()=>[C("div",He,[i[6]||(i[6]=C("i",{class:"pi pi-arrows-v place-self-center hover:cursor-pointer"},null,-1)),C("p",null,N(t(X)(r.date)),1)])]),_:2},1024),n(t(xe),null,{default:y(()=>[C("div",Ye,[n(ze,{name:`buylog-date-${P}`,label:"Datum",modelValue:r.date,"onUpdate:modelValue":V=>r.date=V,"without-time":""},null,8,["name","modelValue","onUpdate:modelValue"]),n(Q,{name:`buylog-quantity-${P}`,label:"Aantal",modelValue:r.quantity,"onUpdate:modelValue":V=>r.quantity=V},null,8,["name","modelValue","onUpdate:modelValue"]),n(Q,{name:`buylog-price-${P}`,label:"Prijs",modelValue:r.price,"onUpdate:modelValue":V=>r.price=V},null,8,["name","modelValue","onUpdate:modelValue"]),n(O,{variant:"danger",outlined:"",label:"Delete",onClick:V=>e.buyLog.splice(P,1)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","itemKey"]),n(O,{icon:"pi pi-plus","icon-only":"",variant:"green",onClick:l})])]),_:1},8,["is-open","title","confirm-text","confirm-loading"]))}}),We=Y({__name:"ProductPriceChart",props:{product:{}},setup(f){const a=f,o=H(()=>a.product.buyLog.map(u=>({date:u.date,value:u.price/u.quantity}))),{headers:c,filteredData:g}=Oe(o,Se.MONTHS);return(u,D)=>(x(),q(Fe,{headers:t(c),datasets:[{label:"Prijsverloop",fill:!1,borderColor:"orange",yAxisID:"y",tension:.4,data:t(g),spanGaps:!0}]},null,8,["headers","datasets"]))}}),Ge={class:"flex gap-3"},et=Y({__name:"Boodschappen",setup(f){const a=Z(),{categoryOptions:o,isFetchLoading:c,isMutationLoading:g}=A(a),u=Ue(Le),{sortedBoodschappen:D,getLatestPurchaseDate:w,getPricePerUnit:d,getPriceIncreasePercentage:e,getProjectedOutOfStockDate:m}=Ae(),p=u.greaterOrEqual("md"),k=_([]),b=_(null),z=_({name:{value:null,matchMode:"startsWith"},"category.label":{value:null,matchMode:"startsWith"}}),l=_(!1),s=_(!1);function i(U){k.value=[U.data]}function r(){b.value=null,s.value=!0}function P(U){b.value=U,s.value=!0}function V(U){b.value=U,l.value=!0}function S(){b.value=null,s.value=!1}async function ee(){b.value&&await a.deleteBoodschap(b.value.id),l.value=!1,b.value=null}return $e(()=>{a.fetchBoodschappen()}),(U,L)=>(x(),W(G,null,[n(qe,null,{content:y(()=>[n(Ne,{class:"!bg-blue-500 !bg-opacity-35 my-5",title:"De Booschappen Tool",description:"Hiermee hoef je nooit meer een boodschappenlijst te maken. Je voegt alleen toe wanneer je iets koopt, en de tool berekent wanneer je weer iets moet kopen op basis van je aankoopgeschiedenis. Je kunt ook zien hoe de prijzen zich ontwikkelen.","description-props":{class:"text-white mb-5"}},{default:y(()=>[n(t(ae),{value:t(D),expandedRows:k.value,"onUpdate:expandedRows":L[0]||(L[0]=h=>k.value=h),filters:z.value,"onUpdate:filters":L[1]||(L[1]=h=>z.value=h),tableStyle:"min-width: 40rem",loading:t(c),size:t(p)?void 0:"small",filterDisplay:"row",onRowExpand:i},{empty:y(()=>[...L[3]||(L[3]=[j(" Er zijn nog geen producten gevonden. ",-1)])]),expansion:y(({data:h})=>[n(t(ae),{value:[h],size:t(p)?void 0:"small"},{default:y(()=>[n(t($),{class:"!border-0",field:"size.value",header:"Formaat"},{body:y(({data:v})=>[j(N(v.size.value)+" "+N(v.size.unit),1)]),_:2},1024),n(t($),{class:"!border-0",header:"Laatste aankoop"},{body:y(({data:v})=>[t(w)(v)?(x(),W(G,{key:1},[j(N(t(X)(t(w)(v))),1)],64)):(x(),W(G,{key:0},[j(" Nog niet gekocht ")],64))]),_:2},1024),n(t($),{class:"!border-0",header:"Prijs"},{body:y(({data:v})=>[j(N(t(d)(v)?`â‚¬${t(d)(v).toFixed(2)}`:""),1)]),_:2},1024),n(t($),{class:"!border-0",header:"Prijsstijging"},{body:y(({data:v})=>[C("span",{class:K(t(e)(v)>0?"text-red-500":t(e)(v)<0?"text-green-500":"")},N(t(e)(v)?`${t(e)(v).toFixed(2)}%`:""),3)]),_:2},1024)]),_:2},1032,["value","size"]),n(We,{class:K(t(p)?"max-h-[50vh]":"max-w-fit"),product:h},null,8,["class","product"])]),default:y(()=>[n(t($),{class:K({"w-[5rem]":t(p)}),expander:""},null,8,["class"]),n(t($),{field:"name",header:"Naam"},{filter:y(({filterModel:h,filterCallback:v})=>[n(T,{name:"nameFilter",modelValue:h.value,"onUpdate:modelValue":F=>h.value=F,placeholder:"Filter...",style:{"min-width":"5rem"},onInput:v},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n(t($),{field:"category.label",header:"Categorie",showFilterMenu:!1},{filter:y(({filterModel:h,filterCallback:v})=>[n(le,{name:"categoryFilter",modelValue:h.value,"onUpdate:modelValue":[F=>h.value=F,v],options:t(o).map(F=>({...F,value:F.value?.label??null})),placeholder:"Filter...",style:{"min-width":"5rem"}},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),n(t($),{header:"Voorraad aanvullen op"},{body:y(({data:h})=>[j(N(t(m)(h)?t(X)(t(m)(h)):"Onbekend"),1)]),_:1}),n(t($),null,{body:y(({data:h})=>[C("div",Ge,[n(O,{icon:"pi pi-cog","icon-only":"",variant:"neutral",loading:t(g),onClick:v=>P(h)},null,8,["loading","onClick"]),n(O,{icon:"pi pi-trash","icon-only":"",variant:"danger",loading:t(g),onClick:v=>V(h)},null,8,["loading","onClick"])])]),_:1})]),_:1},8,["value","expandedRows","filters","loading","size"]),n(O,{class:"w-fit place-self-center mt-4",icon:"pi pi-plus","icon-only":"",variant:"green",loading:t(g),onClick:r},null,8,["loading"])]),_:1})]),_:1}),n(Je,{"is-open":s.value,selectedBoodschap:b.value,onClose:S},null,8,["is-open","selectedBoodschap"]),n(se,{title:"Product verwijderen","is-open":l.value,description:[b.value?`Weet je zeker dat je het product '${b.value.name}' wilt verwijderen?`:"","Dit kan niet ongedaan worden."],"cancel-text":"Annuleren","confirm-text":"Bevestigen","confirm-props":{variant:"danger",outlined:!0},"confirm-loading":t(g),onConfirm:ee,onCancel:L[2]||(L[2]=h=>l.value=!1)},null,8,["is-open","description","confirm-loading"])],64))}});export{et as default};
