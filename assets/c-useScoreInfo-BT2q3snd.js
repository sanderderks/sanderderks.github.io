import{r as P,c as u,aH as F,k as J,D as M,aU as G,t as S,w as T,aA as O,U as W,g as l,o as s,z as B,i as n,h as r,H as X,_ as w,y as o,W as q,J as C,X as K,O as g,N as H,E as Q,C as Y,A,p as Z}from"../bundle.js";import{_ as ee}from"./c-_plugin-vue_export-helper-DlAUqK2U.js";const te=(i,c)=>{const d=P(0),v=u(()=>F(i)),y=u(()=>(d.value+1)*c),k=u(()=>y.value-c),p=u(()=>d.value>0),m=u(()=>v.value.length>y.value),b=u(()=>v.value.filter((a,_)=>_>=k.value&&_<y.value));return{page:d,perPage:c,visibleData:b,hasPrevious:p,hasNext:m,$reset:()=>{d.value=0}}},se={class:"mt-5 flex flex-col items-center"},oe={class:"w-full overflow-x-auto"},ne={class:"w-full mt-5 text-sm md:text-base text-left text-nowrap"},le={key:0},ae={key:0},re={key:1},ue={key:1},ie={key:0},ce={key:1},de={key:2},ve={key:3},fe={key:2},he={key:3},me={key:4},ge={colspan:"100%"},ye={key:0,class:"mt-5 flex justify-center"},ke=J({__name:"Highscores",props:{gameId:{},unit:{},withBackButton:{type:Boolean},backButtonText:{}},emits:["close"],setup(i){const c=i,d=M(),v=G(),{publicUsers:y}=S(d),{allGameData:k,fetchLoading:p}=S(v),{fetchGameData:m,fetchHighscores:b,fetchScores:x}=v,a=P("highscores"),_=P(),V=u(()=>k.value[c.gameId].gameData[a.value]),{page:D,perPage:j,visibleData:f,hasPrevious:I,hasNext:N,$reset:E}=te(()=>V.value,10),L=h=>{var e;return((e=y.value.find(t=>t.id===h))==null?void 0:e.displayName)??"Unknown"},U=h=>{E(),a.value=h},z=()=>{a.value==="highscores"?b():x()};return T(()=>{v.$init(c.gameId),m(),_.value=setInterval(()=>{m()},1e3*60*5)}),O(()=>{clearInterval(_.value)}),W(a,()=>{k.value[c.gameId].gameData[a.value].length||z()}),(h,e)=>(s(),l("div",se,[B(o(q),{class:"w-full md:w-1/2"},{default:X(()=>[B(w,{class:"w-full",variant:"secondary",outlined:a.value==="scores",label:"Highscores",onClick:e[0]||(e[0]=t=>U("highscores"))},null,8,["outlined"]),B(w,{class:"w-full",variant:"secondary",outlined:a.value==="highscores",label:"All Scores",onClick:e[1]||(e[1]=t=>U("scores"))},null,8,["outlined"])]),_:1}),n("div",oe,[n("table",ne,[o(f).length?(s(),l("thead",le,[n("tr",null,[e[5]||(e[5]=n("th",null,"Rank",-1)),e[6]||(e[6]=n("th",null,"User",-1)),e[7]||(e[7]=n("th",null,"Score",-1)),o(f).length&&o(f).some(t=>t.difficulty)?(s(),l("th",ae,"Difficulty")):r("",!0),e[8]||(e[8]=n("th",null,"Date",-1)),o(f).length&&o(f).some(t=>t.bonus)?(s(),l("th",re,"Bonus")):r("",!0)])])):r("",!0),o(f).length?(s(),l("tbody",ue,[(s(!0),l(C,null,K(o(f),(t,R)=>(s(),l("tr",null,[n("th",null,g(R+1+o(D)*o(j)),1),n("th",null,g(L(t.userId??t.id)),1),n("td",null,[H(g(t.score)+" ",1),h.unit?(s(),l(C,{key:0},[H(g(h.unit),1),t.score!==1?(s(),l(C,{key:0},[H("s")],64)):r("",!0)],64)):r("",!0)]),t.difficulty?(s(),l("td",ie,g(t.difficulty),1)):o(f).some($=>$.difficulty)?(s(),l("td",ce)):r("",!0),n("td",null,g(o(Q)(t.date)),1),t.bonus?(s(),l("td",de,g(t.bonus),1)):o(f).some($=>$.bonus)?(s(),l("td",ve)):r("",!0)]))),256))])):o(p)?(s(),l("tbody",fe,e[9]||(e[9]=[n("tr",null,[n("th",null,"Loading highscores...")],-1)]))):(s(),l("tbody",he,[n("tr",null,[n("th",null,"There are no "+g(a.value==="highscores"?"highscores":"scores")+" yet.",1)])])),o(I)||o(N)?(s(),l("tfoot",me,[n("tr",null,[n("td",ge,[n("div",{class:Y(["w-full p-2 flex",[o(I)?"justify-between":"justify-end"]])},[o(I)?(s(),A(w,{key:0,class:"w-fit",label:"Previous",variant:"neutral",onClick:e[2]||(e[2]=t=>D.value-=1)})):r("",!0),o(N)?(s(),A(w,{key:1,class:"w-fit",label:"Next",variant:"neutral",onClick:e[3]||(e[3]=t=>D.value+=1)})):r("",!0)],2)])])])):r("",!0)])]),h.withBackButton?(s(),l("div",ye,[B(w,{class:"w-full md:w-1/2",variant:"neutral",label:h.backButtonText??"Go Back",onClick:e[4]||(e[4]=t=>h.$emit("close"))},null,8,["label"])])):r("",!0)]))}}),_e=ee(ke,[["__scopeId","data-v-ddf85469"]]),we=i=>{const c=Z(),d=G(),{allGameData:v,highscorePosition:y,personalBest:k}=S(d),{firebaseUser:p}=S(c),m=u(()=>p.value?y.value:null),b=u(()=>{if(!i)return!1;const a=v.value[i].previousHighscorePosition;return m.value&&a?a>m.value:!1}),x=u(()=>{if(!i)return!1;const a=v.value[i].previousPersonalBest;return p.value&&a?a<k.value:!1});return T(()=>{d.$init(i)}),{currentHighscorePosition:m,hasImprovedHighscorePosition:b,hasImprovedPersonalBest:x}};export{_e as H,we as u};
