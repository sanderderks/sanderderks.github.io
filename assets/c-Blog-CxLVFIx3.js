import{_ as ie}from"./c-Page.vue_vue_type_script_setup_true_lang-abQPoI-C.js";import{X as re,Y as de,b as t,c as n,$ as P,r as E,J as f,e as l,d as G,q as W,a as Y,al as ce,s as x,l as K,am as ue,an as pe,R as I,f as s,h as v,g as u,B as fe,j as Z,C as U,i as O,u as ee,G as te,ao as se,z as D,P as R,w as N,ap as z,n as A,Q as q,aq as ve,ar as H,t as ge,_ as J,as as me,at as ye,a8 as Q,U as oe,W as he,au as V}from"../bundle.js";import{_ as be}from"./c-BackButton.vue_vue_type_script_setup_true_lang-oHqvxMiV.js";import{_ as ae,b as X,u as ke,a as $e}from"./c-BlogPostDialog.vue_vue_type_script_setup_true_lang-PVZSr2ST.js";import{_ as we}from"./c-Dialog.vue_vue_type_script_setup_true_lang-DI3Y1UAH.js";import"./c-useUsers-CxbPlCdU.js";var xe=`
    .p-card {
        background: dt('card.background');
        color: dt('card.color');
        box-shadow: dt('card.shadow');
        border-radius: dt('card.border.radius');
        display: flex;
        flex-direction: column;
    }

    .p-card-caption {
        display: flex;
        flex-direction: column;
        gap: dt('card.caption.gap');
    }

    .p-card-body {
        padding: dt('card.body.padding');
        display: flex;
        flex-direction: column;
        gap: dt('card.body.gap');
    }

    .p-card-title {
        font-size: dt('card.title.font.size');
        font-weight: dt('card.title.font.weight');
    }

    .p-card-subtitle {
        color: dt('card.subtitle.color');
    }
`,Ce={root:"p-card p-component",header:"p-card-header",body:"p-card-body",caption:"p-card-caption",title:"p-card-title",subtitle:"p-card-subtitle",content:"p-card-content",footer:"p-card-footer"},Se=re.extend({name:"card",style:xe,classes:Ce}),Pe={name:"BaseCard",extends:de,style:Se,provide:function(){return{$pcCard:this,$parentInstance:this}}},le={name:"Card",extends:Pe,inheritAttrs:!1};function Be(e,o,h,C,a,r){return t(),n("div",P({class:e.cx("root")},e.ptmi("root")),[e.$slots.header?(t(),n("div",P({key:0,class:e.cx("header")},e.ptm("header")),[E(e.$slots,"header")],16)):f("",!0),l("div",P({class:e.cx("body")},e.ptm("body")),[e.$slots.title||e.$slots.subtitle?(t(),n("div",P({key:0,class:e.cx("caption")},e.ptm("caption")),[e.$slots.title?(t(),n("div",P({key:0,class:e.cx("title")},e.ptm("title")),[E(e.$slots,"title")],16)):f("",!0),e.$slots.subtitle?(t(),n("div",P({key:1,class:e.cx("subtitle")},e.ptm("subtitle")),[E(e.$slots,"subtitle")],16)):f("",!0)],16)):f("",!0),l("div",P({class:e.cx("content")},e.ptm("content")),[E(e.$slots,"content")],16),e.$slots.footer?(t(),n("div",P({key:1,class:e.cx("footer")},e.ptm("footer")),[E(e.$slots,"footer")],16)):f("",!0)],16)],16)}le.render=Be;const Le={key:0,class:"flex justify-center mt-5"},_e={key:1,class:"flex flex-col gap-3"},Ie=G({__name:"BlogDetails",setup(e){const o=fe(),h=Z(),C=W(),a=Y(),r=ce(),{isLoggedIn:b}=x(C),{blogPosts:k,isBlogPostsFetchLoading:$}=x(a),{fetchBlogPost:B}=a,i=U(()=>o.params.postId);return K(async()=>{if(r.unread=[],i.value)if(k.value.data.single?.id!==i.value){const g=await B(i.value);if(ue(g)&&g===pe.PERMISSION_DENIED&&!b.value){h.push({name:I.LOGIN,params:{redirect:JSON.stringify({name:I.BLOG_DETAILS,params:{postId:i.value}})}});return}}else k.value.data.single}),(g,d)=>s($)?(t(),n("div",Le,[v(O,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:"",label:"Loading..."})])):(t(),n("div",_e,[v(be,{"back-route":s(I).BLOG,label:"Back to other posts"},null,8,["back-route"]),s(k).data.single?(t(),u(ae,{key:0,post:s(k).data.single},null,8,["post"])):f("",!0)]))}}),Oe={class:"flex gap-3"},De={class:"min-h-[50vh] flex flex-col"},Te={class:"flex justify-between h-fit mt-2 gap-2"},Ee={class:"flex flex-wrap gap-3"},Ue={class:"relative mt-5 min-h-[20vh] max-h-screen flex flex-col justify-end"},Re={class:"relative min-h-[20vh] max-h-full flex-grow"},Ne={class:"flex flex-col gap-1"},Ae={class:"flex justify-center mt-5"},Ge={class:"flex justify-center mt-3"},Me=G({__name:"BlogPostOverview",props:{post:{}},setup(e){const o=e,h=ee(),C=W(),a=te(),r=Y(),b=se(),{routeLoading:k,routeLoadingId:$}=x(h),{publicUsers:B}=x(a),{isOwner:i}=x(C),{deleteBlogPost:g}=r,d=D(!1),L=D(o.post.archived),_=U(()=>o.post.allowedUserIds?.length?B.value.filter(c=>o.post.allowedUserIds?.includes(c.id)):[]),T=U(()=>{const c=Q(o.post.date);return o.post.dateUpdated?c+` - updated ${Q(o.post.dateUpdated)}`:c}),M=U(()=>{const c=[];return o.post.datePinned&&c.push({value:"Pinned",severity:"success",rounded:!1}),o.post.locked&&c.push({value:"Locked",severity:"danger",rounded:!1,icon:"pi pi-lock"}),o.post.archived&&c.push({value:"Archived",severity:"warning",rounded:!1,icon:"pi pi-file-excel"}),c}),p=()=>{b.openWith(o.post)},m=()=>{d.value=!0},S=async()=>{await g(o.post.id)&&(d.value=!1)},j=()=>{const c=document.createElement("textarea"),{protocol:y,hostname:w,port:F}=window.location,ne=`${y}//${w}`+(w==="localhost"?`:${F}`:"");c.value=`${ne}#${me.BLOG.path}/${o.post.id}`,document.body.appendChild(c),c.select(),document.execCommand("copy"),document.body.removeChild(c),ye.success("Copied link!")};return(c,y)=>(t(),n(R,null,[v(J,{id:e.post.id,class:A([{"min-h-[50vh]":!L.value},"border-4 border-transparent","!rounded-primary",e.post.colorSecondary||e.post.colorPrimary||"bg-secondary-900",e.post.opacitySecondary||"bg-opacity-50"]),title:e.post.title,subTitle:T.value,tags:M.value,isCollapsed:L.value,clickable:"",route:{name:s(I).BLOG_DETAILS,params:{postId:e.post.id}}},{right:N(()=>[l("div",Oe,[L.value?s(i)?(t(),u(X,{key:1,onEditClicked:p,onDeleteClicked:m})):f("",!0):(t(),u(O,{key:0,class:"border-none h-fit",variant:"neutral",icon:"pi pi-copy",onClick:j}))])]),default:N(()=>[l("div",De,[l("div",Te,[l("div",Ee,[_.value.length?(t(),n(R,{key:0},[v(s(z),{class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:_.value[0]?.displayName,rounded:""},null,8,["label"]),_.value.length>1?(t(),u(s(z),{key:0,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",icon:"pi pi-user",label:"You",rounded:""})):f("",!0),_.value.length>2?(t(),u(s(z),{key:1,class:"h-fit !p-0 !px-4 !py-1 !bg-red-800 !bg-opacity-50",label:`${_.value.length-2} others`,rounded:""},null,8,["label"])):f("",!0)],64)):f("",!0)]),s(i)?(t(),n("div",{key:0,class:A(["flex justify-end ms-5",e.post.allowedUserIds?.length?"flex-col md:flex-row":"flex-row"])},[v(X,{onEditClicked:p,onDeleteClicked:m})],2)):f("",!0)]),l("div",Ue,[y[3]||(y[3]=l("div",{class:"absolute inset-0 rounded-primary bg-gradient-to-t from-neutral-500 to-transparent"},null,-1)),l("div",Re,[v(s(le),{class:A(["z-10 min-h-[20vh] p-5 text-neutral-300",e.post.colorPrimary,e.post.opacityPrimary||"bg-opacity-50"])},{content:N(()=>[l("div",Ne,[(t(!0),n(R,null,q(e.post.content.filter((w,F)=>F<2),w=>(t(),u(ve,{key:w.id,class:"max-h-[150px] overflow-hidden",post:e.post,block:w},null,8,["post","block"]))),128))])]),_:1},8,["class"])])]),l("div",Ae,[v(O,{class:"w-full md:w-1/2",variant:"neutral",label:"Read more",loading:s(k)===s(I).BLOG_DETAILS&&s($)===e.post.id,onClick:y[0]||(y[0]=w=>s(H).push({name:s(I).BLOG_DETAILS,params:{postId:e.post.id}}))},null,8,["loading"])]),l("div",Ge,[l("p",{class:A(e.post.reactions.length?"text-yellow-400 hover:text-yellow-500 cursor-pointer":"text-neutral-200"),onClick:y[1]||(y[1]=w=>s(H).push({name:s(I).BLOG_DETAILS,params:{postId:e.post.id}}))},ge(e.post.reactions.length)+" replies ",3)])])]),_:1},8,["id","class","title","subTitle","tags","isCollapsed","route"]),v(we,{title:"Delete Post",isOpen:d.value,description:[` Are you sure you want to delete this post called '${e.post.title}'?`,"This cannot be undone."],"confirm-text":"Confirm","confirm-props":{variant:"danger",outlined:!0},onConfirm:S,onCancel:y[2]||(y[2]=w=>d.value=!1)},null,8,["isOpen","description"])],64))}}),je={class:"w-full grid gap-4 md:gap-10 xl:gap-20"},Fe={key:2,class:"w-full flex justify-center mt-5"},ze=G({__name:"BlogPosts",props:{single:{type:Boolean}},setup(e){const o=W(),h=Y(),C=se(),{blogPosts:a,visibleBlogPosts:r,isBlogPostsFetchLoading:b}=x(h),{firebaseUser:k,isLoggedIn:$,isOwner:B}=x(o),{fetchBlogPosts:i}=h;ke();const g=D(),d=D(),L=D(),_=()=>{C.openWith(null)},T=async p=>{a.value.visibility!==p&&(a.value.data[p].length||await i({visibility:p}),a.value.visibility=p,a.value.isLastPage=!1,V(g.value))},M=async()=>{const p=r.value.length;await i(),r.value[p]&&V(d.value[p])};return K(()=>{a.value.loadedOnce||($.value?T("private"):a.value.visibility!=="public"&&T("public"),a.value.loadedOnce=!0)}),oe(()=>d.value?.length,()=>{if(d.value?.length&&L.value){const p=r.value.find(m=>m.id===L.value);if(p){const m=r.value.indexOf(p);V(d.value[m]),L.value=void 0}}}),(p,m)=>(t(),n("div",{ref_key:"container",ref:g,class:"flex flex-col gap-5 items-center"},[s(B)?(t(),u(O,{key:0,class:"w-full md:w-1/2",variant:"tertiary",label:"New Post",onClick:_})):f("",!0),s($)?(t(),u(s(he),{key:1,class:"w-full md:w-1/2"},{default:N(()=>[v(O,{class:"w-full",variant:"secondary",outlined:s(a).visibility!=="public",loading:s(a).isLoading.public.fetch,label:"Public Posts",onClick:m[0]||(m[0]=S=>T("public"))},null,8,["outlined","loading"]),v(O,{class:"w-full",variant:"secondary",outlined:s(a).visibility!=="private",loading:s(a).isLoading.private.fetch,label:"Private Posts",onClick:m[1]||(m[1]=S=>T("private"))},null,8,["outlined","loading"])]),_:1})):f("",!0),l("div",je,[s(r).length?(t(!0),n(R,{key:0},q(s(r),(S,j)=>(t(),n("div",{key:S.id,ref_for:!0,ref_key:"posts",ref:d},[j===0||S.datePinned?(t(),u(ae,{key:0,post:S},null,8,["post"])):(t(),u(Me,{key:1,post:S},null,8,["post"]))]))),128)):s(b)?(t(),u(J,{key:1,class:"!bg-neutral-600 !bg-opacity-40 !rounded-primary",title:"Loading..."})):(t(),u(J,{key:2,class:"!bg-red-900 !bg-opacity-40 !rounded-primary",title:"No posts"}))]),s(a).isLastPage?f("",!0):(t(),n("div",Fe,[v(O,{class:"w-full md:w-1/2 xl:w-1/4",outlined:"",loading:s(r).length>0&&s(b),label:"Load more posts",onClick:M},null,8,["loading"])]))],512))}}),Ve={class:"grid mt-10 md:mt-15"},Je={class:"grid justify-center"},We={class:"text-lg md:text-xl text-white"},Ye=["innerHTML"],qe={class:"grid my-5 xl:px-20"},tt=G({__name:"Blog",setup(e){const o=Z(),h=ee(),C=te(),{menuItems:a,content:r}=x(h),{publicUser:b}=x(C),k=D(),$=D(o.currentRoute.value.params.postId),B=U(()=>b.value?[...r.value.blogDescriptionUser.map(i=>i.replace("%USER%",b.value.displayName||"Unknown user")),...a.value.find(i=>i.id==="nfNQM4SMESU2VOkJtcgY")?.description||[]]:r.value.blogDescriptionGuest);return oe(o.currentRoute,i=>{$.value=i.params.postId}),(i,g)=>(t(),u(ie,null,{content:N(()=>[l("div",Ve,[l("div",Je,[(t(!0),n(R,null,q(B.value,d=>(t(),n("h1",We,[l("span",{innerHTML:d},null,8,Ye)]))),256))]),l("div",qe,[$.value?(t(),u(Ie,{key:0})):(t(),u(ze,{key:1})),v($e,{onScrollToUpdated:g[0]||(g[0]=d=>k.value=d)})])])]),_:1}))}});export{tt as default};
